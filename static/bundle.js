(function e(t,r,i){function n(o,s){if(!r[o]){if(!t[o]){var h=typeof require=="function"&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return n(r?r:e)},u,u.exports,e,t,r,i)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<i.length;o++)n(i[o]);return n})({1:[function(e,t,r){var i=e("./three");var n=e("three-orbit-viewer")(i);var a=e("touch-position")();var o=e("gl-vignette-background");var s=e("gl-checker-background");e("domready")(function(){a[0]=window.innerWidth/2;var e=n({clearColor:0,clearAlpha:1,fov:65,position:new i.Vector3(1,1,-2)});e.renderer.autoClear=false;var t=e.renderer.getContext();var r=[o,s].map(function(e){return e(t)});var h=new i.BoxGeometry(1,1,1);var l=new i.MeshBasicMaterial({wireframe:true,color:5143751});var u=new i.Mesh(h,l);e.scene.add(u);var f=0;e.on("tick",function(i){f+=i/1e3;u.rotation.y=Math.sin(f*.15);e.renderer.clear();var n=a[0]/window.innerWidth;t.disable(t.CULL_FACE);t.disable(t.DEPTH_TEST);t.enable(t.SCISSOR_TEST);r.forEach(function(e,r){var i=t.drawingBufferWidth,a=t.drawingBufferHeight,o=i*n,s=r===0?0:o,h=r===0?o:i;t.scissor(s,0,h,a);e.draw()});t.disable(t.SCISSOR_TEST);t.enable(t.DEPTH_TEST);t.enable(t.CULL_FACE);e.renderer.resetGLState()})})},{"./three":119,domready:10,"gl-checker-background":11,"gl-vignette-background":71,"three-orbit-viewer":104,"touch-position":115}],2:[function(e,t,r){var i=e("base64-js");var n=e("ieee754");var a=e("is-array");r.Buffer=s;r.SlowBuffer=s;r.INSPECT_MAX_BYTES=50;s.poolSize=8192;var o=1073741823;s.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0);var t=new Uint8Array(e);t.foo=function(){return 42};return 42===t.foo()&&typeof t.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(r){return false}}();function s(e,t,r){if(!(this instanceof s))return new s(e,t,r);var i=typeof e;var n;if(i==="number")n=e>0?e>>>0:0;else if(i==="string"){if(t==="base64")e=L(e);n=s.byteLength(e,t)}else if(i==="object"&&e!==null){if(e.type==="Buffer"&&a(e.data))e=e.data;n=+e.length>0?Math.floor(+e.length):0}else throw new TypeError("must start with number, buffer, array or string");if(this.length>o)throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+o.toString(16)+" bytes");var h;if(s.TYPED_ARRAY_SUPPORT){h=s._augment(new Uint8Array(n))}else{h=this;h.length=n;h._isBuffer=true}var l;if(s.TYPED_ARRAY_SUPPORT&&typeof e.byteLength==="number"){h._set(e)}else if(P(e)){if(s.isBuffer(e)){for(l=0;l<n;l++)h[l]=e.readUInt8(l)}else{for(l=0;l<n;l++)h[l]=(e[l]%256+256)%256}}else if(i==="string"){h.write(e,0,t)}else if(i==="number"&&!s.TYPED_ARRAY_SUPPORT&&!r){for(l=0;l<n;l++){h[l]=0}}return h}s.isBuffer=function(e){return!!(e!=null&&e._isBuffer)};s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");var r=e.length;var i=t.length;for(var n=0,a=Math.min(r,i);n<a&&e[n]===t[n];n++){}if(n!==a){r=e[n];i=t[n]}if(r<i)return-1;if(i<r)return 1;return 0};s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};s.concat=function(e,t){if(!a(e))throw new TypeError("Usage: Buffer.concat(list[, length])");if(e.length===0){return new s(0)}else if(e.length===1){return e[0]}var r;if(t===undefined){t=0;for(r=0;r<e.length;r++){t+=e[r].length}}var i=new s(t);var n=0;for(r=0;r<e.length;r++){var o=e[r];o.copy(i,n);n+=o.length}return i};s.byteLength=function(e,t){var r;e=e+"";switch(t||"utf8"){case"ascii":case"binary":case"raw":r=e.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=e.length*2;break;case"hex":r=e.length>>>1;break;case"utf8":case"utf-8":r=F(e).length;break;case"base64":r=B(e).length;break;default:r=e.length}return r};s.prototype.length=undefined;s.prototype.parent=undefined;s.prototype.toString=function(e,t,r){var i=false;t=t>>>0;r=r===undefined||r===Infinity?this.length:r>>>0;if(!e)e="utf8";if(t<0)t=0;if(r>this.length)r=this.length;if(r<=t)return"";while(true){switch(e){case"hex":return y(this,t,r);case"utf8":case"utf-8":return m(this,t,r);case"ascii":return v(this,t,r);case"binary":return g(this,t,r);case"base64":return p(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();i=true}}};s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return s.compare(this,e)===0};s.prototype.inspect=function(){var e="";var t=r.INSPECT_MAX_BYTES;if(this.length>0){e=this.toString("hex",0,t).match(/.{2}/g).join(" ");if(this.length>t)e+=" ... "}return"<Buffer "+e+">"};s.prototype.compare=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return s.compare(this,e)};s.prototype.get=function(e){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(e)};s.prototype.set=function(e,t){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(e,t)};function h(e,t,r,i){r=Number(r)||0;var n=e.length-r;if(!i){i=n}else{i=Number(i);if(i>n){i=n}}var a=t.length;if(a%2!==0)throw new Error("Invalid hex string");if(i>a/2){i=a/2}for(var o=0;o<i;o++){var s=parseInt(t.substr(o*2,2),16);if(isNaN(s))throw new Error("Invalid hex string");e[r+o]=s}return o}function l(e,t,r,i){var n=V(F(t),e,r,i);return n}function u(e,t,r,i){var n=V(U(t),e,r,i);return n}function f(e,t,r,i){return u(e,t,r,i)}function c(e,t,r,i){var n=V(B(t),e,r,i);return n}function d(e,t,r,i){var n=V(k(t),e,r,i);return n}s.prototype.write=function(e,t,r,i){if(isFinite(t)){if(!isFinite(r)){i=r;r=undefined}}else{var n=i;i=t;t=r;r=n}t=Number(t)||0;var a=this.length-t;if(!r){r=a}else{r=Number(r);if(r>a){r=a}}i=String(i||"utf8").toLowerCase();var o;switch(i){case"hex":o=h(this,e,t,r);break;case"utf8":case"utf-8":o=l(this,e,t,r);break;case"ascii":o=u(this,e,t,r);break;case"binary":o=f(this,e,t,r);break;case"base64":o=c(this,e,t,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=d(this,e,t,r);break;default:throw new TypeError("Unknown encoding: "+i)}return o};s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function p(e,t,r){if(t===0&&r===e.length){return i.fromByteArray(e)}else{return i.fromByteArray(e.slice(t,r))}}function m(e,t,r){var i="";var n="";r=Math.min(e.length,r);for(var a=t;a<r;a++){if(e[a]<=127){i+=N(n)+String.fromCharCode(e[a]);n=""}else{n+="%"+e[a].toString(16)}}return i+N(n)}function v(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;n++){i+=String.fromCharCode(e[n])}return i}function g(e,t,r){return v(e,t,r)}function y(e,t,r){var i=e.length;if(!t||t<0)t=0;if(!r||r<0||r>i)r=i;var n="";for(var a=t;a<r;a++){n+=D(e[a])}return n}function x(e,t,r){var i=e.slice(t,r);var n="";for(var a=0;a<i.length;a+=2){n+=String.fromCharCode(i[a]+i[a+1]*256)}return n}s.prototype.slice=function(e,t){var r=this.length;e=~~e;t=t===undefined?r:~~t;if(e<0){e+=r;if(e<0)e=0}else if(e>r){e=r}if(t<0){t+=r;if(t<0)t=0}else if(t>r){t=r}if(t<e)t=e;if(s.TYPED_ARRAY_SUPPORT){return s._augment(this.subarray(e,t))}else{var i=t-e;var n=new s(i,undefined,true);for(var a=0;a<i;a++){n[a]=this[a+e]}return n}};function _(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUInt8=function(e,t){if(!t)_(e,1,this.length);return this[e]};s.prototype.readUInt16LE=function(e,t){if(!t)_(e,2,this.length);return this[e]|this[e+1]<<8};s.prototype.readUInt16BE=function(e,t){if(!t)_(e,2,this.length);return this[e]<<8|this[e+1]};s.prototype.readUInt32LE=function(e,t){if(!t)_(e,4,this.length);return(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};s.prototype.readUInt32BE=function(e,t){if(!t)_(e,4,this.length);return this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};s.prototype.readInt8=function(e,t){if(!t)_(e,1,this.length);if(!(this[e]&128))return this[e];return(255-this[e]+1)*-1};s.prototype.readInt16LE=function(e,t){if(!t)_(e,2,this.length);var r=this[e]|this[e+1]<<8;return r&32768?r|4294901760:r};s.prototype.readInt16BE=function(e,t){if(!t)_(e,2,this.length);var r=this[e+1]|this[e]<<8;return r&32768?r|4294901760:r};s.prototype.readInt32LE=function(e,t){if(!t)_(e,4,this.length);return this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};s.prototype.readInt32BE=function(e,t){if(!t)_(e,4,this.length);return this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};s.prototype.readFloatLE=function(e,t){if(!t)_(e,4,this.length);return n.read(this,e,true,23,4)};s.prototype.readFloatBE=function(e,t){if(!t)_(e,4,this.length);return n.read(this,e,false,23,4)};s.prototype.readDoubleLE=function(e,t){if(!t)_(e,8,this.length);return n.read(this,e,true,52,8)};s.prototype.readDoubleBE=function(e,t){if(!t)_(e,8,this.length);return n.read(this,e,false,52,8)};function b(e,t,r,i,n,a){if(!s.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>n||t<a)throw new TypeError("value is out of bounds");if(r+i>e.length)throw new TypeError("index out of range")}s.prototype.writeUInt8=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,1,255,0);if(!s.TYPED_ARRAY_SUPPORT)e=Math.floor(e);this[t]=e;return t+1};function w(e,t,r,i){if(t<0)t=65535+t+1;for(var n=0,a=Math.min(e.length-r,2);n<a;n++){e[r+n]=(t&255<<8*(i?n:1-n))>>>(i?n:1-n)*8}}s.prototype.writeUInt16LE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,2,65535,0);if(s.TYPED_ARRAY_SUPPORT){this[t]=e;this[t+1]=e>>>8}else w(this,e,t,true);return t+2};s.prototype.writeUInt16BE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,2,65535,0);if(s.TYPED_ARRAY_SUPPORT){this[t]=e>>>8;this[t+1]=e}else w(this,e,t,false);return t+2};function M(e,t,r,i){if(t<0)t=4294967295+t+1;for(var n=0,a=Math.min(e.length-r,4);n<a;n++){e[r+n]=t>>>(i?n:3-n)*8&255}}s.prototype.writeUInt32LE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,4,4294967295,0);if(s.TYPED_ARRAY_SUPPORT){this[t+3]=e>>>24;this[t+2]=e>>>16;this[t+1]=e>>>8;this[t]=e}else M(this,e,t,true);return t+4};s.prototype.writeUInt32BE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,4,4294967295,0);if(s.TYPED_ARRAY_SUPPORT){this[t]=e>>>24;this[t+1]=e>>>16;this[t+2]=e>>>8;this[t+3]=e}else M(this,e,t,false);return t+4};s.prototype.writeInt8=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,1,127,-128);if(!s.TYPED_ARRAY_SUPPORT)e=Math.floor(e);if(e<0)e=255+e+1;this[t]=e;return t+1};s.prototype.writeInt16LE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,2,32767,-32768);if(s.TYPED_ARRAY_SUPPORT){this[t]=e;this[t+1]=e>>>8}else w(this,e,t,true);return t+2};s.prototype.writeInt16BE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,2,32767,-32768);if(s.TYPED_ARRAY_SUPPORT){this[t]=e>>>8;this[t+1]=e}else w(this,e,t,false);return t+2};s.prototype.writeInt32LE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,4,2147483647,-2147483648);if(s.TYPED_ARRAY_SUPPORT){this[t]=e;this[t+1]=e>>>8;this[t+2]=e>>>16;this[t+3]=e>>>24}else M(this,e,t,true);return t+4};s.prototype.writeInt32BE=function(e,t,r){e=+e;t=t>>>0;if(!r)b(this,e,t,4,2147483647,-2147483648);if(e<0)e=4294967295+e+1;if(s.TYPED_ARRAY_SUPPORT){this[t]=e>>>24;this[t+1]=e>>>16;this[t+2]=e>>>8;this[t+3]=e}else M(this,e,t,false);return t+4};function T(e,t,r,i,n,a){if(t>n||t<a)throw new TypeError("value is out of bounds");if(r+i>e.length)throw new TypeError("index out of range")}function S(e,t,r,i,a){if(!a)T(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38);n.write(e,t,r,i,23,4);return r+4}s.prototype.writeFloatLE=function(e,t,r){return S(this,e,t,true,r)};s.prototype.writeFloatBE=function(e,t,r){return S(this,e,t,false,r)};function E(e,t,r,i,a){if(!a)T(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308);n.write(e,t,r,i,52,8);return r+8}s.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,true,r)};s.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,false,r)};s.prototype.copy=function(e,t,r,i){var n=this;if(!r)r=0;if(!i&&i!==0)i=this.length;if(!t)t=0;if(i===r)return;if(e.length===0||n.length===0)return;if(i<r)throw new TypeError("sourceEnd < sourceStart");if(t<0||t>=e.length)throw new TypeError("targetStart out of bounds");if(r<0||r>=n.length)throw new TypeError("sourceStart out of bounds");if(i<0||i>n.length)throw new TypeError("sourceEnd out of bounds");if(i>this.length)i=this.length;if(e.length-t<i-r)i=e.length-t+r;var a=i-r;if(a<1e3||!s.TYPED_ARRAY_SUPPORT){for(var o=0;o<a;o++){e[o+t]=this[o+r]}}else{e._set(this.subarray(r,r+a),t)}};s.prototype.fill=function(e,t,r){if(!e)e=0;if(!t)t=0;if(!r)r=this.length;if(r<t)throw new TypeError("end < start");if(r===t)return;if(this.length===0)return;if(t<0||t>=this.length)throw new TypeError("start out of bounds");if(r<0||r>this.length)throw new TypeError("end out of bounds");var i;if(typeof e==="number"){for(i=t;i<r;i++){this[i]=e}}else{var n=F(e.toString());var a=n.length;for(i=t;i<r;i++){this[i]=n[i%a]}}return this};s.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(s.TYPED_ARRAY_SUPPORT){return new s(this).buffer}else{var e=new Uint8Array(this.length);for(var t=0,r=e.length;t<r;t+=1){e[t]=this[t]}return e.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var A=s.prototype;s._augment=function(e){e.constructor=s;e._isBuffer=true;e._get=e.get;e._set=e.set;e.get=A.get;e.set=A.set;e.write=A.write;e.toString=A.toString;e.toLocaleString=A.toString;e.toJSON=A.toJSON;e.equals=A.equals;e.compare=A.compare;e.copy=A.copy;e.slice=A.slice;e.readUInt8=A.readUInt8;e.readUInt16LE=A.readUInt16LE;e.readUInt16BE=A.readUInt16BE;e.readUInt32LE=A.readUInt32LE;e.readUInt32BE=A.readUInt32BE;e.readInt8=A.readInt8;e.readInt16LE=A.readInt16LE;e.readInt16BE=A.readInt16BE;e.readInt32LE=A.readInt32LE;e.readInt32BE=A.readInt32BE;e.readFloatLE=A.readFloatLE;e.readFloatBE=A.readFloatBE;e.readDoubleLE=A.readDoubleLE;e.readDoubleBE=A.readDoubleBE;e.writeUInt8=A.writeUInt8;e.writeUInt16LE=A.writeUInt16LE;e.writeUInt16BE=A.writeUInt16BE;e.writeUInt32LE=A.writeUInt32LE;e.writeUInt32BE=A.writeUInt32BE;e.writeInt8=A.writeInt8;e.writeInt16LE=A.writeInt16LE;e.writeInt16BE=A.writeInt16BE;e.writeInt32LE=A.writeInt32LE;e.writeInt32BE=A.writeInt32BE;e.writeFloatLE=A.writeFloatLE;e.writeFloatBE=A.writeFloatBE;e.writeDoubleLE=A.writeDoubleLE;e.writeDoubleBE=A.writeDoubleBE;e.fill=A.fill;e.inspect=A.inspect;e.toArrayBuffer=A.toArrayBuffer;return e};var C=/[^+\/0-9A-z]/g;function L(e){e=R(e).replace(C,"");while(e.length%4!==0){e=e+"="}return e}function R(e){if(e.trim)return e.trim();return e.replace(/^\s+|\s+$/g,"")}function P(e){return a(e)||s.isBuffer(e)||e&&typeof e==="object"&&typeof e.length==="number"}function D(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function F(e){var t=[];for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<=127){t.push(i)}else{var n=r;if(i>=55296&&i<=57343)r++;var a=encodeURIComponent(e.slice(n,r+1)).substr(1).split("%");for(var o=0;o<a.length;o++){t.push(parseInt(a[o],16))}}}return t}function U(e){var t=[];for(var r=0;r<e.length;r++){t.push(e.charCodeAt(r)&255)}return t}function k(e){var t,r,i;var n=[];for(var a=0;a<e.length;a++){t=e.charCodeAt(a);r=t>>8;i=t%256;n.push(i);n.push(r)}return n}function B(e){return i.toByteArray(e)}function V(e,t,r,i){for(var n=0;n<i;n++){if(n+r>=t.length||n>=e.length)break;t[n+r]=e[n]}return n}function N(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}},{"base64-js":3,ieee754:4,"is-array":5}],3:[function(e,t,r){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(e){"use strict";var t=typeof Uint8Array!=="undefined"?Uint8Array:Array;var r="+".charCodeAt(0);var n="/".charCodeAt(0);var a="0".charCodeAt(0);var o="a".charCodeAt(0);var s="A".charCodeAt(0);function h(e){var t=e.charCodeAt(0);if(t===r)return 62;if(t===n)return 63;if(t<a)return-1;if(t<a+10)return t-a+26+26;if(t<s+26)return t-s;if(t<o+26)return t-o+26}function l(e){var r,i,n,a,o,s;if(e.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var l=e.length;o="="===e.charAt(l-2)?2:"="===e.charAt(l-1)?1:0;s=new t(e.length*3/4-o);n=o>0?e.length-4:e.length;var u=0;function f(e){s[u++]=e}for(r=0,i=0;r<n;r+=4,i+=3){a=h(e.charAt(r))<<18|h(e.charAt(r+1))<<12|h(e.charAt(r+2))<<6|h(e.charAt(r+3));f((a&16711680)>>16);f((a&65280)>>8);f(a&255)}if(o===2){a=h(e.charAt(r))<<2|h(e.charAt(r+1))>>4;f(a&255)}else if(o===1){a=h(e.charAt(r))<<10|h(e.charAt(r+1))<<4|h(e.charAt(r+2))>>2;f(a>>8&255);f(a&255)}return s}function u(e){var t,r=e.length%3,n="",a,o;function s(e){return i.charAt(e)}function h(e){return s(e>>18&63)+s(e>>12&63)+s(e>>6&63)+s(e&63)}for(t=0,o=e.length-r;t<o;t+=3){a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];n+=h(a)}switch(r){case 1:a=e[e.length-1];n+=s(a>>2);n+=s(a<<4&63);n+="==";break;case 2:a=(e[e.length-2]<<8)+e[e.length-1];n+=s(a>>10);n+=s(a>>4&63);n+=s(a<<2&63);n+="=";break}return n}e.toByteArray=l;e.fromByteArray=u})(typeof r==="undefined"?this.base64js={}:r)},{}],4:[function(e,t,r){r.read=function(e,t,r,i,n){var a,o,s=n*8-i-1,h=(1<<s)-1,l=h>>1,u=-7,f=r?n-1:0,c=r?-1:1,d=e[t+f];f+=c;a=d&(1<<-u)-1;d>>=-u;u+=s;for(;u>0;a=a*256+e[t+f],f+=c,u-=8);o=a&(1<<-u)-1;a>>=-u;u+=i;for(;u>0;o=o*256+e[t+f],f+=c,u-=8);if(a===0){a=1-l}else if(a===h){return o?NaN:(d?-1:1)*Infinity}else{o=o+Math.pow(2,i);a=a-l}return(d?-1:1)*o*Math.pow(2,a-i)};r.write=function(e,t,r,i,n,a){var o,s,h,l=a*8-n-1,u=(1<<l)-1,f=u>>1,c=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,p=i?1:-1,m=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){s=isNaN(t)?1:0;o=u}else{o=Math.floor(Math.log(t)/Math.LN2);if(t*(h=Math.pow(2,-o))<1){o--;h*=2}if(o+f>=1){t+=c/h}else{t+=c*Math.pow(2,1-f)}if(t*h>=2){o++;h/=2}if(o+f>=u){s=0;o=u}else if(o+f>=1){s=(t*h-1)*Math.pow(2,n);o=o+f}else{s=t*Math.pow(2,f-1)*Math.pow(2,n);o=0}}for(;n>=8;e[r+d]=s&255,d+=p,s/=256,n-=8);o=o<<n|s;l+=n;for(;l>0;e[r+d]=o&255,d+=p,o/=256,l-=8);e[r+d-p]|=m*128}},{}],5:[function(e,t,r){var i=Array.isArray;var n=Object.prototype.toString;t.exports=i||function(e){return!!e&&"[object Array]"==n.call(e)}},{}],6:[function(e,t,r){if(typeof Object.create==="function"){t.exports=function i(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}}},{}],7:[function(e,t,r){var i=t.exports={};i.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.MutationObserver;var r=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}var i=[];if(t){var n=document.createElement("div");var a=new MutationObserver(function(){var e=i.slice();i.length=0;e.forEach(function(e){e()})});a.observe(n,{attributes:true});return function o(e){if(!i.length){n.setAttribute("yes","no")}i.push(e)}}if(r){window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(i.length>0){var r=i.shift();r()}}},true);return function s(e){i.push(e);window.postMessage("process-tick","*")}}return function h(e){setTimeout(e,0)}}();i.title="browser";i.browser=true;i.env={};i.argv=[];function n(){}i.on=n;i.addListener=n;i.once=n;i.off=n;i.removeListener=n;i.removeAllListeners=n;i.emit=n;i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],8:[function(e,t,r){t.exports=function i(e){return e&&typeof e==="object"&&typeof e.copy==="function"&&typeof e.fill==="function"&&typeof e.readUInt8==="function"}},{}],9:[function(e,t,r){(function(t,i){var n=/%[sdj%]/g;r.format=function(e){if(!w(e)){var t=[];for(var r=0;r<arguments.length;r++){t.push(s(arguments[r]))}return t.join(" ")}var r=1;var i=arguments;var a=i.length;var o=String(e).replace(n,function(e){if(e==="%%")return"%";if(r>=a)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return e}});for(var h=i[r];r<a;h=i[++r]){if(x(h)||!E(h)){o+=" "+h}else{o+=" "+s(h)}}return o};r.deprecate=function(e,n){if(T(i.process)){return function(){return r.deprecate(e,n).apply(this,arguments)}}if(t.noDeprecation===true){return e}var a=false;function o(){if(!a){if(t.throwDeprecation){throw new Error(n)}else if(t.traceDeprecation){console.trace(n)}else{console.error(n)}a=true}return e.apply(this,arguments)}return o};var a={};var o;r.debuglog=function(e){if(T(o))o=t.env.NODE_DEBUG||"";e=e.toUpperCase();if(!a[e]){if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=t.pid;a[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,i,t)}}else{a[e]=function(){}}}return a[e]};function s(e,t){var i={seen:[],stylize:l};if(arguments.length>=3)i.depth=arguments[2];if(arguments.length>=4)i.colors=arguments[3];if(y(t)){i.showHidden=t}else if(t){r._extend(i,t)}if(T(i.showHidden))i.showHidden=false;if(T(i.depth))i.depth=2;if(T(i.colors))i.colors=false;if(T(i.customInspect))i.customInspect=true;if(i.colors)i.stylize=h;return f(i,e,i.depth)}r.inspect=s;s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};s.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function h(e,t){var r=s.styles[t];if(r){return"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m"}else{return e}}function l(e,t){return e}function u(e){var t={};e.forEach(function(e,r){t[e]=true});return t}function f(e,t,i){if(e.customInspect&&t&&L(t.inspect)&&t.inspect!==r.inspect&&!(t.constructor&&t.constructor.prototype===t)){var n=t.inspect(i,e);if(!w(n)){n=f(e,n,i)}return n}var a=c(e,t);if(a){return a}var o=Object.keys(t);var s=u(o);if(e.showHidden){o=Object.getOwnPropertyNames(t)}if(C(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0)){return d(t)}if(o.length===0){if(L(t)){var h=t.name?": "+t.name:"";return e.stylize("[Function"+h+"]","special")}if(S(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}if(A(t)){return e.stylize(Date.prototype.toString.call(t),"date")}if(C(t)){return d(t)}}var l="",y=false,x=["{","}"];if(g(t)){y=true;x=["[","]"]}if(L(t)){var _=t.name?": "+t.name:"";l=" [Function"+_+"]"}if(S(t)){l=" "+RegExp.prototype.toString.call(t)}if(A(t)){l=" "+Date.prototype.toUTCString.call(t)}if(C(t)){l=" "+d(t)}if(o.length===0&&(!y||t.length==0)){return x[0]+l+x[1]}if(i<0){if(S(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}else{return e.stylize("[Object]","special")}}e.seen.push(t);var b;if(y){b=p(e,t,i,s,o)}else{b=o.map(function(r){return m(e,t,i,s,r,y)})}e.seen.pop();return v(b,l,x)}function c(e,t){if(T(t))return e.stylize("undefined","undefined");if(w(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(b(t))return e.stylize(""+t,"number");if(y(t))return e.stylize(""+t,"boolean");if(x(t))return e.stylize("null","null")}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,i,n){var a=[];for(var o=0,s=t.length;o<s;++o){if(k(t,String(o))){a.push(m(e,t,r,i,String(o),true))}else{a.push("")}}n.forEach(function(n){if(!n.match(/^\d+$/)){a.push(m(e,t,r,i,n,true))}});return a}function m(e,t,r,i,n,a){var o,s,h;h=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]};if(h.get){if(h.set){s=e.stylize("[Getter/Setter]","special")}else{s=e.stylize("[Getter]","special")}}else{if(h.set){s=e.stylize("[Setter]","special")}}if(!k(i,n)){o="["+n+"]"}if(!s){if(e.seen.indexOf(h.value)<0){if(x(r)){s=f(e,h.value,null)}else{s=f(e,h.value,r-1)}if(s.indexOf("\n")>-1){if(a){s=s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2)}else{s="\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")}}}else{s=e.stylize("[Circular]","special")}}if(T(o)){if(a&&n.match(/^\d+$/)){return s}o=JSON.stringify(""+n);if(o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){o=o.substr(1,o.length-2);o=e.stylize(o,"name")}else{o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");o=e.stylize(o,"string")}}return o+": "+s}function v(e,t,r){var i=0;var n=e.reduce(function(e,t){i++;if(t.indexOf("\n")>=0)i++;return e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(n>60){return r[0]+(t===""?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]}return r[0]+t+" "+e.join(", ")+" "+r[1]}function g(e){return Array.isArray(e)}r.isArray=g;function y(e){return typeof e==="boolean"}r.isBoolean=y;function x(e){return e===null}r.isNull=x;function _(e){return e==null}r.isNullOrUndefined=_;function b(e){return typeof e==="number"}r.isNumber=b;function w(e){return typeof e==="string"}r.isString=w;function M(e){return typeof e==="symbol"}r.isSymbol=M;function T(e){return e===void 0}r.isUndefined=T;function S(e){return E(e)&&P(e)==="[object RegExp]"}r.isRegExp=S;function E(e){return typeof e==="object"&&e!==null}r.isObject=E;function A(e){return E(e)&&P(e)==="[object Date]"}r.isDate=A;function C(e){return E(e)&&(P(e)==="[object Error]"||e instanceof Error)}r.isError=C;function L(e){return typeof e==="function"}r.isFunction=L;function R(e){return e===null||typeof e==="boolean"||typeof e==="number"||typeof e==="string"||typeof e==="symbol"||typeof e==="undefined"}r.isPrimitive=R;r.isBuffer=e("./support/isBuffer");function P(e){return Object.prototype.toString.call(e)}function D(e){return e<10?"0"+e.toString(10):e.toString(10)}var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function U(){var e=new Date;var t=[D(e.getHours()),D(e.getMinutes()),D(e.getSeconds())].join(":");return[e.getDate(),F[e.getMonth()],t].join(" ")}r.log=function(){console.log("%s - %s",U(),r.format.apply(r,arguments))};r.inherits=e("inherits");r._extend=function(e,t){if(!t||!E(t))return e;var r=Object.keys(t);var i=r.length;while(i--){e[r[i]]=t[r[i]]}return e};function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":8,_process:7,inherits:6}],10:[function(e,t,r){!function(e,r){if(typeof t!="undefined")t.exports=r();else if(typeof define=="function"&&typeof define.amd=="object")define(r);else this[e]=r()}("domready",function(){var e=[],t,r=document,i=r.documentElement.doScroll,n="DOMContentLoaded",a=(i?/^loaded|^c/:/^loaded|^i|^c/).test(r.readyState);if(!a)r.addEventListener(n,t=function(){r.removeEventListener(n,t);a=1;while(t=e.shift())t()});return function(t){a?t():e.push(t)}})},{}],11:[function(e,t,r){var i=e("gl-checker-texture");var n=e("gl-sprite-batch");var a=e("gl-basic-shader");function o(e,t){if(!(this instanceof o))return new o(e,t);t=t||{};this.gl=e;this.texture=i(e,t);var r=window.devicePixelRatio||1;this.size=typeof t.size==="number"?t.size:32*r;this.shader=t.shader||a(e,{texcoord:true,color:true});this.batch=t.batch||n(e,{capacity:1});this.sprite={texture:this.texture,position:[-1,-1],shape:[2,2],texcoord:[0,0,1,1]}}o.prototype.dispose=function(){this.batch.dispose();this.shader.dispose();this.texture.dispose()};o.prototype.push=function(e,t){e=typeof e==="number"?e:this.gl.canvas.width;t=typeof t==="number"?t:this.gl.canvas.height;var r=this.size;this.sprite.texcoord[2]=Math.round(e/r);this.sprite.texcoord[3]=Math.round(t/r);this.batch.push(this.sprite)};o.prototype.draw=function(e,t){this.batch.clear();this.batch.bind(this.shader);this.push(e,t);this.batch.draw();this.batch.unbind()};t.exports=o},{"gl-basic-shader":12,"gl-checker-texture":19,"gl-sprite-batch":34}],12:[function(e,t,r){var i=e("gl-mat4/identity");var n=e("gl-shader-core");var a="position",o="normal",s="color",h="texcoord";t.exports=function(e,r){r=r||{};r.texcoord=typeof r.texcoord==="number"?r.texcoord:r.texcoord||0;var a=t.exports.generate(r),o=a.vertex,s=a.fragment,h=a.uniforms,l=a.attributes;var u=n(e,o,s,h,l);u.bind();for(var f=0;f<r.texcoord;f++)u.uniforms["texture"+f]=f;var c=i(new Float32Array(16));u.uniforms.projection=c;u.uniforms.model=c;u.uniforms.view=c;u.uniforms.tint=r.tint||[1,1,1,1];return u};t.exports.generate=function(e){e=e||{};e.texcoord=typeof e.texcoord==="number"?e.texcoord:e.texcoord||0;var t=typeof e.vertex==="string"?e.vertex:l(e.normal,e.color,e.texcoord);var r=typeof e.fragment==="string"?e.fragment:u(e.color,e.texcoord);var i=[{type:"mat4",name:"projection"},{type:"mat4",name:"view"},{type:"mat4",name:"model"},{type:"vec4",name:"tint"}];var n=[{type:"vec4",name:a,location:0}];if(e.normal)n.push({type:"vec3",name:o,location:1});if(e.color)n.push({type:"vec4",name:s,location:2});var f=3;for(var c=0;c<e.texcoord;c++){i.push({type:"sampler2D",name:"texture"+c});n.push({type:"vec2",name:h+c,location:f++})}return{vertex:t,fragment:r,uniforms:i,attributes:n}};function l(e,t,r){r=r||0;var i="";i+="attribute vec4 "+a+";\n"+(e?"attribute vec3 "+o+";\n":"")+(t?"attribute vec4 "+s+";\n":"");var n;for(n=0;n<r;n++){i+="attribute vec2 "+h+n+";\n"}i+="uniform mat4 projection;\n";i+="uniform mat4 view;\n";i+="uniform mat4 model;\n";i+=t?"varying vec4 v_col;\n":"";for(n=0;n<r;n++){i+="varying vec2 v_tex"+n+";\n"}i+="\nvoid main() {\n"+"   gl_Position = projection * view * model * "+a+";\n"+(t?"   v_col = "+s+";\n":"");for(n=0;n<r;n++){i+="   v_tex"+n+" = "+h+n+";\n"}i+="   gl_PointSize = 1.0;\n";i+="}\n";return i}function u(e,t){t=t||0;var r="#ifdef GL_ES\n"+"precision mediump float;\n"+"#endif\n\n";if(e)r+="varying vec4 v_col;\n";var i;for(i=0;i<t;i++){r+="varying vec2 v_tex"+i+";\n";r+="uniform sampler2D texture"+i+";\n"}r+="uniform vec4 tint;\n";r+="\nvoid main() {\n"+"   gl_FragColor = ";if(e)r+="v_col";if(e&&t>0)r+=" * ";else if(!e&&!t)r+="vec4(1.0)";for(i=0;i<t;i++){if(i==t-1){r+=" texture2D(texture"+i+",  v_tex"+i+")"}else{r+=" texture2D(texture"+i+",  v_tex"+i+") *"}}r+=" * tint";r+=";\n}";return r}},{"gl-mat4/identity":13,"gl-shader-core":18}],13:[function(e,t,r){t.exports=i;function i(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}},{}],14:[function(e,t,r){"use strict";t.exports=o;function i(e,t,r,i,n,a,o){this._gl=e;this._program=t;this._location=r;this._dimension=i;this._name=n;this._constFunc=a;this._relink=o}var n=i.prototype;n.pointer=function s(e,t,r,i){var n=this._gl;n.vertexAttribPointer(this._location,this._dimension,e||n.FLOAT,!!t,r||0,i||0);this._gl.enableVertexAttribArray(this._location)};Object.defineProperty(n,"location",{get:function(){return this._location},set:function(e){if(e!==this._location){this._location=e;this._gl.bindAttribLocation(this._program,e,this._name);this._gl.linkProgram(this._program);this._relink()}}});function a(e,t,r,n,a,o,s){var h=["gl","v"];var l=[];for(var u=0;u<n;++u){h.push("x"+u);l.push("x"+u)}h.push(["if(x0.length===void 0){return gl.vertexAttrib",n,"f(v,",l.join(),")}else{return gl.vertexAttrib",n,"fv(v,x0)}"].join(""));var f=Function.apply(undefined,h);var c=new i(e,t,r,n,o,f,s);Object.defineProperty(a,o,{set:function(t){e.disableVertexAttribArray(c._location);f(e,c._location,t);return t},get:function(){return c},enumerable:true})}function o(e,t,r,i){var n={};for(var o=0,s=r.length;o<s;++o){var h=r[o];var l=h.name;var u=h.type;var f=e.getAttribLocation(t,l);switch(u){case"bool":case"int":case"float":a(e,t,f,1,n,l,i);break;default:if(u.indexOf("vec")>=0){var c=u.charCodeAt(u.length-1)-48;if(c<2||c>4){throw new Error("gl-shader: Invalid data type for attribute "+l+": "+u)}a(e,t,f,c,n,l,i)}else{throw new Error("gl-shader: Unknown data type for attribute "+l+": "+u)
}break}}return n}},{}],15:[function(e,t,r){"use strict";var i=e("dup");var n=e("./reflect");t.exports=o;function a(e){var t=new Function("y","return function(){return y}");return t(e)}function o(e,t,r,o){function s(r){var i=new Function("gl","prog","locations","return function(){return gl.getUniform(prog,locations["+r+"])}");return i(e,t,o)}function h(e,t,r){switch(r){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+t+"],obj"+e+")";case"float":return"gl.uniform1f(locations["+t+"],obj"+e+")";default:var i=r.indexOf("vec");if(0<=i&&i<=1&&r.length===4+i){var n=r.charCodeAt(r.length-1)-48;if(n<2||n>4){throw new Error("gl-shader: Invalid data type")}switch(r.charAt(0)){case"b":case"i":return"gl.uniform"+n+"iv(locations["+t+"],obj"+e+")";case"v":return"gl.uniform"+n+"fv(locations["+t+"],obj"+e+")";default:throw new Error("gl-shader: Unrecognized data type for vector "+name+": "+r)}}else if(r.indexOf("mat")===0&&r.length===4){var n=r.charCodeAt(r.length-1)-48;if(n<2||n>4){throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+r)}return"gl.uniformMatrix"+n+"fv(locations["+t+"],false,obj"+e+")"}else{throw new Error("gl-shader: Unknown uniform data type for "+name+": "+r)}break}}function l(e,t){if(typeof t!=="object"){return[[e,t]]}var r=[];for(var i in t){var n=t[i];var a=e;if(parseInt(i)+""===i){a+="["+i+"]"}else{a+="."+i}if(typeof n==="object"){r.push.apply(r,l(a,n))}else{r.push([a,n])}}return r}function u(i){var n=["return function updateProperty(obj){"];var a=l("",i);for(var s=0;s<a.length;++s){var u=a[s];var f=u[0];var c=u[1];if(o[c]){n.push(h(f,c,r[c].type))}}n.push("return obj}");var d=new Function("gl","prog","locations",n.join("\n"));return d(e,t,o)}function f(e){switch(e){case"bool":return false;case"int":case"sampler2D":case"samplerCube":return 0;case"float":return 0;default:var t=e.indexOf("vec");if(0<=t&&t<=1&&e.length===4+t){var r=e.charCodeAt(e.length-1)-48;if(r<2||r>4){throw new Error("gl-shader: Invalid data type")}if(e.charAt(0)==="b"){return i(r,false)}return i(r)}else if(e.indexOf("mat")===0&&e.length===4){var r=e.charCodeAt(e.length-1)-48;if(r<2||r>4){throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+e)}return i([r,r])}else{throw new Error("gl-shader: Unknown uniform data type for "+name+": "+e)}break}}function c(e,t,i){if(typeof i==="object"){var n=d(i);Object.defineProperty(e,t,{get:a(n),set:u(i),enumerable:true,configurable:false})}else{if(o[i]){Object.defineProperty(e,t,{get:s(i),set:u(i),enumerable:true,configurable:false})}else{e[t]=f(r[i].type)}}}function d(e){var t;if(Array.isArray(e)){t=new Array(e.length);for(var r=0;r<e.length;++r){c(t,r,e[r])}}else{t={};for(var i in e){c(t,i,e[i])}}return t}var p=n(r,true);return{get:a(d(p)),set:u(p),enumerable:true,configurable:true}}},{"./reflect":16,dup:17}],16:[function(e,t,r){"use strict";t.exports=i;function i(e,t){var r={};for(var i=0;i<e.length;++i){var n=e[i].name;var a=n.split(".");var o=r;for(var s=0;s<a.length;++s){var h=a[s].split("[");if(h.length>1){if(!(h[0]in o)){o[h[0]]=[]}o=o[h[0]];for(var l=1;l<h.length;++l){var u=parseInt(h[l]);if(l<h.length-1||s<a.length-1){if(!(u in o)){if(l<h.length-1){o[u]=[]}else{o[u]={}}}o=o[u]}else{if(t){o[u]=i}else{o[u]=e[i].type}}}}else if(s<a.length-1){if(!(h[0]in o)){o[h[0]]={}}o=o[h[0]]}else{if(t){o[h[0]]=i}else{o[h[0]]=e[i].type}}}}return r}},{}],17:[function(e,t,r){"use strict";function i(e,t,r){var n=e[r]|0;if(n<=0){return[]}var a=new Array(n),o;if(r===e.length-1){for(o=0;o<n;++o){a[o]=t}}else{for(o=0;o<n;++o){a[o]=i(e,t,r+1)}}return a}function n(e,t){var r,i;r=new Array(e);for(i=0;i<e;++i){r[i]=t}return r}function a(e,t){if(typeof t==="undefined"){t=0}switch(typeof e){case"number":if(e>0){return n(e|0,t)}break;case"object":if(typeof e.length==="number"){return i(e,t,0)}break}return[]}t.exports=a},{}],18:[function(e,t,r){"use strict";var i=e("./lib/create-uniforms");var n=e("./lib/create-attributes");var a=e("./lib/reflect");function o(e,t,r,i){this.gl=e;this.handle=t;this.attributes=null;this.uniforms=null;this.types=null;this.vertexShader=r;this.fragmentShader=i}o.prototype.bind=function(){this.gl.useProgram(this.handle)};o.prototype.dispose=function(){var e=this.gl;e.deleteShader(this.vertexShader);e.deleteShader(this.fragmentShader);e.deleteProgram(this.handle)};o.prototype.updateExports=function(e,t){var r=new Array(e.length);var o=this.handle;var h=this.gl;var l=s.bind(void 0,h,o,r,e);l();this.types={uniforms:a(e),attributes:a(t)};this.attributes=n(h,o,t,l);Object.defineProperty(this,"uniforms",i(h,o,e,r))};function s(e,t,r,i){for(var n=0;n<i.length;++n){r[n]=e.getUniformLocation(t,i[n].name)}}function h(e,t,r,i,n){var a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,t);e.compileShader(a);if(!e.getShaderParameter(a,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(a);console.error("gl-shader: Error compling vertex shader:",s);throw new Error("gl-shader: Error compiling vertex shader:"+s)}var h=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(h,r);e.compileShader(h);if(!e.getShaderParameter(h,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(h);console.error("gl-shader: Error compiling fragment shader:",s);throw new Error("gl-shader: Error compiling fragment shader:"+s)}var l=e.createProgram();e.attachShader(l,h);e.attachShader(l,a);n.forEach(function(t){if(typeof t.location==="number")e.bindAttribLocation(l,t.location,t.name)});e.linkProgram(l);if(!e.getProgramParameter(l,e.LINK_STATUS)){var s=e.getProgramInfoLog(l);console.error("gl-shader: Error linking shader program:",s);throw new Error("gl-shader: Error linking shader program:"+s)}var u=new o(e,l,a,h);u.updateExports(i,n);return u}t.exports=h},{"./lib/create-attributes":14,"./lib/create-uniforms":15,"./lib/reflect":16}],19:[function(e,t,r){var i=e("gl-texture2d");var n=e("ndarray");var a=[[255,255,255,255],[204,204,204,255]];t.exports=function(e,t){t=t||{};t.colors=t.colors||a;data=[t.colors[0],t.colors[1],t.colors[1],t.colors[0]].reduce(function(e,t){return e.concat(t)});var r=n(new Uint8Array(data),[2,2,4]);var o=i(e,r);o.minFilter=e.NEAREST;o.magFilter=e.NEAREST;o.wrap=e.REPEAT;return o}},{"gl-texture2d":30,ndarray:31}],20:[function(e,t,r){"use strict";var i=e("cwise-compiler");var n={body:"",args:[],thisVars:[],localVars:[]};function a(e){if(!e){return n}for(var t=0;t<e.args.length;++t){var r=e.args[t];if(t===0){e.args[t]={name:r,lvalue:true,rvalue:!!e.rvalue,count:e.count||1}}else{e.args[t]={name:r,lvalue:false,rvalue:true,count:1}}}if(!e.thisVars){e.thisVars=[]}if(!e.localVars){e.localVars=[]}return e}function o(e){return i({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}function s(e){var t=[];for(var r=0;r<e.args.length;++r){t.push("a"+r)}var i=new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""));return i(o(e))}var h={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var e in h){var t=h[e];r[e]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e});r[e+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+t+"=b"},rvalue:true,funcName:e+"eq"});r[e+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"});r[e+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+t+"=s"},rvalue:true,funcName:e+"seq"})}})();var l={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var e in l){var t=l[e];r[e]=s({args:["array","array"],body:{args:["a","b"],body:"a="+t+"b"},funcName:e});r[e+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+t+"a"},rvalue:true,count:2,funcName:e+"eq"})}})();var u={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var e in u){var t=u[e];r[e]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e});r[e+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"});r[e+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+t+"b"},rvalue:true,count:2,funcName:e+"eq"});r[e+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+t+"s"},rvalue:true,count:2,funcName:e+"seq"})}})();var f=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var e=0;e<f.length;++e){var t=f[e];r[t]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:t});r[t+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:t+"eq"})}})();var c=["max","min","atan2","pow"];(function(){for(var e=0;e<c.length;++e){var t=c[e];r[t]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t});r[t+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t+"s"});r[t+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:t+"eq"});r[t+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:t+"seq"})}})();var d=["atan2","pow"];(function(){for(var e=0;e<d.length;++e){var t=d[e];r[t+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"op"});r[t+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"ops"});r[t+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:t+"opeq"});r[t+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:t+"opseq"})}})();r.any=i({args:["array"],pre:n,body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"});r.all=i({args:["array"],pre:n,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"});r.sum=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"});r.prod=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"});r.norm2squared=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"});r.norm2=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"});r.norminf=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"});r.norm1=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"});r.sup=i({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});r.inf=i({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});r.argmin=i({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});r.argmax=i({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});r.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"});r.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"});r.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"});r.equals=i({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1},{name:"y",lvalue:false,rvalue:true,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":21}],21:[function(e,t,r){"use strict";var i=e("./lib/thunk.js");function n(){this.argTypes=[];this.shimArgs=[];this.arrayArgs=[];this.scalarArgs=[];this.offsetArgs=[];this.offsetArgIndex=[];this.indexArgs=[];this.shapeArgs=[];this.funcName="";this.pre=null;this.body=null;this.post=null;this.debug=false}function a(e){var t=new n;t.pre=e.pre;t.body=e.body;t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var a=0;a<r.length;++a){var o=r[a];if(o==="array"){t.arrayArgs.push(a);t.shimArgs.push("array"+a);if(a<t.pre.args.length&&t.pre.args[a].count>0){throw new Error("cwise: pre() block may not reference array args")}if(a<t.post.args.length&&t.post.args[a].count>0){throw new Error("cwise: post() block may not reference array args")}}else if(o==="scalar"){t.scalarArgs.push(a);t.shimArgs.push("scalar"+a)}else if(o==="index"){t.indexArgs.push(a);if(a<t.pre.args.length&&t.pre.args[a].count>0){throw new Error("cwise: pre() block may not reference array index")}if(a<t.body.args.length&&t.body.args[a].lvalue){throw new Error("cwise: body() block may not write to array index")}if(a<t.post.args.length&&t.post.args[a].count>0){throw new Error("cwise: post() block may not reference array index")}}else if(o==="shape"){t.shapeArgs.push(a);if(a<t.pre.args.length&&t.pre.args[a].lvalue){throw new Error("cwise: pre() block may not write to array shape")}if(a<t.body.args.length&&t.body.args[a].lvalue){throw new Error("cwise: body() block may not write to array shape")}if(a<t.post.args.length&&t.post.args[a].lvalue){throw new Error("cwise: post() block may not write to array shape")}}else if(typeof o==="object"&&o.offset){t.argTypes[a]="offset";t.offsetArgs.push({array:o.array,offset:o.offset});t.offsetArgIndex.push(a)}else{throw new Error("cwise: Unknown argument type "+r[a])}}if(t.arrayArgs.length<=0){throw new Error("cwise: No array arguments specified")}if(t.pre.args.length>r.length){throw new Error("cwise: Too many arguments in pre() block")}if(t.body.args.length>r.length){throw new Error("cwise: Too many arguments in body() block")}if(t.post.args.length>r.length){throw new Error("cwise: Too many arguments in post() block")}t.debug=!!e.printCode||!!e.debug;t.funcName=e.funcName||"cwise";t.blockSize=e.blockSize||64;return i(t)}t.exports=a},{"./lib/thunk.js":23}],22:[function(e,t,r){"use strict";var i=e("uniq");function n(e,t,r){var i=e.length,n=t.arrayArgs.length,a=t.indexArgs.length>0,o=[],s=[],h=0,l=0,u,f;for(u=0;u<i;++u){s.push(["i",u,"=0"].join(""))}for(f=0;f<n;++f){for(u=0;u<i;++u){l=h;h=e[u];if(u===0){s.push(["d",f,"s",u,"=t",f,"p",h].join(""))}else{s.push(["d",f,"s",u,"=(t",f,"p",h,"-s",l,"*t",f,"p",l,")"].join(""))}}}o.push("var "+s.join(","));for(u=i-1;u>=0;--u){h=e[u];o.push(["for(i",u,"=0;i",u,"<s",h,";++i",u,"){"].join(""))}o.push(r);for(u=0;u<i;++u){l=h;h=e[u];for(f=0;f<n;++f){o.push(["p",f,"+=d",f,"s",u].join(""))}if(a){if(u>0){o.push(["index[",l,"]-=s",l].join(""))}o.push(["++index[",h,"]"].join(""))}o.push("}")}return o.join("\n")}function a(e,t,r,i){var a=t.length,o=r.arrayArgs.length,s=r.blockSize,h=r.indexArgs.length>0,l=[];for(var u=0;u<o;++u){l.push(["var offset",u,"=p",u].join(""))}for(var u=e;u<a;++u){l.push(["for(var j"+u+"=SS[",t[u],"]|0;j",u,">0;){"].join(""));l.push(["if(j",u,"<",s,"){"].join(""));l.push(["s",t[u],"=j",u].join(""));l.push(["j",u,"=0"].join(""));l.push(["}else{s",t[u],"=",s].join(""));l.push(["j",u,"-=",s,"}"].join(""));if(h){l.push(["index[",t[u],"]=j",u].join(""))}}for(var u=0;u<o;++u){var f=["offset"+u];for(var c=e;c<a;++c){f.push(["j",c,"*t",u,"p",t[c]].join(""))}l.push(["p",u,"=(",f.join("+"),")"].join(""))}l.push(n(t,r,i));for(var u=e;u<a;++u){l.push("}")}return l.join("\n")}function o(e){var t=0,r=e[0].length;while(t<r){for(var i=1;i<e.length;++i){if(e[i][t]!==e[0][t]){return t}}++t}return t}function s(e,t,r){var i=e.body;var n=[];var a=[];for(var o=0;o<e.args.length;++o){var s=e.args[o];if(s.count<=0){continue}var h=new RegExp(s.name,"g");var l="";var u=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var f=t.offsetArgIndex.indexOf(o);var c=t.offsetArgs[f];u=c.array;l="+q"+f;case"array":l="p"+u+l;var d="l"+o;var p="a"+u;if(s.count===1){if(r[u]==="generic"){if(s.lvalue){n.push(["var ",d,"=",p,".get(",l,")"].join(""));i=i.replace(h,d);a.push([p,".set(",l,",",d,")"].join(""))}else{i=i.replace(h,[p,".get(",l,")"].join(""))}}else{i=i.replace(h,[p,"[",l,"]"].join(""))}}else if(r[u]==="generic"){n.push(["var ",d,"=",p,".get(",l,")"].join(""));i=i.replace(h,d);if(s.lvalue){a.push([p,".set(",l,",",d,")"].join(""))}}else{n.push(["var ",d,"=",p,"[",l,"]"].join(""));i=i.replace(h,d);if(s.lvalue){a.push([p,"[",l,"]=",d].join(""))}}break;case"scalar":i=i.replace(h,"Y"+t.scalarArgs.indexOf(o));break;case"index":i=i.replace(h,"index");break;case"shape":i=i.replace(h,"shape");break}}return[n.join("\n"),i,a.join("\n")].join("\n").trim()}function h(e){var t=new Array(e.length);var r=true;for(var i=0;i<e.length;++i){var n=e[i];var a=n.match(/\d+/);if(!a){a=""}else{a=a[0]}if(n.charAt(0)===0){t[i]="u"+n.charAt(1)+a}else{t[i]=n.charAt(0)+a}if(i>0){r=r&&t[i]===t[i-1]}}if(r){return t[0]}return t.join("")}function l(e,t){var r=t[1].length|0;var l=new Array(e.arrayArgs.length);var u=new Array(e.arrayArgs.length);var f=["SS"];var c=["'use strict'"];var d=[];for(var p=0;p<r;++p){d.push(["s",p,"=SS[",p,"]"].join(""))}for(var m=0;m<e.arrayArgs.length;++m){f.push("a"+m);f.push("t"+m);f.push("p"+m);u[m]=t[2*m];l[m]=t[2*m+1];for(var p=0;p<r;++p){d.push(["t",m,"p",p,"=t",m,"[",p,"]"].join(""))}}for(var m=0;m<e.scalarArgs.length;++m){f.push("Y"+m)}if(e.shapeArgs.length>0){d.push("shape=SS.slice(0)")}if(e.indexArgs.length>0){var v=new Array(r);for(var m=0;m<r;++m){v[m]="0"}d.push(["index=[",v.join(","),"]"].join(""))}for(var m=0;m<e.offsetArgs.length;++m){var g=e.offsetArgs[m];var y=[];for(var p=0;p<g.offset.length;++p){if(g.offset[p]===0){continue}else if(g.offset[p]===1){y.push(["t",g.array,"p",p].join(""))}else{y.push([g.offset[p],"*t",g.array,"p",p].join(""))}}if(y.length===0){d.push("q"+m+"=0")}else{d.push(["q",m,"=",y.join("+")].join(""))}}var x=i([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));d=d.concat(x);c.push("var "+d.join(","));for(var m=0;m<e.arrayArgs.length;++m){c.push("p"+m+"|=0")}if(e.pre.body.length>3){c.push(s(e.pre,e,u))}var _=s(e.body,e,u);var b=o(l);if(b<r){c.push(a(b,l[0],e,_))}else{c.push(n(l[0],e,_))}if(e.post.body.length>3){c.push(s(e.post,e,u))}if(e.debug){console.log("Generated cwise routine for ",t,":\n\n",c.join("\n"))}var w=[e.funcName||"unnamed","_cwise_loop_",l[0].join("s"),"m",b,h(u)].join("");var M=new Function(["function ",w,"(",f.join(","),"){",c.join("\n"),"} return ",w].join(""));return M()}t.exports=l},{uniq:24}],23:[function(e,t,r){"use strict";var i=e("./compile.js");function n(e){var t=["'use strict'","var CACHED={}"];var r=[];var n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));var a=[];var o=[];var s=[["array",e.arrayArgs[0],".shape"].join("")];for(var h=0;h<e.arrayArgs.length;++h){var l=e.arrayArgs[h];r.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join(""));a.push("t"+l);a.push("r"+l);o.push("t"+l);o.push("r"+l+".join()");s.push("array"+l+".data");s.push("array"+l+".stride");s.push("array"+l+".offset|0")}for(var h=0;h<e.scalarArgs.length;++h){s.push("scalar"+e.scalarArgs[h])}r.push(["type=[",o.join(","),"].join()"].join(""));r.push("proc=CACHED[type]");t.push("var "+r.join(","));t.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",s.join(","),")}"].join(""));if(e.debug){console.log("Generated thunk:",t.join("\n"))}var u=new Function("compile",t.join("\n"));return u(i.bind(undefined,e))}t.exports=n},{"./compile.js":22}],24:[function(e,t,r){"use strict";function i(e,t){var r=1,i=e.length,n=e[0],a=e[0];for(var o=1;o<i;++o){a=n;n=e[o];if(t(n,a)){if(o===r){r++;continue}e[r++]=n}}e.length=r;return e}function n(e){var t=1,r=e.length,i=e[0],n=e[0];for(var a=1;a<r;++a,n=i){n=i;i=e[a];if(i!==n){if(a===t){t++;continue}e[t++]=i}}e.length=t;return e}function a(e,t,r){if(e.length===0){return e}if(t){if(!r){e.sort(t)}return i(e,t)}if(!r){e.sort()}return n(e)}t.exports=a},{}],25:[function(e,t,r){"use strict";"use restrict";var i=32;r.INT_BITS=i;r.INT_MAX=2147483647;r.INT_MIN=-1<<i-1;r.sign=function(e){return(e>0)-(e<0)};r.abs=function(e){var t=e>>i-1;return(e^t)-t};r.min=function(e,t){return t^(e^t)&-(e<t)};r.max=function(e,t){return e^(e^t)&-(e<t)};r.isPow2=function(e){return!(e&e-1)&&!!e};r.log2=function(e){var t,r;t=(e>65535)<<4;e>>>=t;r=(e>255)<<3;e>>>=r;t|=r;r=(e>15)<<2;e>>>=r;t|=r;r=(e>3)<<1;e>>>=r;t|=r;return t|e>>1};r.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0};r.popCount=function(e){e=e-(e>>>1&1431655765);e=(e&858993459)+(e>>>2&858993459);return(e+(e>>>4)&252645135)*16843009>>>24};function n(e){var t=32;e&=-e;if(e)t--;if(e&65535)t-=16;if(e&16711935)t-=8;if(e&252645135)t-=4;if(e&858993459)t-=2;if(e&1431655765)t-=1;return t}r.countTrailingZeros=n;r.nextPow2=function(e){e+=e===0;--e;e|=e>>>1;e|=e>>>2;e|=e>>>4;e|=e>>>8;e|=e>>>16;return e+1};r.prevPow2=function(e){e|=e>>>1;e|=e>>>2;e|=e>>>4;e|=e>>>8;e|=e>>>16;return e-(e>>>1)};r.parity=function(e){e^=e>>>16;e^=e>>>8;e^=e>>>4;e&=15;return 27030>>>e&1};var a=new Array(256);(function(e){for(var t=0;t<256;++t){var r=t,i=t,n=7;for(r>>>=1;r;r>>>=1){i<<=1;i|=r&1;--n}e[t]=i<<n&255}})(a);r.reverse=function(e){return a[e&255]<<24|a[e>>>8&255]<<16|a[e>>>16&255]<<8|a[e>>>24&255]};r.interleave2=function(e,t){e&=65535;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;t&=65535;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;return e|t<<1};r.deinterleave2=function(e,t){e=e>>>t&1431655765;e=(e|e>>>1)&858993459;e=(e|e>>>2)&252645135;e=(e|e>>>4)&16711935;e=(e|e>>>16)&65535;return e<<16>>16};r.interleave3=function(e,t,r){e&=1023;e=(e|e<<16)&4278190335;e=(e|e<<8)&251719695;e=(e|e<<4)&3272356035;e=(e|e<<2)&1227133513;t&=1023;t=(t|t<<16)&4278190335;t=(t|t<<8)&251719695;t=(t|t<<4)&3272356035;t=(t|t<<2)&1227133513;e|=t<<1;r&=1023;r=(r|r<<16)&4278190335;r=(r|r<<8)&251719695;r=(r|r<<4)&3272356035;r=(r|r<<2)&1227133513;return e|r<<2};r.deinterleave3=function(e,t){e=e>>>t&1227133513;e=(e|e>>>2)&3272356035;e=(e|e>>>4)&251719695;e=(e|e>>>8)&4278190335;e=(e|e>>>16)&1023;return e<<22>>22};r.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},{}],26:[function(e,t,r){t.exports=e(17)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/node_modules/dup/dup.js":17}],27:[function(e,t,r){(function(t,i){"use strict";var n=e("bit-twiddle");var a=e("dup");if(!t.__TYPEDARRAY_POOL){t.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])}}var o=typeof Uint8ClampedArray!=="undefined";var s=t.__TYPEDARRAY_POOL;if(!s.UINT8C){s.UINT8C=a([32,0])}if(!s.BUFFER){s.BUFFER=a([32,0])}var h=s.DATA,l=s.BUFFER;r.free=function T(e){if(i.isBuffer(e)){l[n.log2(e.length)].push(e)}else{if(Object.prototype.toString.call(e)!=="[object ArrayBuffer]"){e=e.buffer}if(!e){return}var t=e.length||e.byteLength;var r=n.log2(t)|0;h[r].push(e)}};function u(e){if(!e){return}var t=e.length||e.byteLength;var r=n.log2(t);h[r].push(e)}function f(e){u(e.buffer)}r.freeUint8=r.freeUint16=r.freeUint32=r.freeInt8=r.freeInt16=r.freeInt32=r.freeFloat32=r.freeFloat=r.freeFloat64=r.freeDouble=r.freeUint8Clamped=r.freeDataView=f;r.freeArrayBuffer=u;r.freeBuffer=function S(e){l[n.log2(e.length)].push(e)};r.malloc=function E(e,t){if(t===undefined||t==="arraybuffer"){return c(e)}else{switch(t){case"uint8":return d(e);case"uint16":return p(e);case"uint32":return m(e);case"int8":return v(e);case"int16":return g(e);case"int32":return y(e);case"float":case"float32":return x(e);case"double":case"float64":return _(e);case"uint8_clamped":return b(e);case"buffer":return M(e);case"data":case"dataview":return w(e);default:return null}}return null};function c(e){var e=n.nextPow2(e);var t=n.log2(e);var r=h[t];if(r.length>0){return r.pop()}return new ArrayBuffer(e)}r.mallocArrayBuffer=c;function d(e){return new Uint8Array(c(e),0,e)}r.mallocUint8=d;function p(e){return new Uint16Array(c(2*e),0,e)}r.mallocUint16=p;function m(e){return new Uint32Array(c(4*e),0,e)}r.mallocUint32=m;function v(e){return new Int8Array(c(e),0,e)}r.mallocInt8=v;function g(e){return new Int16Array(c(2*e),0,e)}r.mallocInt16=g;function y(e){return new Int32Array(c(4*e),0,e)}r.mallocInt32=y;function x(e){return new Float32Array(c(4*e),0,e)}r.mallocFloat32=r.mallocFloat=x;function _(e){return new Float64Array(c(8*e),0,e)}r.mallocFloat64=r.mallocDouble=_;function b(e){if(o){return new Uint8ClampedArray(c(e),0,e)}else{return d(e)}}r.mallocUint8Clamped=b;function w(e){return new DataView(c(e),0,e)}r.mallocDataView=w;function M(e){e=n.nextPow2(e);var t=n.log2(e);var r=l[t];if(r.length>0){return r.pop()}return new i(e)}r.mallocBuffer=M;r.clearCache=function A(){for(var e=0;e<32;++e){s.UINT8[e].length=0;s.UINT16[e].length=0;s.UINT32[e].length=0;s.INT8[e].length=0;s.INT16[e].length=0;s.INT32[e].length=0;s.FLOAT[e].length=0;s.DOUBLE[e].length=0;s.UINT8C[e].length=0;h[e].length=0;l[e].length=0}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("buffer").Buffer)},{"bit-twiddle":25,buffer:2,dup:26}],28:[function(e,t,r){void function(e,i,n){var a=Object.getOwnPropertyNames,o=Object.defineProperty,s=Function.prototype.toString,h=Object.create,l=Object.prototype.hasOwnProperty,u=/^\n?function\s?(\w*)?_?\(/;function f(e,t,r){if(typeof t==="function"){r=t;t=c(r).replace(/_$/,"")}return o(e,t,{configurable:true,writable:true,value:r})}function c(e){return typeof e!=="function"?"":"name"in e?e.name:s.call(e).match(u)[1]}var d=function(){var e={value:{writable:true,value:n}},t="return function(k){if(k===s)return l}",r=h(null),i=function(){var e=Math.random().toString(36).slice(2);return e in r?i():r[e]=e},s=i(),u=function(e){if(l.call(e,s))return e[s];if(!Object.isExtensible(e))throw new TypeError("Object must be extensible");var t=h(null);o(e,s,{value:t});return t};f(Object,function d(e){var t=a(e);if(l.call(e,s))t.splice(t.indexOf(s),1);return t});function c(){var r=i(),n={};this.unlock=function(i){var a=u(i);if(l.call(a,r))return a[r](n);var s=h(null,e);o(a,r,{value:new Function("s","l",t)(n,s)});return s}}f(c.prototype,function p(e){return this.unlock(e).value});f(c.prototype,function m(e,t){this.unlock(e).value=t});return c}();var p=function(t){var r=function(e){if(e==null||typeof e!=="object"&&typeof e!=="function")throw new TypeError("Invalid WeakMap key")};var a=function(e,r){var i=t.unlock(e);if(i.value)throw new TypeError("Object is already a WeakMap");i.value=r};var o=function(e){var r=t.unlock(e).value;if(!r)throw new TypeError("WeakMap is not generic");return r};var s=function(e,t){if(t!==null&&typeof t==="object"&&typeof t.forEach==="function"){t.forEach(function(r,i){if(r instanceof Array&&r.length===2)u.call(e,t[i][0],t[i][1])})}};function h(t){if(this===e||this==null||this===h.prototype)return new h(t);a(this,new d);s(this,t)}function l(e){r(e);var t=o(this).get(e);return t===i?n:t}function u(e,t){r(e);o(this).set(e,t===n?i:t)}function p(e){r(e);return o(this).get(e)!==n}function m(e){r(e);var t=o(this),i=t.get(e)!==n;t.set(e,n);return i}function v(){o(this);return"[object WeakMap]"}try{var g=("return "+m).replace("e_","\\u0065"),y=new Function("unwrap","validate",g)(o,r)}catch(x){var y=m}var g=(""+Object).split("Object");var _=function w(){return g[0]+c(this)+g[1]};f(_,_);var b={__proto__:[]}instanceof Array?function(e){e.__proto__=_}:function(e){f(e,_)};b(h);[v,l,u,p,y].forEach(function(e){f(h.prototype,e);b(e)});return h}(new d);var m=Object.create?function(){return Object.create(null)}:function(){return{}};function v(e){var t=new p;e||(e=m);function r(r,i){if(i||arguments.length===2){t.set(r,i)}else{i=t.get(r);if(i===n){i=e(r);t.set(r,i)}}return i}return r}if(typeof t!=="undefined"){t.exports=p}else if(typeof r!=="undefined"){r.WeakMap=p}else if(!("WeakMap"in e)){e.WeakMap=p}p.createStorage=v;if(e.WeakMap)e.WeakMap.createStorage=v}((0,eval)("this"))},{}],29:[function(e,t,r){"use strict";var i=typeof WeakMap==="undefined"?e("weakmap"):WeakMap;var n=new i;
function a(e){return e.replace(/^[A-Z]+_/,"")}function o(e){var t=n.get(e);if(t){return t}var r={};var i=e.getSupportedExtensions();for(var o=0;o<i.length;++o){var s=i[o];if(s.indexOf("MOZ_")===0){continue}var h=e.getExtension(i[o]);if(!h){continue}while(true){r[s]=h;var l=a(s);if(l===s){break}s=l}}n.set(e,r);return r}t.exports=o},{weakmap:28}],30:[function(e,t,r){"use strict";var i=e("ndarray");var n=e("ndarray-ops");var a=e("typedarray-pool");var o=e("webglew");t.exports=b;var s=null;var h=null;var l=null;function u(e){s=[e.LINEAR,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_NEAREST];h=[e.NEAREST,e.LINEAR,e.NEAREST_MIPMAP_NEAREST,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_LINEAR];l=[e.REPEAT,e.CLAMP_TO_EDGE,e.MIRRORED_REPEAT]}var f=function(e,t){n.muls(e,t,255)};function c(e,t,r){var i=e.gl;var n=i.getParameter(i.MAX_TEXTURE_SIZE);if(t<0||t>n||r<0||r>n){throw new Error("gl-texture2d: Invalid texture size")}e._shape=[t,r];e.bind();i.texImage2D(i.TEXTURE_2D,0,e.format,t,r,0,e.format,e.type,null);e._mipLevels=[0];return e}function d(e,t,r,i,n,a){this.gl=e;this.handle=t;this.format=n;this.type=a;this._shape=[r,i];this._mipLevels=[0];this._magFilter=e.NEAREST;this._minFilter=e.NEAREST;this._wrapS=e.CLAMP_TO_EDGE;this._wrapT=e.CLAMP_TO_EDGE;this._anisoSamples=1;var o=this;var s=[this._wrapS,this._wrapT];Object.defineProperties(s,[{get:function(){return o._wrapS},set:function(e){return o.wrapS=e}},{get:function(){return o._wrapT},set:function(e){return o.wrapT=e}}]);this._wrapVector=s;var h=[this._shape[0],this._shape[1]];Object.defineProperties(h,[{get:function(){return o._shape[0]},set:function(e){return o.width=e}},{get:function(){return o._shape[1]},set:function(e){return o.height=e}}]);this._shapeVector=h}var p=d.prototype;Object.defineProperties(p,{minFilter:{get:function(){return this._minFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&s.indexOf(e)>=0){if(!o(t).texture_float_linear){e=t.NEAREST}}if(h.indexOf(e)<0){throw new Error("gl-texture2d: Unknown filter mode "+e)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e);return this._minFilter=e}},magFilter:{get:function(){return this._magFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&s.indexOf(e)>=0){if(!o(t).texture_float_linear){e=t.NEAREST}}if(h.indexOf(e)<0){throw new Error("gl-texture2d: Unknown filter mode "+e)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);return this._magFilter=e}},mipSamples:{get:function(){return this._anisoSamples},set:function(e){var t=this._anisoSamples;this._anisoSamples=Math.max(e,1)|0;if(t!==this._anisoSamples){var r=o(this.gl).EXT_texture_filter_anisotropic;if(r){this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(e){this.bind();if(l.indexOf(e)<0){throw new Error("gl-texture2d: Unknown wrap mode "+e)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,e);return this._wrapS=e}},wrapT:{get:function(){return this._wrapT},set:function(e){this.bind();if(l.indexOf(e)<0){throw new Error("gl-texture2d: Unknown wrap mode "+e)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,e);return this._wrapT=e}},wrap:{get:function(){return this._wrapVector},set:function(e){if(!Array.isArray(e)){e=[e,e]}if(e.length!==2){throw new Error("gl-texture2d: Must specify wrap mode for rows and columns")}for(var t=0;t<2;++t){if(l.indexOf(e[t])<0){throw new Error("gl-texture2d: Unknown wrap mode "+e)}}this._wrapS=e[0];this._wrapT=e[1];var r=this.gl;this.bind();r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT);return e}},shape:{get:function(){return this._shapeVector},set:function(e){if(!Array.isArray(e)){e=[e|0,e|0]}else{if(e.length!==2){throw new Error("gl-texture2d: Invalid texture shape")}}c(this,e[0]|0,e[1]|0);return[e[0]|0,e[1]|0]}},width:{get:function(){return this._shape[0]},set:function(e){e=e|0;c(this,e,this._shape[1]);return e}},height:{get:function(){return this._shape[1]},set:function(e){e=e|0;c(this,this._shape[0],e);return e}}});p.bind=function(e){var t=this.gl;if(e!==undefined){t.activeTexture(t.TEXTURE0+(e|0))}t.bindTexture(t.TEXTURE_2D,this.handle);if(e!==undefined){return e|0}return t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0};p.dispose=function(){this.gl.deleteTexture(this.handle)};p.generateMipmap=function(){this.bind();this.gl.generateMipmap(this.gl.TEXTURE_2D);var e=Math.min(this._shape[0],this._shape[1]);for(var t=0;e>0;++t,e>>>=1){if(this._mipLevels.indexOf(t)<0){this._mipLevels.push(t)}}};p.setPixels=function(e,t,r,i){var n=this.gl;this.bind();if(Array.isArray(t)){i=r;r=t[1]|0;t=t[0]|0}else{t=t||0;r=r||0}i=i||0;if(e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLVideoElement){var a=this._mipLevels.indexOf(i)<0;if(a){n.texImage2D(n.TEXTURE_2D,0,this.format,this.format,this.type,e);this._mipLevels.push(i)}else{n.texSubImage2D(n.TEXTURE_2D,i,t,r,this.format,this.type,e)}}else if(e.shape&&e.stride&&e.data){if(e.shape.length<2||t+e.shape[1]>this._shape[1]>>>i||r+e.shape[0]>this._shape[0]>>>i||t<0||r<0){throw new Error("gl-texture2d: Texture dimensions are out of bounds")}v(n,t,r,i,this.format,this.type,this._mipLevels,e)}else{throw new Error("gl-texture2d: Unsupported data type")}};function m(e,t){if(e.length===3){return t[2]===1&&t[1]===e[0]*e[2]&&t[0]===e[2]}return t[0]===1&&t[1]===e[0]}function v(e,t,r,o,s,h,l,u){var c=u.dtype;var d=u.shape.slice();if(d.length<2||d.length>3){throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d")}var p=0,v=0;var g=m(d,u.stride.slice());if(c==="float32"){p=e.FLOAT}else if(c==="float64"){p=e.FLOAT;g=false;c="float32"}else if(c==="uint8"){p=e.UNSIGNED_BYTE}else{p=e.UNSIGNED_BYTE;g=false;c="uint8"}var y=1;if(d.length===2){v=e.LUMINANCE;d=[d[0],d[1],1];u=i(u.data,d,[u.stride[0],u.stride[1],1],u.offset)}else if(d.length===3){if(d[2]===1){v=e.ALPHA}else if(d[2]===2){v=e.LUMINANCE_ALPHA}else if(d[2]===3){v=e.RGB}else if(d[2]===4){v=e.RGBA}else{throw new Error("gl-texture2d: Invalid shape for pixel coords")}y=d[2]}else{throw new Error("gl-texture2d: Invalid shape for texture")}if((v===e.LUMINANCE||v===e.ALPHA)&&(s===e.LUMINANCE||s===e.ALPHA)){v=s}if(v!==s){throw new Error("gl-texture2d: Incompatible texture format for setPixels")}var x=u.size;var _=l.indexOf(o)<0;if(_){l.push(o)}if(p===h&&g){if(u.offset===0&&u.data.length===x){if(_){e.texImage2D(e.TEXTURE_2D,o,s,d[0],d[1],0,s,h,u.data)}else{e.texSubImage2D(e.TEXTURE_2D,o,t,r,d[0],d[1],s,h,u.data)}}else{if(_){e.texImage2D(e.TEXTURE_2D,o,s,d[0],d[1],0,s,h,u.data.subarray(u.offset,u.offset+x))}else{e.texSubImage2D(e.TEXTURE_2D,o,t,r,d[0],d[1],s,h,u.data.subarray(u.offset,u.offset+x))}}}else{var b;if(h===e.FLOAT){b=a.mallocFloat32(x)}else{b=a.mallocUint8(x)}var w=i(b,d,[d[2],d[2]*d[0],1]);if(p===e.FLOAT&&h===e.UNSIGNED_BYTE){f(w,u)}else{n.assign(w,u)}if(_){e.texImage2D(e.TEXTURE_2D,o,s,d[0],d[1],0,s,h,b.subarray(0,x))}else{e.texSubImage2D(e.TEXTURE_2D,o,t,r,d[0],d[1],s,h,b.subarray(0,x))}if(h===e.FLOAT){a.freeFloat32(b)}else{a.freeUint8(b)}}}function g(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);return t}function y(e,t,r,i,n){var a=e.getParameter(e.MAX_TEXTURE_SIZE);if(t<0||t>a||r<0||r>a){throw new Error("gl-texture2d: Invalid texture shape")}if(n===e.FLOAT&&!o(e).texture_float){throw new Error("gl-texture2d: Floating point textures not supported on this platform")}var s=g(e);e.texImage2D(e.TEXTURE_2D,0,i,t,r,0,i,n,null);return new d(e,s,t,r,i,n)}function x(e,t,r,i){var n=g(e);e.texImage2D(e.TEXTURE_2D,0,r,r,i,t);return new d(e,n,t.width|0,t.height|0,r,i)}function _(e,t){var r=t.dtype;var s=t.shape.slice();var h=e.getParameter(e.MAX_TEXTURE_SIZE);if(s[0]<0||s[0]>h||s[1]<0||s[1]>h){throw new Error("gl-texture2d: Invalid texture size")}var l=m(s,t.stride.slice());var u=0;if(r==="float32"){u=e.FLOAT}else if(r==="float64"){u=e.FLOAT;l=false;r="float32"}else if(r==="uint8"){u=e.UNSIGNED_BYTE}else{u=e.UNSIGNED_BYTE;l=false;r="uint8"}var c=0;if(s.length===2){c=e.LUMINANCE;s=[s[0],s[1],1];t=i(t.data,s,[t.stride[0],t.stride[1],1],t.offset)}else if(s.length===3){if(s[2]===1){c=e.ALPHA}else if(s[2]===2){c=e.LUMINANCE_ALPHA}else if(s[2]===3){c=e.RGB}else if(s[2]===4){c=e.RGBA}else{throw new Error("gl-texture2d: Invalid shape for pixel coords")}}else{throw new Error("gl-texture2d: Invalid shape for texture")}if(u===e.FLOAT&&!o(e).texture_float){u=e.UNSIGNED_BYTE;l=false}var p,v;var y=t.size;if(!l){var x=[s[2],s[2]*s[0],1];v=a.malloc(y,r);var _=i(v,s,x,0);if((r==="float32"||r==="float64")&&u===e.UNSIGNED_BYTE){f(_,t)}else{n.assign(_,t)}p=v.subarray(0,y)}else if(t.offset===0&&t.data.length===y){p=t.data}else{p=t.data.subarray(t.offset,t.offset+y)}var b=g(e);e.texImage2D(e.TEXTURE_2D,0,c,s[0],s[1],0,c,u,p);if(!l){a.free(v)}return new d(e,b,s[0],s[1],c,u)}function b(e){if(arguments.length<=1){throw new Error("gl-texture2d: Missing arguments for texture2d constructor")}if(!s){u(e)}if(typeof arguments[1]==="number"){return y(e,arguments[1],arguments[2],arguments[3]||e.RGBA,arguments[4]||e.UNSIGNED_BYTE)}if(Array.isArray(arguments[1])){return y(e,arguments[1][0]|0,arguments[1][1]|0,arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE)}if(typeof arguments[1]==="object"){var t=arguments[1];if(t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof ImageData){return x(e,t,arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE)}else if(t.shape&&t.data&&t.stride){return _(e,t)}}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}},{ndarray:31,"ndarray-ops":20,"typedarray-pool":27,webglew:29}],31:[function(e,t,r){(function(r){var i=e("iota-array");var n=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"];var a=typeof Float64Array!=="undefined";var o=typeof r!=="undefined";function s(e,t){return e[0]-t[0]}function h(){var e=this.stride;var t=new Array(e.length);var r;for(r=0;r<t.length;++r){t[r]=[Math.abs(e[r]),r]}t.sort(s);var i=new Array(t.length);for(r=0;r<i.length;++r){i[r]=t[r][1]}return i}function l(e,t){var r=["View",t,"d",e].join("");if(t<0){r="View_Nil"+e}var a=e==="generic";if(t===-1){var o="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";var s=new Function(o);return s()}else if(t===0){var o="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";var s=new Function("TrivialArray",o);return s(f[e][0])}var o=["'use strict'"];var l=i(t);var u=l.map(function(e){return"i"+e});var c="this.offset+"+l.map(function(e){return"this._stride"+e+"*i"+e}).join("+");o.push("function "+r+"(a,"+l.map(function(e){return"b"+e}).join(",")+","+l.map(function(e){return"c"+e}).join(",")+",d){this.data=a");for(var d=0;d<t;++d){o.push("this._shape"+d+"=b"+d+"|0")}for(var d=0;d<t;++d){o.push("this._stride"+d+"=c"+d+"|0")}o.push("this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t);var p="VStride"+t+"d"+e;var m="VShape"+t+"d"+e;var v={stride:p,shape:m};for(var g in v){var y=v[g];o.push("function "+y+"(v) {this._v=v} var aproto="+y+".prototype","aproto.length="+t);var x=[];for(var d=0;d<t;++d){x.push(["this._v._",g,d].join(""))}o.push("aproto.toJSON=function "+y+"_toJSON(){return ["+x.join(",")+"]}","aproto.valueOf=aproto.toString=function "+y+"_toString(){return ["+x.join(",")+"].join()}");for(var d=0;d<t;++d){o.push("Object.defineProperty(aproto,"+d+",{get:function(){return this._v._"+g+d+"},set:function(v){return this._v._"+g+d+"=v|0},enumerable:true})")}for(var d=0;d<n.length;++d){if(n[d]in Array.prototype){o.push("aproto."+n[d]+"=Array.prototype."+n[d])}}o.push(["Object.defineProperty(proto,'",g,"',{get:function ",y,"_get(){return new ",y,"(this)},set: function ",y,"_set(v){"].join(""));for(var d=0;d<t;++d){o.push("this._"+g+d+"=v["+d+"]|0")}o.push("return v}})")}o.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+l.map(function(e){return"this._shape"+e}).join("*"),"}})");if(t===1){o.push("proto.order=[0]")}else{o.push("Object.defineProperty(proto,'order',{get:");if(t<4){o.push("function "+r+"_order(){");if(t===2){o.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})")}else if(t===3){o.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")}}else{o.push("ORDER})")}}o.push("proto.set=function "+r+"_set("+u.join(",")+",v){");if(a){o.push("return this.data.set("+c+",v)}")}else{o.push("return this.data["+c+"]=v}")}o.push("proto.get=function "+r+"_get("+u.join(",")+"){");if(a){o.push("return this.data.get("+c+")}")}else{o.push("return this.data["+c+"]}")}o.push("proto.index=function "+r+"_index(",u.join(),"){return "+c+"}");o.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+l.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this._shape",e,":i",e,"|0"].join("")}).join(",")+","+l.map(function(e){return"this._stride"+e}).join(",")+",this.offset)}");var _=l.map(function(e){return"a"+e+"=this._shape"+e});var b=l.map(function(e){return"c"+e+"=this._stride"+e});o.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+_.join(",")+","+b.join(","));for(var d=0;d<t;++d){o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}")}o.push("return new "+r+"(this.data,"+l.map(function(e){return"a"+e}).join(",")+","+l.map(function(e){return"c"+e}).join(",")+",b)}");o.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+l.map(function(e){return"a"+e+"=this._shape"+e}).join(",")+","+l.map(function(e){return"b"+e+"=this._stride"+e}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var d=0;d<t;++d){o.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}")}o.push("return new "+r+"(this.data,"+l.map(function(e){return"a"+e}).join(",")+","+l.map(function(e){return"b"+e}).join(",")+",c)}");var w=new Array(t);var M=new Array(t);for(var d=0;d<t;++d){w[d]="a[i"+d+"]";M[d]="b[i"+d+"]"}o.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+w.join(",")+","+M.join(",")+",this.offset)}");o.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(var d=0;d<t;++d){o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this._stride"+d+"*i"+d+")|0}else{a.push(this._shape"+d+");b.push(this._stride"+d+")}")}o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}");o.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+l.map(function(e){return"shape["+e+"]"}).join(",")+","+l.map(function(e){return"stride["+e+"]"}).join(",")+",offset)}");var s=new Function("CTOR_LIST","ORDER",o.join("\n"));return s(f[e],h)}function u(e){if(o){if(r.isBuffer(e)){return"buffer"}}if(a){switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}}if(Array.isArray(e)){return"array"}return"generic"}var f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};(function(){for(var e in f){f[e].push(l(e,-1))}});function c(e,t,r,i){if(e===undefined){var n=f.array[0];return n([])}else if(typeof e==="number"){e=[e]}if(t===undefined){t=[e.length]}var a=t.length;if(r===undefined){r=new Array(a);for(var o=a-1,s=1;o>=0;--o){r[o]=s;s*=t[o]}}if(i===undefined){i=0;for(var o=0;o<a;++o){if(r[o]<0){i-=(t[o]-1)*r[o]}}}var h=u(e);var c=f[h];while(c.length<=a+1){c.push(l(h,c.length-1))}var n=c[a+1];return n(e,t,r,i)}t.exports=c}).call(this,e("buffer").Buffer)},{buffer:2,"iota-array":32}],32:[function(e,t,r){"use strict";function i(e){var t=new Array(e);for(var r=0;r<e;++r){t[r]=r}return t}t.exports=i},{}],33:[function(e,t,r){var i=e("gl-aliased-vao");var n=e("gl-buffer");t.exports.floatsPerVertex=5;function a(e){var t=e*6;var r=new Uint16Array(t);for(var i=0,n=0;i<t;i+=6,n+=4){r[i+0]=n+0;r[i+1]=n+1;r[i+2]=n+2;r[i+3]=n+0;r[i+4]=n+2;r[i+5]=n+3}return r}t.exports.mixins={create:function o(e){e=e||{};this.clear();if(this.vao)this.dispose();var r=typeof e.capacity==="number"?e.capacity:100;if(r>10922)throw new Error("Can't have more than 10922 quads per batch: "+r);this._capacity=r;var o=r*4*t.exports.floatsPerVertex;this.vertices=new Float32Array(o);this.indices=a(r);var s=this.gl;var h=e.dynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW;this.vertexBuffer=n(s,this.vertices,s.ARRAY_BUFFER,h);this.indexBuffer=n(s,this.indices,s.ELEMENT_ARRAY_BUFFER,s.STATIC_DRAW);var l=5*4;this.vao=i(s,[{name:"position",buffer:this.vertexBuffer,size:2,stride:l},{name:"texcoord0",buffer:this.vertexBuffer,size:2,offset:2*4,stride:l},{name:"color",buffer:this.vertexBuffer,size:4,stride:l,offset:4*4,type:s.UNSIGNED_BYTE,normalized:true}],this.indexBuffer);return this},ensureCapacity:function(e){if(this.capacity<e)this.create({capacity:e});return this}}},{"gl-aliased-vao":35,"gl-buffer":38}],34:[function(e,t,r){var i=e("./pack-rgba-float");var n=e("mixes");var a=e("premultiplied-rgba");var o=e("gl-white-texture");var s=e("./common").floatsPerVertex;var h=[0,0],l=[0,0],u=[0,0,0,0],f=[0,0,0,0];var c=[0,0,0,0],d=[0,0],p=[0,0];function m(e,t){if(!(this instanceof m))return new m(e,t);if(!e)throw new Error("must specify gl context");this.gl=e;t=t||{};this._bound=false;this.idx=0;this.transform=null;this._defaultTexture=o(e);this._lastTexture=this._defaultTexture;this._texture=this._defaultTexture;this.texture=null;this.mode=typeof t.mode==="number"?t.mode:e.TRIANGLES;this.premultiplied=t.premultiplied||false;this._dirty=true;this.create(t);this.defaults()}n(m,e("./common").mixins);n(m,{capacity:{get:function(){return this._capacity}},texture:{get:function(){return this._texture},set:function(e){this._texture=e||this._defaultTexture}},dispose:function(){if(this.vertexBuffer)this.vertexBuffer.dispose();if(this.indexBuffer)this.indexBuffer.dispose();if(this.vao)this.vao.dispose()},clear:function(){this.idx=0;return this},bind:function(e){e.bind();this.vao.bind(e);this._bound=true},unbind:function(){this.vao.unbind();this._bound=false},defaults:function(){this.position=v(h,0,0);this.texcoord=g(u,0,0,1,1);this.color=g(f,1,1,1,1);this.shape=v(l,0,0);return this},push:function(e){if(e){this.texture=e.texture;this.position=e.position||v(h,0,0);this.texcoord=e.texcoord||g(u,0,0,1,1);this.color=e.color||g(f,1,1,1,1);this.shape=e.shape||v(l,0,0)}if(this.texture!==this._lastTexture){if(this._bound)this.flush();this._lastTexture=this.texture}else if(this.idx===this.vertices.length){if(!this._bound)return this;this.flush()}this._dirty=true;var t=this.premultiplied?a(this.color,c):this.color;var r=i(t);var n=this.texcoord[0],o=this.texcoord[1],s=this.texcoord[2],d=this.texcoord[3];var p=this.position[0],m=this.position[1],y=this.shape[0],x=this.shape[1];this._vert(p,m,n,o,r);this._vert(p+y,m,s,o,r);this._vert(p+y,m+x,s,d,r);this._vert(p,m+x,n,d,r);return this},_vert:function(e,t,r,i,n){var a=this.idx,o=this.vertices,s=this.transform;if(s){var h=e,l=t;e=s[0]*h+s[4]*l+s[12];t=s[1]*h+s[5]*l+s[13]}o[a++]=e;o[a++]=t;o[a++]=r;o[a++]=i;o[a++]=n;this.idx=a},flush:function(){this.draw();return this.clear()},draw:function(){if(this.idx===0||!this._bound)return this;var e=this.gl;if(this._dirty){var t=this.vertices.subarray(0,this.idx);this.vertexBuffer.update(t,0);this._dirty=false}if(this._lastTexture)this._lastTexture.bind();this._lastTexture=this.texture;var r=this.idx/(s*4);if(r>0)this.vao.draw(this.mode,r*6,0);return this}});t.exports=m;function v(e,t,r){e[0]=t;e[1]=r;return e}function g(e,t,r,i,n){e[0]=t;e[1]=r;e[2]=i;e[3]=n;return e}function y(e,t){return v(e,t[0],t[1])}function x(e,t,r){var i=t[0],n=t[1];e[0]=r[0]*i+r[4]*n+r[12];e[1]=r[1]*i+r[5]*n+r[13];return e}},{"./common":33,"./pack-rgba-float":69,"gl-white-texture":51,mixes:65,"premultiplied-rgba":68}],35:[function(e,t,r){var i=e("./lib/vao-emulated.js");function n(e,t,r,n){var a=i(e);a.update(t,r,n);return a}t.exports=n},{"./lib/vao-emulated.js":37}],36:[function(e,t,r){function i(e,t){if(!e)return null;var r=t.attributes;if(r[e])return r[e].location;return null}var n=null;var a=null;function o(e,t,r,o){if(t){t.bind()}else{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}if(n===null){n=e.getParameter(e.MAX_VERTEX_ATTRIBS)|0;a=new Array(n)}if(r){if(r.length>n){throw new Error("gl-vao: Too many vertex attributes")}var s=null;for(v=0;v<n;v++)a[v]=false;for(v=0;v<r.length;v++){var h=r[v];var l=i(h.name,o);if(l===null)continue;a[l]=true;if(h.buffer){var u=h.buffer;var f=h.size||4;var c=h.type||e.FLOAT;var d=!!h.normalized;var p=h.stride||0;var m=h.offset||0;if(s!==u){u.bind();s=u}e.enableVertexAttribArray(l);e.vertexAttribPointer(l,f,c,d,p,m)}else{if(typeof h==="number"){e.vertexAttrib1f(l,h)}else if(h.length===1){e.vertexAttrib1f(l,h[0])}else if(h.length===2){e.vertexAttrib2f(l,h[0],h[1])}else if(h.length===3){e.vertexAttrib3f(l,h[0],h[1],h[2])}else if(h.length===4){e.vertexAttrib4f(l,h[0],h[1],h[2],h[3])}else{throw new Error("gl-vao: Invalid vertex attribute")}e.disableVertexAttribArray(l)}}for(v=0;v<n;v++){if(!a[v])e.disableVertexAttribArray(v)}}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var v=0;v<n;++v){e.disableVertexAttribArray(v)}}}t.exports=o},{}],37:[function(e,t,r){var i=e("./do-bind.js");function n(e){this.gl=e;this._elements=null;this._attributes=null;this._elementsType=e.UNSIGNED_SHORT}n.prototype.bind=function(e){if(!e)throw new Error("must associate shader with vertex array");i(this.gl,this._elements,this._attributes,e)};n.prototype.update=function(e,t,r){this._elements=t;this._attributes=e;this._elementsType=r||this.gl.UNSIGNED_SHORT};n.prototype.dispose=function(){};n.prototype.unbind=function(){i(this.gl)};n.prototype.draw=function(e,t,r){r=r||0;var i=this.gl;if(this._elements){i.drawElements(e,t,this._elementsType,r)}else{i.drawArrays(e,r,t)}};function a(e){return new n(e)}t.exports=a},{"./do-bind.js":36}],38:[function(e,t,r){"use strict";var i=e("typedarray-pool");var n=e("ndarray-ops");var a=e("ndarray");var o=e("webglew");var s=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"];function h(e,t,r,i,n){this.gl=e;this.type=t;this.handle=r;this.length=i;this.usage=n}var l=h.prototype;l.bind=function(){this.gl.bindBuffer(this.type,this.handle)};l.unbind=function(){this.gl.bindBuffer(this.type,null)};l.dispose=function(){this.gl.deleteBuffer(this.handle)};function u(e,t,r,i,n,a){var o=n.length*n.BYTES_PER_ELEMENT;if(a<0){e.bufferData(t,n,i);return o}if(o+a>r){throw new Error("gl-buffer: If resizing buffer, must not specify offset")}e.bufferSubData(t,a,n);return r}function f(e,t){var r=i.malloc(e.length,t);var n=e.length;for(var a=0;a<n;++a){r[a]=e[a]}return r}function c(e,t){var r=1;for(var i=t.length-1;i>=0;--i){if(t[i]!==r){return false}r*=e[i]}return true}l.update=function(e,t){if(typeof t!=="number"){t=-1}this.bind();if(typeof e==="object"&&typeof e.shape!=="undefined"){var r=e.dtype;if(s.indexOf(r)<0){r="float32"}if(this.type===this.gl.ELEMENT_ARRAY_BUFFER){var h=o(this.gl);var l=h.OES_element_index_uint;if(l&&r!=="uint16"){r="uint32"}else{r="uint16"}}if(r===e.dtype&&c(e.shape,e.stride)){if(e.offset===0&&e.data.length===e.shape[0]){this.length=u(this.gl,this.type,this.length,this.usage,e.data,t)}else{this.length=u(this.gl,this.type,this.length,this.usage,e.data.subarray(e.offset,e.shape[0]),t)}}else{var d=i.malloc(e.size,r);var p=a(d,e.shape);n.assign(p,e);if(t<0){this.length=u(this.gl,this.type,this.length,this.usage,d,t)}else{this.length=u(this.gl,this.type,this.length,this.usage,d.subarray(0,e.size),t)}i.free(d)}}else if(Array.isArray(e)){var m;if(this.type===this.gl.ELEMENT_ARRAY_BUFFER){m=f(e,"uint16")}else{m=f(e,"float32")}if(t<0){this.length=u(this.gl,this.type,this.length,this.usage,m,t)}else{this.length=u(this.gl,this.type,this.length,this.usage,m.subarray(0,e.length),t)}i.free(m)}else if(typeof e==="object"&&typeof e.length==="number"){this.length=u(this.gl,this.type,this.length,this.usage,e,t)}else if(typeof e==="number"||e===undefined){if(t>=0){throw new Error("gl-buffer: Cannot specify offset when resizing buffer")}e=e|0;if(e<=0){e=1}this.gl.bufferData(this.type,e|0,this.usage);this.length=e}else{throw new Error("gl-buffer: Invalid data type")}};function d(e,t,r,i){o(e);r=r||e.ARRAY_BUFFER;i=i||e.DYNAMIC_DRAW;if(r!==e.ARRAY_BUFFER&&r!==e.ELEMENT_ARRAY_BUFFER){throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER")}if(i!==e.DYNAMIC_DRAW&&i!==e.STATIC_DRAW&&i!==e.STREAM_DRAW){throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW")}var n=e.createBuffer();var a=new h(e,r,n,0,i);a.update(t);return a}t.exports=d},{ndarray:44,"ndarray-ops":39,"typedarray-pool":48,webglew:50}],39:[function(e,t,r){t.exports=e(20)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/ndarray-ops.js":20,"cwise-compiler":40}],40:[function(e,t,r){t.exports=e(21)},{"./lib/thunk.js":42,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/compiler.js":21}],41:[function(e,t,r){t.exports=e(22)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/compile.js":22,uniq:43}],42:[function(e,t,r){t.exports=e(23)},{"./compile.js":41,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/thunk.js":23}],43:[function(e,t,r){t.exports=e(24)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/node_modules/uniq/uniq.js":24}],44:[function(e,t,r){t.exports=e(31)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/ndarray.js":31,buffer:2,"iota-array":45}],45:[function(e,t,r){t.exports=e(32)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/node_modules/iota-array/iota.js":32}],46:[function(e,t,r){t.exports=e(25)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/node_modules/bit-twiddle/twiddle.js":25}],47:[function(e,t,r){t.exports=e(17)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/node_modules/dup/dup.js":17}],48:[function(e,t,r){t.exports=e(27)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/pool.js":27,"bit-twiddle":46,buffer:2,dup:47}],49:[function(e,t,r){t.exports=e(28)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/node_modules/weakmap/weakmap.js":28}],50:[function(e,t,r){t.exports=e(29)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/webglew.js":29,weakmap:49}],51:[function(e,t,r){var i=e("gl-texture2d");var n=e("ndarray");t.exports=function(e){var t=Array.apply(null,new Array(16)).map(Number.prototype.valueOf,255);var r=n(new Uint8Array(t),[2,2,4]);return i(e,r)}},{"gl-texture2d":62,ndarray:63}],52:[function(e,t,r){t.exports=e(20)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/ndarray-ops.js":20,"cwise-compiler":53}],53:[function(e,t,r){t.exports=e(21)},{"./lib/thunk.js":55,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/compiler.js":21}],54:[function(e,t,r){t.exports=e(22)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/compile.js":22,uniq:56}],55:[function(e,t,r){t.exports=e(23)},{"./compile.js":54,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/thunk.js":23}],56:[function(e,t,r){t.exports=e(24)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/node_modules/uniq/uniq.js":24}],57:[function(e,t,r){t.exports=e(25)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/node_modules/bit-twiddle/twiddle.js":25}],58:[function(e,t,r){t.exports=e(17)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/node_modules/dup/dup.js":17}],59:[function(e,t,r){t.exports=e(27)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/pool.js":27,"bit-twiddle":57,buffer:2,dup:58}],60:[function(e,t,r){t.exports=e(28)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/node_modules/weakmap/weakmap.js":28}],61:[function(e,t,r){t.exports=e(29)
},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/webglew.js":29,weakmap:60}],62:[function(e,t,r){t.exports=e(30)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/texture.js":30,ndarray:63,"ndarray-ops":52,"typedarray-pool":59,webglew:61}],63:[function(e,t,r){t.exports=e(31)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/ndarray.js":31,buffer:2,"iota-array":64}],64:[function(e,t,r){t.exports=e(32)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/node_modules/iota-array/iota.js":32}],65:[function(e,t,r){var i=e("xtend");var n={enumerable:true,configurable:true};function a(e,t){for(var r in t){if(!t.hasOwnProperty(r))continue;var a=t[r];if(typeof a==="function"){e[r]=a}else if(a&&typeof a==="object"){var o=i(n,a);Object.defineProperty(e,r,o)}}}t.exports=function o(e,t){a(e.prototype,t)};t.exports.mix=a},{xtend:66}],66:[function(e,t,r){t.exports=i;function i(){var e={};for(var t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(r.hasOwnProperty(i)){e[i]=r[i]}}}return e}},{}],67:[function(e,t,r){var i=new Int8Array(4);var n=new Int32Array(i.buffer,0,1);var a=new Float32Array(i.buffer,0,1);var o=function(){};o.intBitsToFloat=function(e){n[0]=e;return a[0]};o.floatToIntBits=function(e){a[0]=e;return n[0]};o.intToFloatColor=function(e){return o.intBitsToFloat(e&4278190079)};o.colorToFloat=function(e,t,r,i){var n=i<<24|r<<16|t<<8|e;return o.intToFloatColor(n)};o.isPowerOfTwo=function(e){return(e&e-1)===0};o.nextPowerOfTwo=function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;return e+1};t.exports=o},{}],68:[function(e,t,r){function i(e,t){if(!t||typeof t==="number")t=[0,0,0,0];t[0]=e[0]*e[3];t[1]=e[1]*e[3];t[2]=e[2]*e[3];t[3]=e[3];return t}t.exports=i},{}],69:[function(e,t,r){var i=e("number-util").colorToFloat;t.exports=function n(e){return i(~~(e[0]*255),~~(e[1]*255),~~(e[2]*255),~~(e[3]*255))}},{"number-util":67}],70:[function(e,t,r){var i=e("gl-shader-core");var n=e("deepcopy");var a=["position","normal","color"];var o="texcoord";function s(e){var t=a.indexOf(e);if(t!==-1)return t;if(e.indexOf(o)===0)return parseInt(e.substring(o.length),10)|0+3;return undefined}function h(e){e.location=s(e.name)}t.exports=function(e){return function(t){var r=n(e);r.attributes.forEach(h);return i(t,r.vertex,r.fragment,r.uniforms,r.attributes)}}},{deepcopy:72,"gl-shader-core":100}],71:[function(e,t,r){var i=e("glslify");var n=e("gl-quad");var a=e("inherits");var o=e("./create-shader")(e("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nattribute vec4 position;\nattribute vec2 uv;\nuniform mat4 projection;\nuniform mat4 view;\nuniform mat4 model;\nvarying vec2 vUv;\nvoid main() {\n  gl_Position = projection * view * model * position;\n  vUv = uv;\n}","\n#define GLSLIFY 1\n\n#ifdef GL_ES\n\nprecision mediump float;\n#endif\n\nvarying vec2 vUv;\nhighp float a_x_random(vec2 co) {\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float dt = dot(co.xy, vec2(a, b));\n  highp float sn = mod(dt, 3.14);\n  return fract(sin(sn) * c);\n}\nuniform float aspect;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform bool coloredNoise;\nuniform vec2 smoothing;\nuniform float noiseAlpha;\nuniform vec3 color1;\nuniform vec3 color2;\nvec3 BlendOverlay(vec3 base, vec3 blend) {\n  return vec3(base.r < 0.5 ? (2.0 * base.r * blend.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r)), base.g < 0.5 ? (2.0 * base.g * blend.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - blend.g)), base.b < 0.5 ? (2.0 * base.b * blend.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - blend.b)));\n}\nvoid main() {\n  vec2 pos = vUv;\n  pos -= 0.5;\n  pos.x *= aspect;\n  pos /= scale;\n  pos -= offset;\n  float dist = length(pos);\n  dist = smoothstep(smoothing.x, smoothing.y, 1. - dist);\n  vec4 color = vec4(1.0);\n  color.rgb = mix(color2, color1, dist);\n  if(noiseAlpha > 0.0) {\n    vec3 noise = coloredNoise ? vec3(a_x_random(vUv * 1.5), a_x_random(vUv * 2.5), a_x_random(vUv)) : vec3(a_x_random(vUv));\n    color.rgb = mix(color.rgb, BlendOverlay(color.rgb, noise), noiseAlpha);\n  }\n  gl_FragColor = color;\n}",[{name:"projection",type:"mat4"},{name:"view",type:"mat4"},{name:"model",type:"mat4"},{name:"aspect",type:"float"},{name:"scale",type:"vec2"},{name:"offset",type:"vec2"},{name:"coloredNoise",type:"bool"},{name:"smoothing",type:"vec2"},{name:"noiseAlpha",type:"float"},{name:"color1",type:"vec3"},{name:"color2",type:"vec3"}],[{name:"position",type:"vec4"},{name:"uv",type:"vec2"}]));var s=e("gl-mat4/identity");var h=e("gl-mat4/create");function l(e,t){if(!(this instanceof l))return new l(e,t);n.call(this,e);t=t||{};this.gl=e;var r=t.shader;if(!r)this.defaultShader=o(e);this.shader=r||this.defaultShader;var i=s(h());this.style({aspect:e.canvas.width/e.canvas.height,smoothing:[-.4,.8],noiseAlpha:.04,coloredNoise:true,offset:[0,0],color1:[1,1,1],color2:[0,0,0],scale:[1,1],projection:i,view:i,model:i});if(t)this.style(t)}a(l,n);l.prototype.style=function(e){if(!e)return;this.shader.bind();var t=this.shader.uniforms;for(var r in e){if(e.hasOwnProperty(r)&&(e[r]||typeof e[r]==="number")){t[r]=e[r]}}};l.prototype.draw=function(){n.prototype.draw.call(this,this.shader)};l.prototype.dispose=function(){if(this.defaultShader){this.defaultShader.dispose();this.defaultShader=undefined}n.prototype.dispose.call(this)};t.exports=l},{"./create-shader":70,"gl-mat4/create":74,"gl-mat4/identity":75,"gl-quad":76,glslify:101,"glslify/simple-adapter.js":102,inherits:103}],72:[function(e,t,r){t.exports=e("./lib/deepcopy")},{"./lib/deepcopy":73}],73:[function(e,t,r){(function(){var r=typeof t!=="undefined"?e("util"):function(){var e=Object.prototype.toString;function t(t){return typeof t==="object"&&e.call(t)==="[object Array]"}function r(t){return typeof t==="object"&&e.call(t)==="[object Date]"}function i(t){return typeof t==="object"&&e.call(t)==="[object RegExp]"}return{isArray:Array.isArray||t,isDate:r,isRegExp:i}}();var i=Object.keys||function(e){var t=[],r;if(e===null||typeof e!=="object"){throw new TypeError("parameter type is not an Object")}for(r in e){e.hasOwnProperty(r)&&t.push(r)}return t};function n(e,t){var i,n;if(!r.isArray(e)){throw new TypeError("parameter type is not an Array")}for(i=0,n=e.length;i<n;++i){if(e[i]===t){return i}}return-1}function a(e){var t=r.isArray(e)?[]:{},a=[e],o=[t];function s(e,t,a,o){var h,l,u,f,c,d,p,m;if(e===null||typeof e!=="object"){return e}if(r.isDate(e)){return new Date(Number(e))}if(r.isRegExp(e)){return new RegExp(e.source,String(e).slice(e.source.length+2))}h=i(e);for(l=0,u=h.length;l<u;++l){f=h[l];c=e[f];if(c!==null&&typeof c==="object"){d=n(a,c);if(d===-1){p=r.isArray(c)?[]:{};a.push(c);o.push(p)}else{m=o[d]}}t[f]=m||s(c,p,a,o);d=p=m=null}return t}return s(e,t,a,o)}if(typeof t!=="undefined"){t.exports=a}else{this.deepcopy=a}})()},{util:9}],74:[function(e,t,r){t.exports=i;function i(){var e=new Float32Array(16);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}},{}],75:[function(e,t,r){t.exports=e(13)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-mat4/identity.js":13}],76:[function(e,t,r){var i=e("gl-buffer");var n=e("gl-vao");function a(e){if(!(this instanceof a))return new a(e);this.gl=e;this.vertices=i(e,new Float32Array([-1,-1,-1,1,1,1,1,-1]),e.ARRAY_BUFFER,e.STATIC_DRAW);this.texcoords=i(e,new Float32Array([0,1,0,0,1,0,1,1]),e.ARRAY_BUFFER,e.STATIC_DRAW);this.elements=i(e,new Uint16Array([0,1,2,0,2,3]),e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW);this.vao=n(e,[{buffer:this.vertices,size:2,noramlized:false},{buffer:this.texcoords,size:2,normalized:false}],this.elements)}a.prototype.draw=function(e){if(e)e.bind();this.vao.bind();this.vao.draw(this.gl.TRIANGLES,6);this.vao.unbind()};a.prototype.dispose=function(){this.vertices.dispose();this.texcoords.dispose();this.elements.dispose();this.vao.dispose();this.gl=null};t.exports=a},{"gl-buffer":77,"gl-vao":95}],77:[function(e,t,r){t.exports=e(38)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-sprite-batch/node_modules/gl-buffer/buffer.js":38,ndarray:83,"ndarray-ops":78,"typedarray-pool":87,webglew:89}],78:[function(e,t,r){t.exports=e(20)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/ndarray-ops.js":20,"cwise-compiler":79}],79:[function(e,t,r){t.exports=e(21)},{"./lib/thunk.js":81,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/compiler.js":21}],80:[function(e,t,r){t.exports=e(22)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/compile.js":22,uniq:82}],81:[function(e,t,r){t.exports=e(23)},{"./compile.js":80,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/lib/thunk.js":23}],82:[function(e,t,r){t.exports=e(24)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/ndarray-ops/node_modules/cwise-compiler/node_modules/uniq/uniq.js":24}],83:[function(e,t,r){t.exports=e(31)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/ndarray.js":31,buffer:2,"iota-array":84}],84:[function(e,t,r){t.exports=e(32)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/ndarray/node_modules/iota-array/iota.js":32}],85:[function(e,t,r){t.exports=e(25)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/node_modules/bit-twiddle/twiddle.js":25}],86:[function(e,t,r){t.exports=e(17)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/node_modules/dup/dup.js":17}],87:[function(e,t,r){t.exports=e(27)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/typedarray-pool/pool.js":27,"bit-twiddle":85,buffer:2,dup:86}],88:[function(e,t,r){t.exports=e(28)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/node_modules/weakmap/weakmap.js":28}],89:[function(e,t,r){t.exports=e(29)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/webglew.js":29,weakmap:88}],90:[function(e,t,r){"use strict";function i(e,t,r){if(t){t.bind()}else{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}var i=e.getParameter(e.MAX_VERTEX_ATTRIBS)|0;if(r){if(r.length>i){throw new Error("gl-vao: Too many vertex attributes")}for(var n=0;n<r.length;++n){var a=r[n];if(a.buffer){var o=a.buffer;var s=a.size||4;var h=a.type||e.FLOAT;var l=!!a.normalized;var u=a.stride||0;var f=a.offset||0;o.bind();e.enableVertexAttribArray(n);e.vertexAttribPointer(n,s,h,l,u,f)}else{if(typeof a==="number"){e.vertexAttrib1f(n,a)}else if(a.length===1){e.vertexAttrib1f(n,a[0])}else if(a.length===2){e.vertexAttrib2f(n,a[0],a[1])}else if(a.length===3){e.vertexAttrib3f(n,a[0],a[1],a[2])}else if(a.length===4){e.vertexAttrib4f(n,a[0],a[1],a[2],a[3])}else{throw new Error("gl-vao: Invalid vertex attribute")}e.disableVertexAttribArray(n)}}for(;n<i;++n){e.disableVertexAttribArray(n)}}else{e.bindBuffer(e.ARRAY_BUFFER,null);for(var n=0;n<i;++n){e.disableVertexAttribArray(n)}}}t.exports=i},{}],91:[function(e,t,r){"use strict";var i=e("./do-bind.js");function n(e){this.gl=e;this._elements=null;this._attributes=null;this._elementsType=e.UNSIGNED_SHORT}n.prototype.bind=function(){i(this.gl,this._elements,this._attributes)};n.prototype.update=function(e,t,r){this._elements=t;this._attributes=e;this._elementsType=r||this.gl.UNSIGNED_SHORT};n.prototype.dispose=function(){};n.prototype.unbind=function(){};n.prototype.draw=function(e,t,r){r=r||0;var i=this.gl;if(this._elements){i.drawElements(e,t,this._elementsType,r)}else{i.drawArrays(e,r,t)}};function a(e){return new n(e)}t.exports=a},{"./do-bind.js":90}],92:[function(e,t,r){"use strict";var i=e("./do-bind.js");function n(e,t,r,i,n,a){this.location=e;this.dimension=t;this.a=r;this.b=i;this.c=n;this.d=a}n.prototype.bind=function(e){switch(this.dimension){case 1:e.vertexAttrib1f(this.location,this.a);break;case 2:e.vertexAttrib2f(this.location,this.a,this.b);break;case 3:e.vertexAttrib3f(this.location,this.a,this.b,this.c);break;case 4:e.vertexAttrib4f(this.location,this.a,this.b,this.c,this.d);break}};function a(e,t,r){this.gl=e;this._ext=t;this.handle=r;this._attribs=[];this._useElements=false;this._elementsType=e.UNSIGNED_SHORT}a.prototype.bind=function(){this._ext.bindVertexArrayOES(this.handle);for(var e=0;e<this._attribs.length;++e){this._attribs[e].bind(this.gl)}};a.prototype.unbind=function(){this._ext.bindVertexArrayOES(null)};a.prototype.dispose=function(){this._ext.deleteVertexArrayOES(this.handle)};a.prototype.update=function(e,t,r){this.bind();i(this.gl,t,e);this.unbind();this._attribs.length=0;if(e)for(var a=0;a<e.length;++a){var o=e[a];if(typeof o==="number"){this._attribs.push(new n(a,1,o))}else if(Array.isArray(o)){this._attribs.push(new n(a,o.length,o[0],o[1],o[2],o[3]))}}this._useElements=!!t;this._elementsType=r||this.gl.UNSIGNED_SHORT};a.prototype.draw=function(e,t,r){r=r||0;var i=this.gl;if(this._useElements){i.drawElements(e,t,this._elementsType,r)}else{i.drawArrays(e,r,t)}};function o(e,t){return new a(e,t,t.createVertexArrayOES())}t.exports=o},{"./do-bind.js":90}],93:[function(e,t,r){t.exports=e(28)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/node_modules/weakmap/weakmap.js":28}],94:[function(e,t,r){t.exports=e(29)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-checker-texture/node_modules/gl-texture2d/node_modules/webglew/webglew.js":29,weakmap:93}],95:[function(e,t,r){"use strict";var i=e("webglew");var n=e("./lib/vao-native.js");var a=e("./lib/vao-emulated.js");function o(e,t,r,o){var s=i(e).OES_vertex_array_object;var h;if(s){h=n(e,s)}else{h=a(e)}h.update(t,r,o);return h}t.exports=o},{"./lib/vao-emulated.js":91,"./lib/vao-native.js":92,webglew:94}],96:[function(e,t,r){t.exports=e(14)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/lib/create-attributes.js":14}],97:[function(e,t,r){t.exports=e(15)},{"./reflect":98,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/lib/create-uniforms.js":15,dup:99}],98:[function(e,t,r){t.exports=e(16)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/lib/reflect.js":16}],99:[function(e,t,r){t.exports=e(17)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/node_modules/dup/dup.js":17}],100:[function(e,t,r){t.exports=e(18)},{"./lib/create-attributes":96,"./lib/create-uniforms":97,"./lib/reflect":98,"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-basic-shader/node_modules/gl-shader-core/shader-core.js":18}],101:[function(e,t,r){t.exports=i;function i(){throw new Error("You should bundle your code "+"using `glslify` as a transform.")}},{}],102:[function(e,t,r){t.exports=i;function i(e,t,r,i){return{vertex:e,fragment:t,uniforms:r,attributes:i}}},{}],103:[function(e,t,r){t.exports=e(6)},{"/projects/npmutils/three-gl-state-example/node_modules/browserify/node_modules/inherits/inherits_browser.js":6}],104:[function(e,t,r){var i=e("canvas-app");var n=e("three-orbit-controls");var a=e("events/");var o=e("xtend");var s=e("as-number");t.exports=function(e){var t=n(e);return function(r){r=r||{};var n=new a;var h=function(i,a,o){n.renderer=new e.WebGLRenderer({canvas:i.canvas});var h=0;if(r.clearColor||typeof r.clearColor==="number")h=r.clearColor;var l=r.clearAlpha||0;n.renderer.setClearColor(h,l);var u=s(r.fov,50);var f=s(r.near,.1);var c=s(r.far,1e3);n.scene=new e.Scene;n.camera=new e.PerspectiveCamera(u,a/o,f,c);var d=r.position||new e.Vector3(1,1,-2);var p=r.target||new e.Vector3;n.camera.position.copy(d);n.camera.lookAt(p);n.controls=new t(n.camera);n.controls.target.copy(p)};var l=function(e,t,r,i){n.emit("tick",i);n.renderer.render(n.scene,n.camera);n.emit("render",i)};var u=function(e,t){if(!n.renderer)return;n.renderer.setViewport(0,0,e,t);n.camera.aspect=e/t;n.camera.updateProjectionMatrix();n.emit("resize",e,t)};var f=i(l,o(r,{context:"webgl",onResize:u}));n.engine=f;document.body.appendChild(f.canvas);document.body.style.margin="0";document.body.style.overflow="hidden";h(f.context,f.width,f.height);f.start();return n}}},{"as-number":105,"canvas-app":106,"events/":112,"three-orbit-controls":113,xtend:114}],105:[function(e,t,r){t.exports=function i(e,t){return typeof e==="number"?e:typeof t==="number"?t:0}},{}],106:[function(e,t,r){var i=e("is-webgl-context");var n=e("webgl-context");var a=e("debounce");var o=e("add-event-listener");function s(e){var t=typeof CanvasRenderingContext2D!=="undefined"&&e instanceof CanvasRenderingContext2D;return e&&(t||i(e))}function h(e,t){if(!(this instanceof h))return new h(e,t);if(typeof e==="object"&&e){t=e;e=null}e=typeof e==="function"?e:t.onRender;t=t||{};t.retina=typeof t.retina==="boolean"?t.retina:true;var r=typeof t.width==="number",l=typeof t.height==="number";if(r||l)t.ignoreResize=true;t.width=r?t.width:window.innerWidth;t.height=l?t.height:window.innerHeight;var u=t.retina?window.devicePixelRatio||1:1;var f,c,d=t.contextAttributes||{};this.isWebGL=false;if(s(t.context)){c=t.context;f=c.canvas}if(!f)f=t.canvas||document.createElement("canvas");f.width=t.width*u;f.height=t.height*u;if(!c){if(t.context==="webgl"||t.context==="experimental-webgl"){c=n({canvas:f,attributes:d});if(!c){throw"WebGL Context Not Supported -- try enabling it or using a different browser"}}else{c=f.getContext(t.context||"2d",d)}}this.isWebGL=i(c);if(t.retina){f.style.width=t.width+"px";f.style.height=t.height+"px"}this.running=false;this.width=t.width;this.height=t.height;this.canvas=f;this.context=c;this.onResize=t.onResize;this._DPR=u;this._retina=t.retina;this._once=t.once;this._ignoreResize=t.ignoreResize;this._lastFrame=null;this._then=Date.now();this.maxDeltaTime=typeof t.maxDeltaTime==="number"?t.maxDeltaTime:1e3/24;this.fps=60;this._frames=0;this._prevTime=this._then;if(!this._ignoreResize){t.resizeDebounce=typeof t.resizeDebounce==="number"?t.resizeDebounce:50;o(window,"resize",a(function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this),t.resizeDebounce,false));o(window,"orientationchange",function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this))}if(typeof e==="function"){this.onRender=e.bind(this)}else{this.onRender=function(e,t,r,i){}}this.renderOnce=function(){var e=Date.now();var t=Math.min(this.maxDeltaTime,e-this._then);this._frames++;if(e>this._prevTime+1e3){this.fps=Math.round(this._frames*1e3/(e-this._prevTime));this._prevTime=e;this._frames=0}if(!this.isWebGL){this.context.save();this.context.scale(this._DPR,this._DPR)}else{this.context.viewport(0,0,this.width*this._DPR,this.height*this._DPR)}this.onRender(this.context,this.width,this.height,t);if(!this.isWebGL)this.context.restore();this._then=e};this._renderHandler=function(){if(!this.running)return;if(!this._once){this._lastFrame=requestAnimationFrame(this._renderHandler)}this.renderOnce()}.bind(this);if(typeof t.onReady==="function"){t.onReady.call(this,c,this.width,this.height)}}Object.defineProperty(h.prototype,"retinaEnabled",{set:function(e){this._retina=e;this._DPR=this._retina?window.devicePixelRatio||1:1;this.resize(this.width,this.height)},get:function(){return this._retina}});Object.defineProperty(h.prototype,"deviceWidth",{get:function(){return this.width*this._DPR}});Object.defineProperty(h.prototype,"deviceHeight",{get:function(){return this.height*this._DPR}});h.prototype.resetFPS=function(){this._frames=0;this._prevTime=Date.now();this._then=this._prevTime;this.fps=60};h.prototype.start=function(){if(this.running)return;if(this._lastFrame)cancelAnimationFrame(this._lastFrame);this.resetFPS();this.running=true;this._lastFrame=requestAnimationFrame(this._renderHandler)};h.prototype.stop=function(){if(this._lastFrame){cancelAnimationFrame(this._lastFrame);this._lastFrame=null}this.running=false};h.prototype.resize=function(e,t){var r=this.canvas;this.width=e;this.height=t;r.width=this.width*this._DPR;r.height=this.height*this._DPR;if(this._retina){r.style.width=this.width+"px";r.style.height=this.height+"px"}if(this._once)requestAnimationFrame(this._renderHandler);if(typeof this.onResize==="function")this.onResize(this.width,this.height)};t.exports=h},{"add-event-listener":107,debounce:108,"is-webgl-context":110,"webgl-context":111}],107:[function(e,t,r){n.removeEventListener=a;n.addEventListener=n;t.exports=n;var i=null;function n(e,t,r,n){i=i||(document.addEventListener?{add:o,rm:s}:{add:h,rm:l});return i.add(e,t,r,n)}function a(e,t,r,n){i=i||(document.addEventListener?{add:o,rm:s}:{add:h,rm:l});return i.rm(e,t,r,n)}function o(e,t,r,i){e.addEventListener(t,r,i)}function s(e,t,r,i){e.removeEventListener(t,r,i)}function h(e,t,r,i){if(i){throw new Error("cannot useCapture in oldIE")}e.attachEvent("on"+t,r)}function l(e,t,r,i){e.detachEvent("on"+t,r)}},{}],108:[function(e,t,r){var i=e("date-now");t.exports=function n(e,t,r){var n,a,o,s,h;if(null==t)t=100;function l(){var u=i()-s;if(u<t&&u>0){n=setTimeout(l,t-u)}else{n=null;if(!r){h=e.apply(o,a);if(!n)o=a=null}}}return function u(){o=this;a=arguments;s=i();var u=r&&!n;if(!n)n=setTimeout(l,t);if(u){h=e.apply(o,a);o=a=null}return h}}},{"date-now":109}],109:[function(e,t,r){t.exports=Date.now||i;function i(){return(new Date).getTime()}},{}],110:[function(e,t,r){t.exports=function(e){if(!e)return false;var t=e;if(typeof e.rawgl!=="undefined")t=e.rawgl;if(typeof WebGLRenderingContext!=="undefined"&&t instanceof WebGLRenderingContext)return true;return false}},{}],111:[function(e,t,r){t.exports=function(e){e=e||{};var t=e.canvas||document.createElement("canvas");if(typeof e.width==="number")t.width=e.width;if(typeof e.height==="number")t.height=e.height;var r=e.attributes||e.attribs||{};try{gl=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}catch(i){gl=null}return gl}},{}],112:[function(e,t,r){function i(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=i;i.EventEmitter=i;i.prototype._events=undefined;i.prototype._maxListeners=undefined;i.defaultMaxListeners=10;i.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};i.prototype.emit=function(e){var t,r,i,a,h,l;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||o(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}throw TypeError('Uncaught, unspecified "error" event.')}}r=this._events[e];if(s(r))return false;if(n(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=arguments.length;a=new Array(i-1);for(h=1;h<i;h++)a[h-1]=arguments[h];r.apply(this,a)}}else if(o(r)){i=arguments.length;a=new Array(i-1);for(h=1;h<i;h++)a[h-1]=arguments[h];l=r.slice();i=l.length;for(h=0;h<i;h++)l[h].apply(this,a)}return true};i.prototype.addListener=function(e,t){var r;if(!n(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,n(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(o(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(o(this._events[e])&&!this._events[e].warned){var r;if(!s(this._maxListeners)){r=this._maxListeners}else{r=i.defaultMaxListeners}if(r&&r>0&&this._events[e].length>r){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=false;function i(){this.removeListener(e,i);if(!r){r=true;t.apply(this,arguments)}}i.listener=t;this.on(e,i);return this};i.prototype.removeListener=function(e,t){var r,i,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];a=r.length;i=-1;if(r===t||n(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(o(r)){for(s=a;s-->0;){if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}}if(i<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(i,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(n(r)){this.removeListener(e,r)}else{while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};i.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(n(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};i.listenerCount=function(e,t){var r;if(!e._events||!e._events[t])r=0;else if(n(e._events[t]))r=1;else r=e._events[t].length;return r};function n(e){return typeof e==="function"}function a(e){return typeof e==="number"}function o(e){return typeof e==="object"&&e!==null}function s(e){return e===void 0}},{}],113:[function(e,t,r){t.exports=function(e){var t=e.MOUSE;if(!t)t={LEFT:0,MIDDLE:1,RIGHT:2};function r(r,i){this.object=r;this.domElement=i!==undefined?i:document;this.enabled=true;this.target=new e.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:t.LEFT,ZOOM:t.MIDDLE,PAN:t.RIGHT};var n=this;var a=1e-6;var o=new e.Vector2;var s=new e.Vector2;var h=new e.Vector2;var l=new e.Vector2;var u=new e.Vector2;var f=new e.Vector2;var c=new e.Vector3;var d=new e.Vector3;var p=new e.Vector2;var m=new e.Vector2;var v=new e.Vector2;var g;var y;var x=0;var _=0;var b=1;var w=new e.Vector3;var M=new e.Vector3;var T=new e.Quaternion;var S={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var E=S.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var A=(new e.Quaternion).setFromUnitVectors(r.up,new e.Vector3(0,1,0));var C=A.clone().inverse();var L={type:"change"};var R={type:"start"};var P={type:"end"};this.rotateLeft=function(e){if(e===undefined){e=D()}_-=e};this.rotateUp=function(e){if(e===undefined){e=D()}x-=e};this.panLeft=function(e){var t=this.object.matrix.elements;c.set(t[0],t[1],t[2]);c.multiplyScalar(-e);w.add(c)};this.panUp=function(e){var t=this.object.matrix.elements;c.set(t[4],t[5],t[6]);c.multiplyScalar(e);w.add(c)};this.pan=function(e,t){var r=n.domElement===document?n.domElement.body:n.domElement;if(n.object.fov!==undefined){var i=n.object.position;var a=i.clone().sub(n.target);var o=a.length();o*=Math.tan(n.object.fov/2*Math.PI/180);n.panLeft(2*e*o/r.clientHeight);n.panUp(2*t*o/r.clientHeight)}else if(n.object.top!==undefined){n.panLeft(e*(n.object.right-n.object.left)/r.clientWidth);n.panUp(t*(n.object.top-n.object.bottom)/r.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=F()}b/=e};this.dollyOut=function(e){if(e===undefined){e=F()}b*=e};this.update=function(){var e=this.object.position;d.copy(e).sub(this.target);d.applyQuaternion(A);g=Math.atan2(d.x,d.z);y=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y);if(this.autoRotate){this.rotateLeft(D())}g+=_;y+=x;g=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,g));y=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,y));y=Math.max(a,Math.min(Math.PI-a,y));var t=d.length()*b;t=Math.max(this.minDistance,Math.min(this.maxDistance,t));this.target.add(w);d.x=t*Math.sin(y)*Math.sin(g);d.y=t*Math.cos(y);d.z=t*Math.sin(y)*Math.cos(g);d.applyQuaternion(C);e.copy(this.target).add(d);this.object.lookAt(this.target);_=0;x=0;b=1;w.set(0,0,0);if(M.distanceToSquared(this.object.position)>a||8*(1-T.dot(this.object.quaternion))>a){this.dispatchEvent(L);M.copy(this.object.position);T.copy(this.object.quaternion)}};this.reset=function(){E=S.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.getPolarAngle=function(){return y};this.getAzimuthalAngle=function(){return g};function D(){return 2*Math.PI/60/60*n.autoRotateSpeed}function F(){return Math.pow(.95,n.zoomSpeed)}function U(e){if(n.enabled===false)return;e.preventDefault();if(e.button===n.mouseButtons.ORBIT){if(n.noRotate===true)return;E=S.ROTATE;o.set(e.clientX,e.clientY)}else if(e.button===n.mouseButtons.ZOOM){if(n.noZoom===true)return;E=S.DOLLY;p.set(e.clientX,e.clientY)}else if(e.button===n.mouseButtons.PAN){if(n.noPan===true)return;E=S.PAN;l.set(e.clientX,e.clientY)}if(E!==S.NONE){document.addEventListener("mousemove",k,false);document.addEventListener("mouseup",B,false);n.dispatchEvent(R)}}function k(e){if(n.enabled===false)return;e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(E===S.ROTATE){if(n.noRotate===true)return;s.set(e.clientX,e.clientY);h.subVectors(s,o);n.rotateLeft(2*Math.PI*h.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*h.y/t.clientHeight*n.rotateSpeed);o.copy(s)}else if(E===S.DOLLY){if(n.noZoom===true)return;m.set(e.clientX,e.clientY);v.subVectors(m,p);if(v.y>0){n.dollyIn()}else{n.dollyOut()}p.copy(m)}else if(E===S.PAN){if(n.noPan===true)return;u.set(e.clientX,e.clientY);f.subVectors(u,l);n.pan(f.x,f.y);l.copy(u)}if(E!==S.NONE)n.update()}function B(){if(n.enabled===false)return;document.removeEventListener("mousemove",k,false);document.removeEventListener("mouseup",B,false);n.dispatchEvent(P);E=S.NONE}function V(e){if(n.enabled===false||n.noZoom===true||E!==S.NONE)return;
e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta!==undefined){t=e.wheelDelta}else if(e.detail!==undefined){t=-e.detail}if(t>0){n.dollyOut()}else{n.dollyIn()}n.update();n.dispatchEvent(R);n.dispatchEvent(P)}function N(e){if(n.enabled===false||n.noKeys===true||n.noPan===true)return;switch(e.keyCode){case n.keys.UP:n.pan(0,n.keyPanSpeed);n.update();break;case n.keys.BOTTOM:n.pan(0,-n.keyPanSpeed);n.update();break;case n.keys.LEFT:n.pan(n.keyPanSpeed,0);n.update();break;case n.keys.RIGHT:n.pan(-n.keyPanSpeed,0);n.update();break}}function O(e){if(n.enabled===false)return;switch(e.touches.length){case 1:if(n.noRotate===true)return;E=S.TOUCH_ROTATE;o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(n.noZoom===true)return;E=S.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var i=Math.sqrt(t*t+r*r);p.set(0,i);break;case 3:if(n.noPan===true)return;E=S.TOUCH_PAN;l.set(e.touches[0].pageX,e.touches[0].pageY);break;default:E=S.NONE}if(E!==S.NONE)n.dispatchEvent(R)}function z(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(n.noRotate===true)return;if(E!==S.TOUCH_ROTATE)return;s.set(e.touches[0].pageX,e.touches[0].pageY);h.subVectors(s,o);n.rotateLeft(2*Math.PI*h.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*h.y/t.clientHeight*n.rotateSpeed);o.copy(s);n.update();break;case 2:if(n.noZoom===true)return;if(E!==S.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX;var i=e.touches[0].pageY-e.touches[1].pageY;var a=Math.sqrt(r*r+i*i);m.set(0,a);v.subVectors(m,p);if(v.y>0){n.dollyOut()}else{n.dollyIn()}p.copy(m);n.update();break;case 3:if(n.noPan===true)return;if(E!==S.TOUCH_PAN)return;u.set(e.touches[0].pageX,e.touches[0].pageY);f.subVectors(u,l);n.pan(f.x,f.y);l.copy(u);n.update();break;default:E=S.NONE}}function I(){if(n.enabled===false)return;n.dispatchEvent(P);E=S.NONE}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",U,false);this.domElement.addEventListener("mousewheel",V,false);this.domElement.addEventListener("DOMMouseScroll",V,false);this.domElement.addEventListener("touchstart",O,false);this.domElement.addEventListener("touchend",I,false);this.domElement.addEventListener("touchmove",z,false);window.addEventListener("keydown",N,false);this.update()}r.prototype=Object.create(e.EventDispatcher.prototype);r.prototype.constructor=r;return r}},{}],114:[function(e,t,r){t.exports=e(66)},{"/projects/npmutils/three-gl-state-example/node_modules/gl-checker-background/node_modules/gl-sprite-batch/node_modules/mixes/node_modules/xtend/immutable.js":66}],115:[function(e,t,r){var i=e("add-event-listener");var n=e("mouse-event-offset");var a=e("events/");function o(e){e=e||{};e.element=e.element||window;var t=new a;var r=e.position||[0,0];if(e.touchstart!==false){i(e.element,"mousedown",o);i(e.element,"touchstart",function(e){var t=e.targetTouches[0];o(e,t)})}i(e.element,"mousemove",o);i(e.element,"touchmove",function(e){var t=e.targetTouches[0];o(e,t)});t.position=r;return t;function o(e,i){var a=n(e,i);r[0]=a.x;r[1]=a.y;t.emit("move",e)}}t.exports=function(e){return o(e).position};t.exports.emitter=function(e){return o(e)}},{"add-event-listener":116,"events/":117,"mouse-event-offset":118}],116:[function(e,t,r){t.exports=e(107)},{"/projects/npmutils/three-gl-state-example/node_modules/three-orbit-viewer/node_modules/canvas-app/node_modules/add-event-listener/index.js":107}],117:[function(e,t,r){t.exports=e(112)},{"/projects/npmutils/three-gl-state-example/node_modules/three-orbit-viewer/node_modules/events/events.js":112}],118:[function(e,t,r){t.exports=function a(e,t){e=e||window.event;var r=e.currentTarget||e.srcElement;var i=t&&t.clientRect||n(r),a=t&&t.clientX,o=t&&t.clientY;a=typeof a==="number"?a:e.clientX;o=typeof o==="number"?o:e.clientY;return{x:a-i.left,y:o-i.top}};var i={left:0,top:0};function n(e){if(e===document.body||e===window){i.left=0;i.top=0}else{var t=e.getBoundingClientRect();i.left=t.left;i.top=t.top}return i}},{}],119:[function(e,t,r){var i={REVISION:"70dev"};if(typeof t==="object"){t.exports=i}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:0}}i.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};i.CullFaceNone=0;i.CullFaceBack=1;i.CullFaceFront=2;i.CullFaceFrontBack=3;i.FrontFaceDirectionCW=0;i.FrontFaceDirectionCCW=1;i.BasicShadowMap=0;i.PCFShadowMap=1;i.PCFSoftShadowMap=2;i.FrontSide=0;i.BackSide=1;i.DoubleSide=2;i.NoShading=0;i.FlatShading=1;i.SmoothShading=2;i.NoColors=0;i.FaceColors=1;i.VertexColors=2;i.NoBlending=0;i.NormalBlending=1;i.AdditiveBlending=2;i.SubtractiveBlending=3;i.MultiplyBlending=4;i.CustomBlending=5;i.AddEquation=100;i.SubtractEquation=101;i.ReverseSubtractEquation=102;i.MinEquation=103;i.MaxEquation=104;i.ZeroFactor=200;i.OneFactor=201;i.SrcColorFactor=202;i.OneMinusSrcColorFactor=203;i.SrcAlphaFactor=204;i.OneMinusSrcAlphaFactor=205;i.DstAlphaFactor=206;i.OneMinusDstAlphaFactor=207;i.DstColorFactor=208;i.OneMinusDstColorFactor=209;i.SrcAlphaSaturateFactor=210;i.MultiplyOperation=0;i.MixOperation=1;i.AddOperation=2;i.UVMapping=300;i.CubeReflectionMapping=301;i.CubeRefractionMapping=302;i.EquirectangularReflectionMapping=303;i.EquirectangularRefractionMapping=304;i.SphericalReflectionMapping=305;i.RepeatWrapping=1e3;i.ClampToEdgeWrapping=1001;i.MirroredRepeatWrapping=1002;i.NearestFilter=1003;i.NearestMipMapNearestFilter=1004;i.NearestMipMapLinearFilter=1005;i.LinearFilter=1006;i.LinearMipMapNearestFilter=1007;i.LinearMipMapLinearFilter=1008;i.UnsignedByteType=1009;i.ByteType=1010;i.ShortType=1011;i.UnsignedShortType=1012;i.IntType=1013;i.UnsignedIntType=1014;i.FloatType=1015;i.UnsignedShort4444Type=1016;i.UnsignedShort5551Type=1017;i.UnsignedShort565Type=1018;i.AlphaFormat=1019;i.RGBFormat=1020;i.RGBAFormat=1021;i.LuminanceFormat=1022;i.LuminanceAlphaFormat=1023;i.RGBEFormat=i.RGBAFormat;i.RGB_S3TC_DXT1_Format=2001;i.RGBA_S3TC_DXT1_Format=2002;i.RGBA_S3TC_DXT3_Format=2003;i.RGBA_S3TC_DXT5_Format=2004;i.RGB_PVRTC_4BPPV1_Format=2100;i.RGB_PVRTC_2BPPV1_Format=2101;i.RGBA_PVRTC_4BPPV1_Format=2102;i.RGBA_PVRTC_2BPPV1_Format=2103;i.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() has been removed.")}};i.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};i.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){if(e instanceof i.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,r){this.r=e;this.g=t;this.b=r;return this},setHSL:function(e,t,r){if(t===0){this.r=this.g=this.b=r}else{var i=function(e,t,r){if(r<0)r+=1;if(r>1)r-=1;if(r<1/6)return e+(t-e)*6*r;if(r<1/2)return t;if(r<2/3)return e+(t-e)*6*(2/3-r);return e};var n=r<=.5?r*(1+t):r+t-r*t;var a=2*r-n;this.r=i(a,n,e+1/3);this.g=i(a,n,e);this.b=i(a,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(i.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e){this.r=e.r*e.r;this.g=e.g*e.g;this.b=e.b*e.b;return this},copyLinearToGamma:function(e){this.r=Math.sqrt(e.r);this.g=Math.sqrt(e.g);this.b=Math.sqrt(e.b);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;this.r=e*e;this.g=t*t;this.b=r*r;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var r=this.r,i=this.g,n=this.b;var a=Math.max(r,i,n);var o=Math.min(r,i,n);var s,h;var l=(o+a)/2;if(o===a){s=0;h=0}else{var u=a-o;h=l<=.5?u/(a+o):u/(2-a-o);switch(a){case r:s=(i-n)/u+(i<n?6:0);break;case i:s=(n-r)/u+2;break;case n:s=(r-i)/u+4;break}s/=6}t.h=s;t.s=h;t.l=l;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();i.h+=e;i.s+=t;i.l+=r;this.setHSL(i.h,i.s,i.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new i.Color).setRGB(this.r,this.g,this.b)}};i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};i.Quaternion=function(e,t,r,i){this._x=e||0;this._y=t||0;this._z=r||0;this._w=i!==undefined?i:1};i.Quaternion.prototype={constructor:i.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,r,i){this._x=e;this._y=t;this._z=r;this._w=i;this.onChangeCallback();return this},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof i.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var r=Math.cos(e._x/2);var n=Math.cos(e._y/2);var a=Math.cos(e._z/2);var o=Math.sin(e._x/2);var s=Math.sin(e._y/2);var h=Math.sin(e._z/2);if(e.order==="XYZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(e.order==="YXZ"){this._x=o*n*a+r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(e.order==="ZXY"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a-o*s*h}else if(e.order==="ZYX"){this._x=o*n*a-r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a+o*s*h}else if(e.order==="YZX"){this._x=o*n*a+r*s*h;this._y=r*s*a+o*n*h;this._z=r*n*h-o*s*a;this._w=r*n*a-o*s*h}else if(e.order==="XZY"){this._x=o*n*a-r*s*h;this._y=r*s*a-o*n*h;this._z=r*n*h+o*s*a;this._w=r*n*a+o*s*h}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);this._x=e.x*i;this._y=e.y*i;this._z=e.z*i;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],o=t[5],s=t[9],h=t[2],l=t[6],u=t[10],f=r+o+u,c;if(f>0){c=.5/Math.sqrt(f+1);this._w=.25/c;this._x=(l-s)*c;this._y=(n-h)*c;this._z=(a-i)*c}else if(r>o&&r>u){c=2*Math.sqrt(1+r-o-u);this._w=(l-s)/c;this._x=.25*c;this._y=(i+a)/c;this._z=(n+h)/c}else if(o>u){c=2*Math.sqrt(1+o-r-u);this._w=(n-h)/c;this._x=(i+a)/c;this._y=.25*c;this._z=(s+l)/c}else{c=2*Math.sqrt(1+u-r-o);this._w=(a-i)/c;this._x=(n+h)/c;this._y=(s+l)/c;this._z=.25*c}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var r=1e-6;return function(n,a){if(e===undefined)e=new i.Vector3;t=n.dot(a)+1;if(t<r){t=0;if(Math.abs(n.x)>Math.abs(n.z)){e.set(-n.y,n.x,0)}else{e.set(0,-n.z,n.y)}}else{e.crossVectors(n,a)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w;var o=t._x,s=t._y,h=t._z,l=t._w;this._x=r*l+a*o+i*h-n*s;this._y=i*l+a*s+n*o-r*h;this._z=n*l+a*h+r*s-i*o;this._w=a*l-r*o-i*s-n*h;this.onChangeCallback();return this},multiplyVector3:function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w;var o=a*e._w+r*e._x+i*e._y+n*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=r;this._y=i;this._z=n;return this}var s=Math.acos(o);var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(a+this._w);this._x=.5*(r+this._x);this._y=.5*(i+this._y);this._z=.5*(n+this._z);return this}var l=Math.sin((1-t)*s)/h,u=Math.sin(t*s)/h;this._w=a*l+this._w*u;this._x=r*l+this._x*u;this._y=i*l+this._y*u;this._z=n*l+this._z*u;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new i.Quaternion(this._x,this._y,this._z,this._w)}};i.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)};i.Vector2=function(e,t){this.x=e||0;this.y=t||0};i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function(r,n){if(e===undefined){e=new i.Vector2;t=new i.Vector2}e.set(r,r);t.set(n,n);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},clone:function(){return new i.Vector2(this.x,this.y)}};i.Vector3=function(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0};i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,r){this.x=e;this.y=t;this.z=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function(t){if(t instanceof i.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromEuler(t));return this}}(),applyAxisAngle:function(){var e;return function(t,r){if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromAxisAngle(t,r));return this}}(),applyMatrix3:function(e){var t=this.x;var r=this.y;var i=this.z;var n=e.elements;this.x=n[0]*t+n[3]*r+n[6]*i;this.y=n[1]*t+n[4]*r+n[7]*i;this.z=n[2]*t+n[5]*r+n[8]*i;return this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;this.x=n[0]*t+n[4]*r+n[8]*i+n[12];this.y=n[1]*t+n[5]*r+n[9]*i+n[13];this.z=n[2]*t+n[6]*r+n[10]*i+n[14];return this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;var a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a;this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a;this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a;return this},applyQuaternion:function(e){var t=this.x;var r=this.y;var i=this.z;var n=e.x;var a=e.y;var o=e.z;var s=e.w;var h=s*t+a*i-o*r;var l=s*r+o*t-n*i;var u=s*i+n*r-a*t;var f=-n*t-a*r-o*i;this.x=h*s+f*-n+l*-o-u*-a;this.y=l*s+f*-a+u*-n-h*-o;this.z=u*s+f*-o+h*-a-l*-n;return this},project:function(){var e;return function(t){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function(t){if(e===undefined)e=new i.Matrix4;e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z;var n=e.elements;this.x=n[0]*t+n[4]*r+n[8]*i;this.y=n[1]*t+n[5]*r+n[9]*i;this.z=n[2]*t+n[6]*r+n[10]*i;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function(r,n){if(e===undefined){e=new i.Vector3;t=new i.Vector3}e.set(r,r,r);t.set(n,n,n);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},cross:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var r=this.x,i=this.y,n=this.z;this.x=i*e.z-n*e.y;this.y=n*e.x-r*e.z;this.z=r*e.y-i*e.x;return this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z;var a=t.x,o=t.y,s=t.z;this.x=i*s-n*o;this.y=n*a-r*s;this.z=r*o-i*a;return this},projectOnVector:function(){var e,t;return function(r){if(e===undefined)e=new i.Vector3;e.copy(r).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;e.copy(this).projectOnVector(t);return this.sub(e)}}(),reflect:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var r=this.y-e.y;var i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var r=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=r;this.z=i;return this},setFromMatrixColumn:function(e,t){var r=e*4;var i=t.elements;this.x=i[r];this.y=i[r+1];this.z=i[r+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},clone:function(){return new i.Vector3(this.x,this.y,this.z)}};i.Vector4=function(e,t,r,i){this.x=e||0;this.y=t||0;this.z=r||0;this.w=i!==undefined?i:1};i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,r,i){this.x=e;this.y=t;this.z=r;this.w=i;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var r=this.y;var i=this.z;var n=this.w;var a=e.elements;this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n;this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n;this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n;this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,a=.01,o=.1,s=e.elements,h=s[0],l=s[4],u=s[8],f=s[1],c=s[5],d=s[9],p=s[2],m=s[6],v=s[10];
if(Math.abs(l-f)<a&&Math.abs(u-p)<a&&Math.abs(d-m)<a){if(Math.abs(l+f)<o&&Math.abs(u+p)<o&&Math.abs(d+m)<o&&Math.abs(h+c+v-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(h+1)/2;var y=(c+1)/2;var x=(v+1)/2;var _=(l+f)/4;var b=(u+p)/4;var w=(d+m)/4;if(g>y&&g>x){if(g<a){r=0;i=.707106781;n=.707106781}else{r=Math.sqrt(g);i=_/r;n=b/r}}else if(y>x){if(y<a){r=.707106781;i=0;n=.707106781}else{i=Math.sqrt(y);r=_/i;n=w/i}}else{if(x<a){r=.707106781;i=.707106781;n=0}else{n=Math.sqrt(x);r=b/n;i=w/n}}this.set(r,i,n,t);return this}var M=Math.sqrt((m-d)*(m-d)+(u-p)*(u-p)+(f-l)*(f-l));if(Math.abs(M)<.001)M=1;this.x=(m-d)/M;this.y=(u-p)/M;this.z=(f-l)/M;this.w=Math.acos((h+c+v-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function(r,n){if(e===undefined){e=new i.Vector4;t=new i.Vector4}e.set(r,r,r,r);t.set(n,n,n,n);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},clone:function(){return new i.Vector4(this.x,this.y,this.z,this.w)}};i.Euler=function(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._order=n||i.Euler.DefaultOrder};i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];i.Euler.DefaultOrder="XYZ";i.Euler.prototype={constructor:i.Euler,_x:0,_y:0,_z:0,_order:i.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,r,i){this._x=e;this._y=t;this._z=r;this._order=i||this._order;this.onChangeCallback();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t){var r=i.Math.clamp;var n=e.elements;var a=n[0],o=n[4],s=n[8];var h=n[1],l=n[5],u=n[9];var f=n[2],c=n[6],d=n[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(r(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(-u,d);this._z=Math.atan2(-o,a)}else{this._x=Math.atan2(c,l);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-r(u,-1,1));if(Math.abs(u)<.99999){this._y=Math.atan2(s,d);this._z=Math.atan2(h,l)}else{this._y=Math.atan2(-f,a);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(r(c,-1,1));if(Math.abs(c)<.99999){this._y=Math.atan2(-f,d);this._z=Math.atan2(-o,l)}else{this._y=0;this._z=Math.atan2(h,a)}}else if(t==="ZYX"){this._y=Math.asin(-r(f,-1,1));if(Math.abs(f)<.99999){this._x=Math.atan2(c,d);this._z=Math.atan2(h,a)}else{this._x=0;this._z=Math.atan2(-o,l)}}else if(t==="YZX"){this._z=Math.asin(r(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-u,l);this._y=Math.atan2(-f,a)}else{this._x=0;this._y=Math.atan2(s,d)}}else if(t==="XZY"){this._z=Math.asin(-r(o,-1,1));if(Math.abs(o)<.99999){this._x=Math.atan2(c,l);this._y=Math.atan2(s,a)}else{this._x=Math.atan2(-u,d);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;this.onChangeCallback();return this},setFromQuaternion:function(e,t,r){var n=i.Math.clamp;var a=e.x*e.x;var o=e.y*e.y;var s=e.z*e.z;var h=e.w*e.w;t=t||this._order;if(t==="XYZ"){this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),h-a-o+s);this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w),-1,1));this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),h+a-o-s)}else if(t==="YXZ"){this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z),-1,1));this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),h-a-o+s);this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),h-a+o-s)}else if(t==="ZXY"){this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z),-1,1));this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),h-a-o+s);this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),h-a+o-s)}else if(t==="ZYX"){this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),h-a-o+s);this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z),-1,1));this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),h+a-o-s)}else if(t==="YZX"){this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),h-a+o-s);this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),h+a-o-s);this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w),-1,1))}else if(t==="XZY"){this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),h-a+o-s);this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),h+a-o-s);this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y),-1,1))}else{console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+t)}this._order=t;if(r!==false)this.onChangeCallback();return this},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new i.Euler(this._x,this._y,this._z,this._order)}};i.Line3=function(e,t){this.start=e!==undefined?e:new i.Vector3;this.end=t!==undefined?t:new i.Vector3};i.Line3.prototype={constructor:i.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new i.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,n){e.subVectors(r,this.start);t.subVectors(this.end,this.start);var a=t.dot(t);var o=t.dot(e);var s=o/a;if(n){s=i.Math.clamp(s,0,1)}return s}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);var a=r||new i.Vector3;return this.delta(a).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new i.Line3).copy(this)}};i.Box2=function(e,t){this.min=e!==undefined?e:new i.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new i.Vector2(-Infinity,-Infinity)};i.Box2.prototype={constructor:i.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var r=t||new i.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box2).copy(this)}};i.Box3=function(e,t){this.min=e!==undefined?e:new i.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new i.Vector3(-Infinity,-Infinity,-Infinity)};i.Box3.prototype={constructor:i.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var r=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var n=t.geometry;if(n!==undefined){if(n instanceof i.Geometry){var a=n.vertices;for(var o=0,s=a.length;o<s;o++){e.copy(a[o]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}else if(n instanceof i.BufferGeometry&&n.attributes["position"]!==undefined){var h=n.attributes["position"].array;for(var o=0,s=h.length;o<s;o+=3){e.set(h[o],h[o+1],h[o+2]);e.applyMatrix4(t.matrixWorld);r.expandByPoint(e)}}}});return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var r=t||new i.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var r=t||new i.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var r=t||new i.Sphere;r.center=this.center();r.radius=this.size(e).length()*.5;return r}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box3).copy(this)}};i.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,r,i,n,a,o,s,h){var l=this.elements;l[0]=e;l[3]=t;l[6]=r;l[1]=i;l[4]=n;l[7]=a;l[2]=o;l[5]=s;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,r,i){if(r===undefined)r=0;if(i===undefined)i=t.length;for(var n=0,a=r,o;n<i;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix3(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],h=e[7],l=e[8];return t*a*l-t*o*h-r*n*l+r*o*s+i*n*h-i*a*s},getInverse:function(e,t){var r=e.elements;var i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9];i[1]=-r[10]*r[1]+r[2]*r[9];i[2]=r[6]*r[1]-r[2]*r[5];i[3]=-r[10]*r[4]+r[6]*r[8];i[4]=r[10]*r[0]-r[2]*r[8];i[5]=-r[6]*r[0]+r[2]*r[4];i[6]=r[9]*r[4]-r[5]*r[8];i[7]=-r[9]*r[0]+r[1]*r[8];i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(n===0){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(a)}else{console.warn(a)}this.identity();return this}this.multiplyScalar(1/n);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new i.Matrix3).fromArray(this.elements)}};i.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,r,i,n,a,o,s,h,l,u,f,c,d,p,m){var v=this.elements;v[0]=e;v[4]=t;v[8]=r;v[12]=i;v[1]=n;v[5]=a;v[9]=o;v[13]=s;v[2]=h;v[6]=l;v[10]=u;v[14]=f;v[3]=c;v[7]=d;v[11]=p;v[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var r=e.elements;t[12]=r[12];t[13]=r[13];t[14]=r[14];return this},extractRotation:function(){var e=new i.Vector3;return function(t){var r=this.elements;var i=t.elements;var n=1/e.set(i[0],i[1],i[2]).length();var a=1/e.set(i[4],i[5],i[6]).length();var o=1/e.set(i[8],i[9],i[10]).length();r[0]=i[0]*n;r[1]=i[1]*n;r[2]=i[2]*n;r[4]=i[4]*a;r[5]=i[5]*a;r[6]=i[6]*a;r[8]=i[8]*o;r[9]=i[9]*o;r[10]=i[10]*o;return this}}(),makeRotationFromEuler:function(e){if(e instanceof i.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var r=e.x,n=e.y,a=e.z;var o=Math.cos(r),s=Math.sin(r);var h=Math.cos(n),l=Math.sin(n);var u=Math.cos(a),f=Math.sin(a);if(e.order==="XYZ"){var c=o*u,d=o*f,p=s*u,m=s*f;t[0]=h*u;t[4]=-h*f;t[8]=l;t[1]=d+p*l;t[5]=c-m*l;t[9]=-s*h;t[2]=m-c*l;t[6]=p+d*l;t[10]=o*h}else if(e.order==="YXZ"){var v=h*u,g=h*f,y=l*u,x=l*f;t[0]=v+x*s;t[4]=y*s-g;t[8]=o*l;t[1]=o*f;t[5]=o*u;t[9]=-s;t[2]=g*s-y;t[6]=x+v*s;t[10]=o*h}else if(e.order==="ZXY"){var v=h*u,g=h*f,y=l*u,x=l*f;t[0]=v-x*s;t[4]=-o*f;t[8]=y+g*s;t[1]=g+y*s;t[5]=o*u;t[9]=x-v*s;t[2]=-o*l;t[6]=s;t[10]=o*h}else if(e.order==="ZYX"){var c=o*u,d=o*f,p=s*u,m=s*f;t[0]=h*u;t[4]=p*l-d;t[8]=c*l+m;t[1]=h*f;t[5]=m*l+c;t[9]=d*l-p;t[2]=-l;t[6]=s*h;t[10]=o*h}else if(e.order==="YZX"){var _=o*h,b=o*l,w=s*h,M=s*l;t[0]=h*u;t[4]=M-_*f;t[8]=w*f+b;t[1]=f;t[5]=o*u;t[9]=-s*u;t[2]=-l*u;t[6]=b*f+w;t[10]=_-M*f}else if(e.order==="XZY"){var _=o*h,b=o*l,w=s*h,M=s*l;t[0]=h*u;t[4]=-f;t[8]=l*u;t[1]=_*f+M;t[5]=o*u;t[9]=b*f-w;t[2]=w*f-b;t[6]=s*u;t[10]=M*f+_}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var r=e.x,i=e.y,n=e.z,a=e.w;var o=r+r,s=i+i,h=n+n;var l=r*o,u=r*s,f=r*h;var c=i*s,d=i*h,p=n*h;var m=a*o,v=a*s,g=a*h;t[0]=1-(c+p);t[4]=u-g;t[8]=f+v;t[1]=u+g;t[5]=1-(l+p);t[9]=d-m;t[2]=f-v;t[6]=d+m;t[10]=1-(l+c);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(i,n,a){var o=this.elements;r.subVectors(i,n).normalize();if(r.length()===0){r.z=1}e.crossVectors(a,r).normalize();if(e.length()===0){r.x+=1e-4;e.crossVectors(a,r).normalize()}t.crossVectors(r,e);o[0]=e.x;o[4]=t.x;o[8]=r.x;o[1]=e.y;o[5]=t.y;o[9]=r.y;o[2]=e.z;o[6]=t.z;o[10]=r.z;return this}}(),multiply:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements;var i=t.elements;var n=this.elements;var a=r[0],o=r[4],s=r[8],h=r[12];var l=r[1],u=r[5],f=r[9],c=r[13];var d=r[2],p=r[6],m=r[10],v=r[14];var g=r[3],y=r[7],x=r[11],_=r[15];var b=i[0],w=i[4],M=i[8],T=i[12];var S=i[1],E=i[5],A=i[9],C=i[13];var L=i[2],R=i[6],P=i[10],D=i[14];var F=i[3],U=i[7],k=i[11],B=i[15];n[0]=a*b+o*S+s*L+h*F;n[4]=a*w+o*E+s*R+h*U;n[8]=a*M+o*A+s*P+h*k;n[12]=a*T+o*C+s*D+h*B;n[1]=l*b+u*S+f*L+c*F;n[5]=l*w+u*E+f*R+c*U;n[9]=l*M+u*A+f*P+c*k;n[13]=l*T+u*C+f*D+c*B;n[2]=d*b+p*S+m*L+v*F;n[6]=d*w+p*E+m*R+v*U;n[10]=d*M+p*A+m*P+v*k;n[14]=d*T+p*C+m*D+v*B;n[3]=g*b+y*S+x*L+_*F;n[7]=g*w+y*E+x*R+_*U;n[11]=g*M+y*A+x*P+_*k;n[15]=g*T+y*C+x*D+_*B;return this},multiplyToArray:function(e,t,r){var i=this.elements;this.multiplyMatrices(e,t);r[0]=i[0];r[1]=i[1];r[2]=i[2];r[3]=i[3];r[4]=i[4];r[5]=i[5];r[6]=i[6];r[7]=i[7];r[8]=i[8];r[9]=i[9];r[10]=i[10];r[11]=i[11];r[12]=i[12];r[13]=i[13];r[14]=i[14];r[15]=i[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,r,i){if(r===undefined)r=0;if(i===undefined)i=t.length;for(var n=0,a=r,o;n<i;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix4(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],r=e[4],i=e[8],n=e[12];var a=e[1],o=e[5],s=e[9],h=e[13];var l=e[2],u=e[6],f=e[10],c=e[14];var d=e[3],p=e[7],m=e[11],v=e[15];return d*(+n*s*u-i*h*u-n*o*f+r*h*f+i*o*c-r*s*c)+p*(+t*s*c-t*h*f+n*a*f-i*a*c+i*h*l-n*s*l)+m*(+t*h*u-t*o*c-n*a*u+r*a*c+n*o*l-r*h*l)+v*(-i*o*l-t*s*u+t*o*f+i*a*u-r*a*f+r*s*l)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];e[t+9]=r[9];e[t+10]=r[10];e[t+11]=r[11];e[t+12]=r[12];e[t+13]=r[13];e[t+14]=r[14];e[t+15]=r[15];return e},getPosition:function(){var e=new i.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var r=this.elements;var i=e.elements;var n=i[0],a=i[4],o=i[8],s=i[12];var h=i[1],l=i[5],u=i[9],f=i[13];var c=i[2],d=i[6],p=i[10],m=i[14];var v=i[3],g=i[7],y=i[11],x=i[15];r[0]=u*m*g-f*p*g+f*d*y-l*m*y-u*d*x+l*p*x;r[4]=s*p*g-o*m*g-s*d*y+a*m*y+o*d*x-a*p*x;r[8]=o*f*g-s*u*g+s*l*y-a*f*y-o*l*x+a*u*x;r[12]=s*u*d-o*f*d-s*l*p+a*f*p+o*l*m-a*u*m;r[1]=f*p*v-u*m*v-f*c*y+h*m*y+u*c*x-h*p*x;r[5]=o*m*v-s*p*v+s*c*y-n*m*y-o*c*x+n*p*x;r[9]=s*u*v-o*f*v-s*h*y+n*f*y+o*h*x-n*u*x;r[13]=o*f*c-s*u*c+s*h*p-n*f*p-o*h*m+n*u*m;r[2]=l*m*v-f*d*v+f*c*g-h*m*g-l*c*x+h*d*x;r[6]=s*d*v-a*m*v-s*c*g+n*m*g+a*c*x-n*d*x;r[10]=a*f*v-s*l*v+s*h*g-n*f*g-a*h*x+n*l*x;r[14]=s*l*c-a*f*c-s*h*d+n*f*d+a*h*m-n*l*m;r[3]=u*d*v-l*p*v-u*c*g+h*p*g+l*c*y-h*d*y;r[7]=a*p*v-o*d*v+o*c*g-n*p*g-a*c*y+n*d*y;r[11]=o*l*v-a*u*v-o*h*g+n*u*g+a*h*y-n*l*y;r[15]=a*u*c-o*l*c+o*h*d-n*u*d-a*h*p+n*l*p;var _=n*r[0]+h*r[4]+c*r[8]+v*r[12];if(_==0){var b="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(b)}else{console.warn(b)}this.identity();return this}this.multiplyScalar(1/_);return this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var r=e.x,i=e.y,n=e.z;t[0]*=r;t[4]*=i;t[8]*=n;t[1]*=r;t[5]*=i;t[9]*=n;t[2]*=r;t[6]*=i;t[10]*=n;t[3]*=r;t[7]*=i;t[11]*=n;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var r=Math.cos(t);var i=Math.sin(t);var n=1-r;var a=e.x,o=e.y,s=e.z;var h=n*a,l=n*o;this.set(h*a+r,h*o-i*s,h*s+i*o,0,h*o+i*s,l*o+r,l*s-i*a,0,h*s-i*o,l*s+i*a,n*s*s+r,0,0,0,0,1);return this},makeScale:function(e,t,r){this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1);return this},compose:function(e,t,r){this.makeRotationFromQuaternion(t);this.scale(r);this.setPosition(e);return this},decompose:function(){var e=new i.Vector3;var t=new i.Matrix4;return function(r,i,n){var a=this.elements;var o=e.set(a[0],a[1],a[2]).length();var s=e.set(a[4],a[5],a[6]).length();var h=e.set(a[8],a[9],a[10]).length();var l=this.determinant();if(l<0){o=-o}r.x=a[12];r.y=a[13];r.z=a[14];t.elements.set(this.elements);var u=1/o;var f=1/s;var c=1/h;t.elements[0]*=u;t.elements[1]*=u;t.elements[2]*=u;t.elements[4]*=f;t.elements[5]*=f;t.elements[6]*=f;t.elements[8]*=c;t.elements[9]*=c;t.elements[10]*=c;i.setFromRotationMatrix(t);n.x=o;n.y=s;n.z=h;return this}}(),makeFrustum:function(e,t,r,i,n,a){var o=this.elements;var s=2*n/(t-e);var h=2*n/(i-r);var l=(t+e)/(t-e);var u=(i+r)/(i-r);var f=-(a+n)/(a-n);var c=-2*a*n/(a-n);o[0]=s;o[4]=0;o[8]=l;o[12]=0;o[1]=0;o[5]=h;o[9]=u;o[13]=0;o[2]=0;o[6]=0;o[10]=f;o[14]=c;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,r,n){var a=r*Math.tan(i.Math.degToRad(e*.5));var o=-a;var s=o*t;var h=a*t;return this.makeFrustum(s,h,o,a,r,n)},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements;var s=t-e;var h=r-i;var l=a-n;var u=(t+e)/s;var f=(r+i)/h;var c=(a+n)/l;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-u;o[1]=0;o[5]=2/h;o[9]=0;o[13]=-f;o[2]=0;o[6]=0;o[10]=-2/l;o[14]=-c;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new i.Matrix4).fromArray(this.elements)}};i.Ray=function(e,t){this.origin=e!==undefined?e:new i.Vector3;this.direction=t!==undefined?t:new i.Vector3};i.Ray.prototype={constructor:i.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var r=t||new i.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var r=t||new i.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);if(n<0){return r.copy(this.origin)}return r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);if(r<0){return this.origin.distanceTo(t)}e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(e,t,r,i){var n=e.clone().add(t).multiplyScalar(.5);var a=t.clone().sub(e).normalize();var o=e.distanceTo(t)*.5;var s=this.origin.clone().sub(n);var h=-this.direction.dot(a);var l=s.dot(this.direction);var u=-s.dot(a);var f=s.lengthSq();var c=Math.abs(1-h*h);var d,p,m,v;if(c>=0){d=h*u-l;p=h*l-u;v=o*c;if(d>=0){if(p>=-v){if(p<=v){var g=1/c;d*=g;p*=g;m=d*(d+h*p+2*l)+p*(h*d+p+2*u)+f}else{p=o;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+f}}else{p=-o;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+f}}else{if(p<=-v){d=Math.max(0,-(-h*o+l));p=d>0?-o:Math.min(Math.max(-o,-u),o);m=-d*d+p*(p+2*u)+f}else if(p<=v){d=0;p=Math.min(Math.max(-o,-u),o);m=p*(p+2*u)+f}else{d=Math.max(0,-(h*o+l));p=d>0?o:Math.min(Math.max(-o,-u),o);m=-d*d+p*(p+2*u)+f}}}else{p=h>0?-o:o;d=Math.max(0,-(h*p+l));m=-d*d+p*(p+2*u)+f}if(r){r.copy(this.direction.clone().multiplyScalar(d).add(this.origin))}if(i){i.copy(a.clone().multiplyScalar(p).add(n))}return m},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new i.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction);var n=e.dot(e)-i*i;var a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n);var s=i-o;var h=i+o;if(s<0&&h<0)return null;if(s<0)return this.at(h,r);return this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var r=e.normal.dot(this.direction);if(r*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return null}var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(r===null){return null}return this.at(r,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var r,i,n,a,o,s;var h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z;var f=this.origin;if(h>=0){r=(e.min.x-f.x)*h;i=(e.max.x-f.x)*h}else{r=(e.max.x-f.x)*h;i=(e.min.x-f.x)*h}if(l>=0){n=(e.min.y-f.y)*l;a=(e.max.y-f.y)*l}else{n=(e.max.y-f.y)*l;a=(e.min.y-f.y)*l}if(r>a||n>i)return null;if(n>r||r!==r)r=n;if(a<i||i!==i)i=a;if(u>=0){o=(e.min.z-f.z)*u;s=(e.max.z-f.z)*u}else{o=(e.max.z-f.z)*u;s=(e.min.z-f.z)*u}if(r>s||o>i)return null;if(o>r||r!==r)r=o;if(s<i||i!==i)i=s;if(i<0)return null;return this.at(r>=0?r:i,t)},intersectTriangle:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;var n=new i.Vector3;
return function(i,a,o,s,h){t.subVectors(a,i);r.subVectors(o,i);n.crossVectors(t,r);var l=this.direction.dot(n);var u;if(l>0){if(s)return null;u=1}else if(l<0){u=-1;l=-l}else{return null}e.subVectors(this.origin,i);var f=u*this.direction.dot(r.crossVectors(e,r));if(f<0){return null}var c=u*this.direction.dot(t.cross(e));if(c<0){return null}if(f+c>l){return null}var d=-u*e.dot(n);if(d<0){return null}return this.at(d/l,h)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new i.Ray).copy(this)}};i.Sphere=function(e,t){this.center=e!==undefined?e:new i.Vector3;this.radius=t!==undefined?t:0};i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new i.Box3;return function(t,r){var i=this.center;if(r!==undefined){i.copy(r)}else{e.setFromPoints(t).center(i)}var n=0;for(var a=0,o=t.length;a<o;a++){n=Math.max(n,i.distanceToSquared(t[a]))}this.radius=Math.sqrt(n);return this}}(),copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);var n=t||new i.Vector3;n.copy(e);if(r>this.radius*this.radius){n.sub(this.center).normalize();n.multiplyScalar(this.radius).add(this.center)}return n},getBoundingBox:function(e){var t=e||new i.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new i.Sphere).copy(this)}};i.Frustum=function(e,t,r,n,a,o){this.planes=[e!==undefined?e:new i.Plane,t!==undefined?t:new i.Plane,r!==undefined?r:new i.Plane,n!==undefined?n:new i.Plane,a!==undefined?a:new i.Plane,o!==undefined?o:new i.Plane]};i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,r,i,n,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(r);o[3].copy(i);o[4].copy(n);o[5].copy(a);return this},copy:function(e){var t=this.planes;for(var r=0;r<6;r++){t[r].copy(e.planes[r])}return this},setFromMatrix:function(e){var t=this.planes;var r=e.elements;var i=r[0],n=r[1],a=r[2],o=r[3];var s=r[4],h=r[5],l=r[6],u=r[7];var f=r[8],c=r[9],d=r[10],p=r[11];var m=r[12],v=r[13],g=r[14],y=r[15];t[0].setComponents(o-i,u-s,p-f,y-m).normalize();t[1].setComponents(o+i,u+s,p+f,y+m).normalize();t[2].setComponents(o+n,u+h,p+c,y+v).normalize();t[3].setComponents(o-n,u-h,p-c,y-v).normalize();t[4].setComponents(o-a,u-l,p-d,y-g).normalize();t[5].setComponents(o+a,u+l,p+d,y+g).normalize();return this},intersectsObject:function(){var e=new i.Sphere;return function(t){var r=t.geometry;if(r.boundingSphere===null)r.computeBoundingSphere();e.copy(r.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var r=e.center;var i=-e.radius;for(var n=0;n<6;n++){var a=t[n].distanceToPoint(r);if(a<i){return false}}return true},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(r){var i=this.planes;for(var n=0;n<6;n++){var a=i[n];e.x=a.normal.x>0?r.min.x:r.max.x;t.x=a.normal.x>0?r.max.x:r.min.x;e.y=a.normal.y>0?r.min.y:r.max.y;t.y=a.normal.y>0?r.max.y:r.min.y;e.z=a.normal.z>0?r.min.z:r.max.z;t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e);var s=a.distanceToPoint(t);if(o<0&&s<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var r=0;r<6;r++){if(t[r].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new i.Frustum).copy(this)}};i.Plane=function(e,t){this.normal=e!==undefined?e:new i.Vector3(1,0,0);this.constant=t!==undefined?t:0};i.Plane.prototype={constructor:i.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,r,i){this.normal.set(e,t,r);this.constant=i;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r,i,n){var a=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();this.setFromNormalAndCoplanarPoint(a,r);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);var n=t||new i.Vector3;return n.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,r){var n=r||new i.Vector3;var a=t.delta(e);var o=this.normal.dot(a);if(o==0){if(this.distanceToPoint(t.start)==0){return n.copy(t.start)}return undefined}var s=-(t.start.dot(this.normal)+this.constant)/o;if(s<0||s>1){return undefined}return n.copy(a).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Matrix3;return function(i,n){var a=n||r.getNormalMatrix(i);var o=e.copy(this.normal).applyMatrix3(a);var s=this.coplanarPoint(t);s.applyMatrix4(i);this.setFromNormalAndCoplanarPoint(o,s);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new i.Plane).copy(this)}};i.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var r=0,i;return function(){for(var n=0;n<36;n++){if(n==8||n==13||n==18||n==23){t[n]="-"}else if(n==14){t[n]="4"}else{if(r<=2)r=33554432+Math.random()*16777216|0;i=r&15;r=r>>4;t[n]=e[n==19?i&3|8:i]}}return t.join("")}}(),clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*(3-2*e)},smootherstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}};i.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},n,a,o,s,h,l,u,f,c;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){n=(this.points.length-1)*e;a=Math.floor(n);o=n-a;t[0]=a===0?a:a-1;t[1]=a;t[2]=a>this.points.length-2?this.points.length-1:a+1;t[3]=a>this.points.length-3?this.points.length-1:a+2;l=this.points[t[0]];u=this.points[t[1]];f=this.points[t[2]];c=this.points[t[3]];s=o*o;h=o*s;r.x=d(l.x,u.x,f.x,c.x,o,s,h);r.y=d(l.y,u.y,f.y,c.y,o,s,h);r.z=d(l.z,u.z,f.z,c.z,o,s,h);return r};this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++){t=this.points[e];i[e]=[t.x,t.y,t.z]}return i};this.getLength=function(e){var t,r,n,a,o=0,s=0,h=0,l=new i.Vector3,u=new i.Vector3,f=[],c=0;f[0]=0;if(!e)e=100;n=this.points.length*e;l.copy(this.points[0]);for(t=1;t<n;t++){r=t/n;a=this.getPoint(r);u.copy(a);c+=u.distanceTo(l);l.copy(a);o=(this.points.length-1)*r;s=Math.floor(o);if(s!=h){f[s]=c;h=s}}f[f.length]=c;return{chunks:f,total:c}};this.reparametrizeByArcLength=function(e){var t,r,n,a,o,s,h,l,u,f=[],c=new i.Vector3,d=this.getLength();f.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){h=d.chunks[t]-d.chunks[t-1];l=Math.ceil(e*h/d.total);a=(t-1)/(this.points.length-1);o=t/(this.points.length-1);for(r=1;r<l-1;r++){n=a+r*(1/l)*(o-a);u=this.getPoint(n);f.push(c.copy(u).clone())}f.push(c.copy(this.points[t]).clone())}this.points=f};function d(e,t,r,i,n,a,o){var s=(r-e)*.5,h=(i-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t}};i.Triangle=function(e,t,r){this.a=e!==undefined?e:new i.Vector3;this.b=t!==undefined?t:new i.Vector3;this.c=r!==undefined?r:new i.Vector3};i.Triangle.normal=function(){var e=new i.Vector3;return function(t,r,n,a){var o=a||new i.Vector3;o.subVectors(n,r);e.subVectors(t,r);o.cross(e);var s=o.lengthSq();if(s>0){return o.multiplyScalar(1/Math.sqrt(s))}return o.set(0,0,0)}}();i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(n,a,o,s,h){e.subVectors(s,a);t.subVectors(o,a);r.subVectors(n,a);var l=e.dot(e);var u=e.dot(t);var f=e.dot(r);var c=t.dot(t);var d=t.dot(r);var p=l*c-u*u;var m=h||new i.Vector3;if(p==0){return m.set(-2,-1,-1)}var v=1/p;var g=(c*f-u*d)*v;var y=(l*d-u*f)*v;return m.set(1-g-y,y,g)}}();i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,r,n,a){var o=i.Triangle.barycoordFromPoint(t,r,n,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}();i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,r){this.a.copy(e);this.b.copy(t);this.c.copy(r);return this},setFromPointsAndIndices:function(e,t,r,i){this.a.copy(e[t]);this.b.copy(e[r]);this.c.copy(e[i]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new i.Vector3;var t=new i.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new i.Triangle).copy(this)}};i.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};i.EventDispatcher=function(){};i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener;e.hasEventListener=i.EventDispatcher.prototype.hasEventListener;e.removeEventListener=i.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var r=this._listeners;if(r[e]===undefined){r[e]=[]}if(r[e].indexOf(t)===-1){r[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var r=this._listeners;if(r[e]!==undefined&&r[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var r=this._listeners;var i=r[e];if(i!==undefined){var n=i.indexOf(t);if(n!==-1){i.splice(n,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var r=t[e.type];if(r!==undefined){e.target=this;var i=[];var n=r.length;for(var a=0;a<n;a++){i[a]=r[a]}for(var a=0;a<n;a++){i[a].call(this,e)}}}};(function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r);this.near=i||0;this.far=n||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance};var r=function(e,t,i,n){e.raycast(t,i);if(n===true){var a=e.children;for(var o=0,s=a.length;o<s;o++){r(a[o],t,i,true)}}};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},intersectObject:function(e,i){var n=[];r(e,this,n,i);n.sort(t);return n},intersectObjects:function(e,i){var n=[];if(e instanceof Array===false){console.log("THREE.Raycaster.intersectObjects: objects is not an Array.");return n}for(var a=0,o=e.length;a<o;a++){r(e[a],this,n,i)}n.sort(t);return n}}})(i);i.Object3D=function(){Object.defineProperty(this,"id",{value:i.Object3DIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=i.Object3D.DefaultUp.clone();var e=this;var t=new i.Vector3;var r=new i.Euler;var n=new i.Quaternion;var a=new i.Vector3(1,1,1);var o=function(){n.setFromEuler(r,false)};var s=function(){r.setFromQuaternion(n,undefined,false)};r.onChange(o);n.onChange(s);Object.defineProperties(this,{position:{enumerable:true,value:t},rotation:{enumerable:true,value:r},quaternion:{enumerable:true,value:n},scale:{enumerable:true,value:a}});this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new i.Matrix4;this.matrixWorld=new i.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};i.Object3D.DefaultUp=new i.Vector3(0,1,0);i.Object3D.prototype={constructor:i.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,r){e.setFromAxisAngle(t,r);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,r){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add:",e,"can't be added as a child of itself.");return this}if(e instanceof i.Object3D){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D.")}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var r=this.children.indexOf(e);if(r!==-1){e.parent=undefined;e.dispatchEvent({type:"removed"});this.children.splice(r,1)}},getChildByName:function(e,t){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e,t)},getObjectById:function(e,t){if(this.id===e)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];var a=n.getObjectById(e,t);if(a!==undefined){return a}}return undefined},getObjectByName:function(e,t){if(this.name===e)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r];var a=n.getObjectByName(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){var t=e||new i.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new i.Vector3;var t=new i.Vector3;return function(r){var n=r||new i.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,n,t);return n}}(),getWorldRotation:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Euler;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new i.Vector3;var t=new i.Quaternion;return function(r){var n=r||new i.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,n);return n}}(),getWorldDirection:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++){this.children[t].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);for(var t=0,r=this.children.length;t<r;t++){this.children[t].traverseVisible(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,r=this.children.length;t<r;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var t={};var r=function(r){if(e.geometries===undefined){e.geometries=[]}if(t[r.uuid]===undefined){var i=r.toJSON();delete i.metadata;t[r.uuid]=i;e.geometries.push(i)}return r.uuid};var n={};var a=function(t){if(e.materials===undefined){e.materials=[]}if(n[t.uuid]===undefined){var r=t.toJSON();delete r.metadata;n[t.uuid]=r;e.materials.push(r)}return t.uuid};var o=function(e){var t={};t.uuid=e.uuid;t.type=e.type;if(e.name!=="")t.name=e.name;if(JSON.stringify(e.userData)!=="{}")t.userData=e.userData;if(e.visible!==true)t.visible=e.visible;if(e instanceof i.PerspectiveCamera){t.fov=e.fov;t.aspect=e.aspect;t.near=e.near;t.far=e.far}else if(e instanceof i.OrthographicCamera){t.left=e.left;t.right=e.right;t.top=e.top;t.bottom=e.bottom;t.near=e.near;t.far=e.far}else if(e instanceof i.AmbientLight){t.color=e.color.getHex()}else if(e instanceof i.DirectionalLight){t.color=e.color.getHex();t.intensity=e.intensity}else if(e instanceof i.PointLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance}else if(e instanceof i.SpotLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.angle=e.angle;t.exponent=e.exponent}else if(e instanceof i.HemisphereLight){t.color=e.color.getHex();t.groundColor=e.groundColor.getHex()}else if(e instanceof i.Mesh){t.geometry=r(e.geometry);t.material=a(e.material)}else if(e instanceof i.Line){t.geometry=r(e.geometry);t.material=a(e.material)}else if(e instanceof i.Sprite){t.material=a(e.material)}t.matrix=e.matrix.toArray();if(e.children.length>0){t.children=[];for(var n=0;n<e.children.length;n++){t.children.push(o(e.children[n]))}}return t};e.object=o(this);return e},clone:function(e,t){if(e===undefined)e=new i.Object3D;if(t===undefined)t=true;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.renderDepth=this.renderDepth;e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(t===true){for(var r=0;r<this.children.length;r++){var n=this.children[r];e.add(n.clone())}}return e}};i.EventDispatcher.prototype.apply(i.Object3D.prototype);i.Object3DIdCount=0;i.Face3=function(e,t,r,n,a,o){this.a=e;this.b=t;this.c=r;this.normal=n instanceof i.Vector3?n:new i.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=a instanceof i.Color?a:new i.Color;this.vertexColors=a instanceof Array?a:[];this.vertexTangents=[];this.materialIndex=o!==undefined?o:0};i.Face3.prototype={constructor:i.Face3,clone:function(){var e=new i.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;t<r;t++){e.vertexNormals[t]=this.vertexNormals[t].clone()}for(var t=0,r=this.vertexColors.length;t<r;t++){e.vertexColors[t]=this.vertexColors[t].clone()}for(var t=0,r=this.vertexTangents.length;t<r;t++){e.vertexTangents[t]=this.vertexTangents[t].clone()}return e}};i.Face4=function(e,t,r,n,a,o,s){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new i.Face3(e,t,r,a,o,s)};i.BufferAttribute=function(e,t){this.array=e;this.itemSize=t;this.needsUpdate=false};i.BufferAttribute.prototype={constructor:i.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,r){e*=this.itemSize;r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++){this.array[e+i]=t.array[r+i]}},set:function(e){this.array.set(e);return this},setX:function(e,t){this.array[e*this.itemSize]=t;return this},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},setXY:function(e,t,r){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;return this},setXYZ:function(e,t,r,i){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;this.array[e+2]=i;return this},setXYZW:function(e,t,r,i,n){e*=this.itemSize;this.array[e]=t;this.array[e+1]=r;this.array[e+2]=i;this.array[e+3]=n;return this},clone:function(){return new i.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};i.Int8Attribute=function(e,t){console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Uint8Attribute=function(e,t){console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Uint8ClampedAttribute=function(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Int16Attribute=function(e,t){console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Uint16Attribute=function(e,t){console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Int32Attribute=function(e,t){console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Uint32Attribute=function(e,t){console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Float32Attribute=function(e,t){console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.Float64Attribute=function(e,t){console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new i.BufferAttribute(e,t)};i.BufferGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};i.BufferGeometry.prototype={constructor:i.BufferGeometry,addAttribute:function(e,t){if(t instanceof i.BufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=t;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:r!==undefined?r:0})},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var r=this.attributes.normal;if(r!==undefined){var n=(new i.Matrix3).getNormalMatrix(e);n.applyToVector3Array(r.array);r.needsUpdate=true}},center:function(){},fromGeometry:function(e,t){t=t||{vertexColors:i.NoColors};var r=e.vertices;var n=e.faces;var a=e.faceVertexUvs;var o=t.vertexColors;var s=a[0].length>0;var h=n[0].vertexNormals.length==3;var l=new Float32Array(n.length*3*3);this.addAttribute("position",new i.BufferAttribute(l,3));var u=new Float32Array(n.length*3*3);this.addAttribute("normal",new i.BufferAttribute(u,3));if(o!==i.NoColors){var f=new Float32Array(n.length*3*3);this.addAttribute("color",new i.BufferAttribute(f,3))}if(s===true){var c=new Float32Array(n.length*3*2);this.addAttribute("uv",new i.BufferAttribute(c,2))}for(var d=0,p=0,m=0;d<n.length;d++,p+=6,m+=9){var v=n[d];var g=r[v.a];var y=r[v.b];var x=r[v.c];l[m]=g.x;l[m+1]=g.y;l[m+2]=g.z;l[m+3]=y.x;l[m+4]=y.y;l[m+5]=y.z;l[m+6]=x.x;l[m+7]=x.y;l[m+8]=x.z;if(h===true){var _=v.vertexNormals[0];var b=v.vertexNormals[1];var w=v.vertexNormals[2];u[m]=_.x;u[m+1]=_.y;u[m+2]=_.z;u[m+3]=b.x;u[m+4]=b.y;u[m+5]=b.z;u[m+6]=w.x;u[m+7]=w.y;u[m+8]=w.z}else{var M=v.normal;u[m]=M.x;u[m+1]=M.y;u[m+2]=M.z;u[m+3]=M.x;u[m+4]=M.y;u[m+5]=M.z;u[m+6]=M.x;u[m+7]=M.y;u[m+8]=M.z}if(o===i.FaceColors){var T=v.color;f[m]=T.r;f[m+1]=T.g;f[m+2]=T.b;f[m+3]=T.r;f[m+4]=T.g;f[m+5]=T.b;f[m+6]=T.r;f[m+7]=T.g;f[m+8]=T.b}else if(o===i.VertexColors){var S=v.vertexColors[0];var E=v.vertexColors[1];var A=v.vertexColors[2];f[m]=S.r;f[m+1]=S.g;f[m+2]=S.b;f[m+3]=E.r;f[m+4]=E.g;f[m+5]=E.b;f[m+6]=A.r;f[m+7]=A.g;f[m+8]=A.b}if(s===true){var C=a[0][d][0];var L=a[0][d][1];var R=a[0][d][2];c[p]=C.x;c[p+1]=C.y;c[p+2]=L.x;c[p+3]=L.y;c[p+4]=R.x;c[p+5]=R.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var e=new i.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,a=t.length;n<a;n+=3){e.set(t[n],t[n+1],t[n+2]);r.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var e=new i.Box3;var t=new i.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}var r=this.attributes.position.array;if(r){e.makeEmpty();var n=this.boundingSphere.center;for(var a=0,o=r.length;a<o;a+=3){t.set(r[a],r[a+1],r[a+2]);e.expandByPoint(t)}e.center(n);var s=0;for(var a=0,o=r.length;a<o;a+=3){t.set(r[a],r[a+1],r[a+2]);s=Math.max(s,n.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(s);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(e.normal===undefined){this.addAttribute("normal",new i.BufferAttribute(new Float32Array(t.length),3))}else{var r=e.normal.array;for(var n=0,a=r.length;n<a;n++){r[n]=0}}var r=e.normal.array;var o,s,h,l=new i.Vector3,u=new i.Vector3,f=new i.Vector3,c=new i.Vector3,d=new i.Vector3;if(e.index){var p=e.index.array;var m=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}];for(var v=0,g=m.length;v<g;++v){var y=m[v].start;var x=m[v].count;var _=m[v].index;for(var n=y,a=y+x;n<a;n+=3){o=(_+p[n])*3;s=(_+p[n+1])*3;h=(_+p[n+2])*3;l.fromArray(t,o);u.fromArray(t,s);f.fromArray(t,h);c.subVectors(f,u);d.subVectors(l,u);c.cross(d);r[o]+=c.x;r[o+1]+=c.y;r[o+2]+=c.z;r[s]+=c.x;r[s+1]+=c.y;r[s+2]+=c.z;r[h]+=c.x;r[h+1]+=c.y;r[h+2]+=c.z}}}else{for(var n=0,a=t.length;n<a;n+=9){l.fromArray(t,n);u.fromArray(t,n+3);f.fromArray(t,n+6);c.subVectors(f,u);d.subVectors(l,u);c.cross(d);r[n]=c.x;r[n+1]=c.y;r[n+2]=c.z;r[n+3]=c.x;r[n+4]=c.y;r[n+5]=c.z;r[n+6]=c.x;r[n+7]=c.y;r[n+8]=c.z}}this.normalizeNormals();e.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array;var t=this.attributes.position.array;var r=this.attributes.normal.array;var n=this.attributes.uv.array;var a=t.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new i.BufferAttribute(new Float32Array(4*a),4))}var o=this.attributes.tangent.array;var s=[],h=[];for(var l=0;l<a;l++){s[l]=new i.Vector3;h[l]=new i.Vector3}var u=new i.Vector3,f=new i.Vector3,c=new i.Vector3,d=new i.Vector2,p=new i.Vector2,m=new i.Vector2,v,g,y,x,_,b,w,M,T,S,E;var A=new i.Vector3,C=new i.Vector3;
function L(e,r,i){u.fromArray(t,e*3);f.fromArray(t,r*3);c.fromArray(t,i*3);d.fromArray(n,e*2);p.fromArray(n,r*2);m.fromArray(n,i*2);v=f.x-u.x;g=c.x-u.x;y=f.y-u.y;x=c.y-u.y;_=f.z-u.z;b=c.z-u.z;w=p.x-d.x;M=m.x-d.x;T=p.y-d.y;S=m.y-d.y;E=1/(w*S-M*T);A.set((S*v-T*g)*E,(S*y-T*x)*E,(S*_-T*b)*E);C.set((w*g-M*v)*E,(w*x-M*y)*E,(w*b-M*_)*E);s[e].add(A);s[r].add(A);s[i].add(A);h[e].add(C);h[r].add(C);h[i].add(C)}var R,P;var D,F;var U,k,B;if(this.drawcalls.length===0){this.addDrawCall(0,e.length,0)}var V=this.drawcalls;for(D=0,F=V.length;D<F;++D){var N=V[D].start;var O=V[D].count;var z=V[D].index;for(R=N,P=N+O;R<P;R+=3){U=z+e[R];k=z+e[R+1];B=z+e[R+2];L(U,k,B)}}var I=new i.Vector3,j=new i.Vector3;var G=new i.Vector3,H=new i.Vector3;var W,X,Y;function q(e){G.fromArray(r,e*3);H.copy(G);X=s[e];I.copy(X);I.sub(G.multiplyScalar(G.dot(X))).normalize();j.crossVectors(H,X);Y=j.dot(h[e]);W=Y<0?-1:1;o[e*4]=I.x;o[e*4+1]=I.y;o[e*4+2]=I.z;o[e*4+3]=W}for(D=0,F=V.length;D<F;++D){var N=V[D].start;var O=V[D].count;var z=V[D].index;for(R=N,P=N+O;R<P;R+=3){U=z+e[R];k=z+e[R+1];B=z+e[R+2];q(U);q(k);q(B)}}},computeOffsets:function(e){var t=e;if(e===undefined)t=65535;var r=Date.now();var i=this.attributes.index.array;var n=this.attributes.position.array;var a=n.length/3;var o=i.length/3;var s=new Uint16Array(i.length);var h=0;var l=0;var u=[{start:0,count:0,index:0}];var f=u[0];var c=0;var d=0;var p=new Int32Array(6);var m=new Int32Array(n.length);var v=new Int32Array(n.length);for(var g=0;g<n.length;g++){m[g]=-1;v[g]=-1}for(var y=0;y<o;y++){d=0;for(var x=0;x<3;x++){var _=i[y*3+x];if(m[_]==-1){p[x*2]=_;p[x*2+1]=-1;d++}else if(m[_]<f.index){p[x*2]=_;p[x*2+1]=-1;c++}else{p[x*2]=_;p[x*2+1]=m[_]}}var b=l+d;if(b>f.index+t){var w={start:h,count:0,index:l};u.push(w);f=w;for(var M=0;M<6;M+=2){var T=p[M+1];if(T>-1&&T<f.index)p[M+1]=-1}}for(var M=0;M<6;M+=2){var _=p[M];var T=p[M+1];if(T===-1)T=l++;m[_]=T;v[T]=_;s[h++]=T-f.index;f.count++}}this.reorderBuffers(s,v,l);this.offsets=u;return u},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){var e=this.attributes.normal.array;var t,r,i,n;for(var a=0,o=e.length;a<o;a+=3){t=e[a];r=e[a+1];i=e[a+2];n=1/Math.sqrt(t*t+r*r+i*i);e[a]*=n;e[a+1]*=n;e[a+2]*=n}},reorderBuffers:function(e,t,r){var i={};for(var n in this.attributes){if(n=="index")continue;var a=this.attributes[n].array;i[n]=new a.constructor(this.attributes[n].itemSize*r)}for(var o=0;o<r;o++){var s=t[o];for(var n in this.attributes){if(n=="index")continue;var h=this.attributes[n].array;var l=this.attributes[n].itemSize;var u=i[n];for(var f=0;f<l;f++)u[o*l+f]=h[s*l+f]}}this.attributes["index"].array=e;for(var n in this.attributes){if(n=="index")continue;this.attributes[n].array=i[n];this.attributes[n].numItems=this.attributes[n].itemSize*r}},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var t=this.attributes;var r=this.offsets;var i=this.boundingSphere;for(var n in t){var a=t[n];var o=[],s=a.array;for(var h=0,l=s.length;h<l;h++){o[h]=s[h]}e.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:o}}if(r.length>0){e.data.offsets=JSON.parse(JSON.stringify(r))}if(i!==null){e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}}return e},clone:function(){var e=new i.BufferGeometry;for(var t in this.attributes){var r=this.attributes[t];e.addAttribute(t,r.clone())}for(var n=0,a=this.offsets.length;n<a;n++){var o=this.offsets[n];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype);i.Geometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){var t=(new i.Matrix3).getNormalMatrix(e);for(var r=0,n=this.vertices.length;r<n;r++){var a=this.vertices[r];a.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var s=0,h=o.vertexNormals.length;s<h;s++){o.vertexNormals[s].applyMatrix3(t).normalize()}}if(this.boundingBox instanceof i.Box3){this.computeBoundingBox()}if(this.boundingSphere instanceof i.Sphere){this.computeBoundingSphere()}},fromBufferGeometry:function(e){var t=this;var r=e.attributes;var n=r.position.array;var a=r.index!==undefined?r.index.array:undefined;var o=r.normal!==undefined?r.normal.array:undefined;var s=r.color!==undefined?r.color.array:undefined;var h=r.uv!==undefined?r.uv.array:undefined;var l=[];var u=[];for(var f=0,c=0;f<n.length;f+=3,c+=2){t.vertices.push(new i.Vector3(n[f],n[f+1],n[f+2]));if(o!==undefined){l.push(new i.Vector3(o[f],o[f+1],o[f+2]))}if(s!==undefined){t.colors.push(new i.Color(s[f],s[f+1],s[f+2]))}if(h!==undefined){u.push(new i.Vector2(h[c],h[c+1]))}}var d=function(e,r,n){var a=o!==undefined?[l[e].clone(),l[r].clone(),l[n].clone()]:[];var f=s!==undefined?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[];t.faces.push(new i.Face3(e,r,n,a,f));if(h!==undefined){t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[n].clone()])}};if(a!==undefined){for(var f=0;f<a.length;f+=3){d(a[f],a[f+1],a[f+2])}}else{for(var f=0;f<n.length/3;f+=3){d(f,f+1,f+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=new i.Vector3;e.addVectors(this.boundingBox.min,this.boundingBox.max);e.multiplyScalar(-.5);this.applyMatrix((new i.Matrix4).makeTranslation(e.x,e.y,e.z));this.computeBoundingBox();return e},computeFaceNormals:function(){var e=new i.Vector3,t=new i.Vector3;for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];var o=this.vertices[a.a];var s=this.vertices[a.b];var h=this.vertices[a.c];e.subVectors(h,s);t.subVectors(o,s);e.cross(t);e.normalize();a.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,a,o,s;s=new Array(this.vertices.length);for(t=0,r=this.vertices.length;t<r;t++){s[t]=new i.Vector3}if(e){var h,l,u,f;var c=new i.Vector3,d=new i.Vector3,p=new i.Vector3,m=new i.Vector3,v=new i.Vector3;for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];h=this.vertices[o.a];l=this.vertices[o.b];u=this.vertices[o.c];c.subVectors(u,l);d.subVectors(h,l);c.cross(d);s[o.a].add(c);s[o.b].add(c);s[o.c].add(c)}}else{for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];s[o.a].add(o.normal);s[o.b].add(o.normal);s[o.c].add(o.normal)}}for(t=0,r=this.vertices.length;t<r;t++){s[t].normalize()}for(n=0,a=this.faces.length;n<a;n++){o=this.faces[n];o.vertexNormals[0]=s[o.a].clone();o.vertexNormals[1]=s[o.b].clone();o.vertexNormals[2]=s[o.c].clone()}},computeMorphNormals:function(){var e,t,r,n,a;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(!a.__originalFaceNormal){a.__originalFaceNormal=a.normal.clone()}else{a.__originalFaceNormal.copy(a.normal)}if(!a.__originalVertexNormals)a.__originalVertexNormals=[];for(e=0,t=a.vertexNormals.length;e<t;e++){if(!a.__originalVertexNormals[e]){a.__originalVertexNormals[e]=a.vertexNormals[e].clone()}else{a.__originalVertexNormals[e].copy(a.vertexNormals[e])}}}var o=new i.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals;var h=this.morphNormals[e].vertexNormals;var l,u;for(r=0,n=this.faces.length;r<n;r++){l=new i.Vector3;u={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3};s.push(l);h.push(u)}}var f=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices;o.computeFaceNormals();o.computeVertexNormals();var l,u;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];l=f.faceNormals[r];u=f.vertexNormals[r];l.copy(a.normal);u.a.copy(a.vertexNormals[0]);u.b.copy(a.vertexNormals[1]);u.c.copy(a.vertexNormals[2])}}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];a.normal=a.__originalFaceNormal;a.vertexNormals=a.__originalVertexNormals}},computeTangents:function(){var e,t,r,n,a,o,s,h,l,u,f,c,d,p,m,v,g,y,x,_,b,w,M,T,S,E,A,C,L=[],R=[],P=new i.Vector3,D=new i.Vector3,F=new i.Vector3,U=new i.Vector3,k=new i.Vector3,B;for(r=0,n=this.vertices.length;r<n;r++){L[r]=new i.Vector3;R[r]=new i.Vector3}function V(e,t,r,i,n,a,o){u=e.vertices[t];f=e.vertices[r];c=e.vertices[i];d=l[n];p=l[a];m=l[o];v=f.x-u.x;g=c.x-u.x;y=f.y-u.y;x=c.y-u.y;_=f.z-u.z;b=c.z-u.z;w=p.x-d.x;M=m.x-d.x;T=p.y-d.y;S=m.y-d.y;E=1/(w*S-M*T);P.set((S*v-T*g)*E,(S*y-T*x)*E,(S*_-T*b)*E);D.set((w*g-M*v)*E,(w*x-M*y)*E,(w*b-M*_)*E);L[t].add(P);L[r].add(P);L[i].add(P);R[t].add(D);R[r].add(D);R[i].add(D)}for(e=0,t=this.faces.length;e<t;e++){h=this.faces[e];l=this.faceVertexUvs[0][e];V(this,h.a,h.b,h.c,0,1,2)}var N=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){h=this.faces[e];for(a=0;a<Math.min(h.vertexNormals.length,3);a++){k.copy(h.vertexNormals[a]);s=h[N[a]];A=L[s];F.copy(A);F.sub(k.multiplyScalar(k.dot(A))).normalize();U.crossVectors(h.vertexNormals[a],A);C=U.dot(R[s]);B=C<0?-1:1;h.vertexTangents[a]=new i.Vector4(F.x,F.y,F.z,B)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var r=0,i=t.length;r<i;r++){if(r>0){e+=t[r].distanceTo(t[r-1])}this.lineDistances[r]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof i.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var n,a=this.vertices.length,o=this.vertices,s=e.vertices,h=this.faces,l=e.faces,u=this.faceVertexUvs[0],f=e.faceVertexUvs[0];if(r===undefined)r=0;if(t!==undefined){n=(new i.Matrix3).getNormalMatrix(t)}for(var c=0,d=s.length;c<d;c++){var p=s[c];var m=p.clone();if(t!==undefined)m.applyMatrix4(t);o.push(m)}for(c=0,d=l.length;c<d;c++){var v=l[c],g,y,x,_=v.vertexNormals,b=v.vertexColors;g=new i.Face3(v.a+a,v.b+a,v.c+a);g.normal.copy(v.normal);if(n!==undefined){g.normal.applyMatrix3(n).normalize()}for(var w=0,M=_.length;w<M;w++){y=_[w].clone();if(n!==undefined){y.applyMatrix3(n).normalize()}g.vertexNormals.push(y)}g.color.copy(v.color);for(var w=0,M=b.length;w<M;w++){x=b[w];g.vertexColors.push(x.clone())}g.materialIndex=v.materialIndex+r;h.push(g)}for(c=0,d=f.length;c<d;c++){var T=f[c],S=[];if(T===undefined){continue}for(var w=0,M=T.length;w<M;w++){S.push(T[w].clone())}u.push(S)}},mergeMesh:function(e){if(e instanceof i.Mesh===false){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],r=[];var i,n;var a=4;var o=Math.pow(10,a);var s,h,l;var u,f,c,d,p;for(s=0,h=this.vertices.length;s<h;s++){i=this.vertices[s];n=Math.round(i.x*o)+"_"+Math.round(i.y*o)+"_"+Math.round(i.z*o);if(e[n]===undefined){e[n]=s;t.push(this.vertices[s]);r[s]=t.length-1}else{r[s]=r[e[n]]}}var m=[];for(s=0,h=this.faces.length;s<h;s++){l=this.faces[s];l.a=r[l.a];l.b=r[l.b];l.c=r[l.c];u=[l.a,l.b,l.c];var v=-1;for(var g=0;g<3;g++){if(u[g]==u[(g+1)%3]){v=g;m.push(s);break}}}for(s=m.length-1;s>=0;s--){var y=m[s];this.faces.splice(y,1);for(c=0,d=this.faceVertexUvs.length;c<d;c++){this.faceVertexUvs[c].splice(y,1)}}var x=this.vertices.length-t.length;this.vertices=t;return x},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var r in t){if(t[r]!==undefined)e[r]=t[r]}return e}var i=[];for(var n=0;n<this.vertices.length;n++){var a=this.vertices[n];i.push(a.x,a.y,a.z)}var o=[];var s=[];var h={};var l=[];var u={};var f=[];var c={};for(var n=0;n<this.faces.length;n++){var d=this.faces[n];var p=false;var m=false;var v=this.faceVertexUvs[0][n]!==undefined;var g=d.normal.length()>0;var y=d.vertexNormals.length>0;var x=d.color.r!==1||d.color.g!==1||d.color.b!==1;var _=d.vertexColors.length>0;var b=0;b=S(b,0,0);b=S(b,1,p);b=S(b,2,m);b=S(b,3,v);b=S(b,4,g);b=S(b,5,y);b=S(b,6,x);b=S(b,7,_);o.push(b);o.push(d.a,d.b,d.c);if(v){var w=this.faceVertexUvs[0][n];o.push(C(w[0]),C(w[1]),C(w[2]))}if(g){o.push(E(d.normal))}if(y){var M=d.vertexNormals;o.push(E(M[0]),E(M[1]),E(M[2]))}if(x){o.push(A(d.color))}if(_){var T=d.vertexColors;o.push(A(T[0]),A(T[1]),A(T[2]))}}function S(e,t,r){return r?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(h[t]!==undefined){return h[t]}h[t]=s.length/3;s.push(e.x,e.y,e.z);return h[t]}function A(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(u[t]!==undefined){return u[t]}u[t]=l.length;l.push(e.getHex());return u[t]}function C(e){var t=e.x.toString()+e.y.toString();if(c[t]!==undefined){return c[t]}c[t]=f.length/2;f.push(e.x,e.y);return c[t]}e.data={};e.data.vertices=i;e.data.normals=s;if(l.length>0)e.data.colors=l;if(f.length>0)e.data.uvs=[f];e.data.faces=o;return e},clone:function(){var e=new i.Geometry;var t=this.vertices;for(var r=0,n=t.length;r<n;r++){e.vertices.push(t[r].clone())}var a=this.faces;for(var r=0,n=a.length;r<n;r++){e.faces.push(a[r].clone())}var o=this.faceVertexUvs[0];for(var r=0,n=o.length;r<n;r++){var s=o[r],h=[];for(var l=0,u=s.length;l<u;l++){h.push(new i.Vector2(s[l].x,s[l].y))}e.faceVertexUvs[0].push(h)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Geometry.prototype);i.GeometryIdCount=0;i.Camera=function(){i.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new i.Matrix4;this.projectionMatrix=new i.Matrix4};i.Camera.prototype=Object.create(i.Object3D.prototype);i.Camera.prototype.constructor=i.Camera;i.Camera.prototype.getWorldDirection=function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}();i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();i.Camera.prototype.clone=function(e){if(e===undefined)e=new i.Camera;i.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};i.CubeCamera=function(e,t,r){i.Object3D.call(this);this.type="CubeCamera";var n=90,a=1;var o=new i.PerspectiveCamera(n,a,e,t);o.up.set(0,-1,0);o.lookAt(new i.Vector3(1,0,0));this.add(o);var s=new i.PerspectiveCamera(n,a,e,t);s.up.set(0,-1,0);s.lookAt(new i.Vector3(-1,0,0));this.add(s);var h=new i.PerspectiveCamera(n,a,e,t);h.up.set(0,0,1);h.lookAt(new i.Vector3(0,1,0));this.add(h);var l=new i.PerspectiveCamera(n,a,e,t);l.up.set(0,0,-1);l.lookAt(new i.Vector3(0,-1,0));this.add(l);var u=new i.PerspectiveCamera(n,a,e,t);u.up.set(0,-1,0);u.lookAt(new i.Vector3(0,0,1));this.add(u);var f=new i.PerspectiveCamera(n,a,e,t);f.up.set(0,-1,0);f.lookAt(new i.Vector3(0,0,-1));this.add(f);this.renderTarget=new i.WebGLRenderTargetCube(r,r,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter});this.updateCubeMap=function(e,t){var r=this.renderTarget;var i=r.generateMipmaps;r.generateMipmaps=false;r.activeCubeFace=0;e.render(t,o,r);r.activeCubeFace=1;e.render(t,s,r);r.activeCubeFace=2;e.render(t,h,r);r.activeCubeFace=3;e.render(t,l,r);r.activeCubeFace=4;e.render(t,u,r);r.generateMipmaps=i;r.activeCubeFace=5;e.render(t,f,r)}};i.CubeCamera.prototype=Object.create(i.Object3D.prototype);i.CubeCamera.prototype.constructor=i.CubeCamera;i.OrthographicCamera=function(e,t,r,n,a,o){i.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=r;this.bottom=n;this.near=a!==undefined?a:.1;this.far=o!==undefined?o:2e3;this.updateProjectionMatrix()};i.OrthographicCamera.prototype=Object.create(i.Camera.prototype);i.OrthographicCamera.prototype.constructor=i.OrthographicCamera;i.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var r=(this.right+this.left)/2;var i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)};i.OrthographicCamera.prototype.clone=function(){var e=new i.OrthographicCamera;i.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};i.PerspectiveCamera=function(e,t,r,n){i.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=r!==undefined?r:.1;this.far=n!==undefined?n:2e3;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype);i.PerspectiveCamera.prototype.constructor=i.PerspectiveCamera;i.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*i.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,a){this.fullWidth=e;this.fullHeight=t;this.x=r;this.y=i;this.width=n;this.height=a;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=i.Math.radToDeg(2*Math.atan(Math.tan(i.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var r=Math.tan(i.Math.degToRad(e*.5))*this.near;var n=-r;var a=t*n;var o=t*r;var s=Math.abs(o-a);var h=Math.abs(r-n);this.projectionMatrix.makeFrustum(a+this.x*s/this.fullWidth,a+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};i.PerspectiveCamera.prototype.clone=function(){var e=new i.PerspectiveCamera;i.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};i.Light=function(e){i.Object3D.call(this);this.type="Light";this.color=new i.Color(e)};i.Light.prototype=Object.create(i.Object3D.prototype);i.Light.prototype.constructor=i.Light;i.Light.prototype.clone=function(e){if(e===undefined)e=new i.Light;i.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};i.AmbientLight=function(e){i.Light.call(this,e);this.type="AmbientLight"};i.AmbientLight.prototype=Object.create(i.Light.prototype);i.AmbientLight.prototype.constructor=i.AmbientLight;i.AmbientLight.prototype.clone=function(){var e=new i.AmbientLight;i.Light.prototype.clone.call(this,e);return e};i.AreaLight=function(e,t){i.Light.call(this,e);this.type="AreaLight";this.normal=new i.Vector3(0,-1,0);this.right=new i.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};i.AreaLight.prototype=Object.create(i.Light.prototype);i.AreaLight.prototype.constructor=i.AreaLight;i.DirectionalLight=function(e,t){i.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new i.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.DirectionalLight.prototype=Object.create(i.Light.prototype);i.DirectionalLight.prototype.constructor=i.DirectionalLight;i.DirectionalLight.prototype.clone=function(){var e=new i.DirectionalLight;i.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraLeft=this.shadowCameraLeft;e.shadowCameraRight=this.shadowCameraRight;e.shadowCameraTop=this.shadowCameraTop;e.shadowCameraBottom=this.shadowCameraBottom;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;e.shadowCascade=this.shadowCascade;e.shadowCascadeOffset.copy(this.shadowCascadeOffset);e.shadowCascadeCount=this.shadowCascadeCount;e.shadowCascadeBias=this.shadowCascadeBias.slice(0);e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return e};i.HemisphereLight=function(e,t,r){i.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new i.Color(t);this.intensity=r!==undefined?r:1};i.HemisphereLight.prototype=Object.create(i.Light.prototype);i.HemisphereLight.prototype.constructor=i.HemisphereLight;i.HemisphereLight.prototype.clone=function(){var e=new i.HemisphereLight;i.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};i.PointLight=function(e,t,r){i.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0};i.PointLight.prototype=Object.create(i.Light.prototype);i.PointLight.prototype.constructor=i.PointLight;i.PointLight.prototype.clone=function(){var e=new i.PointLight;i.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;return e};i.SpotLight=function(e,t,r,n,a){i.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.distance=r!==undefined?r:0;this.angle=n!==undefined?n:Math.PI/3;this.exponent=a!==undefined?a:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.SpotLight.prototype=Object.create(i.Light.prototype);i.SpotLight.prototype.constructor=i.SpotLight;i.SpotLight.prototype.clone=function(){var e=new i.SpotLight;i.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraFov=this.shadowCameraFov;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;return e};i.Cache=function(){this.files={}};i.Cache.prototype={constructor:i.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};i.Loader=function(e){this.showStatus=e;this.statusDomElement=e?i.Loader.prototype.addStatusElement():null;this.imageLoader=new i.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};i.Loader.prototype={constructor:i.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ";if(e.total){t+=(100*e.loaded/e.total).toFixed(0)+"%"}else{t+=(e.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t){var r=[];for(var i=0;i<e.length;++i){r[i]=this.createMaterial(e[i],t)}return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t];if(n instanceof i.ShaderMaterial)return true}return false},createMaterial:function(e,t){var r=this;function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function a(e,a,o,s,h,l,u){var f=t+o;var c;var d=i.Loader.Handlers.get(f);if(d!==null){c=d.load(f)}else{c=new i.Texture;d=r.imageLoader;d.crossOrigin=r.crossOrigin;d.load(f,function(e){if(i.Math.isPowerOfTwo(e.width)===false||i.Math.isPowerOfTwo(e.height)===false){var t=n(e.width);var r=n(e.height);var a=document.createElement("canvas");a.width=t;a.height=r;var o=a.getContext("2d");o.drawImage(e,0,0,t,r);c.image=a}else{c.image=e}c.needsUpdate=true})}c.sourceFile=o;if(s){c.repeat.set(s[0],s[1]);if(s[0]!==1)c.wrapS=i.RepeatWrapping;if(s[1]!==1)c.wrapT=i.RepeatWrapping}if(h){c.offset.set(h[0],h[1])}if(l){var p={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};if(p[l[0]]!==undefined)c.wrapS=p[l[0]];if(p[l[1]]!==undefined)c.wrapT=p[l[1]]}if(u){c.anisotropy=u}e[a]=c}function o(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var s="MeshLambertMaterial";var h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(e.shading){var l=e.shading.toLowerCase();if(l==="phong")s="MeshPhongMaterial";else if(l==="basic")s="MeshBasicMaterial"}if(e.blending!==undefined&&i[e.blending]!==undefined){h.blending=i[e.blending]}if(e.transparent!==undefined||e.opacity<1){h.transparent=e.transparent}if(e.depthTest!==undefined){h.depthTest=e.depthTest}if(e.depthWrite!==undefined){h.depthWrite=e.depthWrite}if(e.visible!==undefined){h.visible=e.visible}if(e.flipSided!==undefined){h.side=i.BackSide}if(e.doubleSided!==undefined){h.side=i.DoubleSide}if(e.wireframe!==undefined){h.wireframe=e.wireframe}if(e.vertexColors!==undefined){if(e.vertexColors==="face"){h.vertexColors=i.FaceColors}else if(e.vertexColors){h.vertexColors=i.VertexColors}}if(e.colorDiffuse){h.color=o(e.colorDiffuse)}else if(e.DbgColor){h.color=e.DbgColor}if(e.colorSpecular){h.specular=o(e.colorSpecular)}if(e.colorAmbient){h.ambient=o(e.colorAmbient)}if(e.colorEmissive){h.emissive=o(e.colorEmissive)}if(e.transparency){h.opacity=e.transparency}if(e.specularCoef){h.shininess=e.specularCoef}if(e.mapDiffuse&&t){a(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy)}if(e.mapLight&&t){a(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy)}if(e.mapBump&&t){a(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy)}if(e.mapNormal&&t){a(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy)}if(e.mapSpecular&&t){a(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy)}if(e.mapAlpha&&t){a(h,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy)}if(e.mapBumpScale){h.bumpScale=e.mapBumpScale}if(e.mapNormal){var u=i.ShaderLib["normalmap"];var f=i.UniformsUtils.clone(u.uniforms);f["tNormal"].value=h.normalMap;if(e.mapNormalFactor){f["uNormalScale"].value.set(e.mapNormalFactor,e.mapNormalFactor)}if(h.map){f["tDiffuse"].value=h.map;f["enableDiffuse"].value=true}if(h.specularMap){f["tSpecular"].value=h.specularMap;f["enableSpecular"].value=true}if(h.lightMap){f["tAO"].value=h.lightMap;f["enableAO"].value=true}f["diffuse"].value.setHex(h.color);f["specular"].value.setHex(h.specular);f["ambient"].value.setHex(h.ambient);f["shininess"].value=h.shininess;if(h.opacity!==undefined){f["opacity"].value=h.opacity}var c={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:f,lights:true,fog:true};var d=new i.ShaderMaterial(c);if(h.transparent){d.transparent=true}}else{var d=new i[s](h)}if(e.DbgName!==undefined)d.name=e.DbgName;return d}};i.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;t<r;t+=2){var i=this.handlers[t];var n=this.handlers[t+1];if(i.test(e)){return n}}return null}};i.XHRLoader=function(e){this.cache=new i.Cache;this.manager=e!==undefined?e:i.DefaultLoadingManager};i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,r,i){var n=this;var a=n.cache.get(e);if(a!==undefined){if(t)t(a);return}var o=new XMLHttpRequest;o.open("GET",e,true);o.addEventListener("load",function(r){n.cache.add(e,this.response);if(t)t(this.response);n.manager.itemEnd(e)},false);if(r!==undefined){o.addEventListener("progress",function(e){r(e)},false)}if(i!==undefined){o.addEventListener("error",function(e){i(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)o.responseType=this.responseType;o.send(null);n.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}};i.ImageLoader=function(e){this.cache=new i.Cache;this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,r,i){var n=this;var a=n.cache.get(e);if(a!==undefined){t(a);return}var o=document.createElement("img");if(t!==undefined){o.addEventListener("load",function(r){n.cache.add(e,this);t(this);n.manager.itemEnd(e)},false)}if(r!==undefined){o.addEventListener("progress",function(e){r(e)},false)}if(i!==undefined){o.addEventListener("error",function(e){i(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;o.src=e;n.manager.itemStart(e);return o},setCrossOrigin:function(e){this.crossOrigin=e}};i.JSONLoader=function(e){i.Loader.call(this,e);this.withCredentials=false};i.JSONLoader.prototype=Object.create(i.Loader.prototype);i.JSONLoader.prototype.constructor=i.JSONLoader;i.JSONLoader.prototype.load=function(e,t,r){var i=this;r=r&&typeof r==="string"?r:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,r)};i.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,n){var a=new XMLHttpRequest;var o=0;a.onreadystatechange=function(){if(a.readyState===a.DONE){if(a.status===200||a.status===0){if(a.responseText){var s=JSON.parse(a.responseText);if(s.metadata!==undefined&&s.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var h=e.parse(s,i);r(h.geometry,h.materials)}else{console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.')}e.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+a.status+")")}}else if(a.readyState===a.LOADING){if(n){if(o===0){o=a.getResponseHeader("Content-Length")
}n({total:o,loaded:a.responseText.length})}}else if(a.readyState===a.HEADERS_RECEIVED){if(n!==undefined){o=a.getResponseHeader("Content-Length")}}};a.open("GET",t,true);a.withCredentials=this.withCredentials;a.send(null)};i.JSONLoader.prototype.parse=function(e,t){var r=this,n=new i.Geometry,a=e.scale!==undefined?1/e.scale:1;o(a);s();h(a);n.computeFaceNormals();n.computeBoundingSphere();function o(t){function r(e,t){return e&1<<t}var a,o,s,h,l,u,f,c,d,p,m,v,g,y,x,_,b,w,M,T,S,E,A,C,L,R,P,D,F=e.faces,U=e.vertices,k=e.normals,B=e.colors,V=0;if(e.uvs!==undefined){for(a=0;a<e.uvs.length;a++){if(e.uvs[a].length)V++}for(a=0;a<V;a++){n.faceVertexUvs[a]=[]}}h=0;l=U.length;while(h<l){w=new i.Vector3;w.x=U[h++]*t;w.y=U[h++]*t;w.z=U[h++]*t;n.vertices.push(w)}h=0;l=F.length;while(h<l){p=F[h++];m=r(p,0);v=r(p,1);g=r(p,3);y=r(p,4);x=r(p,5);_=r(p,6);b=r(p,7);if(m){T=new i.Face3;T.a=F[h];T.b=F[h+1];T.c=F[h+3];S=new i.Face3;S.a=F[h+1];S.b=F[h+2];S.c=F[h+3];h+=4;if(v){d=F[h++];T.materialIndex=d;S.materialIndex=d}s=n.faces.length;if(g){for(a=0;a<V;a++){L=e.uvs[a];n.faceVertexUvs[a][s]=[];n.faceVertexUvs[a][s+1]=[];for(o=0;o<4;o++){c=F[h++];P=L[c*2];D=L[c*2+1];R=new i.Vector2(P,D);if(o!==2)n.faceVertexUvs[a][s].push(R);if(o!==0)n.faceVertexUvs[a][s+1].push(R)}}}if(y){f=F[h++]*3;T.normal.set(k[f++],k[f++],k[f]);S.normal.copy(T.normal)}if(x){for(a=0;a<4;a++){f=F[h++]*3;C=new i.Vector3(k[f++],k[f++],k[f]);if(a!==2)T.vertexNormals.push(C);if(a!==0)S.vertexNormals.push(C)}}if(_){u=F[h++];A=B[u];T.color.setHex(A);S.color.setHex(A)}if(b){for(a=0;a<4;a++){u=F[h++];A=B[u];if(a!==2)T.vertexColors.push(new i.Color(A));if(a!==0)S.vertexColors.push(new i.Color(A))}}n.faces.push(T);n.faces.push(S)}else{M=new i.Face3;M.a=F[h++];M.b=F[h++];M.c=F[h++];if(v){d=F[h++];M.materialIndex=d}s=n.faces.length;if(g){for(a=0;a<V;a++){L=e.uvs[a];n.faceVertexUvs[a][s]=[];for(o=0;o<3;o++){c=F[h++];P=L[c*2];D=L[c*2+1];R=new i.Vector2(P,D);n.faceVertexUvs[a][s].push(R)}}}if(y){f=F[h++]*3;M.normal.set(k[f++],k[f++],k[f])}if(x){for(a=0;a<3;a++){f=F[h++]*3;C=new i.Vector3(k[f++],k[f++],k[f]);M.vertexNormals.push(C)}}if(_){u=F[h++];M.color.setHex(B[u])}if(b){for(a=0;a<3;a++){u=F[h++];M.vertexColors.push(new i.Color(B[u]))}}n.faces.push(M)}}}function s(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var r=0,a=e.skinWeights.length;r<a;r+=t){var o=e.skinWeights[r];var s=t>1?e.skinWeights[r+1]:0;var h=t>2?e.skinWeights[r+2]:0;var l=t>3?e.skinWeights[r+3]:0;n.skinWeights.push(new i.Vector4(o,s,h,l))}}if(e.skinIndices){for(var r=0,a=e.skinIndices.length;r<a;r+=t){var u=e.skinIndices[r];var f=t>1?e.skinIndices[r+1]:0;var c=t>2?e.skinIndices[r+2]:0;var d=t>3?e.skinIndices[r+3]:0;n.skinIndices.push(new i.Vector4(u,f,c,d))}}n.bones=e.bones;if(n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)){console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.")}n.animation=e.animation;n.animations=e.animations}function h(t){if(e.morphTargets!==undefined){var r,a,o,s,h,l;for(r=0,a=e.morphTargets.length;r<a;r++){n.morphTargets[r]={};n.morphTargets[r].name=e.morphTargets[r].name;n.morphTargets[r].vertices=[];h=n.morphTargets[r].vertices;l=e.morphTargets[r].vertices;for(o=0,s=l.length;o<s;o+=3){var u=new i.Vector3;u.x=l[o]*t;u.y=l[o+1]*t;u.z=l[o+2]*t;h.push(u)}}}if(e.morphColors!==undefined){var r,a,f,c,d,p,m;for(r=0,a=e.morphColors.length;r<a;r++){n.morphColors[r]={};n.morphColors[r].name=e.morphColors[r].name;n.morphColors[r].colors=[];d=n.morphColors[r].colors;p=e.morphColors[r].colors;for(f=0,c=p.length;f<c;f+=3){m=new i.Color(16755200);m.setRGB(p[f],p[f+1],p[f+2]);d.push(m)}}}}if(e.materials===undefined||e.materials.length===0){return{geometry:n}}else{var l=this.initMaterials(e.materials,t);if(this.needsTangents(l)){n.computeTangents()}return{geometry:n,materials:l}}};i.LoadingManager=function(e,t,r){var i=this;var n=0,a=0;this.onLoad=e;this.onProgress=t;this.onError=r;this.itemStart=function(e){a++};this.itemEnd=function(e){n++;if(i.onProgress!==undefined){i.onProgress(e,n,a)}if(n===a&&i.onLoad!==undefined){i.onLoad()}}};i.DefaultLoadingManager=new i.LoadingManager;i.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry;var r=e.attributes;for(var n in r){var a=r[n];var o=new self[a.type](a.array);t.addAttribute(n,new i.BufferAttribute(o,a.itemSize))}var s=e.offsets;if(s!==undefined){t.offsets=JSON.parse(JSON.stringify(s))}var h=e.boundingSphere;if(h!==undefined){var l=new i.Vector3;if(h.center!==undefined){l.fromArray(h.center)}t.boundingSphere=new i.Sphere(l,h.radius)}return t}};i.MaterialLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i[e.type];if(e.color!==undefined)t.color.setHex(e.color);if(e.ambient!==undefined)t.ambient.setHex(e.ambient);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.materials!==undefined){for(var r=0,n=e.materials.length;r<n;r++){t.materials.push(this.parse(e.materials[r]))}}return t}};i.ObjectLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,r,n){var a=this;var o=new i.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(a.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries);var r=this.parseMaterials(e.materials);var i=this.parseObject(e.object,t,r);return i},parseGeometries:function(e){var t={};if(e!==undefined){var r=new i.JSONLoader;var n=new i.BufferGeometryLoader;for(var a=0,o=e.length;a<o;a++){var s;var h=e[a];switch(h.type){case"PlaneGeometry":s=new i.PlaneGeometry(h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new i.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":s=new i.CircleGeometry(h.radius,h.segments);break;case"CylinderGeometry":s=new i.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":s=new i.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"IcosahedronGeometry":s=new i.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":s=new i.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new i.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":s=n.parse(h.data);break;case"Geometry":s=r.parse(h.data).geometry;break}s.uuid=h.uuid;if(h.name!==undefined)s.name=h.name;t[h.uuid]=s}}return t},parseMaterials:function(e){var t={};if(e!==undefined){var r=new i.MaterialLoader;for(var n=0,a=e.length;n<a;n++){var o=e[n];var s=r.parse(o);s.uuid=o.uuid;if(o.name!==undefined)s.name=o.name;t[o.uuid]=s}}return t},parseObject:function(){var e=new i.Matrix4;return function(t,r,n){var a;switch(t.type){case"Scene":a=new i.Scene;break;case"PerspectiveCamera":a=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new i.AmbientLight(t.color);break;case"DirectionalLight":a=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new i.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":a=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":a=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=r[t.geometry];var s=n[t.material];if(o===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry)}if(s===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}a=new i.Mesh(o,s);break;case"Line":var o=r[t.geometry];var s=n[t.material];if(o===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry)}if(s===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}a=new i.Line(o,s);break;case"Sprite":var s=n[t.material];if(s===undefined){console.warn("THREE.ObjectLoader: Undefined material",t.material)}a=new i.Sprite(s);break;case"Group":a=new i.Group;break;default:a=new i.Object3D}a.uuid=t.uuid;if(t.name!==undefined)a.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(a.position,a.quaternion,a.scale)}else{if(t.position!==undefined)a.position.fromArray(t.position);if(t.rotation!==undefined)a.rotation.fromArray(t.rotation);if(t.scale!==undefined)a.scale.fromArray(t.scale)}if(t.visible!==undefined)a.visible=t.visible;if(t.userData!==undefined)a.userData=t.userData;if(t.children!==undefined){for(var h in t.children){a.add(this.parseObject(t.children[h],r,n))}}return a}}()};i.TextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,r,n){var a=this;var o=new i.ImageLoader(a.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){var r=new i.Texture(e);r.needsUpdate=true;if(t!==undefined){t(r)}},r,n)},setCrossOrigin:function(e){this.crossOrigin=e}};i.DataTextureLoader=i.BinaryTextureLoader=function(){this._parser=null};i.BinaryTextureLoader.prototype={constructor:i.BinaryTextureLoader,load:function(e,t,r,n){var a=this;var o=new i.DataTexture;var s=new i.XHRLoader;s.setResponseType("arraybuffer");s.load(e,function(e){var r=a._parser(e);if(!r)return;if(undefined!==r.image){o.image=r.image}else if(undefined!==r.data){o.image.width=r.width;o.image.height=r.height;o.image.data=r.data}o.wrapS=undefined!==r.wrapS?r.wrapS:i.ClampToEdgeWrapping;o.wrapT=undefined!==r.wrapT?r.wrapT:i.ClampToEdgeWrapping;o.magFilter=undefined!==r.magFilter?r.magFilter:i.LinearFilter;o.minFilter=undefined!==r.minFilter?r.minFilter:i.LinearMipMapLinearFilter;o.anisotropy=undefined!==r.anisotropy?r.anisotropy:1;if(undefined!==r.format){o.format=r.format}if(undefined!==r.type){o.type=r.type}if(undefined!==r.mipmaps){o.mipmaps=r.mipmaps}if(1===r.mipmapCount){o.minFilter=i.LinearFilter}o.needsUpdate=true;if(t)t(o,r)},r,n);return o}};i.CompressedTextureLoader=function(){this._parser=null};i.CompressedTextureLoader.prototype={constructor:i.CompressedTextureLoader,load:function(e,t,r){var n=this;var a=[];var o=new i.CompressedTexture;o.image=a;var s=new i.XHRLoader;s.setResponseType("arraybuffer");if(e instanceof Array){var h=0;var l=function(r){s.load(e[r],function(e){var s=n._parser(e,true);a[r]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps};h+=1;if(h===6){if(s.mipmapCount==1)o.minFilter=i.LinearFilter;o.format=s.format;o.needsUpdate=true;if(t)t(o)}})};for(var u=0,f=e.length;u<f;++u){l(u)}}else{s.load(e,function(e){var r=n._parser(e,true);if(r.isCubemap){var s=r.mipmaps.length/r.mipmapCount;for(var h=0;h<s;h++){a[h]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++){a[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+l]);a[h].format=r.format;a[h].width=r.width;a[h].height=r.height}}}else{o.image.width=r.width;o.image.height=r.height;o.mipmaps=r.mipmaps}if(r.mipmapCount===1){o.minFilter=i.LinearFilter}o.format=r.format;o.needsUpdate=true;if(t)t(o)})}return o}};i.Material=function(){Object.defineProperty(this,"id",{value:i.MaterialIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.type="Material";this.side=i.FrontSide;this.opacity=1;this.transparent=false;this.blending=i.NormalBlending;this.blendSrc=i.SrcAlphaFactor;this.blendDst=i.OneMinusSrcAlphaFactor;this.blendEquation=i.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true};i.Material.prototype={constructor:i.Material,setValues:function(e){if(e===undefined)return;for(var t in e){var r=e[t];if(r===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var n=this[t];if(n instanceof i.Color){n.set(r)}else if(n instanceof i.Vector3&&r instanceof i.Vector3){n.copy(r)}else if(t=="overdraw"){this[t]=Number(r)}else{this[t]=r}}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this instanceof i.MeshBasicMaterial){e.color=this.color.getHex();if(this.vertexColors!==i.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==i.NormalBlending)e.blending=this.blending;if(this.side!==i.FrontSide)e.side=this.side}else if(this instanceof i.MeshLambertMaterial){e.color=this.color.getHex();e.ambient=this.ambient.getHex();e.emissive=this.emissive.getHex();if(this.vertexColors!==i.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==i.NormalBlending)e.blending=this.blending;if(this.side!==i.FrontSide)e.side=this.side}else if(this instanceof i.MeshPhongMaterial){e.color=this.color.getHex();e.ambient=this.ambient.getHex();e.emissive=this.emissive.getHex();e.specular=this.specular.getHex();e.shininess=this.shininess;if(this.vertexColors!==i.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==i.NormalBlending)e.blending=this.blending;if(this.side!==i.FrontSide)e.side=this.side}else if(this instanceof i.MeshNormalMaterial){if(this.shading!==i.FlatShading)e.shading=this.shading;if(this.blending!==i.NormalBlending)e.blending=this.blending;if(this.side!==i.FrontSide)e.side=this.side}else if(this instanceof i.MeshDepthMaterial){if(this.blending!==i.NormalBlending)e.blending=this.blending;if(this.side!==i.FrontSide)e.side=this.side}else if(this instanceof i.ShaderMaterial){e.uniforms=this.uniforms;e.vertexShader=this.vertexShader;e.fragmentShader=this.fragmentShader}else if(this instanceof i.SpriteMaterial){e.color=this.color.getHex()}if(this.opacity<1)e.opacity=this.opacity;if(this.transparent!==false)e.transparent=this.transparent;if(this.wireframe!==false)e.wireframe=this.wireframe;return e},clone:function(e){if(e===undefined)e=new i.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Material.prototype);i.MaterialIdCount=0;i.LineBasicMaterial=function(e){i.Material.call(this);this.type="LineBasicMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.LineBasicMaterial.prototype=Object.create(i.Material.prototype);i.LineBasicMaterial.prototype.constructor=i.LineBasicMaterial;i.LineBasicMaterial.prototype.clone=function(){var e=new i.LineBasicMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.LineDashedMaterial=function(e){i.Material.call(this);this.type="LineDashedMaterial";this.color=new i.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};i.LineDashedMaterial.prototype=Object.create(i.Material.prototype);i.LineDashedMaterial.prototype.constructor=i.LineDashedMaterial;i.LineDashedMaterial.prototype.clone=function(){var e=new i.LineDashedMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.MeshBasicMaterial=function(e){i.Material.call(this);this.type="MeshBasicMaterial";this.color=new i.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype);i.MeshBasicMaterial.prototype.constructor=i.MeshBasicMaterial;i.MeshBasicMaterial.prototype.clone=function(){var e=new i.MeshBasicMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};i.MeshLambertMaterial=function(e){i.Material.call(this);this.type="MeshLambertMaterial";this.color=new i.Color(16777215);this.ambient=new i.Color(16777215);this.emissive=new i.Color(0);this.wrapAround=false;this.wrapRGB=new i.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype);i.MeshLambertMaterial.prototype.constructor=i.MeshLambertMaterial;i.MeshLambertMaterial.prototype.clone=function(){var e=new i.MeshLambertMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.MeshPhongMaterial=function(e){i.Material.call(this);this.type="MeshPhongMaterial";this.color=new i.Color(16777215);this.ambient=new i.Color(16777215);this.emissive=new i.Color(0);this.specular=new i.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new i.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype);i.MeshPhongMaterial.prototype.constructor=i.MeshPhongMaterial;i.MeshPhongMaterial.prototype.clone=function(){var e=new i.MeshPhongMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.MeshDepthMaterial=function(e){i.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype);i.MeshDepthMaterial.prototype.constructor=i.MeshDepthMaterial;i.MeshDepthMaterial.prototype.clone=function(){var e=new i.MeshDepthMaterial;i.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};i.MeshNormalMaterial=function(e){i.Material.call(this,e);this.type="MeshNormalMaterial";this.shading=i.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype);i.MeshNormalMaterial.prototype.constructor=i.MeshNormalMaterial;i.MeshNormalMaterial.prototype.clone=function(){var e=new i.MeshNormalMaterial;i.Material.prototype.clone.call(this,e);e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};i.MeshFaceMaterial=function(e){this.uuid=i.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=e instanceof Array?e:[]};i.MeshFaceMaterial.prototype={constructor:i.MeshFaceMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,r=this.materials.length;t<r;t++){e.materials.push(this.materials[t].toJSON())}return e},clone:function(){var e=new i.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}return e}};i.PointCloudMaterial=function(e){i.Material.call(this);this.type="PointCloudMaterial";this.color=new i.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=i.NoColors;this.fog=true;this.setValues(e)};i.PointCloudMaterial.prototype=Object.create(i.Material.prototype);i.PointCloudMaterial.prototype.constructor=i.PointCloudMaterial;i.PointCloudMaterial.prototype.clone=function(){var e=new i.PointCloudMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new i.PointCloudMaterial(e)};i.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new i.PointCloudMaterial(e)};i.ShaderMaterial=function(e){i.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=i.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(e)};i.ShaderMaterial.prototype=Object.create(i.Material.prototype);i.ShaderMaterial.prototype.constructor=i.ShaderMaterial;i.ShaderMaterial.prototype.clone=function(){var e=new i.ShaderMaterial;i.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=i.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.RawShaderMaterial=function(e){i.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};i.RawShaderMaterial.prototype=Object.create(i.ShaderMaterial.prototype);i.RawShaderMaterial.prototype.constructor=i.RawShaderMaterial;i.RawShaderMaterial.prototype.clone=function(){var e=new i.RawShaderMaterial;i.ShaderMaterial.prototype.clone.call(this,e);return e};i.SpriteMaterial=function(e){i.Material.call(this);this.type="SpriteMaterial";this.color=new i.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};i.SpriteMaterial.prototype=Object.create(i.Material.prototype);i.SpriteMaterial.prototype.constructor=i.SpriteMaterial;i.SpriteMaterial.prototype.clone=function(){var e=new i.SpriteMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};i.Texture=function(e,t,r,n,a,o,s,h,l){Object.defineProperty(this,"id",{value:i.TextureIdCount++});this.uuid=i.Math.generateUUID();this.name="";this.image=e!==undefined?e:i.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:i.Texture.DEFAULT_MAPPING;this.wrapS=r!==undefined?r:i.ClampToEdgeWrapping;this.wrapT=n!==undefined?n:i.ClampToEdgeWrapping;this.magFilter=a!==undefined?a:i.LinearFilter;this.minFilter=o!==undefined?o:i.LinearMipMapLinearFilter;this.anisotropy=l!==undefined?l:1;this.format=s!==undefined?s:i.RGBAFormat;this.type=h!==undefined?h:i.UnsignedByteType;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};i.Texture.DEFAULT_IMAGE=undefined;i.Texture.DEFAULT_MAPPING=i.UVMapping;i.Texture.prototype={constructor:i.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},clone:function(e){if(e===undefined)e=new i.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Texture.prototype);i.TextureIdCount=0;i.CubeTexture=function(e,t,r,n,a,o,s,h,l){t=t!==undefined?t:i.CubeReflectionMapping;i.Texture.call(this,e,t,r,n,a,o,s,h,l);this.images=e};i.CubeTexture.prototype=Object.create(i.Texture.prototype);i.CubeTexture.prototype.constructor=i.CubeTexture;i.CubeTexture.clone=function(e){if(e===undefined)e=new i.CubeTexture;i.Texture.prototype.clone.call(this,e);e.images=this.images;return e};i.CompressedTexture=function(e,t,r,n,a,o,s,h,l,u,f){i.Texture.call(this,null,o,s,h,l,u,n,a,f);this.image={width:t,height:r};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};i.CompressedTexture.prototype=Object.create(i.Texture.prototype);i.CompressedTexture.prototype.constructor=i.CompressedTexture;i.CompressedTexture.prototype.clone=function(){var e=new i.CompressedTexture;i.Texture.prototype.clone.call(this,e);return e};i.DataTexture=function(e,t,r,n,a,o,s,h,l,u,f){i.Texture.call(this,null,o,s,h,l,u,n,a,f);this.image={data:e,width:t,height:r}};i.DataTexture.prototype=Object.create(i.Texture.prototype);i.DataTexture.prototype.constructor=i.DataTexture;i.DataTexture.prototype.clone=function(){var e=new i.DataTexture;i.Texture.prototype.clone.call(this,e);return e};i.VideoTexture=function(e,t,r,n,a,o,s,h,l){i.Texture.call(this,e,t,r,n,a,o,s,h,l);this.generateMipmaps=false;var u=this;var f=function(){requestAnimationFrame(f);if(e.readyState===e.HAVE_ENOUGH_DATA){u.needsUpdate=true}};f()};i.VideoTexture.prototype=Object.create(i.Texture.prototype);i.VideoTexture.prototype.constructor=i.VideoTexture;i.Group=function(){i.Object3D.call(this);this.type="Group"};i.Group.prototype=Object.create(i.Object3D.prototype);i.Group.prototype.constructor=i.Group;i.PointCloud=function(e,t){i.Object3D.call(this);this.type="PointCloud";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.PointCloudMaterial({color:Math.random()*16777215});this.sortParticles=false};i.PointCloud.prototype=Object.create(i.Object3D.prototype);i.PointCloud.prototype.constructor=i.PointCloud;i.PointCloud.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;return function(r,n){var a=this;var o=a.geometry;var s=r.params.PointCloud.threshold;e.getInverse(this.matrixWorld);t.copy(r.ray).applyMatrix4(e);if(o.boundingBox!==null){if(t.isIntersectionBox(o.boundingBox)===false){return}}var h=s/((this.scale.x+this.scale.y+this.scale.z)/3);var l=new i.Vector3;var u=function(e,i){var o=t.distanceToPoint(e);if(o<h){var s=t.closestPointToPoint(e);s.applyMatrix4(a.matrixWorld);var l=r.ray.origin.distanceTo(s);n.push({distance:l,distanceToRay:o,point:s.clone(),index:i,face:null,object:a})}};if(o instanceof i.BufferGeometry){var f=o.attributes;var c=f.position.array;if(f.index!==undefined){var d=f.index.array;var p=o.offsets;if(p.length===0){var m={start:0,count:d.length,index:0};p=[m]}for(var v=0,g=p.length;v<g;++v){var y=p[v].start;var x=p[v].count;var _=p[v].index;for(var b=y,w=y+x;b<w;b++){var M=_+d[b];l.fromArray(c,M*3);u(l,M)}}}else{var T=c.length/3;for(var b=0;b<T;b++){l.set(c[3*b],c[3*b+1],c[3*b+2]);u(l,b)}}}else{var S=this.geometry.vertices;for(var b=0;b<S.length;b++){u(S[b],b)}}}}();i.PointCloud.prototype.clone=function(e){if(e===undefined)e=new i.PointCloud(this.geometry,this.material);e.sortParticles=this.sortParticles;i.Object3D.prototype.clone.call(this,e);return e};i.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");
return new i.PointCloud(e,t)};i.Line=function(e,t,r){i.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.LineBasicMaterial({color:Math.random()*16777215});this.mode=r!==undefined?r:i.LineStrip};i.LineStrip=0;i.LinePieces=1;i.Line.prototype=Object.create(i.Object3D.prototype);i.Line.prototype.constructor=i.Line;i.Line.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;return function(n,a){var o=n.linePrecision;var s=o*o;var h=this.geometry;if(h.boundingSphere===null)h.computeBoundingSphere();r.copy(h.boundingSphere);r.applyMatrix4(this.matrixWorld);if(n.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(n.ray).applyMatrix4(e);if(h instanceof i.Geometry){var l=h.vertices;var u=l.length;var f=new i.Vector3;var c=new i.Vector3;var d=this.mode===i.LineStrip?1:2;for(var p=0;p<u-1;p=p+d){var m=t.distanceSqToSegment(l[p],l[p+1],c,f);if(m>s)continue;var v=t.origin.distanceTo(c);if(v<n.near||v>n.far)continue;a.push({distance:v,point:f.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}();i.Line.prototype.clone=function(e){if(e===undefined)e=new i.Line(this.geometry,this.material,this.mode);i.Object3D.prototype.clone.call(this,e);return e};i.Mesh=function(e,t){i.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};i.Mesh.prototype=Object.create(i.Object3D.prototype);i.Mesh.prototype.constructor=i.Mesh;i.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};i.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};i.Mesh.prototype.raycast=function(){var e=new i.Matrix4;var t=new i.Ray;var r=new i.Sphere;var n=new i.Vector3;var a=new i.Vector3;var o=new i.Vector3;return function(s,h){var l=this.geometry;if(l.boundingSphere===null)l.computeBoundingSphere();r.copy(l.boundingSphere);r.applyMatrix4(this.matrixWorld);if(s.ray.isIntersectionSphere(r)===false){return}e.getInverse(this.matrixWorld);t.copy(s.ray).applyMatrix4(e);if(l.boundingBox!==null){if(t.isIntersectionBox(l.boundingBox)===false){return}}if(l instanceof i.BufferGeometry){var u=this.material;if(u===undefined)return;var f=l.attributes;var c,d,p;var m=s.precision;if(f.index!==undefined){var v=f.index.array;var g=f.position.array;var y=l.offsets;if(y.length===0){y=[{start:0,count:v.length,index:0}]}for(var x=0,_=y.length;x<_;++x){var b=y[x].start;var w=y[x].count;var M=y[x].index;for(var T=b,S=b+w;T<S;T+=3){c=M+v[T];d=M+v[T+1];p=M+v[T+2];n.fromArray(g,c*3);a.fromArray(g,d*3);o.fromArray(g,p*3);if(u.side===i.BackSide){var E=t.intersectTriangle(o,a,n,true)}else{var E=t.intersectTriangle(n,a,o,u.side!==i.DoubleSide)}if(E===null)continue;E.applyMatrix4(this.matrixWorld);var A=s.ray.origin.distanceTo(E);if(A<m||A<s.near||A>s.far)continue;h.push({distance:A,point:E,face:new i.Face3(c,d,p,i.Triangle.normal(n,a,o)),faceIndex:null,object:this})}}}else{var g=f.position.array;for(var T=0,C=0,S=g.length;T<S;T+=3,C+=9){c=T;d=T+1;p=T+2;n.fromArray(g,C);a.fromArray(g,C+3);o.fromArray(g,C+6);if(u.side===i.BackSide){var E=t.intersectTriangle(o,a,n,true)}else{var E=t.intersectTriangle(n,a,o,u.side!==i.DoubleSide)}if(E===null)continue;E.applyMatrix4(this.matrixWorld);var A=s.ray.origin.distanceTo(E);if(A<m||A<s.near||A>s.far)continue;h.push({distance:A,point:E,face:new i.Face3(c,d,p,i.Triangle.normal(n,a,o)),faceIndex:null,object:this})}}}else if(l instanceof i.Geometry){var L=this.material instanceof i.MeshFaceMaterial;var R=L===true?this.material.materials:null;var c,d,p,P;var m=s.precision;var D=l.vertices;for(var F=0,U=l.faces.length;F<U;F++){var k=l.faces[F];var u=L===true?R[k.materialIndex]:this.material;if(u===undefined)continue;c=D[k.a];d=D[k.b];p=D[k.c];if(u.morphTargets===true){var B=l.morphTargets;var V=this.morphTargetInfluences;n.set(0,0,0);a.set(0,0,0);o.set(0,0,0);for(var N=0,O=B.length;N<O;N++){var z=V[N];if(z===0)continue;var I=B[N].vertices;n.x+=(I[k.a].x-c.x)*z;n.y+=(I[k.a].y-c.y)*z;n.z+=(I[k.a].z-c.z)*z;a.x+=(I[k.b].x-d.x)*z;a.y+=(I[k.b].y-d.y)*z;a.z+=(I[k.b].z-d.z)*z;o.x+=(I[k.c].x-p.x)*z;o.y+=(I[k.c].y-p.y)*z;o.z+=(I[k.c].z-p.z)*z}n.add(c);a.add(d);o.add(p);c=n;d=a;p=o}if(u.side===i.BackSide){var E=t.intersectTriangle(p,d,c,true)}else{var E=t.intersectTriangle(c,d,p,u.side!==i.DoubleSide)}if(E===null)continue;E.applyMatrix4(this.matrixWorld);var A=s.ray.origin.distanceTo(E);if(A<m||A<s.near||A>s.far)continue;h.push({distance:A,point:E,face:k,faceIndex:F,object:this})}}}}();i.Mesh.prototype.clone=function(e,t){if(e===undefined)e=new i.Mesh(this.geometry,this.material);i.Object3D.prototype.clone.call(this,e,t);return e};i.Bone=function(e){i.Object3D.call(this);this.skin=e};i.Bone.prototype=Object.create(i.Object3D.prototype);i.Bone.prototype.constructor=i.Bone;i.Skeleton=function(e,t,r){this.useVertexTexture=r!==undefined?r:true;this.identityMatrix=new i.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var n;if(this.bones.length>256)n=64;else if(this.bones.length>64)n=32;else if(this.bones.length>16)n=16;else n=8;this.boneTextureWidth=n;this.boneTextureHeight=n;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType);this.boneTexture.minFilter=i.NearestFilter;this.boneTexture.magFilter=i.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var a=0,o=this.bones.length;a<o;a++){this.boneInverses.push(new i.Matrix4)}}}};i.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new i.Matrix4;if(this.bones[e]){r.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(r)}};i.Skeleton.prototype.pose=function(){var e;for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,r=this.bones.length;t<r;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};i.Skeleton.prototype.update=function(){var e=new i.Matrix4;return function(){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();i.SkinnedMesh=function(e,t,r){i.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new i.Matrix4;this.bindMatrixInverse=new i.Matrix4;var n=[];if(this.geometry&&this.geometry.bones!==undefined){var a,o,s,h,l;for(var u=0,f=this.geometry.bones.length;u<f;++u){o=this.geometry.bones[u];s=o.pos;h=o.rotq;l=o.scl;a=new i.Bone(this);n.push(a);a.name=o.name;a.position.set(s[0],s[1],s[2]);a.quaternion.set(h[0],h[1],h[2],h[3]);if(l!==undefined){a.scale.set(l[0],l[1],l[2])}else{a.scale.set(1,1,1)}}for(var u=0,f=this.geometry.bones.length;u<f;++u){o=this.geometry.bones[u];if(o.parent!==-1){n[o.parent].add(n[u])}else{this.add(n[u])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new i.Skeleton(n,undefined,r))};i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype);i.SkinnedMesh.prototype.constructor=i.SkinnedMesh;i.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};i.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var r=1/t.lengthManhattan();if(r!==Infinity){t.multiplyScalar(r)}else{t.set(1)}}}else{}};i.SkinnedMesh.prototype.updateMatrixWorld=function(e){i.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};i.SkinnedMesh.prototype.clone=function(e){if(e===undefined){e=new i.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}i.Mesh.prototype.clone.call(this,e);return e};i.MorphAnimMesh=function(e,t){i.Mesh.call(this,e,t);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};i.MorphAnimMesh.prototype=Object.create(i.Mesh.prototype);i.MorphAnimMesh.prototype.constructor=i.MorphAnimMesh;i.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};i.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};i.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};i.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,r=e.animations;var i=/([a-z]+)_?(\d+)/;for(var n=0,a=e.morphTargets.length;n<a;n++){var o=e.morphTargets[n];var s=o.name.match(i);if(s&&s.length>1){var h=s[1];var l=s[2];if(!r[h])r[h]={start:Infinity,end:-Infinity};var u=r[h];if(n<u.start)u.start=n;if(n>u.end)u.end=n;if(!t)t=h}}e.firstAnimation=t};i.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:r}};i.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];if(r){this.setFrameRange(r.start,r.end);this.duration=1e3*((r.end-r.start)/t);this.time=0}else{console.warn("animation["+e+"] undefined")}};i.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var r=this.startKeyframe+i.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(r!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[r]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=r}var n=this.time%t/t;if(this.directionBackwards){n=1-n}this.morphTargetInfluences[this.currentKeyframe]=n;this.morphTargetInfluences[this.lastKeyframe]=1-n};i.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){var i=this.morphTargetInfluences;for(var n=0,a=i.length;n<a;n++){i[n]=0}if(e>-1)i[e]=1-r;if(t>-1)i[t]=r};i.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new i.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;i.Mesh.prototype.clone.call(this,e);return e};i.LOD=function(){i.Object3D.call(this);this.objects=[]};i.LOD.prototype=Object.create(i.Object3D.prototype);i.LOD.prototype.constructor=i.LOD;i.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var r=0;r<this.objects.length;r++){if(t<this.objects[r].distance){break}}this.objects.splice(r,0,{distance:t,object:e});this.add(e)};i.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};i.LOD.prototype.raycast=function(){var e=new i.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}();i.LOD.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=true;for(var n=1,a=this.objects.length;n<a;n++){if(i>=this.objects[n].distance){this.objects[n-1].object.visible=false;this.objects[n].object.visible=true}else{break}}for(;n<a;n++){this.objects[n].object.visible=false}}}}();i.LOD.prototype.clone=function(e){if(e===undefined)e=new i.LOD;i.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;t<r;t++){var n=this.objects[t].object.clone();n.visible=t===0;e.addLevel(n,this.objects[t].distance)}return e};i.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var r=new Float32Array([0,0,1,0,1,1,0,1]);var n=new i.BufferGeometry;n.addAttribute("index",new i.BufferAttribute(e,1));n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("uv",new i.BufferAttribute(r,2));return function(e){i.Object3D.call(this);this.type="Sprite";this.geometry=n;this.material=e!==undefined?e:new i.SpriteMaterial}}();i.Sprite.prototype=Object.create(i.Object3D.prototype);i.Sprite.prototype.constructor=i.Sprite;i.Sprite.prototype.raycast=function(){var e=new i.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);if(i>this.scale.x){return}r.push({distance:i,point:this.position,face:null,object:this})}}();i.Sprite.prototype.clone=function(e){if(e===undefined)e=new i.Sprite(this.material);i.Object3D.prototype.clone.call(this,e);return e};i.Particle=i.Sprite;i.LensFlare=function(e,t,r,n,a){i.Object3D.call(this);this.lensFlares=[];this.positionScreen=new i.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,r,n,a)}};i.LensFlare.prototype=Object.create(i.Object3D.prototype);i.LensFlare.prototype.constructor=i.LensFlare;i.LensFlare.prototype.add=function(e,t,r,n,a,o){if(t===undefined)t=-1;if(r===undefined)r=0;if(o===undefined)o=1;if(a===undefined)a=new i.Color(16777215);if(n===undefined)n=i.NormalBlending;r=Math.min(r,Math.max(0,r));this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:a,blending:n})};i.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var r;var i=-this.positionScreen.x*2;var n=-this.positionScreen.y*2;for(e=0;e<t;e++){r=this.lensFlares[e];r.x=this.positionScreen.x+i*r.distance;r.y=this.positionScreen.y+n*r.distance;r.wantedRotation=r.x*Math.PI*.25;r.rotation+=(r.wantedRotation-r.rotation)*.25}};i.Scene=function(){i.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};i.Scene.prototype=Object.create(i.Object3D.prototype);i.Scene.prototype.constructor=i.Scene;i.Scene.prototype.clone=function(e){if(e===undefined)e=new i.Scene;i.Object3D.prototype.clone.call(this,e);if(this.fog!==null)e.fog=this.fog.clone();if(this.overrideMaterial!==null)e.overrideMaterial=this.overrideMaterial.clone();e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};i.Fog=function(e,t,r){this.name="";this.color=new i.Color(e);this.near=t!==undefined?t:1;this.far=r!==undefined?r:1e3};i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)};i.FogExp2=function(e,t){this.name="";this.color=new i.Color(e);this.density=t!==undefined?t:25e-5};i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)};i.ShaderChunk={};i.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";i.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";i.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";i.ShaderChunk["default_vertex"]="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;";i.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";i.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n";i.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";i.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif";i.ShaderChunk["lights_phong_fragment"]="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";i.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";i.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif";
i.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif";i.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";i.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";i.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";i.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif";i.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";i.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif";i.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif";i.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif";i.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";i.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";i.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif";i.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";i.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n";i.ShaderChunk["linear_to_gamma_fragment"]="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";i.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";i.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n";i.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";i.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = clamp( flipNormal * reflectVec.y * 0.5 + 0.5, 0.0, 1.0);\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * 0.15915494309189533576888376337251 + 0.5; // reciprocal( 2 PI ) + 0.5\n		vec4 envColor = texture2D( envMap, sampleUV );\n		\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		envColor.xyz *= envColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, envColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += envColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * envColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif";i.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";i.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";i.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";i.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";i.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";i.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif";i.ShaderChunk["defaultnormal_vertex"]="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;";i.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";i.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";i.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";i.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";i.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";i.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";i.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif";i.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif";i.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";i.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif";i.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";i.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";i.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif";i.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";i.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";i.UniformsUtils={merge:function(e){var t={};for(var r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i){t[n]=i[n]}}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var n in e[r]){var a=e[r][n];if(a instanceof i.Color||a instanceof i.Vector2||a instanceof i.Vector3||a instanceof i.Vector4||a instanceof i.Matrix4||a instanceof i.Texture){t[r][n]=a.clone()}else if(a instanceof Array){t[r][n]=a.slice()}else{t[r][n]=a}}}return t}};i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["shadowmap"]]),vertexShader:[i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"	#endif",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_lambert_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_lambert_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["bump"],i.UniformsLib["normalmap"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_phong_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"	vNormal = normalize( transformedNormal );",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = -mvPosition.xyz;",i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_phong_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["alphamap_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["lights_phong_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["bumpmap_pars_fragment"],i.ShaderChunk["normalmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_fragment"],i.ShaderChunk["alphamap_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["lights_phong_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["particle"],i.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_particle_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( psColor, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["map_particle_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk["logdepthbuf_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},normalmap:{uniforms:i.UniformsUtils.merge([i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new i.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new i.Color(16777215)},specular:{type:"c",value:new i.Color(1118481)},ambient:{type:"c",value:new i.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new i.Vector2(0,0)},uRepeat:{type:"v2",value:new i.Vector2(1,1)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",i.ShaderChunk["alphatest_fragment"],"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["logdepthbuf_vertex"],"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = clamp( tFlip * direction.y * -0.5 + 0.5, 0.0, 1.0);","sampleUV.x = atan( direction.z, direction.x ) * 0.15915494309189533576888376337251 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",i.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[i.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",i.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}};
i.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",i.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),r=e.context!==undefined?e.context:null,n=e.precision!==undefined?e.precision:"highp",a=e.alpha!==undefined?e.alpha:false,o=e.depth!==undefined?e.depth:true,s=e.stencil!==undefined?e.stencil:true,h=e.antialias!==undefined?e.antialias:false,l=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,u=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,f=e.logarithmicDepthBuffer!==undefined?e.logarithmicDepthBuffer:false,c=new i.Color(0),d=0;var p=[];var m={};var v=[];var g=[];var y=[];var x=[];var _=[];this.domElement=t;this.context=null;this.devicePixelRatio=self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=i.PCFShadowMap;this.shadowMapCullFace=i.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var b=this,w=[],M=null,T=null,S=-1,E=-1,A=null,C=0,L=-1,R=-1,P=-1,D=-1,F=-1,U=-1,k=-1,B=-1,V=null,N=null,O=null,z=null,I=0,j=0,G=t.width,H=t.height,W=0,X=0,Y=new Uint8Array(16),q=new Uint8Array(16),K=new i.Frustum,Z=new i.Matrix4,Q=new i.Matrix4,J=new i.Vector3,$=new i.Vector3,et=true,tt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var rt;try{var it={alpha:a,depth:o,stencil:s,antialias:h,premultipliedAlpha:l,preserveDrawingBuffer:u};rt=r||t.getContext("webgl",it)||t.getContext("experimental-webgl",it);if(rt===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}t.addEventListener("webglcontextlost",function(e){e.preventDefault();st();ot();m={}},false)}catch(nt){console.error(nt)}if(rt.getShaderPrecisionFormat===undefined){rt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var at=new i.WebGLExtensions(rt);at.get("OES_texture_float");at.get("OES_texture_float_linear");at.get("OES_standard_derivatives");if(f){at.get("EXT_frag_depth")}var ot=function(){rt.clearColor(0,0,0,1);rt.clearDepth(1);rt.clearStencil(0);rt.enable(rt.DEPTH_TEST);rt.depthFunc(rt.LEQUAL);rt.frontFace(rt.CCW);rt.cullFace(rt.BACK);rt.enable(rt.CULL_FACE);rt.enable(rt.BLEND);rt.blendEquation(rt.FUNC_ADD);rt.blendFunc(rt.SRC_ALPHA,rt.ONE_MINUS_SRC_ALPHA);rt.viewport(I,j,G,H);rt.clearColor(c.r,c.g,c.b,d)};var st=function(){M=null;A=null;P=-1;k=-1;B=-1;L=-1;R=-1;E=-1;S=-1;et=true;for(var e=0;e<q.length;e++){q[e]=0}};ot();this.context=rt;var ht=rt.getParameter(rt.MAX_TEXTURE_IMAGE_UNITS);var lt=rt.getParameter(rt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var ut=rt.getParameter(rt.MAX_TEXTURE_SIZE);var ft=rt.getParameter(rt.MAX_CUBE_MAP_TEXTURE_SIZE);var ct=lt>0;var dt=ct&&at.get("OES_texture_float");var pt=rt.getShaderPrecisionFormat(rt.VERTEX_SHADER,rt.HIGH_FLOAT);var mt=rt.getShaderPrecisionFormat(rt.VERTEX_SHADER,rt.MEDIUM_FLOAT);var vt=rt.getShaderPrecisionFormat(rt.VERTEX_SHADER,rt.LOW_FLOAT);var gt=rt.getShaderPrecisionFormat(rt.FRAGMENT_SHADER,rt.HIGH_FLOAT);var yt=rt.getShaderPrecisionFormat(rt.FRAGMENT_SHADER,rt.MEDIUM_FLOAT);var xt=rt.getShaderPrecisionFormat(rt.FRAGMENT_SHADER,rt.LOW_FLOAT);var _t=function(){var e;return function(){if(e!==undefined){return e}e=[];if(at.get("WEBGL_compressed_texture_pvrtc")||at.get("WEBGL_compressed_texture_s3tc")){var t=rt.getParameter(rt.COMPRESSED_TEXTURE_FORMATS);for(var r=0;r<t.length;r++){e.push(t[r])}}return e}}();var bt=pt.precision>0&&gt.precision>0;var wt=mt.precision>0&&yt.precision>0;if(n==="highp"&&!bt){if(wt){n="mediump";console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{n="lowp";console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(n==="mediump"&&!wt){n="lowp";console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var Mt=new i.ShadowMapPlugin(this,p,m,v);var Tt=new i.SpritePlugin(this,x);var St=new i.LensFlarePlugin(this,_);this.getContext=function(){return rt};this.forceContextLoss=function(){at.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return ct};this.supportsFloatTextures=function(){return at.get("OES_texture_float")};this.supportsStandardDerivatives=function(){return at.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return at.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return at.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return at.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var e;return function(){if(e!==undefined){return e}var t=at.get("EXT_texture_filter_anisotropic");e=t!==null?rt.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return e}}();this.getPrecision=function(){return n};this.setSize=function(e,r,i){t.width=e*this.devicePixelRatio;t.height=r*this.devicePixelRatio;if(i!==false){t.style.width=e+"px";t.style.height=r+"px"}this.setViewport(0,0,e,r)};this.setViewport=function(e,t,r,i){I=e*this.devicePixelRatio;j=t*this.devicePixelRatio;G=r*this.devicePixelRatio;H=i*this.devicePixelRatio;rt.viewport(I,j,G,H)};this.setScissor=function(e,t,r,i){rt.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,i*this.devicePixelRatio)};this.enableScissorTest=function(e){e?rt.enable(rt.SCISSOR_TEST):rt.disable(rt.SCISSOR_TEST)};this.setClearColor=function(e,t){c.set(e);d=t!==undefined?t:1;rt.clearColor(c.r,c.g,c.b,d)};this.setClearColorHex=function(e,t){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,t)};this.getClearColor=function(){return c};this.getClearAlpha=function(){return d};this.clear=function(e,t,r){var i=0;if(e===undefined||e)i|=rt.COLOR_BUFFER_BIT;if(t===undefined||t)i|=rt.DEPTH_BUFFER_BIT;if(r===undefined||r)i|=rt.STENCIL_BUFFER_BIT;rt.clear(i)};this.clearColor=function(){rt.clear(rt.COLOR_BUFFER_BIT)};this.clearDepth=function(){rt.clear(rt.DEPTH_BUFFER_BIT)};this.clearStencil=function(){rt.clear(rt.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,r,i){this.setRenderTarget(e);this.clear(t,r,i)};this.resetGLState=st;function Et(e){e.__webglVertexBuffer=rt.createBuffer();e.__webglColorBuffer=rt.createBuffer();b.info.memory.geometries++}function At(e){e.__webglVertexBuffer=rt.createBuffer();e.__webglColorBuffer=rt.createBuffer();e.__webglLineDistanceBuffer=rt.createBuffer();b.info.memory.geometries++}function Ct(e){e.__webglVertexBuffer=rt.createBuffer();e.__webglNormalBuffer=rt.createBuffer();e.__webglTangentBuffer=rt.createBuffer();e.__webglColorBuffer=rt.createBuffer();e.__webglUVBuffer=rt.createBuffer();e.__webglUV2Buffer=rt.createBuffer();e.__webglSkinIndicesBuffer=rt.createBuffer();e.__webglSkinWeightsBuffer=rt.createBuffer();e.__webglFaceBuffer=rt.createBuffer();e.__webglLineBuffer=rt.createBuffer();var t,r;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,r=e.numMorphTargets;t<r;t++){e.__webglMorphTargetsBuffers.push(rt.createBuffer())}}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,r=e.numMorphNormals;t<r;t++){e.__webglMorphNormalsBuffers.push(rt.createBuffer())}}b.info.memory.geometries++}var Lt=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",Lt);yr(e)})};var Rt=function(e){var t=e.target;t.removeEventListener("dispose",Rt);kt(t)};var Pt=function(e){var t=e.target;t.removeEventListener("dispose",Pt);Bt(t);b.info.memory.textures--};var Dt=function(e){var t=e.target;t.removeEventListener("dispose",Dt);Vt(t);b.info.memory.textures--};var Ft=function(e){var t=e.target;t.removeEventListener("dispose",Ft);Nt(t)};var Ut=function(e){var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var r=0,i=t.length;r<i;r++){var n=t[r];if(e[n]!==undefined){rt.deleteBuffer(e[n]);delete e[n]}}if(e.__webglCustomAttributesList!==undefined){for(var n in e.__webglCustomAttributesList){rt.deleteBuffer(e.__webglCustomAttributesList[n].buffer)}delete e.__webglCustomAttributesList}b.info.memory.geometries--};var kt=function(e){delete e.__webglInit;if(e instanceof i.BufferGeometry){for(var t in e.attributes){var r=e.attributes[t];if(r.buffer!==undefined){rt.deleteBuffer(r.buffer);delete r.buffer}}b.info.memory.geometries--}else{var n=lr[e.id];if(n!==undefined){for(var a=0,o=n.length;a<o;a++){var s=n[a];if(s.numMorphTargets!==undefined){for(var h=0,l=s.numMorphTargets;h<l;h++){rt.deleteBuffer(s.__webglMorphTargetsBuffers[h])}delete s.__webglMorphTargetsBuffers}if(s.numMorphNormals!==undefined){for(var h=0,l=s.numMorphNormals;h<l;h++){rt.deleteBuffer(s.__webglMorphNormalsBuffers[h])}delete s.__webglMorphNormalsBuffers}Ut(s)}delete lr[e.id]}else{Ut(e)}}E=-1};var Bt=function(e){if(e.image&&e.image.__webglTextureCube){rt.deleteTexture(e.image.__webglTextureCube);delete e.image.__webglTextureCube}else{if(e.__webglInit===undefined)return;rt.deleteTexture(e.__webglTexture);delete e.__webglTexture;delete e.__webglInit}};var Vt=function(e){if(!e||e.__webglTexture===undefined)return;rt.deleteTexture(e.__webglTexture);delete e.__webglTexture;if(e instanceof i.WebGLRenderTargetCube){for(var t=0;t<6;t++){rt.deleteFramebuffer(e.__webglFramebuffer[t]);rt.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{rt.deleteFramebuffer(e.__webglFramebuffer);rt.deleteRenderbuffer(e.__webglRenderbuffer)}delete e.__webglFramebuffer;delete e.__webglRenderbuffer};var Nt=function(e){var t=e.program.program;if(t===undefined)return;e.program=undefined;var r,i,n;var a=false;for(r=0,i=w.length;r<i;r++){n=w[r];if(n.program===t){n.usedTimes--;if(n.usedTimes===0){a=true}break}}if(a===true){var o=[];for(r=0,i=w.length;r<i;r++){n=w[r];if(n.program!==t){o.push(n)}}w=o;rt.deleteProgram(t);b.info.memory.programs--}};function Ot(e){var t=e.geometry;var r=e.material;var i=t.vertices.length;if(r.attributes){if(t.__webglCustomAttributesList===undefined){t.__webglCustomAttributesList=[]}for(var n in r.attributes){var a=r.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=true;var o=1;if(a.type==="v2")o=2;else if(a.type==="v3")o=3;else if(a.type==="v4")o=4;else if(a.type==="c")o=3;a.size=o;a.array=new Float32Array(i*o);a.buffer=rt.createBuffer();a.buffer.belongsToAttribute=n;a.needsUpdate=true}t.__webglCustomAttributesList.push(a)}}}function zt(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(r*3);e.__colorArray=new Float32Array(r*3);e.__sortArray=[];e.__webglParticleCount=r;Ot(t)}function It(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(r*3);e.__colorArray=new Float32Array(r*3);e.__lineDistanceArray=new Float32Array(r*1);e.__webglLineCount=r;Ot(t)}function jt(e,t){var r=t.geometry,i=e.faces3,n=i.length*3,a=i.length*1,o=i.length*3,s=Gt(t,e);e.__vertexArray=new Float32Array(n*3);e.__normalArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__uvArray=new Float32Array(n*2);if(r.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(n*2)}if(r.hasTangents){e.__tangentArray=new Float32Array(n*4)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(n*4);e.__skinWeightArray=new Float32Array(n*4)}var h=at.get("OES_element_index_uint")!==null&&a>21845?Uint32Array:Uint16Array;e.__typeArray=h;e.__faceArray=new h(a*3);e.__lineArray=new h(o*2);var l,u;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(l=0,u=e.numMorphTargets;l<u;l++){e.__morphTargetsArrays.push(new Float32Array(n*3))}}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(l=0,u=e.numMorphNormals;l<u;l++){e.__morphNormalsArrays.push(new Float32Array(n*3))}}e.__webglFaceCount=a*3;e.__webglLineCount=o*2;if(s.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var f in s.attributes){var c=s.attributes[f];var d={};for(var p in c){d[p]=c[p]}if(!d.__webglInitialized||d.createUniqueBuffers){d.__webglInitialized=true;var m=1;if(d.type==="v2")m=2;else if(d.type==="v3")m=3;else if(d.type==="v4")m=4;else if(d.type==="c")m=3;d.size=m;d.array=new Float32Array(n*m);d.buffer=rt.createBuffer();d.buffer.belongsToAttribute=f;c.needsUpdate=true;d.__original=c}e.__webglCustomAttributesList.push(d)}}e.__inittedArrays=true}function Gt(e,t){return e.material instanceof i.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Ht(e){return e&&e.shading!==undefined&&e.shading===i.SmoothShading}function Wt(e,t,r){var i,n,a,o,s,h,l=e.vertices,u=l.length,f=e.colors,c=f.length,d=e.__vertexArray,p=e.__colorArray,m=e.__sortArray,v=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,x=e.__webglCustomAttributesList,_,b,w,M,T,S,E;if(r.sortParticles){Q.copy(Z);Q.multiply(r.matrixWorld);for(i=0;i<u;i++){a=l[i];J.copy(a);J.applyProjection(Q);m[i]=[J.z,i]}m.sort(rr);for(i=0;i<u;i++){a=l[m[i][1]];o=i*3;d[o]=a.x;d[o+1]=a.y;d[o+2]=a.z}for(n=0;n<c;n++){o=n*3;h=f[m[n][1]];p[o]=h.r;p[o+1]=h.g;p[o+2]=h.b}if(x){for(_=0,b=x.length;_<b;_++){E=x[_];if(!(E.boundTo===undefined||E.boundTo==="vertices"))continue;o=0;T=E.value.length;if(E.size===1){for(M=0;M<T;M++){s=m[M][1];E.array[M]=E.value[s]}}else if(E.size===2){for(M=0;M<T;M++){s=m[M][1];S=E.value[s];E.array[o]=S.x;E.array[o+1]=S.y;o+=2}}else if(E.size===3){if(E.type==="c"){for(M=0;M<T;M++){s=m[M][1];S=E.value[s];E.array[o]=S.r;E.array[o+1]=S.g;E.array[o+2]=S.b;o+=3}}else{for(M=0;M<T;M++){s=m[M][1];S=E.value[s];E.array[o]=S.x;E.array[o+1]=S.y;E.array[o+2]=S.z;o+=3}}}else if(E.size===4){for(M=0;M<T;M++){s=m[M][1];S=E.value[s];E.array[o]=S.x;E.array[o+1]=S.y;E.array[o+2]=S.z;E.array[o+3]=S.w;o+=4}}}}}else{if(v){for(i=0;i<u;i++){a=l[i];o=i*3;d[o]=a.x;d[o+1]=a.y;d[o+2]=a.z}}if(y){for(n=0;n<c;n++){h=f[n];o=n*3;p[o]=h.r;p[o+1]=h.g;p[o+2]=h.b}}if(x){for(_=0,b=x.length;_<b;_++){E=x[_];if(E.needsUpdate&&(E.boundTo===undefined||E.boundTo==="vertices")){T=E.value.length;o=0;if(E.size===1){for(M=0;M<T;M++){E.array[M]=E.value[M]}}else if(E.size===2){for(M=0;M<T;M++){S=E.value[M];E.array[o]=S.x;E.array[o+1]=S.y;o+=2}}else if(E.size===3){if(E.type==="c"){for(M=0;M<T;M++){S=E.value[M];E.array[o]=S.r;E.array[o+1]=S.g;E.array[o+2]=S.b;o+=3}}else{for(M=0;M<T;M++){S=E.value[M];E.array[o]=S.x;E.array[o+1]=S.y;E.array[o+2]=S.z;o+=3}}}else if(E.size===4){for(M=0;M<T;M++){S=E.value[M];E.array[o]=S.x;E.array[o+1]=S.y;E.array[o+2]=S.z;E.array[o+3]=S.w;o+=4}}}}}}if(v||r.sortParticles){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglVertexBuffer);rt.bufferData(rt.ARRAY_BUFFER,d,t)}if(y||r.sortParticles){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglColorBuffer);rt.bufferData(rt.ARRAY_BUFFER,p,t)}if(x){for(_=0,b=x.length;_<b;_++){E=x[_];if(E.needsUpdate||r.sortParticles){rt.bindBuffer(rt.ARRAY_BUFFER,E.buffer);rt.bufferData(rt.ARRAY_BUFFER,E.array,t)}}}}function Xt(e,t){var r,i,n,a,o,s,h=e.vertices,l=e.colors,u=e.lineDistances,f=h.length,c=l.length,d=u.length,p=e.__vertexArray,m=e.__colorArray,v=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,x=e.lineDistancesNeedUpdate,_=e.__webglCustomAttributesList,b,w,M,T,S,E,A;if(g){for(r=0;r<f;r++){a=h[r];o=r*3;p[o]=a.x;p[o+1]=a.y;p[o+2]=a.z}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglVertexBuffer);rt.bufferData(rt.ARRAY_BUFFER,p,t)}if(y){for(i=0;i<c;i++){s=l[i];o=i*3;m[o]=s.r;m[o+1]=s.g;m[o+2]=s.b}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglColorBuffer);rt.bufferData(rt.ARRAY_BUFFER,m,t)}if(x){for(n=0;n<d;n++){v[n]=u[n]}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglLineDistanceBuffer);rt.bufferData(rt.ARRAY_BUFFER,v,t)}if(_){for(b=0,w=_.length;b<w;b++){A=_[b];if(A.needsUpdate&&(A.boundTo===undefined||A.boundTo==="vertices")){o=0;S=A.value.length;if(A.size===1){for(T=0;T<S;T++){A.array[T]=A.value[T]}}else if(A.size===2){for(T=0;T<S;T++){E=A.value[T];A.array[o]=E.x;A.array[o+1]=E.y;o+=2}}else if(A.size===3){if(A.type==="c"){for(T=0;T<S;T++){E=A.value[T];A.array[o]=E.r;A.array[o+1]=E.g;A.array[o+2]=E.b;o+=3}}else{for(T=0;T<S;T++){E=A.value[T];A.array[o]=E.x;A.array[o+1]=E.y;A.array[o+2]=E.z;o+=3}}}else if(A.size===4){for(T=0;T<S;T++){E=A.value[T];A.array[o]=E.x;A.array[o+1]=E.y;A.array[o+2]=E.z;A.array[o+3]=E.w;o+=4}}rt.bindBuffer(rt.ARRAY_BUFFER,A.buffer);rt.bufferData(rt.ARRAY_BUFFER,A.array,t)}}}}function Yt(e,t,r,n,a){if(!e.__inittedArrays){return}var o=Ht(a);var s,h,l,u,f,c,d,p,m,v,g,y,x,_,b,w,M,T,S,E,A,C,L,R,P,D,F,U,k,B,V,N,O,z,I,j,G,H,W,X,Y,q,K,Z,Q,J,$,et,tt,it,nt,at,ot,st,ht,lt,ut,ft=0,ct=0,dt=0,pt=0,mt=0,vt=0,gt=0,yt=0,xt=0,_t=0,bt=0,wt=0,Mt=0,Tt,St=e.__vertexArray,Et=e.__uvArray,At=e.__uv2Array,Ct=e.__normalArray,Lt=e.__tangentArray,Rt=e.__colorArray,Pt=e.__skinIndexArray,Dt=e.__skinWeightArray,Ft=e.__morphTargetsArrays,Ut=e.__morphNormalsArrays,kt=e.__webglCustomAttributesList,Bt,Vt=e.__faceArray,Nt=e.__lineArray,Ot=t.geometry,zt=Ot.verticesNeedUpdate,It=Ot.elementsNeedUpdate,jt=Ot.uvsNeedUpdate,Gt=Ot.normalsNeedUpdate,Wt=Ot.tangentsNeedUpdate,Xt=Ot.colorsNeedUpdate,Yt=Ot.morphTargetsNeedUpdate,qt=Ot.vertices,Kt=e.faces3,Zt=Ot.faces,Qt=Ot.faceVertexUvs[0],Jt=Ot.faceVertexUvs[1],$t=Ot.colors,er=Ot.skinIndices,tr=Ot.skinWeights,rr=Ot.morphTargets,ir=Ot.morphNormals;if(zt){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];x=qt[u.a];_=qt[u.b];b=qt[u.c];St[ct]=x.x;St[ct+1]=x.y;St[ct+2]=x.z;St[ct+3]=_.x;St[ct+4]=_.y;St[ct+5]=_.z;St[ct+6]=b.x;St[ct+7]=b.y;St[ct+8]=b.z;ct+=9}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglVertexBuffer);rt.bufferData(rt.ARRAY_BUFFER,St,r)}if(Yt){for(nt=0,at=rr.length;nt<at;nt++){bt=0;for(s=0,h=Kt.length;s<h;s++){ht=Kt[s];u=Zt[ht];x=rr[nt].vertices[u.a];_=rr[nt].vertices[u.b];b=rr[nt].vertices[u.c];ot=Ft[nt];ot[bt]=x.x;ot[bt+1]=x.y;ot[bt+2]=x.z;ot[bt+3]=_.x;ot[bt+4]=_.y;ot[bt+5]=_.z;ot[bt+6]=b.x;ot[bt+7]=b.y;ot[bt+8]=b.z;if(a.morphNormals){if(o){lt=ir[nt].vertexNormals[ht];A=lt.a;C=lt.b;L=lt.c}else{A=ir[nt].faceNormals[ht];C=A;L=A}st=Ut[nt];st[bt]=A.x;st[bt+1]=A.y;st[bt+2]=A.z;st[bt+3]=C.x;st[bt+4]=C.y;st[bt+5]=C.z;st[bt+6]=L.x;st[bt+7]=L.y;st[bt+8]=L.z}bt+=9}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[nt]);rt.bufferData(rt.ARRAY_BUFFER,Ft[nt],r);if(a.morphNormals){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[nt]);rt.bufferData(rt.ARRAY_BUFFER,Ut[nt],r)}}}if(tr.length){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];U=tr[u.a];k=tr[u.b];B=tr[u.c];Dt[_t]=U.x;Dt[_t+1]=U.y;Dt[_t+2]=U.z;Dt[_t+3]=U.w;Dt[_t+4]=k.x;Dt[_t+5]=k.y;Dt[_t+6]=k.z;Dt[_t+7]=k.w;Dt[_t+8]=B.x;Dt[_t+9]=B.y;Dt[_t+10]=B.z;Dt[_t+11]=B.w;N=er[u.a];O=er[u.b];z=er[u.c];Pt[_t]=N.x;Pt[_t+1]=N.y;Pt[_t+2]=N.z;Pt[_t+3]=N.w;Pt[_t+4]=O.x;Pt[_t+5]=O.y;Pt[_t+6]=O.z;Pt[_t+7]=O.w;Pt[_t+8]=z.x;Pt[_t+9]=z.y;Pt[_t+10]=z.z;Pt[_t+11]=z.w;_t+=12}if(_t>0){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);rt.bufferData(rt.ARRAY_BUFFER,Pt,r);rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);rt.bufferData(rt.ARRAY_BUFFER,Dt,r)}}if(Xt){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];p=u.vertexColors;m=u.color;if(p.length===3&&a.vertexColors===i.VertexColors){P=p[0];D=p[1];F=p[2]}else{P=m;D=m;F=m}Rt[xt]=P.r;Rt[xt+1]=P.g;Rt[xt+2]=P.b;Rt[xt+3]=D.r;Rt[xt+4]=D.g;Rt[xt+5]=D.b;Rt[xt+6]=F.r;Rt[xt+7]=F.g;Rt[xt+8]=F.b;xt+=9}if(xt>0){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglColorBuffer);rt.bufferData(rt.ARRAY_BUFFER,Rt,r)}}if(Wt&&Ot.hasTangents){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];v=u.vertexTangents;M=v[0];T=v[1];S=v[2];Lt[gt]=M.x;Lt[gt+1]=M.y;Lt[gt+2]=M.z;Lt[gt+3]=M.w;Lt[gt+4]=T.x;Lt[gt+5]=T.y;Lt[gt+6]=T.z;Lt[gt+7]=T.w;Lt[gt+8]=S.x;Lt[gt+9]=S.y;Lt[gt+10]=S.z;Lt[gt+11]=S.w;gt+=12}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglTangentBuffer);rt.bufferData(rt.ARRAY_BUFFER,Lt,r)}if(Gt){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];f=u.vertexNormals;c=u.normal;if(f.length===3&&o){for(J=0;J<3;J++){et=f[J];Ct[vt]=et.x;Ct[vt+1]=et.y;Ct[vt+2]=et.z;vt+=3}}else{for(J=0;J<3;J++){Ct[vt]=c.x;Ct[vt+1]=c.y;Ct[vt+2]=c.z;vt+=3}}}rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglNormalBuffer);rt.bufferData(rt.ARRAY_BUFFER,Ct,r)}if(jt&&Qt){for(s=0,h=Kt.length;s<h;s++){l=Kt[s];g=Qt[l];if(g===undefined)continue;for(J=0;J<3;J++){tt=g[J];Et[dt]=tt.x;Et[dt+1]=tt.y;dt+=2}}if(dt>0){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglUVBuffer);rt.bufferData(rt.ARRAY_BUFFER,Et,r)}}if(jt&&Jt){for(s=0,h=Kt.length;s<h;s++){l=Kt[s];y=Jt[l];if(y===undefined)continue;for(J=0;J<3;J++){it=y[J];At[pt]=it.x;At[pt+1]=it.y;pt+=2}}if(pt>0){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglUV2Buffer);rt.bufferData(rt.ARRAY_BUFFER,At,r)}}if(It){for(s=0,h=Kt.length;s<h;s++){Vt[mt]=ft;Vt[mt+1]=ft+1;Vt[mt+2]=ft+2;mt+=3;Nt[yt]=ft;Nt[yt+1]=ft+1;Nt[yt+2]=ft;Nt[yt+3]=ft+2;Nt[yt+4]=ft+1;Nt[yt+5]=ft+2;yt+=6;ft+=3}rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);rt.bufferData(rt.ELEMENT_ARRAY_BUFFER,Vt,r);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);rt.bufferData(rt.ELEMENT_ARRAY_BUFFER,Nt,r)}if(kt){for(J=0,$=kt.length;J<$;J++){Bt=kt[J];if(!Bt.__original.needsUpdate)continue;wt=0;Mt=0;if(Bt.size===1){if(Bt.boundTo===undefined||Bt.boundTo==="vertices"){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];Bt.array[wt]=Bt.value[u.a];Bt.array[wt+1]=Bt.value[u.b];Bt.array[wt+2]=Bt.value[u.c];wt+=3}}else if(Bt.boundTo==="faces"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];Bt.array[wt]=Tt;Bt.array[wt+1]=Tt;Bt.array[wt+2]=Tt;wt+=3}}}else if(Bt.size===2){if(Bt.boundTo===undefined||Bt.boundTo==="vertices"){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];x=Bt.value[u.a];_=Bt.value[u.b];b=Bt.value[u.c];Bt.array[wt]=x.x;Bt.array[wt+1]=x.y;Bt.array[wt+2]=_.x;Bt.array[wt+3]=_.y;Bt.array[wt+4]=b.x;Bt.array[wt+5]=b.y;wt+=6}}else if(Bt.boundTo==="faces"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];x=Tt;_=Tt;b=Tt;Bt.array[wt]=x.x;Bt.array[wt+1]=x.y;Bt.array[wt+2]=_.x;Bt.array[wt+3]=_.y;Bt.array[wt+4]=b.x;Bt.array[wt+5]=b.y;wt+=6}}}else if(Bt.size===3){var nr;if(Bt.type==="c"){nr=["r","g","b"]}else{nr=["x","y","z"]}if(Bt.boundTo===undefined||Bt.boundTo==="vertices"){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];x=Bt.value[u.a];_=Bt.value[u.b];b=Bt.value[u.c];Bt.array[wt]=x[nr[0]];Bt.array[wt+1]=x[nr[1]];Bt.array[wt+2]=x[nr[2]];Bt.array[wt+3]=_[nr[0]];Bt.array[wt+4]=_[nr[1]];Bt.array[wt+5]=_[nr[2]];Bt.array[wt+6]=b[nr[0]];Bt.array[wt+7]=b[nr[1]];Bt.array[wt+8]=b[nr[2]];wt+=9}}else if(Bt.boundTo==="faces"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];x=Tt;_=Tt;b=Tt;Bt.array[wt]=x[nr[0]];Bt.array[wt+1]=x[nr[1]];Bt.array[wt+2]=x[nr[2]];Bt.array[wt+3]=_[nr[0]];Bt.array[wt+4]=_[nr[1]];Bt.array[wt+5]=_[nr[2]];Bt.array[wt+6]=b[nr[0]];Bt.array[wt+7]=b[nr[1]];Bt.array[wt+8]=b[nr[2]];wt+=9}}else if(Bt.boundTo==="faceVertices"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];x=Tt[0];_=Tt[1];b=Tt[2];Bt.array[wt]=x[nr[0]];Bt.array[wt+1]=x[nr[1]];Bt.array[wt+2]=x[nr[2]];Bt.array[wt+3]=_[nr[0]];Bt.array[wt+4]=_[nr[1]];Bt.array[wt+5]=_[nr[2]];Bt.array[wt+6]=b[nr[0]];Bt.array[wt+7]=b[nr[1]];Bt.array[wt+8]=b[nr[2]];wt+=9}}}else if(Bt.size===4){if(Bt.boundTo===undefined||Bt.boundTo==="vertices"){for(s=0,h=Kt.length;s<h;s++){u=Zt[Kt[s]];x=Bt.value[u.a];_=Bt.value[u.b];b=Bt.value[u.c];Bt.array[wt]=x.x;Bt.array[wt+1]=x.y;Bt.array[wt+2]=x.z;Bt.array[wt+3]=x.w;Bt.array[wt+4]=_.x;Bt.array[wt+5]=_.y;Bt.array[wt+6]=_.z;Bt.array[wt+7]=_.w;Bt.array[wt+8]=b.x;Bt.array[wt+9]=b.y;Bt.array[wt+10]=b.z;Bt.array[wt+11]=b.w;wt+=12}}else if(Bt.boundTo==="faces"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];x=Tt;_=Tt;b=Tt;Bt.array[wt]=x.x;Bt.array[wt+1]=x.y;Bt.array[wt+2]=x.z;Bt.array[wt+3]=x.w;Bt.array[wt+4]=_.x;Bt.array[wt+5]=_.y;Bt.array[wt+6]=_.z;Bt.array[wt+7]=_.w;Bt.array[wt+8]=b.x;Bt.array[wt+9]=b.y;Bt.array[wt+10]=b.z;Bt.array[wt+11]=b.w;wt+=12}}else if(Bt.boundTo==="faceVertices"){for(s=0,h=Kt.length;s<h;s++){Tt=Bt.value[Kt[s]];x=Tt[0];_=Tt[1];b=Tt[2];Bt.array[wt]=x.x;Bt.array[wt+1]=x.y;Bt.array[wt+2]=x.z;Bt.array[wt+3]=x.w;Bt.array[wt+4]=_.x;Bt.array[wt+5]=_.y;Bt.array[wt+6]=_.z;Bt.array[wt+7]=_.w;Bt.array[wt+8]=b.x;Bt.array[wt+9]=b.y;Bt.array[wt+10]=b.z;Bt.array[wt+11]=b.w;wt+=12}}}rt.bindBuffer(rt.ARRAY_BUFFER,Bt.buffer);rt.bufferData(rt.ARRAY_BUFFER,Bt.array,r)}}if(n){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}function qt(e){var t=e.attributes;var r=e.attributesKeys;for(var i=0,n=r.length;i<n;i++){var a=r[i];var o=t[a];if(o.buffer===undefined){o.buffer=rt.createBuffer();o.needsUpdate=true}if(o.needsUpdate===true){var s=a==="index"?rt.ELEMENT_ARRAY_BUFFER:rt.ARRAY_BUFFER;rt.bindBuffer(s,o.buffer);rt.bufferData(s,o.array,rt.STATIC_DRAW);o.needsUpdate=false}}}this.renderBufferImmediate=function(e,t,r){Zt();if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=rt.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=rt.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=rt.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=rt.createBuffer();if(e.hasPositions){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglVertexBuffer);rt.bufferData(rt.ARRAY_BUFFER,e.positionArray,rt.DYNAMIC_DRAW);Qt(t.attributes.position);rt.vertexAttribPointer(t.attributes.position,3,rt.FLOAT,false,0,0)}if(e.hasNormals){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglNormalBuffer);if(r.shading===i.FlatShading){var n,a,o,s,h,l,u,f,c,d,p,m,v,g,y=e.count*3;for(g=0;g<y;g+=9){v=e.normalArray;s=v[g];u=v[g+1];d=v[g+2];h=v[g+3];f=v[g+4];p=v[g+5];l=v[g+6];c=v[g+7];m=v[g+8];n=(s+h+l)/3;a=(u+f+c)/3;o=(d+p+m)/3;v[g]=n;v[g+1]=a;v[g+2]=o;v[g+3]=n;v[g+4]=a;v[g+5]=o;v[g+6]=n;v[g+7]=a;v[g+8]=o}}rt.bufferData(rt.ARRAY_BUFFER,e.normalArray,rt.DYNAMIC_DRAW);Qt(t.attributes.normal);rt.vertexAttribPointer(t.attributes.normal,3,rt.FLOAT,false,0,0)}if(e.hasUvs&&r.map){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglUvBuffer);rt.bufferData(rt.ARRAY_BUFFER,e.uvArray,rt.DYNAMIC_DRAW);Qt(t.attributes.uv);rt.vertexAttribPointer(t.attributes.uv,2,rt.FLOAT,false,0,0)}if(e.hasColors&&r.vertexColors!==i.NoColors){rt.bindBuffer(rt.ARRAY_BUFFER,e.__webglColorBuffer);rt.bufferData(rt.ARRAY_BUFFER,e.colorArray,rt.DYNAMIC_DRAW);Qt(t.attributes.color);rt.vertexAttribPointer(t.attributes.color,3,rt.FLOAT,false,0,0)}Jt();rt.drawArrays(rt.TRIANGLES,0,e.count);e.count=0};function Kt(e,t,r,i){var n=r.attributes;var a=t.attributes;var o=t.attributesKeys;for(var s=0,h=o.length;s<h;s++){var l=o[s];var u=a[l];if(u>=0){var f=n[l];if(f!==undefined){var c=f.itemSize;rt.bindBuffer(rt.ARRAY_BUFFER,f.buffer);Qt(u);rt.vertexAttribPointer(u,c,rt.FLOAT,false,0,i*c*4)}else if(e.defaultAttributeValues!==undefined){if(e.defaultAttributeValues[l].length===2){rt.vertexAttrib2fv(u,e.defaultAttributeValues[l])}else if(e.defaultAttributeValues[l].length===3){rt.vertexAttrib3fv(u,e.defaultAttributeValues[l])}}}}Jt()}this.renderBufferDirect=function(e,t,r,n,a,o){if(n.visible===false)return;var s=br(e,t,r,n,o);var h=false,l=n.wireframe?1:0,u=a.id*16777215+s.id*2+l;if(u!==E){E=u;h=true}if(h){Zt()}if(o instanceof i.Mesh){var f=n.wireframe===true?rt.LINES:rt.TRIANGLES;var c=a.attributes.index;if(c){var d,p;if(c.array instanceof Uint32Array&&at.get("OES_element_index_uint")){d=rt.UNSIGNED_INT;p=4}else{d=rt.UNSIGNED_SHORT;p=2}var m=a.offsets;if(m.length===0){if(h){Kt(n,s,a,0);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,c.array.length,d,0);b.info.render.calls++;b.info.render.vertices+=c.array.length;b.info.render.faces+=c.array.length/3}else{h=true;for(var v=0,g=m.length;v<g;v++){var y=m[v].index;if(h){Kt(n,s,a,y);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,m[v].count,d,m[v].start*p);b.info.render.calls++;b.info.render.vertices+=m[v].count;b.info.render.faces+=m[v].count/3}}}else{if(h){Kt(n,s,a,0)}var x=a.attributes["position"];rt.drawArrays(f,0,x.array.length/3);b.info.render.calls++;b.info.render.vertices+=x.array.length/3;b.info.render.faces+=x.array.length/9}}else if(o instanceof i.PointCloud){var f=rt.POINTS;var c=a.attributes.index;if(c){var d,p;if(c.array instanceof Uint32Array&&at.get("OES_element_index_uint")){d=rt.UNSIGNED_INT;p=4}else{d=rt.UNSIGNED_SHORT;p=2}var m=a.offsets;if(m.length===0){if(h){Kt(n,s,a,0);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,c.array.length,d,0);b.info.render.calls++;b.info.render.points+=c.array.length}else{if(m.length>1)h=true;for(var v=0,g=m.length;v<g;v++){var y=m[v].index;if(h){Kt(n,s,a,y);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,m[v].count,d,m[v].start*p);b.info.render.calls++;b.info.render.points+=m[v].count}}}else{if(h){Kt(n,s,a,0)}var x=a.attributes.position;rt.drawArrays(f,0,x.array.length/3);b.info.render.calls++;b.info.render.points+=x.array.length/3}}else if(o instanceof i.Line){var f=o.mode===i.LineStrip?rt.LINE_STRIP:rt.LINES;Or(n.linewidth);var c=a.attributes.index;if(c){var d,p;if(c.array instanceof Uint32Array){d=rt.UNSIGNED_INT;p=4}else{d=rt.UNSIGNED_SHORT;p=2}var m=a.offsets;if(m.length===0){if(h){Kt(n,s,a,0);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,c.array.length,d,0);b.info.render.calls++;b.info.render.vertices+=c.array.length}else{if(m.length>1)h=true;for(var v=0,g=m.length;v<g;v++){var y=m[v].index;if(h){Kt(n,s,a,y);rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,c.buffer)}rt.drawElements(f,m[v].count,d,m[v].start*p);b.info.render.calls++;b.info.render.vertices+=m[v].count}}}else{if(h){Kt(n,s,a,0)}var x=a.attributes.position;rt.drawArrays(f,0,x.array.length/3);b.info.render.calls++;b.info.render.points+=x.array.length/3}}};this.renderBuffer=function(e,t,r,n,a,o){if(n.visible===false)return;var s=br(e,t,r,n,o);var h=s.attributes;var l=false,u=n.wireframe?1:0,f=a.id*16777215+s.id*2+u;if(f!==E){E=f;l=true}if(l){Zt()}if(!n.morphTargets&&h.position>=0){if(l){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglVertexBuffer);Qt(h.position);rt.vertexAttribPointer(h.position,3,rt.FLOAT,false,0,0)}}else{if(o.morphTargetBase){$t(n,a,o)}}if(l){if(a.__webglCustomAttributesList){for(var c=0,d=a.__webglCustomAttributesList.length;c<d;c++){var p=a.__webglCustomAttributesList[c];if(h[p.buffer.belongsToAttribute]>=0){rt.bindBuffer(rt.ARRAY_BUFFER,p.buffer);Qt(h[p.buffer.belongsToAttribute]);rt.vertexAttribPointer(h[p.buffer.belongsToAttribute],p.size,rt.FLOAT,false,0,0)}}}if(h.color>=0){if(o.geometry.colors.length>0||o.geometry.faces.length>0){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglColorBuffer);Qt(h.color);rt.vertexAttribPointer(h.color,3,rt.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){rt.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)}}if(h.normal>=0){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglNormalBuffer);Qt(h.normal);rt.vertexAttribPointer(h.normal,3,rt.FLOAT,false,0,0)}if(h.tangent>=0){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglTangentBuffer);Qt(h.tangent);rt.vertexAttribPointer(h.tangent,4,rt.FLOAT,false,0,0)}if(h.uv>=0){if(o.geometry.faceVertexUvs[0]){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglUVBuffer);Qt(h.uv);rt.vertexAttribPointer(h.uv,2,rt.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){rt.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)}}if(h.uv2>=0){if(o.geometry.faceVertexUvs[1]){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglUV2Buffer);Qt(h.uv2);rt.vertexAttribPointer(h.uv2,2,rt.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){rt.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)}}if(n.skinning&&h.skinIndex>=0&&h.skinWeight>=0){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglSkinIndicesBuffer);Qt(h.skinIndex);rt.vertexAttribPointer(h.skinIndex,4,rt.FLOAT,false,0,0);rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglSkinWeightsBuffer);Qt(h.skinWeight);
rt.vertexAttribPointer(h.skinWeight,4,rt.FLOAT,false,0,0)}if(h.lineDistance>=0){rt.bindBuffer(rt.ARRAY_BUFFER,a.__webglLineDistanceBuffer);Qt(h.lineDistance);rt.vertexAttribPointer(h.lineDistance,1,rt.FLOAT,false,0,0)}}Jt();if(o instanceof i.Mesh){var m=a.__typeArray===Uint32Array?rt.UNSIGNED_INT:rt.UNSIGNED_SHORT;if(n.wireframe){Or(n.wireframeLinewidth);if(l)rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer);rt.drawElements(rt.LINES,a.__webglLineCount,m,0)}else{if(l)rt.bindBuffer(rt.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer);rt.drawElements(rt.TRIANGLES,a.__webglFaceCount,m,0)}b.info.render.calls++;b.info.render.vertices+=a.__webglFaceCount;b.info.render.faces+=a.__webglFaceCount/3}else if(o instanceof i.Line){var v=o.mode===i.LineStrip?rt.LINE_STRIP:rt.LINES;Or(n.linewidth);rt.drawArrays(v,0,a.__webglLineCount);b.info.render.calls++}else if(o instanceof i.PointCloud){rt.drawArrays(rt.POINTS,0,a.__webglParticleCount);b.info.render.calls++;b.info.render.points+=a.__webglParticleCount}};function Zt(){for(var e=0,t=Y.length;e<t;e++){Y[e]=0}}function Qt(e){Y[e]=1;if(q[e]===0){rt.enableVertexAttribArray(e);q[e]=1}}function Jt(){for(var e=0,t=q.length;e<t;e++){if(q[e]!==Y[e]){rt.disableVertexAttribArray(e);q[e]=0}}}function $t(e,t,r){var i=e.program.attributes;if(r.morphTargetBase!==-1&&i.position>=0){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]);Qt(i.position);rt.vertexAttribPointer(i.position,3,rt.FLOAT,false,0,0)}else if(i.position>=0){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglVertexBuffer);Qt(i.position);rt.vertexAttribPointer(i.position,3,rt.FLOAT,false,0,0)}if(r.morphTargetForcedOrder.length){var n=0;var a=r.morphTargetForcedOrder;var o=r.morphTargetInfluences;while(n<e.numSupportedMorphTargets&&n<a.length){if(i["morphTarget"+n]>=0){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[a[n]]);Qt(i["morphTarget"+n]);rt.vertexAttribPointer(i["morphTarget"+n],3,rt.FLOAT,false,0,0)}if(i["morphNormal"+n]>=0&&e.morphNormals){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[a[n]]);Qt(i["morphNormal"+n]);rt.vertexAttribPointer(i["morphNormal"+n],3,rt.FLOAT,false,0,0)}r.__webglMorphTargetInfluences[n]=o[a[n]];n++}}else{var s,h=[];var o=r.morphTargetInfluences;var l,u=o.length;for(l=0;l<u;l++){s=o[l];if(s>0){h.push([s,l])}}if(h.length>e.numSupportedMorphTargets){h.sort(rr);h.length=e.numSupportedMorphTargets}else if(h.length>e.numSupportedMorphNormals){h.sort(rr)}else if(h.length===0){h.push([0,0])}var f,n=0;while(n<e.numSupportedMorphTargets){if(h[n]){f=h[n][1];if(i["morphTarget"+n]>=0){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[f]);Qt(i["morphTarget"+n]);rt.vertexAttribPointer(i["morphTarget"+n],3,rt.FLOAT,false,0,0)}if(i["morphNormal"+n]>=0&&e.morphNormals){rt.bindBuffer(rt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[f]);Qt(i["morphNormal"+n]);rt.vertexAttribPointer(i["morphNormal"+n],3,rt.FLOAT,false,0,0)}r.__webglMorphTargetInfluences[n]=o[f]}else{r.__webglMorphTargetInfluences[n]=0}n++}}if(e.program.uniforms.morphTargetInfluences!==null){rt.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}}function er(e,t){if(e.material.id!==t.material.id){return t.material.id-e.material.id}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function tr(e,t){if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function rr(e,t){return t[0]-e[0]}this.render=function(e,t,r,n){if(t instanceof i.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var a=e.fog;E=-1;S=-1;A=null;et=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();e.traverse(function(e){if(e instanceof i.SkinnedMesh){e.skeleton.update()}});t.matrixWorldInverse.getInverse(t.matrixWorld);Z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);K.setFromMatrix(Z);p.length=0;g.length=0;y.length=0;x.length=0;_.length=0;ir(e,e);if(b.sortObjects===true){g.sort(er);y.sort(tr)}Mt.render(e,t);b.info.render.calls=0;b.info.render.vertices=0;b.info.render.faces=0;b.info.render.points=0;this.setRenderTarget(r);if(this.autoClear||n){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var o=0,s=v.length;o<s;o++){var h=v[o];var l=h.object;if(l.visible){kr(l,t);or(h)}}if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);this.setDepthTest(u.depthTest);this.setDepthWrite(u.depthWrite);zr(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits);nr(g,t,p,a,true,u);nr(y,t,p,a,true,u);ar(v,"",t,p,a,false,u)}else{var u=null;this.setBlending(i.NoBlending);nr(g,t,p,a,false,u);ar(v,"opaque",t,p,a,false,u);nr(y,t,p,a,true,u);ar(v,"transparent",t,p,a,true,u)}Tt.render(e,t);St.render(e,t,W,X);if(r&&r.generateMipmaps&&r.minFilter!==i.NearestFilter&&r.minFilter!==i.LinearFilter){Yr(r)}this.setDepthTest(true);this.setDepthWrite(true)};function ir(e,t){if(t.visible===false)return;if(t instanceof i.Scene||t instanceof i.Group){}else{hr(t,e);if(t instanceof i.Light){p.push(t)}else if(t instanceof i.Sprite){x.push(t)}else if(t instanceof i.LensFlare){_.push(t)}else{var r=m[t.id];if(r&&(t.frustumCulled===false||K.intersectsObject(t)===true)){mr(t,e);for(var n=0,a=r.length;n<a;n++){var o=r[n];sr(o);o.render=true;if(b.sortObjects===true){if(t.renderDepth!==null){o.z=t.renderDepth}else{J.setFromMatrixPosition(t.matrixWorld);J.applyProjection(Z);o.z=J.z}}}}}}for(var n=0,a=t.children.length;n<a;n++){ir(e,t.children[n])}}function nr(e,t,r,n,a,o){var s;for(var h=e.length-1;h!==-1;h--){var l=e[h];var u=l.object;var f=l.buffer;kr(u,t);if(o){s=o}else{s=l.material;if(!s)continue;if(a)b.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst);b.setDepthTest(s.depthTest);b.setDepthWrite(s.depthWrite);zr(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}b.setMaterialFaces(s);if(f instanceof i.BufferGeometry){b.renderBufferDirect(t,r,n,s,f,u)}else{b.renderBuffer(t,r,n,s,f,u)}}}function ar(e,t,r,i,n,a,o){var s;for(var h=0,l=e.length;h<l;h++){var u=e[h];var f=u.object;if(f.visible){if(o){s=o}else{s=u[t];if(!s)continue;if(a)b.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst);b.setDepthTest(s.depthTest);b.setDepthWrite(s.depthWrite);zr(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}b.renderImmediateObject(r,i,n,s,f)}}}this.renderImmediateObject=function(e,t,r,i,n){var a=br(e,t,r,i,n);E=-1;b.setMaterialFaces(i);if(n.immediateRenderCallback){n.immediateRenderCallback(a,rt,K)}else{n.render(function(e){b.renderBufferImmediate(e,a,i)})}};function or(e){var t=e.object,r=t.material;if(r.transparent){e.transparent=r;e.opaque=null}else{e.opaque=r;e.transparent=null}}function sr(e){var t=e.object;var r=e.buffer;var n=t.geometry;var a=t.material;if(a instanceof i.MeshFaceMaterial){var o=n instanceof i.BufferGeometry?0:r.materialIndex;a=a.materials[o];e.material=a;if(a.transparent){y.push(e)}else{g.push(e)}}else if(a){e.material=a;if(a.transparent){y.push(e)}else{g.push(e)}}}function hr(e,t){if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new i.Matrix4;e._normalMatrix=new i.Matrix3;e.addEventListener("removed",Lt)}var r=e.geometry;if(r===undefined){}else if(r.__webglInit===undefined){r.__webglInit=true;r.addEventListener("dispose",Rt);if(r instanceof i.BufferGeometry){}else if(e instanceof i.Mesh){cr(t,e,r)}else if(e instanceof i.Line){if(r.__webglVertexBuffer===undefined){At(r);It(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true;r.lineDistancesNeedUpdate=true}}else if(e instanceof i.PointCloud){if(r.__webglVertexBuffer===undefined){Et(r);zt(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){e.__webglActive=true;if(e instanceof i.Mesh){if(r instanceof i.BufferGeometry){dr(m,r,e)}else if(r instanceof i.Geometry){var n=lr[r.id];for(var a=0,o=n.length;a<o;a++){dr(m,n[a],e)}}}else if(e instanceof i.Line||e instanceof i.PointCloud){dr(m,r,e)}else if(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback){pr(v,e)}}}var lr={};var ur=0;function fr(e,t){var r=at.get("OES_element_index_uint")?4294967296:65535;var i,n={};var a=e.morphTargets.length;var o=e.morphNormals.length;var s;var h={};var l=[];for(var u=0,f=e.faces.length;u<f;u++){var c=e.faces[u];var d=t?c.materialIndex:0;if(!(d in n)){n[d]={hash:d,counter:0}}i=n[d].hash+"_"+n[d].counter;if(!(i in h)){s={id:ur++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:a,numMorphNormals:o};h[i]=s;l.push(s)}if(h[i].vertices+3>r){n[d].counter+=1;i=n[d].hash+"_"+n[d].counter;if(!(i in h)){s={id:ur++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:a,numMorphNormals:o};h[i]=s;l.push(s)}}h[i].faces3.push(u);h[i].vertices+=3}return l}function cr(e,t,r){var n=t.material,a=false;if(lr[r.id]===undefined||r.groupsNeedUpdate===true){delete m[t.id];lr[r.id]=fr(r,n instanceof i.MeshFaceMaterial);r.groupsNeedUpdate=false}var o=lr[r.id];for(var s=0,h=o.length;s<h;s++){var l=o[s];if(l.__webglVertexBuffer===undefined){Ct(l);jt(l,t);r.verticesNeedUpdate=true;r.morphTargetsNeedUpdate=true;r.elementsNeedUpdate=true;r.uvsNeedUpdate=true;r.normalsNeedUpdate=true;r.tangentsNeedUpdate=true;r.colorsNeedUpdate=true;a=true}else{a=false}if(a||t.__webglActive===undefined){dr(m,l,t)}}t.__webglActive=true}function dr(e,t,r){var i=r.id;e[i]=e[i]||[];e[i].push({id:i,buffer:t,object:r,material:null,z:0})}function pr(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function mr(e,t){var r=e.geometry,n,a;if(r instanceof i.BufferGeometry){qt(r)}else if(e instanceof i.Mesh){if(r.groupsNeedUpdate===true){cr(t,e,r)}var o=lr[r.id];for(var s=0,h=o.length;s<h;s++){var l=o[s];a=Gt(e,l);if(r.groupsNeedUpdate===true){jt(l,e)}n=a.attributes&&vr(a);if(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||n){Yt(l,e,rt.DYNAMIC_DRAW,!r.dynamic,a)}}r.verticesNeedUpdate=false;r.morphTargetsNeedUpdate=false;r.elementsNeedUpdate=false;r.uvsNeedUpdate=false;r.normalsNeedUpdate=false;r.colorsNeedUpdate=false;r.tangentsNeedUpdate=false;a.attributes&&gr(a)}else if(e instanceof i.Line){a=Gt(e,r);n=a.attributes&&vr(a);if(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||n){Xt(r,rt.DYNAMIC_DRAW)}r.verticesNeedUpdate=false;r.colorsNeedUpdate=false;r.lineDistancesNeedUpdate=false;a.attributes&&gr(a)}else if(e instanceof i.PointCloud){a=Gt(e,r);n=a.attributes&&vr(a);if(r.verticesNeedUpdate||r.colorsNeedUpdate||e.sortParticles||n){Wt(r,rt.DYNAMIC_DRAW,e)}r.verticesNeedUpdate=false;r.colorsNeedUpdate=false;a.attributes&&gr(a)}}function vr(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function gr(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function yr(e){if(e instanceof i.Mesh||e instanceof i.PointCloud||e instanceof i.Line){delete m[e.id]}else if(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback){xr(v,e)}delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive}function xr(e,t){for(var r=e.length-1;r>=0;r--){if(e[r].object===t){e.splice(r,1)}}}function _r(e,t,r,a){e.addEventListener("dispose",Ft);var o;if(e instanceof i.MeshDepthMaterial){o="depth"}else if(e instanceof i.MeshNormalMaterial){o="normal"}else if(e instanceof i.MeshBasicMaterial){o="basic"}else if(e instanceof i.MeshLambertMaterial){o="lambert"}else if(e instanceof i.MeshPhongMaterial){o="phong"}else if(e instanceof i.LineBasicMaterial){o="basic"}else if(e instanceof i.LineDashedMaterial){o="dashed"}else if(e instanceof i.PointCloudMaterial){o="particle_basic"}if(o){var s=i.ShaderLib[o];e.__webglShader={uniforms:i.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else{e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}var h=Qr(t);var l=Jr(t);var u=Zr(a);var c={precision:n,supportsVertexTextures:ct,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof i.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:f,skinning:e.skinning,maxBones:u,useVertexTexture:dt&&a&&a.skeleton&&a.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:b.maxMorphTargets,maxMorphNormals:b.maxMorphNormals,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,maxShadows:l,shadowMapEnabled:b.shadowMapEnabled&&a.receiveShadow&&l>0,shadowMapType:b.shadowMapType,shadowMapDebug:b.shadowMapDebug,shadowMapCascade:b.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===i.DoubleSide,flipSided:e.side===i.BackSide};var d=[];if(o){d.push(o)}else{d.push(e.fragmentShader);d.push(e.vertexShader)}if(e.defines!==undefined){for(var p in e.defines){d.push(p);d.push(e.defines[p])}}for(var p in c){d.push(p);d.push(c[p])}var m=d.join();var v;for(var g=0,y=w.length;g<y;g++){var x=w[g];if(x.code===m){v=x;v.usedTimes++;break}}if(v===undefined){v=new i.WebGLProgram(b,m,e,c);w.push(v);b.info.memory.programs=w.length}e.program=v;var _=v.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var M,T="morphTarget";for(var S=0;S<b.maxMorphTargets;S++){M=T+S;if(_[M]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var M,T="morphNormal";for(S=0;S<b.maxMorphNormals;S++){M=T+S;if(_[M]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(var E in e.__webglShader.uniforms){var A=e.program.uniforms[E];if(A){e.uniformsList.push([e.__webglShader.uniforms[E],A])}}}function br(e,t,r,n,a){C=0;if(n.needsUpdate){if(n.program)Nt(n);_r(n,t,r,a);n.needsUpdate=false}if(n.morphTargets){if(!a.__webglMorphTargetInfluences){a.__webglMorphTargetInfluences=new Float32Array(b.maxMorphTargets)}}var o=false;var s=false;var h=false;var l=n.program,u=l.uniforms,c=n.__webglShader.uniforms;if(l.id!==M){rt.useProgram(l.program);M=l.id;o=true;s=true;h=true}if(n.id!==S){if(S===-1)h=true;S=n.id;s=true}if(o||e!==A){rt.uniformMatrix4fv(u.projectionMatrix,false,e.projectionMatrix.elements);if(f){rt.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==A)A=e;if(n instanceof i.ShaderMaterial||n instanceof i.MeshPhongMaterial||n.envMap){if(u.cameraPosition!==null){J.setFromMatrixPosition(e.matrixWorld);rt.uniform3f(u.cameraPosition,J.x,J.y,J.z)}}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshBasicMaterial||n instanceof i.ShaderMaterial||n.skinning){if(u.viewMatrix!==null){rt.uniformMatrix4fv(u.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(n.skinning){if(a.bindMatrix&&u.bindMatrix!==null){rt.uniformMatrix4fv(u.bindMatrix,false,a.bindMatrix.elements)}if(a.bindMatrixInverse&&u.bindMatrixInverse!==null){rt.uniformMatrix4fv(u.bindMatrixInverse,false,a.bindMatrixInverse.elements)}if(dt&&a.skeleton&&a.skeleton.useVertexTexture){if(u.boneTexture!==null){var d=Fr();rt.uniform1i(u.boneTexture,d);b.setTexture(a.skeleton.boneTexture,d)}if(u.boneTextureWidth!==null){rt.uniform1i(u.boneTextureWidth,a.skeleton.boneTextureWidth)}if(u.boneTextureHeight!==null){rt.uniform1i(u.boneTextureHeight,a.skeleton.boneTextureHeight)}}else if(a.skeleton&&a.skeleton.boneMatrices){if(u.boneGlobalMatrices!==null){rt.uniformMatrix4fv(u.boneGlobalMatrices,false,a.skeleton.boneMatrices)}}}if(s){if(r&&n.fog){Er(c,r)}if(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n.lights){if(et){h=true;Nr(t);et=false}if(h){Lr(c,tt);Rr(c,true)}else{Rr(c,false)}}if(n instanceof i.MeshBasicMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshPhongMaterial){wr(c,n)}if(n instanceof i.LineBasicMaterial){Mr(c,n)}else if(n instanceof i.LineDashedMaterial){Mr(c,n);Tr(c,n)}else if(n instanceof i.PointCloudMaterial){Sr(c,n)}else if(n instanceof i.MeshPhongMaterial){Ar(c,n)}else if(n instanceof i.MeshLambertMaterial){Cr(c,n)}else if(n instanceof i.MeshDepthMaterial){c.mNear.value=e.near;c.mFar.value=e.far;c.opacity.value=n.opacity}else if(n instanceof i.MeshNormalMaterial){c.opacity.value=n.opacity}if(a.receiveShadow&&!n._shadowPass){Pr(c,t)}Ur(n.uniformsList)}Dr(u,a);if(u.modelMatrix!==null){rt.uniformMatrix4fv(u.modelMatrix,false,a.matrixWorld.elements)}return l}function wr(e,t){e.opacity.value=t.opacity;if(b.gammaInput){e.diffuse.value.copyGammaToLinear(t.color)}else{e.diffuse.value=t.color}e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var r;if(t.map){r=t.map}else if(t.specularMap){r=t.specularMap}else if(t.normalMap){r=t.normalMap}else if(t.bumpMap){r=t.bumpMap}else if(t.alphaMap){r=t.alphaMap}if(r!==undefined){var n=r.offset;var a=r.repeat;e.offsetRepeat.value.set(n.x,n.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1;if(b.gammaInput){e.reflectivity.value=t.reflectivity}else{e.reflectivity.value=t.reflectivity}e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&(t.envMap.mapping===i.CubeRefractionMapping||t.envMap.mapping===i.EquirectangularRefractionMapping)}function Mr(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function Tr(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Sr(e,r){e.psColor.value=r.color;e.opacity.value=r.opacity;e.size.value=r.size;e.scale.value=t.height/2;e.map.value=r.map}function Er(e,t){e.fogColor.value=t.color;if(t instanceof i.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof i.FogExp2){e.fogDensity.value=t.density}}function Ar(e,t){e.shininess.value=t.shininess;if(b.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Cr(e,t){if(b.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Lr(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function Rr(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function Pr(e,t){if(e.shadowMatrix){var r=0;for(var n=0,a=t.length;n<a;n++){var o=t[n];if(!o.castShadow)continue;if(o instanceof i.SpotLight||o instanceof i.DirectionalLight&&!o.shadowCascade){e.shadowMap.value[r]=o.shadowMap;e.shadowMapSize.value[r]=o.shadowMapSize;e.shadowMatrix.value[r]=o.shadowMatrix;e.shadowDarkness.value[r]=o.shadowDarkness;e.shadowBias.value[r]=o.shadowBias;r++}}}}function Dr(e,t){rt.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){rt.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function Fr(){var e=C;if(e>=ht){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ht)}C+=1;return e}function Ur(e){var t,r,n;for(var a=0,o=e.length;a<o;a++){var s=e[a][0];if(s.needsUpdate===false)continue;var h=s.type;var l=s.value;var u=e[a][1];switch(h){case"1i":rt.uniform1i(u,l);break;case"1f":rt.uniform1f(u,l);break;case"2f":rt.uniform2f(u,l[0],l[1]);break;case"3f":rt.uniform3f(u,l[0],l[1],l[2]);break;case"4f":rt.uniform4f(u,l[0],l[1],l[2],l[3]);break;case"1iv":rt.uniform1iv(u,l);break;case"3iv":rt.uniform3iv(u,l);break;case"1fv":rt.uniform1fv(u,l);break;case"2fv":rt.uniform2fv(u,l);break;case"3fv":rt.uniform3fv(u,l);break;case"4fv":rt.uniform4fv(u,l);break;case"Matrix3fv":rt.uniformMatrix3fv(u,false,l);break;case"Matrix4fv":rt.uniformMatrix4fv(u,false,l);break;case"i":rt.uniform1i(u,l);break;case"f":rt.uniform1f(u,l);break;case"v2":rt.uniform2f(u,l.x,l.y);break;case"v3":rt.uniform3f(u,l.x,l.y,l.z);break;case"v4":rt.uniform4f(u,l.x,l.y,l.z,l.w);break;case"c":rt.uniform3f(u,l.r,l.g,l.b);break;case"iv1":rt.uniform1iv(u,l);break;case"iv":rt.uniform3iv(u,l);break;case"fv1":rt.uniform1fv(u,l);break;case"fv":rt.uniform3fv(u,l);break;case"v2v":if(s._array===undefined){s._array=new Float32Array(2*l.length)}for(var f=0,c=l.length;f<c;f++){n=f*2;s._array[n]=l[f].x;s._array[n+1]=l[f].y}rt.uniform2fv(u,s._array);break;case"v3v":if(s._array===undefined){s._array=new Float32Array(3*l.length)}for(var f=0,c=l.length;f<c;f++){n=f*3;s._array[n]=l[f].x;s._array[n+1]=l[f].y;s._array[n+2]=l[f].z}rt.uniform3fv(u,s._array);break;case"v4v":if(s._array===undefined){s._array=new Float32Array(4*l.length)}for(var f=0,c=l.length;f<c;f++){n=f*4;s._array[n]=l[f].x;s._array[n+1]=l[f].y;s._array[n+2]=l[f].z;s._array[n+3]=l[f].w}rt.uniform4fv(u,s._array);break;case"m3":rt.uniformMatrix3fv(u,false,l.elements);break;case"m3v":if(s._array===undefined){s._array=new Float32Array(9*l.length)}for(var f=0,c=l.length;f<c;f++){l[f].flattenToArrayOffset(s._array,f*9)}rt.uniformMatrix3fv(u,false,s._array);break;case"m4":rt.uniformMatrix4fv(u,false,l.elements);break;case"m4v":if(s._array===undefined){s._array=new Float32Array(16*l.length)}for(var f=0,c=l.length;f<c;f++){l[f].flattenToArrayOffset(s._array,f*16)}rt.uniformMatrix4fv(u,false,s._array);break;case"t":t=l;r=Fr();rt.uniform1i(u,r);if(!t)continue;if(t instanceof i.CubeTexture||t.image instanceof Array&&t.image.length===6){Gr(t,r)}else if(t instanceof i.WebGLRenderTargetCube){Hr(t,r)}else{b.setTexture(t,r)}break;case"tv":if(s._array===undefined){s._array=[]}for(var f=0,c=s.value.length;f<c;f++){s._array[f]=Fr()}rt.uniform1iv(u,s._array);for(var f=0,c=s.value.length;f<c;f++){t=s.value[f];r=s._array[f];if(!t)continue;b.setTexture(t,r)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}}function kr(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Br(e,t,r,i){e[t]=r.r*r.r*i;e[t+1]=r.g*r.g*i;e[t+2]=r.b*r.b*i}function Vr(e,t,r,i){e[t]=r.r*i;e[t+1]=r.g*i;e[t+2]=r.b*i}function Nr(e){var t,r,n,a,o=0,s=0,h=0,l,u,f,c,d,p,m,v=tt,g=v.directional.colors,y=v.directional.positions,x=v.point.colors,_=v.point.positions,w=v.point.distances,M=v.spot.colors,T=v.spot.positions,S=v.spot.distances,E=v.spot.directions,A=v.spot.anglesCos,C=v.spot.exponents,L=v.hemi.skyColors,R=v.hemi.groundColors,P=v.hemi.positions,D=0,F=0,U=0,k=0,B=0,V=0,N=0,O=0,z=0,I=0,j=0,G=0;for(t=0,r=e.length;t<r;t++){n=e[t];if(n.onlyShadow)continue;l=n.color;c=n.intensity;m=n.distance;if(n instanceof i.AmbientLight){if(!n.visible)continue;if(b.gammaInput){o+=l.r*l.r;s+=l.g*l.g;h+=l.b*l.b}else{o+=l.r;s+=l.g;h+=l.b}}else if(n instanceof i.DirectionalLight){B+=1;if(!n.visible)continue;$.setFromMatrixPosition(n.matrixWorld);J.setFromMatrixPosition(n.target.matrixWorld);$.sub(J);$.normalize();z=D*3;y[z]=$.x;y[z+1]=$.y;y[z+2]=$.z;if(b.gammaInput){Br(g,z,l,c*c)}else{Vr(g,z,l,c)}D+=1}else if(n instanceof i.PointLight){V+=1;if(!n.visible)continue;I=F*3;if(b.gammaInput){Br(x,I,l,c*c)}else{Vr(x,I,l,c)}J.setFromMatrixPosition(n.matrixWorld);_[I]=J.x;_[I+1]=J.y;_[I+2]=J.z;w[F]=m;F+=1}else if(n instanceof i.SpotLight){N+=1;if(!n.visible)continue;j=U*3;if(b.gammaInput){Br(M,j,l,c*c)}else{Vr(M,j,l,c)}$.setFromMatrixPosition(n.matrixWorld);T[j]=$.x;T[j+1]=$.y;T[j+2]=$.z;S[U]=m;J.setFromMatrixPosition(n.target.matrixWorld);$.sub(J);$.normalize();E[j]=$.x;E[j+1]=$.y;E[j+2]=$.z;A[U]=Math.cos(n.angle);C[U]=n.exponent;U+=1}else if(n instanceof i.HemisphereLight){O+=1;if(!n.visible)continue;$.setFromMatrixPosition(n.matrixWorld);$.normalize();G=k*3;P[G]=$.x;P[G+1]=$.y;P[G+2]=$.z;u=n.color;f=n.groundColor;if(b.gammaInput){d=c*c;Br(L,G,u,d);Br(R,G,f,d)}else{Vr(L,G,u,c);Vr(R,G,f,c)}k+=1}}for(t=D*3,r=Math.max(g.length,B*3);t<r;t++)g[t]=0;for(t=F*3,r=Math.max(x.length,V*3);t<r;t++)x[t]=0;for(t=U*3,r=Math.max(M.length,N*3);t<r;t++)M[t]=0;for(t=k*3,r=Math.max(L.length,O*3);t<r;t++)L[t]=0;for(t=k*3,r=Math.max(R.length,O*3);t<r;t++)R[t]=0;v.directional.length=D;v.point.length=F;v.spot.length=U;v.hemi.length=k;v.ambient[0]=o;v.ambient[1]=s;v.ambient[2]=h}this.setFaceCulling=function(e,t){if(e===i.CullFaceNone){rt.disable(rt.CULL_FACE)}else{if(t===i.FrontFaceDirectionCW){rt.frontFace(rt.CW)}else{rt.frontFace(rt.CCW)}if(e===i.CullFaceBack){rt.cullFace(rt.BACK)}else if(e===i.CullFaceFront){rt.cullFace(rt.FRONT)}else{rt.cullFace(rt.FRONT_AND_BACK)}rt.enable(rt.CULL_FACE)}};this.setMaterialFaces=function(e){var t=e.side===i.DoubleSide;var r=e.side===i.BackSide;if(L!==t){if(t){rt.disable(rt.CULL_FACE)}else{rt.enable(rt.CULL_FACE)}L=t}if(R!==r){if(r){rt.frontFace(rt.CW)}else{rt.frontFace(rt.CCW)}R=r}};this.setDepthTest=function(e){if(k!==e){if(e){rt.enable(rt.DEPTH_TEST)}else{rt.disable(rt.DEPTH_TEST)}k=e}};this.setDepthWrite=function(e){if(B!==e){rt.depthMask(e);B=e}};function Or(e){if(e!==z){rt.lineWidth(e);z=e}}function zr(e,t,r){if(V!==e){if(e){rt.enable(rt.POLYGON_OFFSET_FILL)}else{rt.disable(rt.POLYGON_OFFSET_FILL)}V=e}if(e&&(N!==t||O!==r)){rt.polygonOffset(t,r);N=t;O=r}}this.setBlending=function(e,t,r,n){if(e!==P){if(e===i.NoBlending){rt.disable(rt.BLEND)}else if(e===i.AdditiveBlending){rt.enable(rt.BLEND);rt.blendEquation(rt.FUNC_ADD);rt.blendFunc(rt.SRC_ALPHA,rt.ONE)}else if(e===i.SubtractiveBlending){rt.enable(rt.BLEND);rt.blendEquation(rt.FUNC_ADD);rt.blendFunc(rt.ZERO,rt.ONE_MINUS_SRC_COLOR)}else if(e===i.MultiplyBlending){rt.enable(rt.BLEND);rt.blendEquation(rt.FUNC_ADD);rt.blendFunc(rt.ZERO,rt.SRC_COLOR)}else if(e===i.CustomBlending){rt.enable(rt.BLEND)}else{rt.enable(rt.BLEND);rt.blendEquationSeparate(rt.FUNC_ADD,rt.FUNC_ADD);rt.blendFuncSeparate(rt.SRC_ALPHA,rt.ONE_MINUS_SRC_ALPHA,rt.ONE,rt.ONE_MINUS_SRC_ALPHA)}P=e}if(e===i.CustomBlending){if(t!==D){rt.blendEquation(Kr(t));D=t}if(r!==F||n!==U){rt.blendFunc(Kr(r),Kr(n));F=r;U=n}}else{D=null;F=null;U=null}};function Ir(e,t,r){var n;if(r){rt.texParameteri(e,rt.TEXTURE_WRAP_S,Kr(t.wrapS));rt.texParameteri(e,rt.TEXTURE_WRAP_T,Kr(t.wrapT));rt.texParameteri(e,rt.TEXTURE_MAG_FILTER,Kr(t.magFilter));rt.texParameteri(e,rt.TEXTURE_MIN_FILTER,Kr(t.minFilter))}else{rt.texParameteri(e,rt.TEXTURE_WRAP_S,rt.CLAMP_TO_EDGE);rt.texParameteri(e,rt.TEXTURE_WRAP_T,rt.CLAMP_TO_EDGE);if(t.wrapS!==i.ClampToEdgeWrapping||t.wrapT!==i.ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT is set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )")}rt.texParameteri(e,rt.TEXTURE_MAG_FILTER,qr(t.magFilter));rt.texParameteri(e,rt.TEXTURE_MIN_FILTER,qr(t.minFilter));if(t.minFilter!==i.NearestFilter&&t.minFilter!==i.LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter is set to THREE.LinearFilter or THREE.NearestFilter. ( "+t.sourceFile+" )")}}n=at.get("EXT_texture_filter_anisotropic");if(n&&t.type!==i.FloatType){if(t.anisotropy>1||t.__oldAnisotropy){rt.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,b.getMaxAnisotropy()));t.__oldAnisotropy=t.anisotropy}}}this.uploadTexture=function(e){if(e.__webglInit===undefined){e.__webglInit=true;e.addEventListener("dispose",Pt);e.__webglTexture=rt.createTexture();b.info.memory.textures++}rt.bindTexture(rt.TEXTURE_2D,e.__webglTexture);rt.pixelStorei(rt.UNPACK_FLIP_Y_WEBGL,e.flipY);rt.pixelStorei(rt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);rt.pixelStorei(rt.UNPACK_ALIGNMENT,e.unpackAlignment);e.image=jr(e.image,ut);var t=e.image,r=i.Math.isPowerOfTwo(t.width)&&i.Math.isPowerOfTwo(t.height),n=Kr(e.format),a=Kr(e.type);Ir(rt.TEXTURE_2D,e,r);var o,s=e.mipmaps;if(e instanceof i.DataTexture){if(s.length>0&&r){for(var h=0,l=s.length;h<l;h++){o=s[h];rt.texImage2D(rt.TEXTURE_2D,h,n,o.width,o.height,0,n,a,o.data)}e.generateMipmaps=false}else{rt.texImage2D(rt.TEXTURE_2D,0,n,t.width,t.height,0,n,a,t.data)}}else if(e instanceof i.CompressedTexture){for(var h=0,l=s.length;h<l;h++){o=s[h];if(e.format!==i.RGBAFormat&&e.format!==i.RGBFormat){if(_t().indexOf(n)>-1){rt.compressedTexImage2D(rt.TEXTURE_2D,h,n,o.width,o.height,0,o.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{rt.texImage2D(rt.TEXTURE_2D,h,n,o.width,o.height,0,n,a,o.data)}}}else{if(s.length>0&&r){for(var h=0,l=s.length;h<l;h++){o=s[h];rt.texImage2D(rt.TEXTURE_2D,h,n,n,a,o)}e.generateMipmaps=false}else{rt.texImage2D(rt.TEXTURE_2D,0,n,n,a,e.image)}}if(e.generateMipmaps&&r)rt.generateMipmap(rt.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()};this.setTexture=function(e,t){rt.activeTexture(rt.TEXTURE0+t);if(e.needsUpdate){b.uploadTexture(e)}else{rt.bindTexture(rt.TEXTURE_2D,e.__webglTexture)}};function jr(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height);var i=document.createElement("canvas");i.width=Math.floor(e.width*r);i.height=Math.floor(e.height*r);var n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height);console.log("THREE.WebGLRenderer:",e,"is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height+".");return i}return e}function Gr(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",Pt);e.image.__webglTextureCube=rt.createTexture();b.info.memory.textures++}rt.activeTexture(rt.TEXTURE0+t);rt.bindTexture(rt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);rt.pixelStorei(rt.UNPACK_FLIP_Y_WEBGL,e.flipY);var r=e instanceof i.CompressedTexture;var n=e.image[0]instanceof i.DataTexture;var a=[];for(var o=0;o<6;o++){if(b.autoScaleCubemaps&&!r&&!n){a[o]=jr(e.image[o],ft)}else{a[o]=n?e.image[o].image:e.image[o]}}var s=a[0],h=i.Math.isPowerOfTwo(s.width)&&i.Math.isPowerOfTwo(s.height),l=Kr(e.format),u=Kr(e.type);Ir(rt.TEXTURE_CUBE_MAP,e,h);for(var o=0;o<6;o++){if(!r){if(n){rt.texImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,a[o].width,a[o].height,0,l,u,a[o].data)}else{rt.texImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,u,a[o])}}else{var f,c=a[o].mipmaps;for(var d=0,p=c.length;d<p;d++){f=c[d];if(e.format!==i.RGBAFormat&&e.format!==i.RGBFormat){if(_t().indexOf(l)>-1){rt.compressedTexImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,f.width,f.height,0,f.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{rt.texImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,f.width,f.height,0,l,u,f.data)}}}}if(e.generateMipmaps&&h){rt.generateMipmap(rt.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{rt.activeTexture(rt.TEXTURE0+t);rt.bindTexture(rt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function Hr(e,t){rt.activeTexture(rt.TEXTURE0+t);rt.bindTexture(rt.TEXTURE_CUBE_MAP,e.__webglTexture)}function Wr(e,t,r){rt.bindFramebuffer(rt.FRAMEBUFFER,e);rt.framebufferTexture2D(rt.FRAMEBUFFER,rt.COLOR_ATTACHMENT0,r,t.__webglTexture,0)
}function Xr(e,t){rt.bindRenderbuffer(rt.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){rt.renderbufferStorage(rt.RENDERBUFFER,rt.DEPTH_COMPONENT16,t.width,t.height);rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){rt.renderbufferStorage(rt.RENDERBUFFER,rt.DEPTH_STENCIL,t.width,t.height);rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_STENCIL_ATTACHMENT,rt.RENDERBUFFER,e)}else{rt.renderbufferStorage(rt.RENDERBUFFER,rt.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&e.__webglFramebuffer===undefined){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",Dt);e.__webglTexture=rt.createTexture();b.info.memory.textures++;var r=i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height),n=Kr(e.format),a=Kr(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];rt.bindTexture(rt.TEXTURE_CUBE_MAP,e.__webglTexture);Ir(rt.TEXTURE_CUBE_MAP,e,r);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=rt.createFramebuffer();e.__webglRenderbuffer[o]=rt.createRenderbuffer();rt.texImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,e.width,e.height,0,n,a,null);Wr(e.__webglFramebuffer[o],e,rt.TEXTURE_CUBE_MAP_POSITIVE_X+o);Xr(e.__webglRenderbuffer[o],e)}if(r)rt.generateMipmap(rt.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=rt.createFramebuffer();if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=rt.createRenderbuffer()}rt.bindTexture(rt.TEXTURE_2D,e.__webglTexture);Ir(rt.TEXTURE_2D,e,r);rt.texImage2D(rt.TEXTURE_2D,0,n,e.width,e.height,0,n,a,null);Wr(e.__webglFramebuffer,e,rt.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_STENCIL_ATTACHMENT,rt.RENDERBUFFER,e.__webglRenderbuffer)}}else{Xr(e.__webglRenderbuffer,e)}if(r)rt.generateMipmap(rt.TEXTURE_2D)}if(t){rt.bindTexture(rt.TEXTURE_CUBE_MAP,null)}else{rt.bindTexture(rt.TEXTURE_2D,null)}rt.bindRenderbuffer(rt.RENDERBUFFER,null);rt.bindFramebuffer(rt.FRAMEBUFFER,null)}var s,h,l,u,f;if(e){if(t){s=e.__webglFramebuffer[e.activeCubeFace]}else{s=e.__webglFramebuffer}h=e.width;l=e.height;u=0;f=0}else{s=null;h=G;l=H;u=I;f=j}if(s!==T){rt.bindFramebuffer(rt.FRAMEBUFFER,s);rt.viewport(u,f,h,l);T=s}W=h;X=l};function Yr(e){if(e instanceof i.WebGLRenderTargetCube){rt.bindTexture(rt.TEXTURE_CUBE_MAP,e.__webglTexture);rt.generateMipmap(rt.TEXTURE_CUBE_MAP);rt.bindTexture(rt.TEXTURE_CUBE_MAP,null)}else{rt.bindTexture(rt.TEXTURE_2D,e.__webglTexture);rt.generateMipmap(rt.TEXTURE_2D);rt.bindTexture(rt.TEXTURE_2D,null)}}function qr(e){if(e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter){return rt.NEAREST}return rt.LINEAR}function Kr(e){var t;if(e===i.RepeatWrapping)return rt.REPEAT;if(e===i.ClampToEdgeWrapping)return rt.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return rt.MIRRORED_REPEAT;if(e===i.NearestFilter)return rt.NEAREST;if(e===i.NearestMipMapNearestFilter)return rt.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return rt.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return rt.LINEAR;if(e===i.LinearMipMapNearestFilter)return rt.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return rt.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return rt.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return rt.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return rt.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return rt.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return rt.BYTE;if(e===i.ShortType)return rt.SHORT;if(e===i.UnsignedShortType)return rt.UNSIGNED_SHORT;if(e===i.IntType)return rt.INT;if(e===i.UnsignedIntType)return rt.UNSIGNED_INT;if(e===i.FloatType)return rt.FLOAT;if(e===i.AlphaFormat)return rt.ALPHA;if(e===i.RGBFormat)return rt.RGB;if(e===i.RGBAFormat)return rt.RGBA;if(e===i.LuminanceFormat)return rt.LUMINANCE;if(e===i.LuminanceAlphaFormat)return rt.LUMINANCE_ALPHA;if(e===i.AddEquation)return rt.FUNC_ADD;if(e===i.SubtractEquation)return rt.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return rt.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return rt.ZERO;if(e===i.OneFactor)return rt.ONE;if(e===i.SrcColorFactor)return rt.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return rt.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return rt.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return rt.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return rt.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return rt.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return rt.DST_COLOR;if(e===i.OneMinusDstColorFactor)return rt.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return rt.SRC_ALPHA_SATURATE;t=at.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===i.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=at.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===i.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===i.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===i.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===i.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=at.get("EXT_blend_minmax");if(t!==null){if(e===i.MinEquation)return t.MIN_EXT;if(e===i.MaxEquation)return t.MAX_EXT}return 0}function Zr(e){if(dt&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var t=rt.getParameter(rt.MAX_VERTEX_UNIFORM_VECTORS);var r=Math.floor((t-20)/4);var n=r;if(e!==undefined&&e instanceof i.SkinnedMesh){n=Math.min(e.skeleton.bones.length,n);if(n<e.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")}}return n}}function Qr(e){var t=0;var r=0;var n=0;var a=0;for(var o=0,s=e.length;o<s;o++){var h=e[o];if(h.onlyShadow||h.visible===false)continue;if(h instanceof i.DirectionalLight)t++;if(h instanceof i.PointLight)r++;if(h instanceof i.SpotLight)n++;if(h instanceof i.HemisphereLight)a++}return{directional:t,point:r,spot:n,hemi:a}}function Jr(e){var t=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(!a.castShadow)continue;if(a instanceof i.SpotLight)t++;if(a instanceof i.DirectionalLight&&!a.shadowCascade)t++}return t}this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};i.WebGLRenderTarget=function(e,t,r){this.width=e;this.height=t;r=r||{};this.wrapS=r.wrapS!==undefined?r.wrapS:i.ClampToEdgeWrapping;this.wrapT=r.wrapT!==undefined?r.wrapT:i.ClampToEdgeWrapping;this.magFilter=r.magFilter!==undefined?r.magFilter:i.LinearFilter;this.minFilter=r.minFilter!==undefined?r.minFilter:i.LinearMipMapLinearFilter;this.anisotropy=r.anisotropy!==undefined?r.anisotropy:1;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.format=r.format!==undefined?r.format:i.RGBAFormat;this.type=r.type!==undefined?r.type:i.UnsignedByteType;this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:true;this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,setSize:function(e,t){this.width=e;this.height=t},clone:function(){var e=new i.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube=function(e,t,r){i.WebGLRenderTarget.call(this,e,t,r);this.activeCubeFace=0};i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube.prototype.constructor=i.WebGLRenderTargetCube;i.WebGLExtensions=function(e){var t={};this.get=function(r){if(t[r]!==undefined){return t[r]}var i;switch(r){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}if(i===null){console.log("THREE.WebGLRenderer: "+r+" extension not supported.")}t[r]=i;return i}};i.WebGLProgram=function(){var e=0;var t=function(e){var t,r,i=[];for(var n in e){t=e[n];if(t===false)continue;r="#define "+n+" "+t;i.push(r)}return i.join("\n")};var r=function(e,t,r){var i={};for(var n=0,a=r.length;n<a;n++){var o=r[n];i[o]=e.getUniformLocation(t,o)}return i};var n=function(e,t,r){var i={};for(var n=0,a=r.length;n<a;n++){var o=r[n];i[o]=e.getAttribLocation(t,o)}return i};return function(a,o,s,h){var l=a;var u=l.context;var f=s.defines;var c=s.__webglShader.uniforms;var d=s.attributes;var p=s.__webglShader.vertexShader;var m=s.__webglShader.fragmentShader;var v=s.index0AttributeName;if(v===undefined&&h.morphTargets===true){v="position"}var g="SHADOWMAP_TYPE_BASIC";if(h.shadowMapType===i.PCFShadowMap){g="SHADOWMAP_TYPE_PCF"}else if(h.shadowMapType===i.PCFSoftShadowMap){g="SHADOWMAP_TYPE_PCF_SOFT"}var y=null;if(h.envMap){switch(s.envMap.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:y="ENVMAP_TYPE_CUBE";break;case i.EquirectangularReflectionMapping:case i.EquirectangularRefractionMapping:y="ENVMAP_TYPE_EQUIREC";break;case i.SphericalReflectionMapping:y="ENVMAP_TYPE_SPHERE";break}}var x=t(f);var _=u.createProgram();var b,w;if(s instanceof i.RawShaderMaterial){b="";w=""}else{b=["precision "+h.precision+" float;","precision "+h.precision+" int;",x,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n");w=["precision "+h.precision+" float;","precision "+h.precision+" int;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",x,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",y?"#define "+y:"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var M=new i.WebGLShader(u,u.VERTEX_SHADER,b+p);var T=new i.WebGLShader(u,u.FRAGMENT_SHADER,w+m);u.attachShader(_,M);u.attachShader(_,T);if(v!==undefined){u.bindAttribLocation(_,0,v)}u.linkProgram(_);if(u.getProgramParameter(_,u.LINK_STATUS)===false){console.error("THREE.WebGLProgram: Could not initialise shader.");console.error("gl.VALIDATE_STATUS",u.getProgramParameter(_,u.VALIDATE_STATUS));console.error("gl.getError()",u.getError())}if(u.getProgramInfoLog(_)!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",u.getProgramInfoLog(_))}u.deleteShader(M);u.deleteShader(T);var S=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(h.useVertexTexture){S.push("boneTexture");S.push("boneTextureWidth");S.push("boneTextureHeight")}else{S.push("boneGlobalMatrices")}if(h.logarithmicDepthBuffer){S.push("logDepthBufFC")}for(var E in c){S.push(E)}this.uniforms=r(u,_,S);S=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var A=0;A<h.maxMorphTargets;A++){S.push("morphTarget"+A)}for(var A=0;A<h.maxMorphNormals;A++){S.push("morphNormal"+A)}for(var C in d){S.push(C)}this.attributes=n(u,_,S);this.attributesKeys=Object.keys(this.attributes);this.id=e++;this.code=o;this.usedTimes=1;this.program=_;this.vertexShader=M;this.fragmentShader=T;return this}}();i.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var r=0;r<t.length;r++){t[r]=r+1+": "+t[r]}return t.join("\n")};return function(t,r,i){var n=t.createShader(r);t.shaderSource(n,i);t.compileShader(n);if(t.getShaderParameter(n,t.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(t.getShaderInfoLog(n)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(n));console.warn(e(i))}return n}}();i.LensFlarePlugin=function(e,t){var r=e.context;var n,a;var o,s,h;var l;var u,f;var c=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);n=r.createBuffer();a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);u=r.createTexture();f=r.createTexture();r.bindTexture(r.TEXTURE_2D,u);r.texImage2D(r.TEXTURE_2D,0,r.RGB,16,16,0,r.RGB,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);r.bindTexture(r.TEXTURE_2D,f);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,16,16,0,r.RGBA,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);l=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;if(l){i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{i={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}o=d(i);s={vertex:r.getAttribLocation(o,"position"),uv:r.getAttribLocation(o,"uv")};h={renderType:r.getUniformLocation(o,"renderType"),map:r.getUniformLocation(o,"map"),occlusionMap:r.getUniformLocation(o,"occlusionMap"),opacity:r.getUniformLocation(o,"opacity"),color:r.getUniformLocation(o,"color"),scale:r.getUniformLocation(o,"scale"),rotation:r.getUniformLocation(o,"rotation"),screenPosition:r.getUniformLocation(o,"screenPosition")}};this.render=function(d,p,m,v){if(t.length===0)return;var g=new i.Vector3;var y=v/m,x=m*.5,_=v*.5;var b=16/v,w=new i.Vector2(b*y,b);var M=new i.Vector3(1,1,0),T=new i.Vector2(1,1);if(o===undefined){c()}r.useProgram(o);r.enableVertexAttribArray(s.vertex);r.enableVertexAttribArray(s.uv);r.uniform1i(h.occlusionMap,0);r.uniform1i(h.map,1);r.bindBuffer(r.ARRAY_BUFFER,n);r.vertexAttribPointer(s.vertex,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(s.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.disable(r.CULL_FACE);r.depthMask(false);for(var S=0,E=t.length;S<E;S++){b=16/v;w.set(b*y,b);var A=t[S];g.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]);g.applyMatrix4(p.matrixWorldInverse);g.applyProjection(p.projectionMatrix);M.copy(g);T.x=M.x*x+x;T.y=M.y*_+_;if(l||T.x>0&&T.x<m&&T.y>0&&T.y<v){r.activeTexture(r.TEXTURE1);r.bindTexture(r.TEXTURE_2D,u);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGB,T.x-8,T.y-8,16,16,0);r.uniform1i(h.renderType,0);r.uniform2f(h.scale,w.x,w.y);r.uniform3f(h.screenPosition,M.x,M.y,M.z);r.disable(r.BLEND);r.enable(r.DEPTH_TEST);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);r.activeTexture(r.TEXTURE0);r.bindTexture(r.TEXTURE_2D,f);r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,T.x-8,T.y-8,16,16,0);r.uniform1i(h.renderType,1);r.disable(r.DEPTH_TEST);r.activeTexture(r.TEXTURE1);r.bindTexture(r.TEXTURE_2D,u);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0);A.positionScreen.copy(M);if(A.customUpdateCallback){A.customUpdateCallback(A)}else{A.updateLensFlares()}r.uniform1i(h.renderType,2);r.enable(r.BLEND);for(var C=0,L=A.lensFlares.length;C<L;C++){var R=A.lensFlares[C];if(R.opacity>.001&&R.scale>.001){M.x=R.x;M.y=R.y;M.z=R.z;b=R.size*R.scale/v;w.x=b*y;w.y=b;r.uniform3f(h.screenPosition,M.x,M.y,M.z);r.uniform2f(h.scale,w.x,w.y);r.uniform1f(h.rotation,R.rotation);r.uniform1f(h.opacity,R.opacity);r.uniform3f(h.color,R.color.r,R.color.g,R.color.b);e.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst);e.setTexture(R.texture,1);r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}}}}r.enable(r.CULL_FACE);r.enable(r.DEPTH_TEST);r.depthMask(true);e.resetGLState()};function d(t){var i=r.createProgram();var n=r.createShader(r.FRAGMENT_SHADER);var a=r.createShader(r.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";r.shaderSource(n,o+t.fragmentShader);r.shaderSource(a,o+t.vertexShader);r.compileShader(n);r.compileShader(a);r.attachShader(i,n);r.attachShader(i,a);r.linkProgram(i);return i}};i.ShadowMapPlugin=function(e,t,r,n){var a=e.context;var o,s,h,l,u=new i.Frustum,f=new i.Matrix4,c=new i.Vector3,d=new i.Vector3,p=new i.Vector3,m=[];var v=i.ShaderLib["depthRGBA"];var g=i.UniformsUtils.clone(v.uniforms);o=new i.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader});s=new i.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true});h=new i.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,skinning:true});l=new i.ShaderMaterial({uniforms:g,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:true,skinning:true});o._shadowPass=true;s._shadowPass=true;h._shadowPass=true;l._shadowPass=true;this.render=function(r,c){if(e.shadowMapEnabled===false)return;var d,v,g,M,T,S,E,A,C,L,R,P,D,F,U=[],k=0,B=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(e.shadowMapCullFace===i.CullFaceFront){a.cullFace(a.FRONT)}else{a.cullFace(a.BACK)}e.setDepthTest(true);for(d=0,v=t.length;d<v;d++){F=t[d];if(!F.castShadow)continue;if(F instanceof i.DirectionalLight&&F.shadowCascade){for(T=0;T<F.shadowCascadeCount;T++){var V;if(!F.shadowCascadeArray[T]){V=x(F,T);V.originalCamera=c;var N=new i.Gyroscope;N.position.copy(F.shadowCascadeOffset);N.add(V);N.add(V.target);c.add(N);F.shadowCascadeArray[T]=V;console.log("Created virtualLight",V)}else{V=F.shadowCascadeArray[T]}_(F,T);U[k]=V;k++}}else{U[k]=F;k++}}for(d=0,v=U.length;d<v;d++){F=U[d];if(!F.shadowMap){var O=i.LinearFilter;if(e.shadowMapType===i.PCFSoftShadowMap){O=i.NearestFilter}var z={minFilter:O,magFilter:O,format:i.RGBAFormat};F.shadowMap=new i.WebGLRenderTarget(F.shadowMapWidth,F.shadowMapHeight,z);F.shadowMapSize=new i.Vector2(F.shadowMapWidth,F.shadowMapHeight);F.shadowMatrix=new i.Matrix4}if(!F.shadowCamera){if(F instanceof i.SpotLight){F.shadowCamera=new i.PerspectiveCamera(F.shadowCameraFov,F.shadowMapWidth/F.shadowMapHeight,F.shadowCameraNear,F.shadowCameraFar)}else if(F instanceof i.DirectionalLight){F.shadowCamera=new i.OrthographicCamera(F.shadowCameraLeft,F.shadowCameraRight,F.shadowCameraTop,F.shadowCameraBottom,F.shadowCameraNear,F.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}r.add(F.shadowCamera);if(r.autoUpdate===true)r.updateMatrixWorld()}if(F.shadowCameraVisible&&!F.cameraHelper){F.cameraHelper=new i.CameraHelper(F.shadowCamera);r.add(F.cameraHelper)}if(F.isVirtual&&V.originalCamera==c){b(c,F)}S=F.shadowMap;E=F.shadowMatrix;A=F.shadowCamera;A.position.setFromMatrixPosition(F.matrixWorld);p.setFromMatrixPosition(F.target.matrixWorld);A.lookAt(p);A.updateMatrixWorld();A.matrixWorldInverse.getInverse(A.matrixWorld);if(F.cameraHelper)F.cameraHelper.visible=F.shadowCameraVisible;if(F.shadowCameraVisible)F.cameraHelper.update();E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);E.multiply(A.projectionMatrix);E.multiply(A.matrixWorldInverse);f.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse);u.setFromMatrix(f);e.setRenderTarget(S);e.clear();m.length=0;y(r,r,A);var I,j,G;for(g=0,M=m.length;g<M;g++){P=m[g];D=P.object;L=P.buffer;I=w(D);j=D.geometry.morphTargets!==undefined&&D.geometry.morphTargets.length>0&&I.morphTargets;G=D instanceof i.SkinnedMesh&&I.skinning;if(D.customDepthMaterial){R=D.customDepthMaterial}else if(G){R=j?l:h}else if(j){R=s}else{R=o}e.setMaterialFaces(I);if(L instanceof i.BufferGeometry){e.renderBufferDirect(A,t,B,R,L,D)}else{e.renderBuffer(A,t,B,R,L,D)}}for(g=0,M=n.length;g<M;g++){P=n[g];D=P.object;if(D.visible&&D.castShadow){D._modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,D.matrixWorld);e.renderImmediateObject(A,t,B,o,D)}}}var H=e.getClearColor(),W=e.getClearAlpha();a.clearColor(H.r,H.g,H.b,W);a.enable(a.BLEND);if(e.shadowMapCullFace===i.CullFaceFront){a.cullFace(a.BACK)}e.resetGLState()};function y(e,t,i){if(t.visible){var n=r[t.id];if(n&&t.castShadow&&(t.frustumCulled===false||u.intersectsObject(t)===true)){for(var a=0,o=n.length;a<o;a++){var s=n[a];t._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld);m.push(s)}}for(var a=0,o=t.children.length;a<o;a++){y(e,t.children[a],i)}}}function x(e,t){var r=new i.DirectionalLight;r.isVirtual=true;r.onlyShadow=true;r.castShadow=true;r.shadowCameraNear=e.shadowCameraNear;r.shadowCameraFar=e.shadowCameraFar;r.shadowCameraLeft=e.shadowCameraLeft;r.shadowCameraRight=e.shadowCameraRight;r.shadowCameraBottom=e.shadowCameraBottom;r.shadowCameraTop=e.shadowCameraTop;r.shadowCameraVisible=e.shadowCameraVisible;r.shadowDarkness=e.shadowDarkness;r.shadowBias=e.shadowCascadeBias[t];r.shadowMapWidth=e.shadowCascadeWidth[t];r.shadowMapHeight=e.shadowCascadeHeight[t];r.pointsWorld=[];r.pointsFrustum=[];var n=r.pointsWorld,a=r.pointsFrustum;for(var o=0;o<8;o++){n[o]=new i.Vector3;a[o]=new i.Vector3}var s=e.shadowCascadeNearZ[t];var h=e.shadowCascadeFarZ[t];a[0].set(-1,-1,s);a[1].set(1,-1,s);a[2].set(-1,1,s);a[3].set(1,1,s);a[4].set(-1,-1,h);a[5].set(1,-1,h);a[6].set(-1,1,h);a[7].set(1,1,h);return r}function _(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position);r.target.position.copy(e.target.position);r.lookAt(r.target);r.shadowCameraVisible=e.shadowCameraVisible;r.shadowDarkness=e.shadowDarkness;r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t];var n=e.shadowCascadeFarZ[t];var a=r.pointsFrustum;a[0].z=i;a[1].z=i;a[2].z=i;a[3].z=i;a[4].z=n;a[5].z=n;a[6].z=n;a[7].z=n}function b(e,t){var r=t.shadowCamera,i=t.pointsFrustum,n=t.pointsWorld;c.set(Infinity,Infinity,Infinity);d.set(-Infinity,-Infinity,-Infinity);for(var a=0;a<8;a++){var o=n[a];o.copy(i[a]);o.unproject(e);o.applyMatrix4(r.matrixWorldInverse);if(o.x<c.x)c.x=o.x;if(o.x>d.x)d.x=o.x;if(o.y<c.y)c.y=o.y;if(o.y>d.y)d.y=o.y;if(o.z<c.z)c.z=o.z;if(o.z>d.z)d.z=o.z}r.left=c.x;r.right=d.x;r.top=d.y;r.bottom=c.y;r.updateProjectionMatrix()}function w(e){return e.material instanceof i.MeshFaceMaterial?e.material.materials[0]:e.material}};i.SpritePlugin=function(e,t){var r=e.context;var n,a;var o,s,h;var l;var u=new i.Vector3;var f=new i.Quaternion;var c=new i.Vector3;var d=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);n=r.createBuffer();a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n);r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW);o=p();s={position:r.getAttribLocation(o,"position"),uv:r.getAttribLocation(o,"uv")};h={uvOffset:r.getUniformLocation(o,"uvOffset"),uvScale:r.getUniformLocation(o,"uvScale"),rotation:r.getUniformLocation(o,"rotation"),scale:r.getUniformLocation(o,"scale"),color:r.getUniformLocation(o,"color"),map:r.getUniformLocation(o,"map"),opacity:r.getUniformLocation(o,"opacity"),modelViewMatrix:r.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(o,"projectionMatrix"),fogType:r.getUniformLocation(o,"fogType"),fogDensity:r.getUniformLocation(o,"fogDensity"),fogNear:r.getUniformLocation(o,"fogNear"),fogFar:r.getUniformLocation(o,"fogFar"),fogColor:r.getUniformLocation(o,"fogColor"),alphaTest:r.getUniformLocation(o,"alphaTest")};var u=document.createElement("canvas");u.width=8;u.height=8;var f=u.getContext("2d");f.fillStyle="white";f.fillRect(0,0,8,8);l=new i.Texture(u);l.needsUpdate=true};this.render=function(p,v){if(t.length===0)return;if(o===undefined){d()}r.useProgram(o);r.enableVertexAttribArray(s.position);r.enableVertexAttribArray(s.uv);r.disable(r.CULL_FACE);r.enable(r.BLEND);r.bindBuffer(r.ARRAY_BUFFER,n);r.vertexAttribPointer(s.position,2,r.FLOAT,false,2*8,0);r.vertexAttribPointer(s.uv,2,r.FLOAT,false,2*8,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a);r.uniformMatrix4fv(h.projectionMatrix,false,v.projectionMatrix.elements);r.activeTexture(r.TEXTURE0);r.uniform1i(h.map,0);var g=0;var y=0;var x=p.fog;if(x){r.uniform3f(h.fogColor,x.color.r,x.color.g,x.color.b);if(x instanceof i.Fog){r.uniform1f(h.fogNear,x.near);r.uniform1f(h.fogFar,x.far);r.uniform1i(h.fogType,1);g=1;y=1}else if(x instanceof i.FogExp2){r.uniform1f(h.fogDensity,x.density);r.uniform1i(h.fogType,2);g=2;y=2}}else{r.uniform1i(h.fogType,0);g=0;y=0}for(var _=0,b=t.length;_<b;_++){var w=t[_];w._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,w.matrixWorld);if(w.renderDepth===null){w.z=-w._modelViewMatrix.elements[14]}else{w.z=w.renderDepth}}t.sort(m);var M=[];for(var _=0,b=t.length;_<b;_++){var w=t[_];var T=w.material;r.uniform1f(h.alphaTest,T.alphaTest);r.uniformMatrix4fv(h.modelViewMatrix,false,w._modelViewMatrix.elements);
w.matrixWorld.decompose(u,f,c);M[0]=c.x;M[1]=c.y;var S=0;if(p.fog&&T.fog){S=y}if(g!==S){r.uniform1i(h.fogType,S);g=S}if(T.map!==null){r.uniform2f(h.uvOffset,T.map.offset.x,T.map.offset.y);r.uniform2f(h.uvScale,T.map.repeat.x,T.map.repeat.y)}else{r.uniform2f(h.uvOffset,0,0);r.uniform2f(h.uvScale,1,1)}r.uniform1f(h.opacity,T.opacity);r.uniform3f(h.color,T.color.r,T.color.g,T.color.b);r.uniform1f(h.rotation,T.rotation);r.uniform2fv(h.scale,M);e.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst);e.setDepthTest(T.depthTest);e.setDepthWrite(T.depthWrite);if(T.map&&T.map.image&&T.map.image.width){e.setTexture(T.map,0)}else{e.setTexture(l,0)}r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}r.enable(r.CULL_FACE);e.resetGLState()};function p(){var t=r.createProgram();var i=r.createShader(r.VERTEX_SHADER);var n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));r.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));r.compileShader(i);r.compileShader(n);r.attachShader(t,i);r.attachShader(t,n);r.linkProgram(t);return t}function m(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};i.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;if(t instanceof i.Mesh){t.matrixAutoUpdate&&t.updateMatrix();n=t.matrix;t=t.geometry}e.merge(t,n,r)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};i.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,r,n){var a=new i.ImageLoader;a.crossOrigin=this.crossOrigin;var o=new i.Texture(undefined,t);a.load(e,function(e){o.image=e;o.needsUpdate=true;if(r)r(o)},undefined,function(e){if(n)n(e)});o.sourceFile=e;return o},loadTextureCube:function(e,t,r,n){var a=[];var o=new i.ImageLoader;o.crossOrigin=this.crossOrigin;var s=new i.CubeTexture(a,t);s.flipY=false;var h=0;var l=function(t){o.load(e[t],function(e){s.images[t]=e;h+=1;if(h===6){s.needsUpdate=true;if(r)r(s)}})};for(var u=0,f=e.length;u<f;++u){l(u)}return s},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var a=e.width;var o=e.height;var s=document.createElement("canvas");s.width=a;s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0);var l=h.getImageData(0,0,a,o).data;var u=h.createImageData(a,o);var f=u.data;for(var c=0;c<a;c++){for(var d=0;d<o;d++){var p=d-1<0?0:d-1;var m=d+1>o-1?o-1:d+1;var v=c-1<0?0:c-1;var g=c+1>a-1?a-1:c+1;var y=[];var x=[0,0,l[(d*a+c)*4]/255*t];y.push([-1,0,l[(d*a+v)*4]/255*t]);y.push([-1,-1,l[(p*a+v)*4]/255*t]);y.push([0,-1,l[(p*a+c)*4]/255*t]);y.push([1,-1,l[(p*a+g)*4]/255*t]);y.push([1,0,l[(d*a+g)*4]/255*t]);y.push([1,1,l[(m*a+g)*4]/255*t]);y.push([0,1,l[(m*a+c)*4]/255*t]);y.push([-1,1,l[(m*a+v)*4]/255*t]);var _=[];var b=y.length;for(var w=0;w<b;w++){var M=y[w];var T=y[(w+1)%b];M=i(M,x);T=i(T,x);_.push(n(r(M,T)))}var S=[0,0,0];for(var w=0;w<_.length;w++){S[0]+=_[w][0];S[1]+=_[w][1];S[2]+=_[w][2]}S[0]/=_.length;S[1]/=_.length;S[2]/=_.length;var E=(d*a+c)*4;f[E]=(S[0]+1)/2*255|0;f[E+1]=(S[1]+1)/2*255|0;f[E+2]=S[2]*255|0;f[E+3]=255}}h.putImageData(u,0,0);return s},generateDataTexture:function(e,t,r){var n=e*t;var a=new Uint8Array(3*n);var o=Math.floor(r.r*255);var s=Math.floor(r.g*255);var h=Math.floor(r.b*255);for(var l=0;l<n;l++){a[l*3]=o;a[l*3+1]=s;a[l*3+2]=h}var u=new i.DataTexture(a,e,t,i.RGBFormat);u.needsUpdate=true;return u}};i.SceneUtils={createMultiMaterialObject:function(e,t){var r=new i.Object3D;for(var n=0,a=t.length;n<a;n++){r.add(new i.Mesh(e,t[n]))}return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld);t.remove(e);r.add(e)},attach:function(e,t,r){var n=new i.Matrix4;n.getInverse(r.matrixWorld);e.applyMatrix(n);t.remove(e);r.add(e)}};i.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();var r=this;r.faces[t]=r.faces[t]||{};r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{};r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var i=r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],r=[];var n,a,o=this.getFace(),s=this.size/o.resolution,h=0,l=String(e).split(""),u=l.length;var f=[];for(n=0;n<u;n++){var c=new i.Path;var d=this.extractGlyphPoints(l[n],o,s,h,c);h+=d.offset;f.push(d.path)}var p=h/2;return{paths:f,offset:p}},extractGlyphPoints:function(e,t,r,n,a){var o=[];var s,h,l,u,f,c,d,p,m,v,g,y,x,_,b,w,M,T,S,E=t.glyphs[e]||t.glyphs["?"];if(!E)return;if(E.o){u=E._cachedOutline||(E._cachedOutline=E.o.split(" "));c=u.length;d=r;p=r;for(s=0;s<c;){f=u[s++];switch(f){case"m":m=u[s++]*d+n;v=u[s++]*p;a.moveTo(m,v);break;case"l":m=u[s++]*d+n;v=u[s++]*p;a.lineTo(m,v);break;case"q":g=u[s++]*d+n;y=u[s++]*p;b=u[s++]*d+n;w=u[s++]*p;a.quadraticCurveTo(b,w,g,y);S=o[o.length-1];if(S){x=S.x;_=S.y;for(h=1,l=this.divisions;h<=l;h++){var A=h/l;var C=i.Shape.Utils.b2(A,x,b,g);var L=i.Shape.Utils.b2(A,_,w,y)}}break;case"b":g=u[s++]*d+n;y=u[s++]*p;b=u[s++]*d+n;w=u[s++]*p;M=u[s++]*d+n;T=u[s++]*p;a.bezierCurveTo(b,w,M,T,g,y);S=o[o.length-1];if(S){x=S.x;_=S.y;for(h=1,l=this.divisions;h<=l;h++){var A=h/l;var C=i.Shape.Utils.b3(A,x,b,M,g);var L=i.Shape.Utils.b3(A,_,w,T,y)}}break}}}return{offset:E.ha*r,path:a}}};i.FontUtils.generateShapes=function(e,t){t=t||{};var r=t.size!==undefined?t.size:100;var n=t.curveSegments!==undefined?t.curveSegments:4;var a=t.font!==undefined?t.font:"helvetiker";var o=t.weight!==undefined?t.weight:"normal";var s=t.style!==undefined?t.style:"normal";i.FontUtils.size=r;i.FontUtils.divisions=n;i.FontUtils.face=a;i.FontUtils.weight=o;i.FontUtils.style=s;var h=i.FontUtils.drawText(e);var l=h.paths;var u=[];for(var f=0,c=l.length;f<c;f++){Array.prototype.push.apply(u,l[f].toShapes())}return u};(function(e){var t=1e-10;var r=function(e,t){var r=e.length;if(r<3)return null;var a=[],o=[],s=[];var h,l,u;if(i(e)>0){for(l=0;l<r;l++)o[l]=l}else{for(l=0;l<r;l++)o[l]=r-1-l}var f=r;var c=2*f;for(l=f-1;f>2;){if(c--<=0){console.log("Warning, unable to triangulate polygon!");if(t)return s;return a}h=l;if(f<=h)h=0;l=h+1;if(f<=l)l=0;u=l+1;if(f<=u)u=0;if(n(e,h,l,u,f,o)){var d,p,m,v,g;d=o[h];p=o[l];m=o[u];a.push([e[d],e[p],e[m]]);s.push([o[h],o[l],o[u]]);for(v=l,g=l+1;g<f;v++,g++){o[v]=o[g]}f--;c=2*f}}if(t)return s;return a};var i=function(e){var t=e.length;var r=0;for(var i=t-1,n=0;n<t;i=n++){r+=e[i].x*e[n].y-e[n].x*e[i].y}return r*.5};var n=function(e,r,i,n,a,o){var s;var h,l,u,f;var c,d,p,m;h=e[o[r]].x;l=e[o[r]].y;u=e[o[i]].x;f=e[o[i]].y;c=e[o[n]].x;d=e[o[n]].y;if(t>(u-h)*(d-l)-(f-l)*(c-h))return false;var v,g,y,x,_,b;var w,M,T,S,E,A;var C,L,R;v=c-u;g=d-f;y=h-c;x=l-d;_=u-h;b=f-l;for(s=0;s<a;s++){p=e[o[s]].x;m=e[o[s]].y;if(p===h&&m===l||p===u&&m===f||p===c&&m===d)continue;w=p-h;M=m-l;T=p-u;S=m-f;E=p-c;A=m-d;R=v*S-g*T;C=_*M-b*w;L=y*A-x*E;if(R>=-t&&L>=-t&&C>=-t)return false}return true};e.Triangulate=r;e.Triangulate.area=i;return e})(i.FontUtils);self._typeface_js={faces:i.FontUtils.faces,loadFace:i.FontUtils.loadFace};i.typeface_js=self._typeface_js;i.Audio=function(e){i.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain)};i.Audio.prototype=Object.create(i.Object3D.prototype);i.Audio.prototype.constructor=i.Audio;i.Audio.prototype.load=function(e){var t=this;var r=new XMLHttpRequest;r.open("GET",e,true);r.responseType="arraybuffer";r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;t.source.connect(t.panner);t.source.start(0)})};r.send();return this};i.Audio.prototype.setLoop=function(e){this.source.loop=e};i.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};i.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};i.Audio.prototype.updateMatrixWorld=function(){var e=new i.Vector3;return function(t){i.Object3D.prototype.updateMatrixWorld.call(this,t);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();i.AudioListener=function(){i.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};i.AudioListener.prototype=Object.create(i.Object3D.prototype);i.AudioListener.prototype.constructor=i.AudioListener;i.AudioListener.prototype.updateMatrixWorld=function(){var e=new i.Vector3;var t=new i.Quaternion;var r=new i.Vector3;var n=new i.Vector3;var a=new i.Vector3;var o=new i.Vector3;return function(s){i.Object3D.prototype.updateMatrixWorld.call(this,s);var h=this.context.listener;this.matrixWorld.decompose(e,t,r);n.set(0,0,-1).applyQuaternion(t);a.subVectors(e,o);h.setPosition(e.x,e.y,e.z);h.setOrientation(n.x,n.y,n.z,this.up.x,this.up.y,this.up.z);h.setVelocity(a.x,a.y,a.z);o.copy(e)}}();i.Curve=function(){};i.Curve.prototype.getPoint=function(e){console.log("Warning, getPoint() not implemented!");return null};i.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};i.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPoint(t/e))}return r};i.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,r=[];for(t=0;t<=e;t++){r.push(this.getPointAt(t/e))}return r};i.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};i.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var r,i=this.getPoint(0);var n,a=0;t.push(0);for(n=1;n<=e;n++){r=this.getPoint(n/e);a+=r.distanceTo(i);t.push(a);i=r}this.cacheArcLengths=t;return t};i.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};i.Curve.prototype.getUtoTmapping=function(e,t){var r=this.getLengths();var i=0,n=r.length;var a;if(t){a=t}else{a=e*r[n-1]}var o=0,s=n-1,h;while(o<=s){i=Math.floor(o+(s-o)/2);h=r[i]-a;if(h<0){o=i+1;continue}else if(h>0){s=i-1;continue}else{s=i;break}}i=s;if(r[i]==a){var l=i/(n-1);return l}var u=r[i];var f=r[i+1];var c=f-u;var d=(a-u)/c;var l=(i+d)/(n-1);return l};i.Curve.prototype.getTangent=function(e){var t=1e-4;var r=e-t;var i=e+t;if(r<0)r=0;if(i>1)i=1;var n=this.getPoint(r);var a=this.getPoint(i);var o=a.clone().sub(n);return o.normalize()};i.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};i.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var h=3*e*e-2*e;return a+o+s+h},interpolate:function(e,t,r,i,n){var a=(r-e)*.5;var o=(i-t)*.5;var s=n*n;var h=n*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*n+t}};i.Curve.create=function(e,t){e.prototype=Object.create(i.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};i.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};i.CurvePath.prototype=Object.create(i.Curve.prototype);i.CurvePath.prototype.constructor=i.CurvePath;i.CurvePath.prototype.add=function(e){this.curves.push(e)};i.CurvePath.prototype.checkConnection=function(){};i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new i.LineCurve(t,e))}};i.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var r=this.getCurveLengths();var i=0,n,a;while(i<r.length){if(r[i]>=t){n=r[i]-t;a=this.curves[i];var o=1-n/a.getLength();return a.getPointAt(o);break}i++}return null};i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var r,i=this.curves.length;for(r=0;r<i;r++){t+=this.curves[r].getLength();e.push(t)}this.cacheLengths=e;return e};i.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,r,n;var a,o,s;t=r=Number.NEGATIVE_INFINITY;a=o=Number.POSITIVE_INFINITY;var h,l,u,f;var c=e[0]instanceof i.Vector3;f=c?new i.Vector3:new i.Vector2;for(l=0,u=e.length;l<u;l++){h=e[l];if(h.x>t)t=h.x;else if(h.x<a)a=h.x;if(h.y>r)r=h.y;else if(h.y<o)o=h.y;if(c){if(h.z>n)n=h.z;else if(h.z<s)s=h.z}f.add(h)}var d={minX:a,minY:o,maxX:t,maxY:r};if(c){d.maxZ=n;d.minZ=s}return d};i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createGeometry=function(e){var t=new i.Geometry;for(var r=0;r<e.length;r++){t.vertices.push(new i.Vector3(e[r].x,e[r].y,e[r].z||0))}return t};i.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};i.CurvePath.prototype.getTransformedPoints=function(e,t){var r=this.getPoints(e);var i,n;if(!t){t=this.bends}for(i=0,n=t.length;i<n;i++){r=this.getWrapPoints(r,t[i])}return r};i.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r=this.getSpacedPoints(e);var i,n;if(!t){t=this.bends}for(i=0,n=t.length;i<n;i++){r=this.getWrapPoints(r,t[i])}return r};i.CurvePath.prototype.getWrapPoints=function(e,t){var r=this.getBoundingBox();var i,n,a,o,s,h;for(i=0,n=e.length;i<n;i++){a=e[i];o=a.x;s=a.y;h=o/r.maxX;h=t.getUtoTmapping(h,o);var l=t.getPoint(h);var u=t.getTangent(h);u.set(-u.y,u.x).multiplyScalar(s);a.x=l.x+u.x;a.y=l.y+u.y}return e};i.Gyroscope=function(){i.Object3D.call(this)};i.Gyroscope.prototype=Object.create(i.Object3D.prototype);i.Gyroscope.prototype.constructor=i.Gyroscope;i.Gyroscope.prototype.updateMatrixWorld=function(){var e=new i.Vector3;var t=new i.Quaternion;var r=new i.Vector3;var n=new i.Vector3;var a=new i.Quaternion;var o=new i.Vector3;return function(i){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||i){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(n,a,o);this.matrix.decompose(e,t,r);this.matrixWorld.compose(n,t,o)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;i=true}for(var s=0,h=this.children.length;s<h;s++){this.children[s].updateMatrixWorld(i)}}}();i.Path=function(e){i.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};i.Path.prototype=Object.create(i.CurvePath.prototype);i.Path.prototype.constructor=i.Path;i.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++){this.lineTo(e[t].x,e[t].y)}};i.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:i.PathActions.MOVE_TO,args:r})};i.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments);var n=this.actions[this.actions.length-1].args;var a=n[n.length-2];var o=n[n.length-1];var s=new i.LineCurve(new i.Vector2(a,o),new i.Vector2(e,t));this.curves.push(s);this.actions.push({action:i.PathActions.LINE_TO,args:r})};i.Path.prototype.quadraticCurveTo=function(e,t,r,n){var a=Array.prototype.slice.call(arguments);var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];var l=new i.QuadraticBezierCurve(new i.Vector2(s,h),new i.Vector2(e,t),new i.Vector2(r,n));this.curves.push(l);this.actions.push({action:i.PathActions.QUADRATIC_CURVE_TO,args:a})};i.Path.prototype.bezierCurveTo=function(e,t,r,n,a,o){var s=Array.prototype.slice.call(arguments);var h=this.actions[this.actions.length-1].args;var l=h[h.length-2];var u=h[h.length-1];var f=new i.CubicBezierCurve(new i.Vector2(l,u),new i.Vector2(e,t),new i.Vector2(r,n),new i.Vector2(a,o));this.curves.push(f);this.actions.push({action:i.PathActions.BEZIER_CURVE_TO,args:s})};i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=[new i.Vector2(n,a)];Array.prototype.push.apply(o,e);var s=new i.SplineCurve(o);this.curves.push(s);this.actions.push({action:i.PathActions.CSPLINE_THRU,args:t})};i.Path.prototype.arc=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];this.absarc(e+s,t+h,r,i,n,a)};i.Path.prototype.absarc=function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)};i.Path.prototype.ellipse=function(e,t,r,i,n,a,o){var s=this.actions[this.actions.length-1].args;var h=s[s.length-2];var l=s[s.length-1];this.absellipse(e+h,t+l,r,i,n,a,o)};i.Path.prototype.absellipse=function(e,t,r,n,a,o,s){var h=Array.prototype.slice.call(arguments);var l=new i.EllipseCurve(e,t,r,n,a,o,s);this.curves.push(l);var u=l.getPoint(1);h.push(u.x);h.push(u.y);this.actions.push({action:i.PathActions.ELLIPSE,args:h})};i.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var r=[];for(var i=0;i<e;i++){r.push(this.getPoint(i/e))}return r};i.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var r=[];var n,a,o,s,h;var l,u,f,c,d,p,m,v,g,y,x,_,b;for(n=0,a=this.actions.length;n<a;n++){o=this.actions[n];s=o.action;h=o.args;switch(s){case i.PathActions.MOVE_TO:r.push(new i.Vector2(h[0],h[1]));break;case i.PathActions.LINE_TO:r.push(new i.Vector2(h[0],h[1]));break;case i.PathActions.QUADRATIC_CURVE_TO:l=h[2];u=h[3];d=h[0];p=h[1];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[n-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;_=i.Shape.Utils.b2(x,m,d,l);b=i.Shape.Utils.b2(x,v,p,u);r.push(new i.Vector2(_,b))}break;case i.PathActions.BEZIER_CURVE_TO:l=h[4];u=h[5];d=h[0];p=h[1];f=h[2];c=h[3];if(r.length>0){g=r[r.length-1];m=g.x;v=g.y}else{g=this.actions[n-1].args;m=g[g.length-2];v=g[g.length-1]}for(y=1;y<=e;y++){x=y/e;_=i.Shape.Utils.b3(x,m,d,f,l);b=i.Shape.Utils.b3(x,v,p,c,u);r.push(new i.Vector2(_,b))}break;case i.PathActions.CSPLINE_THRU:g=this.actions[n-1].args;var w=new i.Vector2(g[g.length-2],g[g.length-1]);var M=[w];var T=e*h[0].length;M=M.concat(h[0]);var S=new i.SplineCurve(M);for(y=1;y<=T;y++){r.push(S.getPointAt(y/T))}break;case i.PathActions.ARC:var E=h[0],A=h[1],C=h[2],L=h[3],R=h[4],P=!!h[5];var D=R-L;var F;var U=e*2;for(y=1;y<=U;y++){x=y/U;if(!P){x=1-x}F=L+x*D;_=E+C*Math.cos(F);b=A+C*Math.sin(F);r.push(new i.Vector2(_,b))}break;case i.PathActions.ELLIPSE:var E=h[0],A=h[1],k=h[2],B=h[3],L=h[4],R=h[5],P=!!h[6];var D=R-L;var F;var U=e*2;for(y=1;y<=U;y++){x=y/U;if(!P){x=1-x}F=L+x*D;_=E+k*Math.cos(F);b=A+B*Math.sin(F);r.push(new i.Vector2(_,b))}break}}var V=r[r.length-1];var N=1e-10;if(Math.abs(V.x-r[0].x)<N&&Math.abs(V.y-r[0].y)<N)r.splice(r.length-1,1);if(t){r.push(r[0])}return r};i.Path.prototype.toShapes=function(e,t){function r(e){var t,r,n,a,o;var s=[],h=new i.Path;for(t=0,r=e.length;t<r;t++){n=e[t];o=n.args;a=n.action;if(a==i.PathActions.MOVE_TO){if(h.actions.length!=0){s.push(h);h=new i.Path}}h[a].apply(h,o)}if(h.actions.length!=0){s.push(h)}return s}function n(e){var t=[];for(var r=0,n=e.length;r<n;r++){var a=e[r];var o=new i.Shape;o.actions=a.actions;o.curves=a.curves;t.push(o)}return t}function a(e,t){var r=1e-10;var i=t.length;var n=false;for(var a=i-1,o=0;o<i;a=o++){var s=t[a];var h=t[o];var l=h.x-s.x;var u=h.y-s.y;if(Math.abs(u)>r){if(u<0){s=t[o];l=-l;h=t[a];u=-u}if(e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return true}else{var f=u*(e.x-s.x)-l*(e.y-s.y);if(f==0)return true;if(f<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return true}}return n}var o=r(this.actions);if(o.length==0)return[];if(t===true)return n(o);var s,h,l,u=[];if(o.length==1){h=o[0];l=new i.Shape;l.actions=h.actions;l.curves=h.curves;u.push(l);return u}var f=!i.Shape.Utils.isClockWise(o[0].getPoints());f=e?!f:f;var c=[];var d=[];var p=[];var m=0;var v;d[m]=undefined;p[m]=[];var g,y;for(g=0,y=o.length;g<y;g++){h=o[g];v=h.getPoints();s=i.Shape.Utils.isClockWise(v);s=e?!s:s;if(s){if(!f&&d[m])m++;d[m]={s:new i.Shape,p:v};d[m].s.actions=h.actions;d[m].s.curves=h.curves;if(f)m++;p[m]=[]}else{p[m].push({h:h,p:v[0]})}}if(!d[0])return n(o);if(d.length>1){var x=false;var _=[];for(var b=0,w=d.length;b<w;b++){c[b]=[]}for(var b=0,w=d.length;b<w;b++){var M=d[b];var T=p[b];for(var S=0;S<T.length;S++){var E=T[S];var A=true;for(var C=0;C<d.length;C++){if(a(E.p,d[C].p)){if(b!=C)_.push({froms:b,tos:C,hole:S});if(A){A=false;c[C].push(E)}else{x=true}}}if(A){c[b].push(E)}}}if(_.length>0){if(!x)p=c}}var L,R,P;for(g=0,y=d.length;g<y;g++){l=d[g].s;u.push(l);L=p[g];for(R=0,P=L.length;R<P;R++){l.holes.push(L[R].h)}}return u};i.Shape=function(){i.Path.apply(this,arguments);this.holes=[]};i.Shape.prototype=Object.create(i.Path.prototype);i.Shape.prototype.constructor=i.Shape;i.Shape.prototype.extrude=function(e){var t=new i.ExtrudeGeometry(this,e);return t};i.Shape.prototype.makeGeometry=function(e){var t=new i.ShapeGeometry(this,e);return t};i.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++){i[t]=this.holes[t].getTransformedPoints(e,this.bends)}return i};i.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++){i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return i};i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};i.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};i.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};i.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){if(e.x!=t.x){if(e.x<t.x){return e.x<=r.x&&r.x<=t.x}else{return t.x<=r.x&&r.x<=e.x}}else{if(e.y<t.y){return e.y<=r.y&&r.y<=t.y}else{return t.y<=r.y&&r.y<=e.y}}}function n(e,t,i,n,a){var o=1e-10;var s=t.x-e.x,h=t.y-e.y;var l=n.x-i.x,u=n.y-i.y;var f=e.x-i.x;var c=e.y-i.y;var d=h*l-s*u;var p=h*f-s*c;if(Math.abs(d)>o){var m;if(d>0){if(p<0||p>d)return[];m=u*f-l*c;if(m<0||m>d)return[]}else{if(p>0||p<d)return[];m=u*f-l*c;if(m>0||m<d)return[]}if(m==0){if(a&&(p==0||p==d))return[];return[e]}if(m==d){if(a&&(p==0||p==d))return[];return[t]}if(p==0)return[i];if(p==d)return[n];var v=m/d;return[{x:e.x+v*s,y:e.y+v*h}]}else{if(p!=0||u*f!=l*c)return[];var g=s==0&&h==0;var y=l==0&&u==0;if(g&&y){if(e.x!=i.x||e.y!=i.y)return[];return[e]}if(g){if(!r(i,n,e))return[];return[e]}if(y){if(!r(e,t,i))return[];return[i]}var x,_,b,w;var M,T,S,E;if(s!=0){if(e.x<t.x){x=e;b=e.x;_=t;w=t.x}else{x=t;b=t.x;_=e;w=e.x}if(i.x<n.x){M=i;S=i.x;T=n;E=n.x}else{M=n;S=n.x;T=i;E=i.x}}else{if(e.y<t.y){x=e;b=e.y;_=t;w=t.y}else{x=t;b=t.y;_=e;w=e.y}if(i.y<n.y){M=i;S=i.y;T=n;E=n.y}else{M=n;S=n.y;T=i;E=i.y}}if(b<=S){if(w<S)return[];if(w==S){if(a)return[];return[M]}if(w<=E)return[M,_];return[M,T]}else{if(b>E)return[];if(b==E){if(a)return[];return[x]}if(w<=E)return[x,_];return[x,T]}}}function a(e,t,r,i){var n=1e-10;var a=t.x-e.x,o=t.y-e.y;var s=r.x-e.x,h=r.y-e.y;var l=i.x-e.x,u=i.y-e.y;var f=a*h-o*s;var c=a*u-o*l;if(Math.abs(f)>n){var d=l*h-u*s;if(f>0){return c>=0&&d>=0}else{return c>=0||d>=0}}else{return c>0}}function o(e,t){var r=e.concat();var i;function o(e,t){var n=r.length-1;var o=e-1;if(o<0)o=n;var s=e+1;if(s>n)s=0;var h=a(r[e],r[o],r[s],i[t]);if(!h){return false}var l=i.length-1;var u=t-1;if(u<0)u=l;var f=t+1;if(f>l)f=0;h=a(i[t],i[u],i[f],r[e]);if(!h){return false}return true}function s(e,t){var i,a,o;for(i=0;i<r.length;i++){a=i+1;a%=r.length;o=n(e,t,r[i],r[a],true);if(o.length>0)return true}return false}var h=[];function l(e,r){var i,a,o,s,l;for(i=0;i<h.length;i++){a=t[h[i]];for(o=0;o<a.length;o++){s=o+1;s%=a.length;l=n(e,r,a[o],a[s],true);if(l.length>0)return true}}return false}var u,f,c,d,p,m,v=[],g,y,x,_;for(var b=0,w=t.length;b<w;b++){h.push(b)}var M=0;var T=h.length*2;while(h.length>0){T--;if(T<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(f=M;f<r.length;f++){c=r[f];u=-1;for(var b=0;b<h.length;b++){p=h[b];m=c.x+":"+c.y+":"+p;if(v[m]!==undefined)continue;i=t[p];for(var S=0;S<i.length;S++){d=i[S];if(!o(f,S))continue;if(s(c,d))continue;if(l(c,d))continue;u=S;h.splice(b,1);g=r.slice(0,f+1);y=r.slice(f);x=i.slice(u);_=i.slice(0,u+1);r=g.concat(x).concat(_).concat(y);M=f;break}if(u>=0)break;v[m]=true}if(u>=0)break}}return r}var s,h,l,u,f,c,d={};var p=e.concat();for(var m=0,v=t.length;m<v;m++){Array.prototype.push.apply(p,t[m])}for(s=0,h=p.length;s<h;s++){f=p[s].x+":"+p[s].y;if(d[f]!==undefined){console.log("Duplicate point",f)}d[f]=s}var g=o(e,t);var y=i.FontUtils.Triangulate(g,false);for(s=0,h=y.length;s<h;s++){u=y[s];for(l=0;l<3;l++){f=u[l].x+":"+u[l].y;c=d[f];if(c!==undefined){u[l]=c}}}return y.concat()},isClockWise:function(e){return i.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}};i.LineCurve=function(e,t){this.v1=e;this.v2=t};i.LineCurve.prototype=Object.create(i.Curve.prototype);i.LineCurve.prototype.constructor=i.LineCurve;i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};i.QuadraticBezierCurve=function(e,t,r){this.v0=e;this.v1=t;this.v2=r};i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype);i.QuadraticBezierCurve.prototype.constructor=i.QuadraticBezierCurve;i.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new i.Vector2;t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return t};i.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new i.Vector2;t.x=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return t.normalize()};i.CubicBezierCurve=function(e,t,r,i){this.v0=e;this.v1=t;this.v2=r;this.v3=i};i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype);i.CubicBezierCurve.prototype.constructor=i.CubicBezierCurve;i.CubicBezierCurve.prototype.getPoint=function(e){var t,r;t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new i.Vector2(t,r)};i.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=i.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r=i.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new i.Vector2(t,r);n.normalize();return n};i.SplineCurve=function(e){this.points=e==undefined?[]:e};i.SplineCurve.prototype=Object.create(i.Curve.prototype);i.SplineCurve.prototype.constructor=i.SplineCurve;i.SplineCurve.prototype.getPoint=function(e){var t=this.points;var r=(t.length-1)*e;var n=Math.floor(r);var a=r-n;var o=t[n==0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var l=t[n>t.length-3?t.length-1:n+2];var u=new i.Vector2;u.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);return u};i.EllipseCurve=function(e,t,r,i,n,a,o){this.aX=e;this.aY=t;this.xRadius=r;this.yRadius=i;this.aStartAngle=n;this.aEndAngle=a;this.aClockwise=o};i.EllipseCurve.prototype=Object.create(i.Curve.prototype);i.EllipseCurve.prototype.constructor=i.EllipseCurve;i.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var r;if(this.aClockwise===true){r=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{r=this.aStartAngle+e*t}var n=new i.Vector2;n.x=this.aX+this.xRadius*Math.cos(r);n.y=this.aY+this.yRadius*Math.sin(r);return n};i.ArcCurve=function(e,t,r,n,a,o){i.EllipseCurve.call(this,e,t,r,r,n,a,o)};i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype);i.ArcCurve.prototype.constructor=i.ArcCurve;i.LineCurve3=i.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new i.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});i.QuadraticBezierCurve3=i.Curve.create(function(e,t,r){this.v0=e;this.v1=t;this.v2=r},function(e){var t=new i.Vector3;t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);t.z=i.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return t});i.CubicBezierCurve3=i.Curve.create(function(e,t,r,i){this.v0=e;this.v1=t;this.v2=r;this.v3=i},function(e){var t=new i.Vector3;t.x=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t.y=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t.z=i.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return t});i.SplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-1)*e;
var n=Math.floor(r);var a=r-n;var o=t[n==0?n:n-1];var s=t[n];var h=t[n>t.length-2?t.length-1:n+1];var l=t[n>t.length-3?t.length-1:n+2];var u=new i.Vector3;u.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);u.z=i.Curve.Utils.interpolate(o.z,s.z,h.z,l.z,a);return u});i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var r=(t.length-0)*e;var n=Math.floor(r);var a=r-n;n+=n>0?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length;var o=t[(n-1)%t.length];var s=t[n%t.length];var h=t[(n+1)%t.length];var l=t[(n+2)%t.length];var u=new i.Vector3;u.x=i.Curve.Utils.interpolate(o.x,s.x,h.x,l.x,a);u.y=i.Curve.Utils.interpolate(o.y,s.y,h.y,l.y,a);u.z=i.Curve.Utils.interpolate(o.z,s.z,h.z,l.z,a);return u});i.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===true)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time<0){e.hierarchy[t].keys[r].time=0}if(e.hierarchy[t].keys[r].rot!==undefined&&!(e.hierarchy[t].keys[r].rot instanceof i.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new i.Quaternion).fromArray(n)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var a={};for(var r=0;r<e.hierarchy[t].keys.length;r++){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){var s=e.hierarchy[t].keys[r].morphTargets[o];a[s]=-1}}e.hierarchy[t].usedMorphTargets=a;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var s in a){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){if(e.hierarchy[t].keys[r].morphTargets[o]===s){h[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}}if(o===e.hierarchy[t].keys[r].morphTargets.length){h[s]=0}}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++){if(e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time){e.hierarchy[t].keys.splice(r,1);r--}}for(var r=0;r<e.hierarchy[t].keys.length;r++){e.hierarchy[t].keys[r].index=r}}e.initialized=true;return e},parse:function(e){var t=function(e,r){r.push(e);for(var i=0;i<e.children.length;i++)t(e.children[i],r)};var r=[];if(e instanceof i.SkinnedMesh){for(var n=0;n<e.skeleton.bones.length;n++){r.push(e.skeleton.bones[n])}}else{t(e,r)}return r},play:function(e){if(this.animations.indexOf(e)===-1){this.animations.push(e)}},stop:function(e){var t=this.animations.indexOf(e);if(t!==-1){this.animations.splice(t,1)}},update:function(e){for(var t=0;t<this.animations.length;t++){this.animations[t].resetBlendWeights()}for(var t=0;t<this.animations.length;t++){this.animations[t].update(e)}}};i.Animation=function(e,t){this.root=e;this.data=i.AnimationHandler.init(t);this.hierarchy=i.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=i.AnimationHandler.LINEAR};i.Animation.prototype.keyTypes=["pos","rot","scl"];i.Animation.prototype.play=function(e,t){this.currentTime=e!==undefined?e:0;this.weight=t!==undefined?t:1;this.isPlaying=true;this.reset();i.AnimationHandler.play(this)};i.Animation.prototype.stop=function(){this.isPlaying=false;i.AnimationHandler.stop(this)};i.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];r.matrixAutoUpdate=true;if(r.animationCache===undefined){r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}if(r.animationCache.animations[this.data.name]===undefined){r.animationCache.animations[this.data.name]={};r.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0};r.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0};r.animationCache.animations[this.data.name].originalMatrix=r.matrix}var i=r.animationCache.animations[this.data.name];for(var n=0;n<3;n++){var a=this.keyTypes[n];var o=this.data.hierarchy[e].keys[0];var s=this.getNextKeyWith(a,e,1);while(s.time<this.currentTime&&s.index>o.index){o=s;s=this.getNextKeyWith(a,e,s.index+1)}i.prevKey[a]=o;i.nextKey[a]=s}}};i.Animation.prototype.resetBlendWeights=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];if(r.animationCache!==undefined){r.animationCache.blending.positionWeight=0;r.animationCache.blending.quaternionWeight=0;r.animationCache.blending.scaleWeight=0}}};i.Animation.prototype.update=function(){var e=[];var t=new i.Vector3;var r=new i.Vector3;var n=new i.Quaternion;var a=function(e,t){var r=[],i=[],n,a,s,h,l,u,f,c,d;n=(e.length-1)*t;a=Math.floor(n);s=n-a;r[0]=a===0?a:a-1;r[1]=a;r[2]=a>e.length-2?a:a+1;r[3]=a>e.length-3?a:a+2;u=e[r[0]];f=e[r[1]];c=e[r[2]];d=e[r[3]];h=s*s;l=s*h;i[0]=o(u[0],f[0],c[0],d[0],s,h,l);i[1]=o(u[1],f[1],c[1],d[1],s,h,l);i[2]=o(u[2],f[2],c[2],d[2],s,h,l);return i};var o=function(e,t,r,i,n,a,o){var s=(r-e)*.5,h=(i-t)*.5;return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t};return function(o){if(this.isPlaying===false)return;this.currentTime+=o*this.timeScale;if(this.weight===0)return;var s=this.data.length;if(this.currentTime>s||this.currentTime<0){if(this.loop){this.currentTime%=s;if(this.currentTime<0)this.currentTime+=s;this.reset()}else{this.stop();return}}for(var h=0,l=this.hierarchy.length;h<l;h++){var u=this.hierarchy[h];var f=u.animationCache.animations[this.data.name];var c=u.animationCache.blending;for(var d=0;d<3;d++){var p=this.keyTypes[d];var m=f.prevKey[p];var v=f.nextKey[p];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){m=this.data.hierarchy[h].keys[0];v=this.getNextKeyWith(p,h,1);while(v.time<this.currentTime&&v.index>m.index){m=v;v=this.getNextKeyWith(p,h,v.index+1)}f.prevKey[p]=m;f.nextKey[p]=v}u.matrixAutoUpdate=true;u.matrixWorldNeedsUpdate=true;var g=(this.currentTime-m.time)/(v.time-m.time);var y=m[p];var x=v[p];if(g<0)g=0;if(g>1)g=1;if(p==="pos"){if(this.interpolationType===i.AnimationHandler.LINEAR){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var _=this.weight/(this.weight+c.positionWeight);u.position.lerp(r,_);c.positionWeight+=this.weight}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",h,m.index-1)["pos"];e[1]=y;e[2]=x;e[3]=this.getNextKeyWith("pos",h,v.index+1)["pos"];g=g*.33+.33;var b=a(e,g);var _=this.weight/(this.weight+c.positionWeight);c.positionWeight+=this.weight;var w=u.position;w.x=w.x+(b[0]-w.x)*_;w.y=w.y+(b[1]-w.y)*_;w.z=w.z+(b[2]-w.z)*_;if(this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var M=a(e,g*1.01);t.set(M[0],M[1],M[2]);t.sub(w);t.y=0;t.normalize();var T=Math.atan2(t.x,t.z);u.rotation.set(0,T,0)}}}else if(p==="rot"){i.Quaternion.slerp(y,x,n,g);if(c.quaternionWeight===0){u.quaternion.copy(n);c.quaternionWeight=this.weight}else{var _=this.weight/(this.weight+c.quaternionWeight);i.Quaternion.slerp(u.quaternion,n,u.quaternion,_);c.quaternionWeight+=this.weight}}else if(p==="scl"){r.x=y[0]+(x[0]-y[0])*g;r.y=y[1]+(x[1]-y[1])*g;r.z=y[2]+(x[2]-y[2])*g;var _=this.weight/(this.weight+c.scaleWeight);u.scale.lerp(r,_);c.scaleWeight+=this.weight}}}return true}}();i.Animation.prototype.getNextKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){r=r<n.length-1?r:n.length-1}else{r=r%n.length}for(;r<n.length;r++){if(n[r][e]!==undefined){return n[r]}}return this.data.hierarchy[t].keys[0]};i.Animation.prototype.getPrevKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){r=r>0?r:0}else{r=r>=0?r:r+n.length}for(;r>=0;r--){if(n[r][e]!==undefined){return n[r]}}return this.data.hierarchy[t].keys[n.length-1]};i.KeyFrameAnimation=function(e){this.root=e.node;this.data=i.AnimationHandler.init(e);this.hierarchy=i.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var t=0,r=this.hierarchy.length;t<r;t++){var n=this.data.hierarchy[t].keys,a=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(n.length&&a){for(var s=0;s<a.length;s++){var h=a[s],l=this.getNextKeyWith(h,t,0);if(l){l.apply(h)}}o.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}};i.KeyFrameAnimation.prototype.play=function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,r=this.hierarchy.length,n,a;for(t=0;t<r;t++){n=this.hierarchy[t];a=this.data.hierarchy[t];if(a.animationCache===undefined){a.animationCache={};a.animationCache.prevKey=null;a.animationCache.nextKey=null;a.animationCache.originalMatrix=n.matrix}var o=this.data.hierarchy[t].keys;if(o.length){a.animationCache.prevKey=o[0];a.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;i.AnimationHandler.play(this)};i.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;i.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var r=this.data.hierarchy[e];if(r.animationCache!==undefined){var n=r.animationCache.originalMatrix;n.copy(t.matrix);t.matrix=n;delete r.animationCache}}};i.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var r=0,i=this.hierarchy.length;r<i;r++){var n=this.hierarchy[r];var a=this.data.hierarchy[r];var o=a.keys,s=a.animationCache;if(o.length){var h=s.prevKey;var l=s.nextKey;if(l.time<=this.currentTime){while(l.time<this.currentTime&&l.index>h.index){h=l;l=o[h.index+1]}s.prevKey=h;s.nextKey=l}if(l.time>=this.currentTime){h.interpolate(l,this.currentTime)}else{h.interpolate(l,l.time)}this.data.hierarchy[r].node.updateMatrix();n.matrixWorldNeedsUpdate=true}}};i.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;r=r%i.length;for(;r<i.length;r++){if(i[r].hasTarget(e)){return i[r]}}return i[0]};i.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;r=r>=0?r:r+i.length;for(;r>=0;r--){if(i[r].hasTarget(e)){return i[r]}}return i[i.length-1]};i.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};i.MorphAnimation.prototype={constructor:i.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames;var r=Math.floor(this.currentTime/t);if(r!=this.currentFrame){this.mesh.morphTargetInfluences[this.lastFrame]=0;this.mesh.morphTargetInfluences[this.currentFrame]=1;this.mesh.morphTargetInfluences[r]=0;this.lastFrame=this.currentFrame;this.currentFrame=r}this.mesh.morphTargetInfluences[r]=this.currentTime%t/t;this.mesh.morphTargetInfluences[this.lastFrame]=1-this.mesh.morphTargetInfluences[r]}};i.BoxGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:a,depthSegments:o};this.widthSegments=n||1;this.heightSegments=a||1;this.depthSegments=o||1;var s=this;var h=e/2;var l=t/2;var u=r/2;f("z","y",-1,-1,r,t,h,0);f("z","y",1,-1,r,t,-h,1);f("x","z",1,1,e,r,l,2);f("x","z",1,-1,e,r,-l,3);f("x","y",1,-1,e,t,u,4);f("x","y",-1,-1,e,t,-u,5);function f(e,t,r,n,a,o,h,l){var u,f,c,d=s.widthSegments,p=s.heightSegments,m=a/2,v=o/2,g=s.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){u="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){u="y";p=s.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){u="x";d=s.depthSegments}var y=d+1,x=p+1,_=a/d,b=o/p,w=new i.Vector3;w[u]=h>0?1:-1;for(c=0;c<x;c++){for(f=0;f<y;f++){var M=new i.Vector3;M[e]=(f*_-m)*r;M[t]=(c*b-v)*n;M[u]=h;s.vertices.push(M)}}for(c=0;c<p;c++){for(f=0;f<d;f++){var T=f+y*c;var S=f+y*(c+1);var E=f+1+y*(c+1);var A=f+1+y*c;var C=new i.Vector2(f/d,1-c/p);var L=new i.Vector2(f/d,1-(c+1)/p);var R=new i.Vector2((f+1)/d,1-(c+1)/p);var P=new i.Vector2((f+1)/d,1-c/p);var D=new i.Face3(T+g,S+g,A+g);D.normal.copy(w);D.vertexNormals.push(w.clone(),w.clone(),w.clone());D.materialIndex=l;s.faces.push(D);s.faceVertexUvs[0].push([C,L,P]);D=new i.Face3(S+g,E+g,A+g);D.normal.copy(w);D.vertexNormals.push(w.clone(),w.clone(),w.clone());D.materialIndex=l;s.faces.push(D);s.faceVertexUvs[0].push([L.clone(),R,P.clone()])}}}this.mergeVertices()};i.BoxGeometry.prototype=Object.create(i.Geometry.prototype);i.BoxGeometry.prototype.constructor=i.BoxGeometry;i.CircleGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};e=e||50;t=t!==undefined?Math.max(3,t):8;r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;var a,o=[],s=new i.Vector3,h=new i.Vector2(.5,.5);this.vertices.push(s);o.push(h);for(a=0;a<=t;a++){var l=new i.Vector3;var u=r+a/t*n;l.x=e*Math.cos(u);l.y=e*Math.sin(u);this.vertices.push(l);o.push(new i.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var f=new i.Vector3(0,0,1);for(a=1;a<=t;a++){this.faces.push(new i.Face3(a,a+1,0,[f.clone(),f.clone(),f.clone()]));this.faceVertexUvs[0].push([o[a].clone(),o[a+1].clone(),h.clone()])}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.CircleGeometry.prototype=Object.create(i.Geometry.prototype);i.CircleGeometry.prototype.constructor=i.CircleGeometry;i.CubeGeometry=function(e,t,r,n,a,o){console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new i.BoxGeometry(e,t,r,n,a,o)};i.CylinderGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:a,openEnded:o};e=e!==undefined?e:20;t=t!==undefined?t:20;r=r!==undefined?r:100;n=n||8;a=a||1;o=o!==undefined?o:false;var s=r/2;var h,l,u=[],f=[];for(l=0;l<=a;l++){var c=[];var d=[];var p=l/a;var m=p*(t-e)+e;for(h=0;h<=n;h++){var v=h/n;var g=new i.Vector3;g.x=m*Math.sin(v*Math.PI*2);g.y=-p*r+s;g.z=m*Math.cos(v*Math.PI*2);this.vertices.push(g);c.push(this.vertices.length-1);d.push(new i.Vector2(v,1-p))}u.push(c);f.push(d)}var y=(t-e)/r;var x,_;for(h=0;h<n;h++){if(e!==0){x=this.vertices[u[0][h]].clone();_=this.vertices[u[0][h+1]].clone()}else{x=this.vertices[u[1][h]].clone();_=this.vertices[u[1][h+1]].clone()}x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*y).normalize();_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*y).normalize();for(l=0;l<a;l++){var b=u[l][h];var w=u[l+1][h];var M=u[l+1][h+1];var T=u[l][h+1];var S=x.clone();var E=x.clone();var A=_.clone();var C=_.clone();var L=f[l][h].clone();var R=f[l+1][h].clone();var P=f[l+1][h+1].clone();var D=f[l][h+1].clone();this.faces.push(new i.Face3(b,w,T,[S,E,C]));this.faceVertexUvs[0].push([L,R,D]);this.faces.push(new i.Face3(w,M,T,[E.clone(),A,C.clone()]));this.faceVertexUvs[0].push([R.clone(),P,D.clone()])}}if(o===false&&e>0){this.vertices.push(new i.Vector3(0,s,0));for(h=0;h<n;h++){var b=u[0][h];var w=u[0][h+1];var M=this.vertices.length-1;var S=new i.Vector3(0,1,0);var E=new i.Vector3(0,1,0);var A=new i.Vector3(0,1,0);var L=f[0][h].clone();var R=f[0][h+1].clone();var P=new i.Vector2(R.x,0);this.faces.push(new i.Face3(b,w,M,[S,E,A]));this.faceVertexUvs[0].push([L,R,P])}}if(o===false&&t>0){this.vertices.push(new i.Vector3(0,-s,0));for(h=0;h<n;h++){var b=u[l][h+1];var w=u[l][h];var M=this.vertices.length-1;var S=new i.Vector3(0,-1,0);var E=new i.Vector3(0,-1,0);var A=new i.Vector3(0,-1,0);var L=f[l][h+1].clone();var R=f[l][h].clone();var P=new i.Vector2(R.x,1);this.faces.push(new i.Face3(b,w,M,[S,E,A]));this.faceVertexUvs[0].push([L,R,P])}}this.computeFaceNormals()};i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype);i.CylinderGeometry.prototype.constructor=i.CylinderGeometry;i.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}i.Geometry.call(this);this.type="ExtrudeGeometry";e=e instanceof Array?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype);i.ExtrudeGeometry.prototype.constructor=i.ExtrudeGeometry;i.ExtrudeGeometry.prototype.addShapeList=function(e,t){var r=e.length;for(var i=0;i<r;i++){var n=e[i];this.addShape(n,t)}};i.ExtrudeGeometry.prototype.addShape=function(e,t){var r=t.amount!==undefined?t.amount:100;var n=t.bevelThickness!==undefined?t.bevelThickness:6;var a=t.bevelSize!==undefined?t.bevelSize:n-2;var o=t.bevelSegments!==undefined?t.bevelSegments:3;var s=t.bevelEnabled!==undefined?t.bevelEnabled:true;var h=t.curveSegments!==undefined?t.curveSegments:12;var l=t.steps!==undefined?t.steps:1;var u=t.extrudePath;var f,c=false;var d=t.material;var p=t.extrudeMaterial;var m=t.UVGenerator!==undefined?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;var v,g,y,x;if(u){f=u.getSpacedPoints(l);c=true;s=false;v=t.frames!==undefined?t.frames:new i.TubeGeometry.FrenetFrames(u,l,false);g=new i.Vector3;y=new i.Vector3;x=new i.Vector3}if(!s){o=0;n=0;a=0}var _,b,w;var M=this;var T=[];var S=this.vertices.length;var E=e.extractPoints(h);var A=E.shape;var C=E.holes;var L=!i.Shape.Utils.isClockWise(A);if(L){A=A.reverse();for(b=0,w=C.length;b<w;b++){_=C[b];if(i.Shape.Utils.isClockWise(_)){C[b]=_.reverse()}}L=false}var R=i.Shape.Utils.triangulateShape(A,C);var P=A;for(b=0,w=C.length;b<w;b++){_=C[b];A=A.concat(_)}function D(e,t,r){if(!t)console.log("die");return t.clone().multiplyScalar(r).add(e)}var F,U,k,B,V,N=A.length,O,z=R.length,I,j=P.length;var G=180/Math.PI;function H(e,t,r){var n=1e-10;var a,o,s=1;var h=e.x-t.x,l=e.y-t.y;var u=r.x-e.x,f=r.y-e.y;var c=h*h+l*l;var d=h*f-l*u;if(Math.abs(d)>n){var p=Math.sqrt(c);var m=Math.sqrt(u*u+f*f);var v=t.x-l/p;var g=t.y+h/p;var y=r.x-f/m;var x=r.y+u/m;var _=((y-v)*f-(x-g)*u)/(h*f-l*u);a=v+h*_-e.x;o=g+l*_-e.y;var b=a*a+o*o;if(b<=2){return new i.Vector2(a,o)}else{s=Math.sqrt(b/2)}}else{var w=false;if(h>n){if(u>n){w=true}}else{if(h<-n){if(u<-n){w=true}}else{if(Math.sign(l)==Math.sign(f)){w=true}}}if(w){a=-l;o=h;s=Math.sqrt(c)}else{a=h;o=l;s=Math.sqrt(c/2)}}return new i.Vector2(a/s,o/s)}var W=[];for(var X=0,Y=P.length,q=Y-1,K=X+1;X<Y;X++,q++,K++){if(q===Y)q=0;if(K===Y)K=0;var Z=P[X];var Q=P[q];var J=P[K];W[X]=H(P[X],P[q],P[K])}var $=[],et,tt=W.concat();for(b=0,w=C.length;b<w;b++){_=C[b];et=[];for(X=0,Y=_.length,q=Y-1,K=X+1;X<Y;X++,q++,K++){if(q===Y)q=0;if(K===Y)K=0;et[X]=H(_[X],_[q],_[K])}$.push(et);tt=tt.concat(et)}for(F=0;F<o;F++){k=F/o;B=n*(1-k);U=a*Math.sin(k*Math.PI/2);for(X=0,Y=P.length;X<Y;X++){V=D(P[X],W[X],U);ot(V.x,V.y,-B)}for(b=0,w=C.length;b<w;b++){_=C[b];et=$[b];for(X=0,Y=_.length;X<Y;X++){V=D(_[X],et[X],U);ot(V.x,V.y,-B)}}}U=a;for(X=0;X<N;X++){V=s?D(A[X],tt[X],U):A[X];if(!c){ot(V.x,V.y,0)}else{y.copy(v.normals[0]).multiplyScalar(V.x);g.copy(v.binormals[0]).multiplyScalar(V.y);x.copy(f[0]).add(y).add(g);ot(x.x,x.y,x.z)}}var rt;for(rt=1;rt<=l;rt++){for(X=0;X<N;X++){V=s?D(A[X],tt[X],U):A[X];if(!c){ot(V.x,V.y,r/l*rt)}else{y.copy(v.normals[rt]).multiplyScalar(V.x);g.copy(v.binormals[rt]).multiplyScalar(V.y);x.copy(f[rt]).add(y).add(g);ot(x.x,x.y,x.z)}}}for(F=o-1;F>=0;F--){k=F/o;B=n*(1-k);U=a*Math.sin(k*Math.PI/2);for(X=0,Y=P.length;X<Y;X++){V=D(P[X],W[X],U);ot(V.x,V.y,r+B)}for(b=0,w=C.length;b<w;b++){_=C[b];et=$[b];for(X=0,Y=_.length;X<Y;X++){V=D(_[X],et[X],U);if(!c){ot(V.x,V.y,r+B)}else{ot(V.x,V.y+f[l-1].y,f[l-1].x+B)}}}}it();nt();function it(){if(s){var e=0;var t=N*e;for(X=0;X<z;X++){O=R[X];st(O[2]+t,O[1]+t,O[0]+t)}e=l+o*2;t=N*e;for(X=0;X<z;X++){O=R[X];st(O[0]+t,O[1]+t,O[2]+t)}}else{for(X=0;X<z;X++){O=R[X];st(O[2],O[1],O[0])}for(X=0;X<z;X++){O=R[X];st(O[0]+N*l,O[1]+N*l,O[2]+N*l)}}}function nt(){var e=0;at(P,e);e+=P.length;for(b=0,w=C.length;b<w;b++){_=C[b];at(_,e);e+=_.length}}function at(e,t){var r,i;X=e.length;while(--X>=0){r=X;i=X-1;if(i<0)i=e.length-1;var n=0,a=l+o*2;for(n=0;n<a;n++){var s=N*n;var h=N*(n+1);var u=t+r+s,f=t+i+s,c=t+i+h,d=t+r+h;ht(u,f,c,d,e,n,a,r,i)}}}function ot(e,t,r){M.vertices.push(new i.Vector3(e,t,r))}function st(e,t,r){e+=S;t+=S;r+=S;M.faces.push(new i.Face3(e,t,r,null,null,d));var n=m.generateTopUV(M,e,t,r);M.faceVertexUvs[0].push(n)}function ht(e,t,r,n,a,o,s,h,l){e+=S;t+=S;r+=S;n+=S;M.faces.push(new i.Face3(e,t,n,null,null,p));M.faces.push(new i.Face3(t,r,n,null,null,p));var u=m.generateSideWallUV(M,e,t,r,n);M.faceVertexUvs[0].push([u[0],u[1],u[3]]);M.faceVertexUvs[0].push([u[1],u[2],u[3]])}};i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){var a=e.vertices;var o=a[t];var s=a[r];var h=a[n];return[new i.Vector2(o.x,o.y),new i.Vector2(s.x,s.y),new i.Vector2(h.x,h.y)]},generateSideWallUV:function(e,t,r,n,a){var o=e.vertices;var s=o[t];var h=o[r];var l=o[n];var u=o[a];if(Math.abs(s.y-h.y)<.01){return[new i.Vector2(s.x,1-s.z),new i.Vector2(h.x,1-h.z),new i.Vector2(l.x,1-l.z),new i.Vector2(u.x,1-u.z)]}else{return[new i.Vector2(s.y,1-s.z),new i.Vector2(h.y,1-h.z),new i.Vector2(l.y,1-l.z),new i.Vector2(u.y,1-u.z)]}}};i.ShapeGeometry=function(e,t){i.Geometry.call(this);this.type="ShapeGeometry";if(e instanceof Array===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype);i.ShapeGeometry.prototype.constructor=i.ShapeGeometry;i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++){this.addShape(e[r],t)}return this};i.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var r=t.curveSegments!==undefined?t.curveSegments:12;var n=t.material;var a=t.UVGenerator===undefined?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var o,s,h,l;var u=this.vertices.length;var f=e.extractPoints(r);var c=f.shape;var d=f.holes;var p=!i.Shape.Utils.isClockWise(c);if(p){c=c.reverse();for(o=0,s=d.length;o<s;o++){h=d[o];if(i.Shape.Utils.isClockWise(h)){d[o]=h.reverse()}}p=false}var m=i.Shape.Utils.triangulateShape(c,d);var v=c;for(o=0,s=d.length;o<s;o++){h=d[o];c=c.concat(h)}var g,y=c.length;var x,_=m.length;var b,w=v.length;for(o=0;o<y;o++){g=c[o];this.vertices.push(new i.Vector3(g.x,g.y,0))}for(o=0;o<_;o++){x=m[o];var M=x[0]+u;var T=x[1]+u;var S=x[2]+u;this.faces.push(new i.Face3(M,T,S,null,null,n));this.faceVertexUvs[0].push(a.generateTopUV(this,M,T,S))}};i.LatheGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:n};t=t||12;r=r||0;n=n||2*Math.PI;var a=1/(e.length-1);var o=1/t;for(var s=0,h=t;s<=h;s++){var l=r+s*o*n;var u=Math.cos(l),f=Math.sin(l);for(var c=0,d=e.length;c<d;c++){var p=e[c];var m=new i.Vector3;m.x=u*p.x-f*p.y;m.y=f*p.x+u*p.y;m.z=p.z;this.vertices.push(m)}}var v=e.length;for(var s=0,h=t;s<h;s++){for(var c=0,d=e.length-1;c<d;c++){var g=c+v*s;var y=g;var x=g+v;var u=g+1+v;var _=g+1;var b=s*o;var w=c*a;var M=b+o;var T=w+a;this.faces.push(new i.Face3(y,x,_));this.faceVertexUvs[0].push([new i.Vector2(b,w),new i.Vector2(M,w),new i.Vector2(b,T)]);this.faces.push(new i.Face3(x,u,_));this.faceVertexUvs[0].push([new i.Vector2(M,w),new i.Vector2(M,T),new i.Vector2(b,T)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};i.LatheGeometry.prototype=Object.create(i.Geometry.prototype);i.LatheGeometry.prototype.constructor=i.LatheGeometry;i.PlaneGeometry=function(e,t,r,n){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");i.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};this.fromBufferGeometry(new i.PlaneBufferGeometry(e,t,r,n))};i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype);i.PlaneGeometry.prototype.constructor=i.PlaneGeometry;i.PlaneBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var a=e/2;var o=t/2;var s=r||1;var h=n||1;var l=s+1;var u=h+1;var f=e/s;var c=t/h;var d=new Float32Array(l*u*3);var p=new Float32Array(l*u*3);var m=new Float32Array(l*u*2);var v=0;var g=0;for(var y=0;y<u;y++){var x=y*c-o;for(var _=0;_<l;_++){var b=_*f-a;d[v]=b;d[v+1]=-x;p[v+2]=1;m[g]=_/s;m[g+1]=1-y/h;v+=3;g+=2}}v=0;var w=new(d.length/3>65535?Uint32Array:Uint16Array)(s*h*6);for(var y=0;y<h;y++){for(var _=0;_<s;_++){var M=_+l*y;var T=_+l*(y+1);var S=_+1+l*(y+1);var E=_+1+l*y;w[v]=M;w[v+1]=T;w[v+2]=E;w[v+3]=T;w[v+4]=S;w[v+5]=E;v+=6}}this.addAttribute("index",new i.BufferAttribute(w,1));this.addAttribute("position",new i.BufferAttribute(d,3));this.addAttribute("normal",new i.BufferAttribute(p,3));this.addAttribute("uv",new i.BufferAttribute(m,2))};i.PlaneBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype);i.PlaneBufferGeometry.prototype.constructor=i.PlaneBufferGeometry;i.RingGeometry=function(e,t,r,n,a,o){i.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:a,thetaLength:o};e=e||0;t=t||50;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI*2;r=r!==undefined?Math.max(3,r):8;n=n!==undefined?Math.max(1,n):8;var s,h,l=[],u=e,f=(t-e)/n;for(s=0;s<n+1;s++){for(h=0;h<r+1;h++){var c=new i.Vector3;var d=a+h/r*o;c.x=u*Math.cos(d);c.y=u*Math.sin(d);this.vertices.push(c);l.push(new i.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}u+=f}var p=new i.Vector3(0,0,1);for(s=0;s<n;s++){var m=s*(r+1);for(h=0;h<r;h++){var d=h+m;var v=d;var g=d+r+1;var y=d+r+2;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()]);v=d;g=d+r+2;y=d+1;this.faces.push(new i.Face3(v,g,y,[p.clone(),p.clone(),p.clone()]));this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()])}}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,u)};i.RingGeometry.prototype=Object.create(i.Geometry.prototype);i.RingGeometry.prototype.constructor=i.RingGeometry;i.SphereGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:a,thetaStart:o,thetaLength:s};e=e||50;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;o=o!==undefined?o:0;s=s!==undefined?s:Math.PI;var h,l,u=[],f=[];for(l=0;l<=r;l++){var c=[];var d=[];for(h=0;h<=t;h++){var p=h/t;var m=l/r;var v=new i.Vector3;v.x=-e*Math.cos(n+p*a)*Math.sin(o+m*s);v.y=e*Math.cos(o+m*s);v.z=e*Math.sin(n+p*a)*Math.sin(o+m*s);this.vertices.push(v);c.push(this.vertices.length-1);d.push(new i.Vector2(p,1-m))}u.push(c);f.push(d)}for(l=0;l<r;l++){for(h=0;h<t;h++){var g=u[l][h+1];var y=u[l][h];var x=u[l+1][h];var _=u[l+1][h+1];var b=this.vertices[g].clone().normalize();var w=this.vertices[y].clone().normalize();var M=this.vertices[x].clone().normalize();var T=this.vertices[_].clone().normalize();var S=f[l][h+1].clone();var E=f[l][h].clone();var A=f[l+1][h].clone();var C=f[l+1][h+1].clone();if(Math.abs(this.vertices[g].y)===e){S.x=(S.x+E.x)/2;this.faces.push(new i.Face3(g,x,_,[b,M,T]));this.faceVertexUvs[0].push([S,A,C])}else if(Math.abs(this.vertices[x].y)===e){A.x=(A.x+C.x)/2;this.faces.push(new i.Face3(g,y,x,[b,w,M]));this.faceVertexUvs[0].push([S,E,A])}else{this.faces.push(new i.Face3(g,y,_,[b,w,T]));this.faceVertexUvs[0].push([S,E,C]);this.faces.push(new i.Face3(y,x,_,[w.clone(),M,T.clone()]));this.faceVertexUvs[0].push([E.clone(),A,C.clone()])}}}this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.SphereGeometry.prototype=Object.create(i.Geometry.prototype);i.SphereGeometry.prototype.constructor=i.SphereGeometry;i.TextGeometry=function(e,t){t=t||{};var r=i.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;i.ExtrudeGeometry.call(this,r,t);this.type="TextGeometry"};i.TextGeometry.prototype=Object.create(i.ExtrudeGeometry.prototype);i.TextGeometry.prototype.constructor=i.TextGeometry;i.TorusGeometry=function(e,t,r,n,a){i.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:a};e=e||100;t=t||40;r=r||8;n=n||6;a=a||Math.PI*2;var o=new i.Vector3,s=[],h=[];for(var l=0;l<=r;l++){for(var u=0;u<=n;u++){var f=u/n*a;var c=l/r*Math.PI*2;o.x=e*Math.cos(f);o.y=e*Math.sin(f);var d=new i.Vector3;d.x=(e+t*Math.cos(c))*Math.cos(f);d.y=(e+t*Math.cos(c))*Math.sin(f);d.z=t*Math.sin(c);this.vertices.push(d);s.push(new i.Vector2(u/n,l/r));h.push(d.clone().sub(o).normalize())}}for(var l=1;l<=r;l++){for(var u=1;u<=n;u++){var p=(n+1)*l+u-1;var m=(n+1)*(l-1)+u-1;var v=(n+1)*(l-1)+u;var g=(n+1)*l+u;var y=new i.Face3(p,m,g,[h[p].clone(),h[m].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()]);y=new i.Face3(m,v,g,[h[m].clone(),h[v].clone(),h[g].clone()]);this.faces.push(y);this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}}this.computeFaceNormals()};i.TorusGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusGeometry.prototype.constructor=i.TorusGeometry;i.TorusKnotGeometry=function(e,t,r,n,a,o,s){i.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:a,q:o,heightScale:s};e=e||100;t=t||40;r=r||64;n=n||8;a=a||2;o=o||3;s=s||1;var h=new Array(r);var l=new i.Vector3;var u=new i.Vector3;var f=new i.Vector3;for(var c=0;c<r;++c){h[c]=new Array(n);var d=c/r*2*a*Math.PI;var p=P(d,o,a,e,s);var m=P(d+.01,o,a,e,s);l.subVectors(m,p);u.addVectors(m,p);f.crossVectors(l,u);u.crossVectors(f,l);f.normalize();u.normalize();for(var v=0;v<n;++v){var g=v/n*2*Math.PI;var y=-t*Math.cos(g);var x=t*Math.sin(g);var _=new i.Vector3;_.x=p.x+y*u.x+x*f.x;_.y=p.y+y*u.y+x*f.y;_.z=p.z+y*u.z+x*f.z;h[c][v]=this.vertices.push(_)-1}}for(var c=0;c<r;++c){for(var v=0;v<n;++v){var b=(c+1)%r;var w=(v+1)%n;var M=h[c][v];var T=h[b][v];var S=h[b][w];var E=h[c][w];var A=new i.Vector2(c/r,v/n);var C=new i.Vector2((c+1)/r,v/n);var L=new i.Vector2((c+1)/r,(v+1)/n);var R=new i.Vector2(c/r,(v+1)/n);this.faces.push(new i.Face3(M,T,E));this.faceVertexUvs[0].push([A,C,R]);this.faces.push(new i.Face3(T,S,E));this.faceVertexUvs[0].push([C.clone(),L,R.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function P(e,t,r,n,a){var o=Math.cos(e);var s=Math.sin(e);var h=t/r*e;var l=Math.cos(h);var u=n*(2+l)*.5*o;var f=n*(2+l)*s*.5;var c=a*n*Math.sin(h)*.5;return new i.Vector3(u,f,c)}};i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusKnotGeometry.prototype.constructor=i.TorusKnotGeometry;i.TubeGeometry=function(e,t,r,n,a){i.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:a};t=t||64;r=r||1;n=n||8;a=a||false;var o=[];var s=this,h,l,u,f=t+1,c,d,p,m,v,g,y,x,_,b,w,M=new i.Vector3,T,S,E,A,C,L,R,P,D,F,U,k;var B=new i.TubeGeometry.FrenetFrames(e,t,a),V=B.tangents,N=B.normals,O=B.binormals;this.tangents=V;this.normals=N;this.binormals=O;function z(e,t,r){return s.vertices.push(new i.Vector3(e,t,r))-1}for(T=0;T<f;T++){o[T]=[];y=T/(f-1);w=e.getPointAt(y);h=V[T];l=N[T];u=O[T];for(S=0;S<n;S++){x=S/n*2*Math.PI;_=-r*Math.cos(x);b=r*Math.sin(x);
M.copy(w);M.x+=_*l.x+b*u.x;M.y+=_*l.y+b*u.y;M.z+=_*l.z+b*u.z;o[T][S]=z(M.x,M.y,M.z)}}for(T=0;T<t;T++){for(S=0;S<n;S++){E=a?(T+1)%t:T+1;A=(S+1)%n;C=o[T][S];L=o[E][S];R=o[E][A];P=o[T][A];D=new i.Vector2(T/t,S/n);F=new i.Vector2((T+1)/t,S/n);U=new i.Vector2((T+1)/t,(S+1)/n);k=new i.Vector2(T/t,(S+1)/n);this.faces.push(new i.Face3(C,L,P));this.faceVertexUvs[0].push([D,F,k]);this.faces.push(new i.Face3(L,R,P));this.faceVertexUvs[0].push([F.clone(),U,k.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.TubeGeometry.prototype=Object.create(i.Geometry.prototype);i.TubeGeometry.prototype.constructor=i.TubeGeometry;i.TubeGeometry.FrenetFrames=function(e,t,r){var n=new i.Vector3,a=new i.Vector3,o=new i.Vector3,s=[],h=[],l=[],u=new i.Vector3,f=new i.Matrix4,c=t+1,d,p=1e-4,m,v,g,y,x,_,b;this.tangents=s;this.normals=h;this.binormals=l;for(x=0;x<c;x++){_=x/(c-1);s[x]=e.getTangentAt(_);s[x].normalize()}w();function w(){h[0]=new i.Vector3;l[0]=new i.Vector3;m=Number.MAX_VALUE;v=Math.abs(s[0].x);g=Math.abs(s[0].y);y=Math.abs(s[0].z);if(v<=m){m=v;a.set(1,0,0)}if(g<=m){m=g;a.set(0,1,0)}if(y<=m){a.set(0,0,1)}u.crossVectors(s[0],a).normalize();h[0].crossVectors(s[0],u);l[0].crossVectors(s[0],h[0])}for(x=1;x<c;x++){h[x]=h[x-1].clone();l[x]=l[x-1].clone();u.crossVectors(s[x-1],s[x]);if(u.length()>p){u.normalize();d=Math.acos(i.Math.clamp(s[x-1].dot(s[x]),-1,1));h[x].applyMatrix4(f.makeRotationAxis(u,d))}l[x].crossVectors(s[x],h[x])}if(r){d=Math.acos(i.Math.clamp(h[0].dot(h[c-1]),-1,1));d/=c-1;if(s[0].dot(u.crossVectors(h[0],h[c-1]))>0){d=-d}for(x=1;x<c;x++){h[x].applyMatrix4(f.makeRotationAxis(s[x],d*x));l[x].crossVectors(s[x],h[x])}}};i.PolyhedronGeometry=function(e,t,r,n){i.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:r,detail:n};r=r||1;n=n||0;var a=this;for(var o=0,s=e.length;o<s;o+=3){w(new i.Vector3(e[o],e[o+1],e[o+2]))}var h=[],l=this.vertices;var u=[];for(var o=0,f=0,s=t.length;o<s;o+=3,f++){var c=l[t[o]];var d=l[t[o+1]];var p=l[t[o+2]];u[f]=new i.Face3(c.index,d.index,p.index,[c.clone(),d.clone(),p.clone()])}var m=new i.Vector3;for(var o=0,s=u.length;o<s;o++){T(u[o],n)}for(var o=0,s=this.faceVertexUvs[0].length;o<s;o++){var v=this.faceVertexUvs[0][o];var g=v[0].x;var y=v[1].x;var x=v[2].x;var _=Math.max(g,Math.max(y,x));var b=Math.min(g,Math.min(y,x));if(_>.9&&b<.1){if(g<.2)v[0].x+=1;if(y<.2)v[1].x+=1;if(x<.2)v[2].x+=1}}for(var o=0,s=this.vertices.length;o<s;o++){this.vertices[o].multiplyScalar(r)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,r);function w(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var r=S(e)/2/Math.PI+.5;var n=E(e)/Math.PI+.5;t.uv=new i.Vector2(r,1-n);return t}function M(e,t,r){var n=new i.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);a.faces.push(n);m.copy(e).add(t).add(r).divideScalar(3);var o=S(m);a.faceVertexUvs[0].push([A(e.uv,e,o),A(t.uv,t,o),A(r.uv,r,o)])}function T(e,t){var r=Math.pow(2,t);var i=Math.pow(4,t);var n=w(a.vertices[e.a]);var o=w(a.vertices[e.b]);var s=w(a.vertices[e.c]);var h=[];for(var l=0;l<=r;l++){h[l]=[];var u=w(n.clone().lerp(s,l/r));var f=w(o.clone().lerp(s,l/r));var c=r-l;for(var d=0;d<=c;d++){if(d==0&&l==r){h[l][d]=u}else{h[l][d]=w(u.clone().lerp(f,d/c))}}}for(var l=0;l<r;l++){for(var d=0;d<2*(r-l)-1;d++){var p=Math.floor(d/2);if(d%2==0){M(h[l][p+1],h[l+1][p],h[l][p])}else{M(h[l][p+1],h[l+1][p+1],h[l+1][p])}}}}function S(e){return Math.atan2(e.z,-e.x)}function E(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function A(e,t,r){if(r<0&&e.x===1)e=new i.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new i.Vector2(r/2/Math.PI+.5,e.y);return e.clone()}};i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype);i.PolyhedronGeometry.prototype.constructor=i.PolyhedronGeometry;i.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2;var n=1/r;var a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];var o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];i.PolyhedronGeometry.call(this,a,o,e,t)};i.DodecahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.DodecahedronGeometry.prototype.constructor=i.DodecahedronGeometry;i.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;var n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];var a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];i.PolyhedronGeometry.call(this,n,a,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};i.IcosahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.IcosahedronGeometry.prototype.constructor=i.IcosahedronGeometry;i.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};i.OctahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.OctahedronGeometry.prototype.constructor=i.OctahedronGeometry;i.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var n=[2,1,0,0,3,2,1,3,0,2,3,1];i.PolyhedronGeometry.call(this,r,n,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};i.TetrahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.TetrahedronGeometry.prototype.constructor=i.TetrahedronGeometry;i.ParametricGeometry=function(e,t,r){i.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:r};var n=this.vertices;var a=this.faces;var o=this.faceVertexUvs[0];var s,h,l,u;var f,c;var d=r+1;var p=t+1;for(s=0;s<=r;s++){c=s/r;for(l=0;l<=t;l++){f=l/t;u=e(f,c);n.push(u)}}var m,v,g,y;var x,_,b,w;for(s=0;s<r;s++){for(l=0;l<t;l++){m=s*p+l;v=s*p+l+1;g=(s+1)*p+l+1;y=(s+1)*p+l;x=new i.Vector2(l/t,s/r);_=new i.Vector2((l+1)/t,s/r);b=new i.Vector2((l+1)/t,(s+1)/r);w=new i.Vector2(l/t,(s+1)/r);a.push(new i.Face3(m,v,y));o.push([x,_,w]);a.push(new i.Face3(v,g,y));o.push([_.clone(),b,w.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype);i.ParametricGeometry.prototype.constructor=i.ParametricGeometry;i.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var n=new i.BufferGeometry;n.addAttribute("position",new i.BufferAttribute(t,3));n.addAttribute("color",new i.BufferAttribute(r,3));var a=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.Line.call(this,n,a,i.LinePieces)};i.AxisHelper.prototype=Object.create(i.Line.prototype);i.AxisHelper.prototype.constructor=i.AxisHelper;i.ArrowHelper=function(){var e=new i.Geometry;e.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));var t=new i.CylinderGeometry(0,.5,1,5,1);t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0));return function(r,n,a,o,s,h){i.Object3D.call(this);if(o===undefined)o=16776960;if(a===undefined)a=1;if(s===undefined)s=.2*a;if(h===undefined)h=.2*s;this.position.copy(n);this.line=new i.Line(e,new i.LineBasicMaterial({color:o}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new i.Mesh(t,new i.MeshBasicMaterial({color:o}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(r);this.setLength(a,s,h)}}();i.ArrowHelper.prototype=Object.create(i.Object3D.prototype);i.ArrowHelper.prototype.constructor=i.ArrowHelper;i.ArrowHelper.prototype.setDirection=function(){var e=new i.Vector3;var t;return function(r){if(r.y>.99999){this.quaternion.set(0,0,0,1)}else if(r.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(r.z,0,-r.x).normalize();t=Math.acos(r.y);this.quaternion.setFromAxisAngle(e,t)}}}();i.ArrowHelper.prototype.setLength=function(e,t,r){if(t===undefined)t=.2*e;if(r===undefined)r=.2*t;this.line.scale.set(1,e-t,1);this.line.updateMatrix();this.cone.scale.set(r,t,r);this.cone.position.y=e;this.cone.updateMatrix()};i.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e);this.cone.material.color.set(e)};i.BoxHelper=function(e){var t=new i.BufferGeometry;t.addAttribute("position",new i.BufferAttribute(new Float32Array(72),3));i.Line.call(this,t,new i.LineBasicMaterial({color:16776960}),i.LinePieces);if(e!==undefined){this.update(e)}};i.BoxHelper.prototype=Object.create(i.Line.prototype);i.BoxHelper.prototype.constructor=i.BoxHelper;i.BoxHelper.prototype.update=function(e){var t=e.geometry;if(t.boundingBox===null){t.computeBoundingBox()}var r=t.boundingBox.min;var i=t.boundingBox.max;var n=this.geometry.attributes.position.array;n[0]=i.x;n[1]=i.y;n[2]=i.z;n[3]=r.x;n[4]=i.y;n[5]=i.z;n[6]=r.x;n[7]=i.y;n[8]=i.z;n[9]=r.x;n[10]=r.y;n[11]=i.z;n[12]=r.x;n[13]=r.y;n[14]=i.z;n[15]=i.x;n[16]=r.y;n[17]=i.z;n[18]=i.x;n[19]=r.y;n[20]=i.z;n[21]=i.x;n[22]=i.y;n[23]=i.z;n[24]=i.x;n[25]=i.y;n[26]=r.z;n[27]=r.x;n[28]=i.y;n[29]=r.z;n[30]=r.x;n[31]=i.y;n[32]=r.z;n[33]=r.x;n[34]=r.y;n[35]=r.z;n[36]=r.x;n[37]=r.y;n[38]=r.z;n[39]=i.x;n[40]=r.y;n[41]=r.z;n[42]=i.x;n[43]=r.y;n[44]=r.z;n[45]=i.x;n[46]=i.y;n[47]=r.z;n[48]=i.x;n[49]=i.y;n[50]=i.z;n[51]=i.x;n[52]=i.y;n[53]=r.z;n[54]=r.x;n[55]=i.y;n[56]=i.z;n[57]=r.x;n[58]=i.y;n[59]=r.z;n[60]=r.x;n[61]=r.y;n[62]=i.z;n[63]=r.x;n[64]=r.y;n[65]=r.z;n[66]=i.x;n[67]=r.y;n[68]=i.z;n[69]=i.x;n[70]=r.y;n[71]=r.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.BoundingBoxHelper=function(e,t){var r=t!==undefined?t:8947848;this.object=e;this.box=new i.Box3;i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:r,wireframe:true}))};i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype);i.BoundingBoxHelper.prototype.constructor=i.BoundingBoxHelper;i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};i.CameraHelper=function(e){var t=new i.Geometry;var r=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors});var n={};var a=16755200;var o=16711680;var s=43775;var h=16777215;var l=3355443;u("n1","n2",a);u("n2","n4",a);u("n4","n3",a);u("n3","n1",a);u("f1","f2",a);u("f2","f4",a);u("f4","f3",a);u("f3","f1",a);u("n1","f1",a);u("n2","f2",a);u("n3","f3",a);u("n4","f4",a);u("p","n1",o);u("p","n2",o);u("p","n3",o);u("p","n4",o);u("u1","u2",s);u("u2","u3",s);u("u3","u1",s);u("c","t",h);u("p","c",l);u("cn1","cn2",l);u("cn3","cn4",l);u("cf1","cf2",l);u("cf3","cf4",l);function u(e,t,r){f(e,r);f(t,r)}function f(e,r){t.vertices.push(new i.Vector3);t.colors.push(new i.Color(r));if(n[e]===undefined){n[e]=[]}n[e].push(t.vertices.length-1)}i.Line.call(this,t,r,i.LinePieces);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=n;this.update()};i.CameraHelper.prototype=Object.create(i.Line.prototype);i.CameraHelper.prototype.constructor=i.CameraHelper;i.CameraHelper.prototype.update=function(){var e,t;var r=new i.Vector3;var n=new i.Camera;var a=function(i,a,o,s){r.set(a,o,s).unproject(n);var h=t[i];if(h!==undefined){for(var l=0,u=h.length;l<u;l++){e.vertices[h[l]].copy(r)}}};return function(){e=this.geometry;t=this.pointMap;var r=1,i=1;n.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-r,-i,-1);a("n2",r,-i,-1);a("n3",-r,i,-1);a("n4",r,i,-1);a("f1",-r,-i,1);a("f2",r,-i,1);a("f3",-r,i,1);a("f4",r,i,1);a("u1",r*.7,i*1.1,-1);a("u2",-r*.7,i*1.1,-1);a("u3",0,i*2,-1);a("cf1",-r,0,1);a("cf2",r,0,1);a("cf3",0,-i,1);a("cf4",0,i,1);a("cn1",-r,0,-1);a("cn2",r,0,-1);a("cn3",0,-i,-1);a("cn4",0,i,-1);e.verticesNeedUpdate=true}}();i.DirectionalLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var r=new i.Geometry;r.vertices.push(new i.Vector3(-t,t,0),new i.Vector3(t,t,0),new i.Vector3(t,-t,0),new i.Vector3(-t,-t,0),new i.Vector3(-t,t,0));var n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new i.Line(r,n);this.add(this.lightPlane);r=new i.Geometry;r.vertices.push(new i.Vector3,new i.Vector3);n=new i.LineBasicMaterial({fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new i.Line(r,n);this.add(this.targetLine);this.update()};i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype);i.DirectionalLightHelper.prototype.constructor=i.DirectionalLightHelper;i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var r=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);r.subVectors(t,e);this.lightPlane.lookAt(r);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(r);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();i.EdgesHelper=function(e,t){var r=t!==undefined?t:16777215;var n=[0,0],a={};var o=function(e,t){return e-t};var s=["a","b","c"];var h=new i.BufferGeometry;var l=e.geometry.clone();l.mergeVertices();l.computeFaceNormals();var u=l.vertices;var f=l.faces;var c=0;for(var d=0,p=f.length;d<p;d++){var m=f[d];for(var v=0;v<3;v++){n[0]=m[s[v]];n[1]=m[s[(v+1)%3]];n.sort(o);var g=n.toString();if(a[g]===undefined){a[g]={vert1:n[0],vert2:n[1],face1:d,face2:undefined};c++}else{a[g].face2=d}}}var y=new Float32Array(c*2*3);var x=0;for(var g in a){var _=a[g];if(_.face2===undefined||f[_.face1].normal.dot(f[_.face2].normal)<.9999){var b=u[_.vert1];y[x++]=b.x;y[x++]=b.y;y[x++]=b.z;b=u[_.vert2];y[x++]=b.x;y[x++]=b.y;y[x++]=b.z}}h.addAttribute("position",new i.BufferAttribute(y,3));i.Line.call(this,h,new i.LineBasicMaterial({color:r}),i.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.EdgesHelper.prototype=Object.create(i.Line.prototype);i.EdgesHelper.prototype.constructor=i.EdgesHelper;i.FaceNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16776960;var o=n!==undefined?n:1;var s=new i.Geometry;var h=this.object.geometry.faces;for(var l=0,u=h.length;l<u;l++){s.vertices.push(new i.Vector3,new i.Vector3)}i.Line.call(this,s,new i.LineBasicMaterial({color:a,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new i.Matrix3;this.update()};i.FaceNormalsHelper.prototype=Object.create(i.Line.prototype);i.FaceNormalsHelper.prototype.constructor=i.FaceNormalsHelper;i.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices;var t=this.object;var r=t.geometry.vertices;var i=t.geometry.faces;var n=t.matrixWorld;t.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(n);for(var a=0,o=0,s=i.length;a<s;a++,o+=2){var h=i[a];e[o].copy(r[h.a]).add(r[h.b]).add(r[h.c]).divideScalar(3).applyMatrix4(n);e[o+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}this.geometry.verticesNeedUpdate=true;return this};i.GridHelper=function(e,t){var r=new i.Geometry;var n=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924);this.color2=new i.Color(8947848);for(var a=-e;a<=e;a+=t){r.vertices.push(new i.Vector3(-e,0,a),new i.Vector3(e,0,a),new i.Vector3(a,0,-e),new i.Vector3(a,0,e));var o=a===0?this.color1:this.color2;r.colors.push(o,o,o,o)}i.Line.call(this,r,n,i.LinePieces)};i.GridHelper.prototype=Object.create(i.Line.prototype);i.GridHelper.prototype.constructor=i.GridHelper;i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};i.HemisphereLightHelper=function(e,t,r,n){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new i.Color,new i.Color];var a=new i.SphereGeometry(t,4,2);a.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));for(var o=0,s=8;o<s;o++){a.faces[o].color=this.colors[o<4?0:1]}var h=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:true});this.lightSphere=new i.Mesh(a,h);this.add(this.lightSphere);this.update()};i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype);i.HemisphereLightHelper.prototype.constructor=i.HemisphereLightHelper;i.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();i.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var r=new i.SphereGeometry(t,4,2);var n=new i.MeshBasicMaterial({wireframe:true,fog:false});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);i.Mesh.call(this,r,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};i.PointLightHelper.prototype=Object.create(i.Mesh.prototype);i.PointLightHelper.prototype.constructor=i.PointLightHelper;i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};i.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new i.Geometry;for(var r=0;r<this.bones.length;r++){var n=this.bones[r];if(n.parent instanceof i.Bone){t.vertices.push(new i.Vector3);t.vertices.push(new i.Vector3);t.colors.push(new i.Color(0,0,1));t.colors.push(new i.Color(0,1,0))}}var a=new i.LineBasicMaterial({vertexColors:i.VertexColors,depthTest:false,depthWrite:false,transparent:true});i.Line.call(this,t,a,i.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};i.SkeletonHelper.prototype=Object.create(i.Line.prototype);i.SkeletonHelper.prototype.constructor=i.SkeletonHelper;i.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof i.Bone){t.push(e)}for(var r=0;r<e.children.length;r++){t.push.apply(t,this.getBoneList(e.children[r]))}return t};i.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new i.Matrix4).getInverse(this.root.matrixWorld);var r=new i.Matrix4;var n=0;for(var a=0;a<this.bones.length;a++){var o=this.bones[a];if(o.parent instanceof i.Bone){r.multiplyMatrices(t,o.matrixWorld);e.vertices[n].setFromMatrixPosition(r);r.multiplyMatrices(t,o.parent.matrixWorld);e.vertices[n+1].setFromMatrixPosition(r);n+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};i.SpotLightHelper=function(e){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new i.CylinderGeometry(0,1,1,8,1,true);t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0));t.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));var r=new i.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new i.Mesh(t,r);this.add(this.cone);this.update()};i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype);i.SpotLightHelper.prototype.constructor=i.SpotLightHelper;i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4;var i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();i.VertexNormalsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:16711680;var o=n!==undefined?n:1;var s=new i.Geometry;var h=e.geometry.vertices;var l=e.geometry.faces;for(var u=0,f=l.length;u<f;u++){var c=l[u];for(var d=0,p=c.vertexNormals.length;d<p;d++){s.vertices.push(new i.Vector3,new i.Vector3)}}i.Line.call(this,s,new i.LineBasicMaterial({color:a,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new i.Matrix3;this.update()};i.VertexNormalsHelper.prototype=Object.create(i.Line.prototype);i.VertexNormalsHelper.prototype.constructor=i.VertexNormalsHelper;i.VertexNormalsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var i=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var f=0,c=u.vertexNormals.length;f<c;f++){var d=u[r[f]];var p=n[d];var m=u.vertexNormals[f];i[s].copy(p).applyMatrix4(o);t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);t.add(i[s]);s=s+1;i[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();i.VertexTangentsHelper=function(e,t,r,n){this.object=e;this.size=t!==undefined?t:1;var a=r!==undefined?r:255;var o=n!==undefined?n:1;var s=new i.Geometry;var h=e.geometry.vertices;var l=e.geometry.faces;for(var u=0,f=l.length;u<f;u++){var c=l[u];for(var d=0,p=c.vertexTangents.length;d<p;d++){s.vertices.push(new i.Vector3);s.vertices.push(new i.Vector3)}}i.Line.call(this,s,new i.LineBasicMaterial({color:a,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.update()};i.VertexTangentsHelper.prototype=Object.create(i.Line.prototype);i.VertexTangentsHelper.prototype.constructor=i.VertexTangentsHelper;i.VertexTangentsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(true);var i=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var f=0,c=u.vertexTangents.length;f<c;f++){var d=u[r[f]];var p=n[d];var m=u.vertexTangents[f];i[s].copy(p).applyMatrix4(o);t.copy(m).transformDirection(o).multiplyScalar(this.size);t.add(i[s]);s=s+1;i[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();i.WireframeHelper=function(e,t){var r=t!==undefined?t:16777215;var n=[0,0],a={};var o=function(e,t){return e-t};var s=["a","b","c"];var h=new i.BufferGeometry;if(e.geometry instanceof i.Geometry){var l=e.geometry.vertices;var u=e.geometry.faces;var f=0;var c=new Uint32Array(6*u.length);for(var d=0,p=u.length;d<p;d++){var m=u[d];for(var v=0;v<3;v++){n[0]=m[s[v]];n[1]=m[s[(v+1)%3]];n.sort(o);var g=n.toString();if(a[g]===undefined){c[2*f]=n[0];c[2*f+1]=n[1];a[g]=true;f++}}}var y=new Float32Array(f*2*3);for(var d=0,p=f;d<p;d++){for(var v=0;v<2;v++){var x=l[c[2*d+v]];var _=6*d+3*v;y[_+0]=x.x;y[_+1]=x.y;y[_+2]=x.z}}h.addAttribute("position",new i.BufferAttribute(y,3))}else if(e.geometry instanceof i.BufferGeometry){if(e.geometry.attributes.index!==undefined){var l=e.geometry.attributes.position.array;var b=e.geometry.attributes.index.array;var w=e.geometry.drawcalls;var f=0;if(w.length===0){w=[{count:b.length,index:0,start:0}]}var c=new Uint32Array(2*b.length);for(var M=0,T=w.length;M<T;++M){var S=w[M].start;var E=w[M].count;var _=w[M].index;for(var d=S,A=S+E;d<A;d+=3){for(var v=0;v<3;v++){n[0]=_+b[d+v];n[1]=_+b[d+(v+1)%3];n.sort(o);var g=n.toString();if(a[g]===undefined){c[2*f]=n[0];c[2*f+1]=n[1];a[g]=true;f++}}}}var y=new Float32Array(f*2*3);for(var d=0,p=f;d<p;d++){for(var v=0;v<2;v++){var _=6*d+3*v;var C=3*c[2*d+v];y[_+0]=l[C];y[_+1]=l[C+1];y[_+2]=l[C+2]}}h.addAttribute("position",new i.BufferAttribute(y,3))}else{var l=e.geometry.attributes.position.array;var f=l.length/3;var L=f/3;var y=new Float32Array(f*2*3);for(var d=0,p=L;d<p;d++){for(var v=0;v<3;v++){var _=18*d+6*v;var R=9*d+3*v;y[_+0]=l[R];y[_+1]=l[R+1];y[_+2]=l[R+2];var C=9*d+3*((v+1)%3);y[_+3]=l[C];y[_+4]=l[C+1];y[_+5]=l[C+2]}}h.addAttribute("position",new i.BufferAttribute(y,3))}}i.Line.call(this,h,new i.LineBasicMaterial({color:r}),i.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};i.WireframeHelper.prototype=Object.create(i.Line.prototype);i.WireframeHelper.prototype.constructor=i.WireframeHelper;i.ImmediateRenderObject=function(){i.Object3D.call(this);this.render=function(e){}};i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype);i.ImmediateRenderObject.prototype.constructor=i.ImmediateRenderObject;i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var r=this.geometry.morphTargets.length;var n="__default";var a=0;var o=r-1;var s=r/1;this.createAnimation(n,a,o,s);this.setAnimationWeight(n,1)};i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype);i.MorphBlendMesh.prototype.constructor=i.MorphBlendMesh;i.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=n;this.animationsList.push(n)};i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var r,i={};var n=this.geometry;for(var a=0,o=n.morphTargets.length;a<o;a++){var s=n.morphTargets[a];var h=s.name.match(t);if(h&&h.length>1){var l=h[1];var u=h[2];if(!i[l])i[l]={start:Infinity,end:-Infinity};var f=i[l];if(a<f.start)f.start=a;if(a>f.end)f.end=a;if(!r)r=l}}for(var l in i){var f=i[l];this.createAnimation(l,f.start,f.end,e)}this.firstAnimation=r};i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];if(r){r.fps=t;r.duration=(r.end-r.start)/r.fps}};i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];if(r){r.duration=t;r.fps=(r.end-r.start)/r.duration}};i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];if(r){r.weight=t}};i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];if(r){r.time=t}};i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var r=this.animationsMap[e];if(r){t=r.time}return t};i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var r=this.animationsMap[e];if(r){t=r.duration}return t};i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{console.warn("animation["+e+"] undefined")}};i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};i.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var n=this.animationsList[t];if(!n.active)continue;var a=n.duration/n.length;n.time+=n.direction*e;if(n.mirroredLoop){if(n.time>n.duration||n.time<0){n.direction*=-1;if(n.time>n.duration){n.time=n.duration;n.directionBackwards=true}if(n.time<0){n.time=0;n.directionBackwards=false}}}else{n.time=n.time%n.duration;if(n.time<0)n.time+=n.duration}var o=n.startFrame+i.Math.clamp(Math.floor(n.time/a),0,n.length-1);var s=n.weight;if(o!==n.currentFrame){this.morphTargetInfluences[n.lastFrame]=0;this.morphTargetInfluences[n.currentFrame]=1*s;this.morphTargetInfluences[o]=0;n.lastFrame=n.currentFrame;n.currentFrame=o}var h=n.time%a/a;if(n.directionBackwards)h=1-h;this.morphTargetInfluences[n.currentFrame]=h*s;this.morphTargetInfluences[n.lastFrame]=(1-h)*s}}},{}]},{},[1]);